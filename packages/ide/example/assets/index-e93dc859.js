var _l=Object.defineProperty,gl=Object.defineProperties;var bl=Object.getOwnPropertyDescriptors;var At=Object.getOwnPropertySymbols;var yl=Object.prototype.hasOwnProperty,kl=Object.prototype.propertyIsEnumerable;var lt=(u,e,t)=>e in u?_l(u,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):u[e]=t,z=(u,e)=>{for(var t in e||(e={}))yl.call(e,t)&&lt(u,t,e[t]);if(At)for(var t of At(e))kl.call(e,t)&&lt(u,t,e[t]);return u},ae=(u,e)=>gl(u,bl(e));var $=(u,e,t)=>(lt(u,typeof e!="symbol"?e+"":e,t),t);var O=(u,e,t)=>new Promise((l,n)=>{var a=o=>{try{r(t.next(o))}catch(p){n(p)}},i=o=>{try{r(t.throw(o))}catch(p){n(p)}},r=o=>o.done?l(o.value):Promise.resolve(o.value).then(a,i);r((t=t.apply(u,e)).next())});import{b as El,u as Vl}from"./vue-router-a9d75a6b.js";import{S as Cl,c as Sl,d as Nt,e as he,i as nt,a as ee,M as wl,K as xl,b as Se,g as jl,t as st,E as $l,f as qe,V as rt,h as ut,j as Rl,_ as Gt,L as Dl,p as Tl,D as Il,A as Al,k as Pt,v as Ot,l as Nl,m as Pl,n as Ol,o as Ll,q as Bl,r as Ul,s as Ml,w as Fl,x as Jl,y as Lt,z as qt,B as zl,C as Hl}from"./index-a8c85bae.js";import{s as ge,a as re,r as ue,l as W,x as Xe,y as Ze,n as ct,p as dt,i as yt,h as kt,g as Et,j as Wt,A as Vt,u as ve,B as pt,E as Ct,m as le,C as Yt,D as vt,F as J,G as Q,H as Gl,I as ql,J as Wl,K as Yl,k as ke,L as Kl,M as Xl,N as Zl,O as Ql,P as St,Q as Ie,w as en,v as tn,R as ln,S as nn,T as sn,U as an,c as on,V as rn,W as un,X as cn,z as dn,Y as pn,Z as Be,_ as vn}from"./element-plus-32a3cd1a.js";import{E as wt,e as k,m as R,I as N,o as c,c as V,a as T,a3 as Z,T as x,J as ne,X as M,ae as F,R as X,U as q,V as H,a2 as mn,M as y,W as h,aj as Kt,O as m,K,a7 as fn,u as s,Z as De,ap as Xt,_ as be,w as xt,f as te,a9 as Qe,ar as Zt,i as et,af as Qt,h as hn,ah as We,ai as jt,aJ as _n,P as Ee,Q as je,S as $t,b5 as Ye,a0 as Je,n as Ue,ad as ze,k as Bt,bt as Oe,aw as gn,H as bn,s as at,bg as yn,be as kn}from"./@vue-74e1d4f0.js";import{m as En}from"./mitt-f7ef348c.js";import{_ as Vn}from"./monaco-editor-919908db.js";import{h as Cn,p as el,q as tl}from"./@vueuse-33fff3de.js";import{x as ll,G as nl,f as Sn,I as wn,e as xn}from"./@element-plus-2e6cd78b.js";import{m as sl,l as we}from"./lodash-es-1922f8b4.js";import"./vue-c69ca412.js";import"./axios-4cbcee7f.js";import"./async-validator-b6b8d38d.js";import"./@ctrl-b0f23ca4.js";import"./@popperjs-7c8154ca.js";const al="0.6.1",ye=Sl({url:"/vtj/base.json",method:"post",settings:{type:"json",validSuccess:!0,originResponse:!1,validate:u=>{var e;return((e=u.data)==null?void 0:e.code)===0},showError:u=>{ge.error({message:u||"未知错误"})}}});class jn extends Cl{getProject(e){return O(this,null,function*(){const t=e.id;return(yield ye({type:"getProject",data:t}).catch(n=>null))||(yield this.createProject(e))})}createProject(e){return O(this,null,function*(){const t=e.id,l=e.name||"未命名项目",n=ae(z({},e),{id:t,name:l});return yield ye({type:"createProject",data:n}).catch(a=>null),n})}updateProject(e){return O(this,null,function*(){if(!e.id)return!1;const t=yield this.getProject(e),l=Object.assign(t,e);return!!this.createProject(l)})}createFile(e){return O(this,null,function*(){const t=e.id,l=ae(z({},e),{id:t});return yield ye({type:"createFile",data:l}),l})}updateFile(e){return O(this,null,function*(){return e.id?!!this.createFile(e):!1})}getFile(e){return O(this,null,function*(){return yield ye({type:"getFile",data:e}).catch(t=>null)})}removeFile(e){return O(this,null,function*(){return yield ye({type:"removeHistory",data:e}),yield ye({type:"removeFile",data:e}),!0})}saveHistory(e){return O(this,null,function*(){const{blockId:t,items:l}=e;return yield ye({type:"saveHistory",data:{blockId:t,items:l}}),!0})}getHistory(e){return O(this,null,function*(){return yield ye({type:"getHistory",data:e}).catch(t=>[])})}}const ol=""+new URL("logo-32adf494.png",import.meta.url).href,$n=[{name:"logo",type:"Logo",region:"brand",props:{text:"Tj",icon:ol}},{name:"switcher",type:"Switcher",region:"brand",props:{link:"/"}}],Rn=[{name:"toolbar",type:"Toolbar",region:"toolbar"}],Dn=[{name:"actions",type:"Actions",region:"action"}],Tn=[{name:"pages",type:"Pages",region:"apps",order:1,trigger:{icon:"vtj-icon-document",label:"页面",type:"panel"}},{name:"blocks",type:"Blocks",region:"apps",order:2,trigger:{icon:"vtj-icon-components",label:"区块",type:"panel"}},{name:"components",type:"Components",region:"apps",order:3,trigger:{icon:"vtj-icon-block",label:"组件库",type:"panel"},props:{title:"组件库"}},{name:"outline",type:"Outline",region:"apps",order:4,trigger:{icon:"vtj-icon-outline",label:"大纲树",type:"panel"}},{name:"history",type:"History",region:"apps",order:4,trigger:{icon:"vtj-icon-history",label:"历史记录",type:"panel"}},{name:"api",type:"Apis",region:"apps",order:4,trigger:{icon:"vtj-icon-api",label:"Api管理",type:"panel"}},{name:"packages",type:"Dependencies",region:"apps",order:6,trigger:{icon:"vtj-icon-category",label:"依赖管理",type:"panel"}},{name:"about",type:"About",region:"apps",props:{title:"关于",width:"500px",height:"300px"},trigger:{icon:"vtj-icon-info",label:"关于",type:"dialog"}}],In=[{package:"vue",version:"3.3.4",library:"Vue",urls:["./libs/vue.global.js"],required:!0,official:!0,enabled:!0},{package:"@vueuse/core",version:"latest",library:"VueUse",urls:["./libs/vueuse.shared.iife.min.js","./libs/vueuse.core.iife.min.js"],required:!1,official:!0,enabled:!1},{package:"element-plus",version:"latest",library:"ElementPlus",urls:["./libs/element-plus.index.css","./libs/element-plus.full.min.js"],assetsUrl:"./libs/element-plus-assets.js",assetsLibrary:"ElementPlusAssets",required:!1,official:!0,enabled:!0},{package:"@element-plus/icons-vue",version:"latest",library:"ElementPlusIconsVue",urls:["./libs/element-plus-icons-vue.js"],required:!1,official:!0,enabled:!0},{package:"@vtj/utils",version:"latest",library:"VtjUtils",urls:["./libs/vtj-utils.js"],required:!1,official:!0,enabled:!0},{package:"@vtj/icons",version:"latest",library:"VtjIcons",urls:["./libs/vtj-icons.css","./libs/vtj-icons.js"],required:!1,official:!0,enabled:!0}],An=[{name:"designer",type:"Designer",region:"workspace",disabled:!1,order:0,trigger:{label:"设计视图",type:"tab"}},{name:"schema",type:"Schema",region:"workspace",disabled:!1,order:1,trigger:{label:"Schema",type:"tab",closable:!0}},{name:"docs",type:"Docs",region:"workspace",disabled:!1,order:2,props:{url:"https://element-plus.org/zh-CN/"},trigger:{label:"帮助中心",type:"tab",closable:!0}}],Nn=[{name:"properties",type:"Properties",region:"setting",group:"Node",trigger:{label:"属性",type:"tab"}},{name:"events",type:"Events",region:"setting",group:"Node",trigger:{label:"事件",type:"tab"}},{name:"directives",type:"Directives",region:"setting",group:"Node",trigger:{label:"指令",type:"tab"}},{name:"script",type:"BlockScript",region:"setting",group:"Block",trigger:{label:"设置",type:"tab"}},{name:"dataSources",type:"DataSources",region:"setting",group:"Block",trigger:{label:"数据源",type:"tab"}},{name:"css",type:"Css",region:"setting",group:"Block",trigger:{label:"样式",type:"tab"}},{name:"advanced",type:"Advanced",region:"setting",group:"Block",trigger:{label:"定义",type:"tab"}}],Pn=[{name:"nodePath",type:"NodePath",region:"status",props:{}}],On={activeApp:"pages",widgets:[...$n,...Rn,...Dn,...Tn,...An,...Nn,...Pn],dependencies:In};function Ln(u,e){const t=u.slice(0);return e.forEach(l=>{const n=t.findIndex(a=>a.name===l.name);n>-1?t.splice(n,1,sl(t[n],l)):t.push(l)}),t}function Bn(u,e){const t=Ln(u.widgets||[],(e==null?void 0:e.widgets)||[]);return Object.assign({},u,e||{},{widgets:t})}function Y(){const u=wt(It);return{engine:u,regions:u.skeleton.regions,config:u.config,emitter:u.emitter,project:u.project,assets:u.assets}}function Un(u){const e=k(""),t=R(()=>{const l=e.value.toLowerCase();return!l||!u?[]:u.filter(n=>{var a;return n.name.toLowerCase().includes(l)||((a=n.title)==null?void 0:a.toLowerCase().includes(l))})});return{searchKey:e,searchResult:t}}const Mn=["onClick"],Fn={key:1,class:"vtj-panel__header"},Jn={class:"vtj-panel__title"},zn={key:1,class:"vtj-panel__subtitle"},Hn={key:0,class:"vtj-panel__tools"},Gn=["onClick"],qn={key:0,class:"vtj-panel__footer"},fe=N({__name:"Panel",props:{icon:{},title:{},subtitle:{},tools:{},bodyPadding:{type:Boolean,default:!0},back:{type:Boolean}},emits:["tool-click","back"],setup(u,{expose:e,emit:t}){const l=u,n=k(),a=k();function i(o){t("tool-click",o)}function r(){t("back")}return e({panel:n,header:a}),(o,p)=>(c(),V("div",{class:"vtj-panel",ref_key:"panel",ref:n},[T("div",{ref_key:"header",ref:a,class:"vtj-panel__header-wrapper"},[l.back?(c(),V("i",{key:0,onClick:Z(r,["stop"]),class:"vtj-panel__back vtj-icon-arrow-left"},null,8,Mn)):x("",!0),o.title!==null?(c(),V("div",Fn,[ne(o.$slots,"title",{},()=>[T("div",Jn,[o.icon?(c(),V("i",{key:0,class:X(["vtj-panel__icon",o.icon])},null,2)):x("",!0),q(" "+H(o.title)+" ",1),o.subtitle?(c(),V("span",zn,H(o.subtitle),1)):x("",!0)])]),o.tools&&o.tools.length||o.$slots.tools?(c(),V("div",Hn,[(c(!0),V(M,null,F(o.tools,f=>(c(),V("i",{key:f.name,class:X(f.icon),onClick:d=>i(f)},null,10,Gn))),128)),ne(o.$slots,"tools")])):x("",!0)])):x("",!0)],512),T("div",{class:X(["vtj-panel__body",{"is-padding":l.bodyPadding}])},[ne(o.$slots,"default")],2),o.$slots.footer?(c(),V("div",qn,[ne(o.$slots,"footer")])):x("",!0)],512))}});const se=N({__name:"Dialog",props:{modelValue:{type:Boolean,default:!0},modal:{type:Boolean,default:!0},width:{default:"80%"},height:{},top:{default:"40%"},cancel:{type:Boolean,default:!1},submit:{type:Boolean,default:!1},clear:{type:Boolean,default:!1},closable:{type:Boolean,default:!0}},emits:["close","update:modelValue","submit","clear"],setup(u,{expose:e,emit:t}){const l=u,n=mn(),a=k(),i=R(()=>{const v=[...n.tools||[]];return l.closable&&v.push({name:"close",icon:"vtj-icon-close"}),v}),{x:r,y:o}=ms(a),p=R(()=>({width:l.width,height:l.height,left:`${r.value}px`,top:`${o.value}px`})),f=v=>{v.name==="close"&&(t("update:modelValue",!1),t("close"))};function d(){t("update:modelValue",!1),t("close")}function _(){t("submit")}function g(){t("clear")}return e({close:d}),(v,b)=>l.modelValue?(c(),y(fn,{key:0,to:"body"},[T("div",{class:"vtj-dialog__modal",onMousemove:b[0]||(b[0]=Z(()=>{},["stop"]))},null,32),h(fe,K({ref_key:"panelRef",ref:a,onMousemove:b[1]||(b[1]=Z(()=>{},["stop"])),class:"vtj-dialog"},v.$attrs,{tools:i.value,style:p.value,draggable:"",onToolClick:f}),Kt({default:m(()=>[ne(v.$slots,"default")]),_:2},[v.$slots.footer||v.cancel||v.submit||v.clear?{name:"footer",fn:m(()=>[ne(v.$slots,"footer",{},()=>[T("div",null,[ne(v.$slots,"action"),v.clear?(c(),y(s(re),{key:0,type:"warning",size:"default",class:"vtj-dialog__clear",onClick:g},{default:m(()=>[q(" 清除绑定 ")]),_:1})):x("",!0)]),T("div",null,[v.cancel?(c(),y(s(re),{key:0,onClick:d,size:"default"},{default:m(()=>[q(" 取消 ")]),_:1})):x("",!0),v.submit?(c(),y(s(re),{key:1,type:"primary",onClick:_,size:"default"},{default:m(()=>[q(" 确定 ")]),_:1})):x("",!0)])])]),key:"0"}:void 0]),1040,["tools","style"])])):x("",!0)}});const Wn=T("div",null,"该组件支持多个插槽，请选择放置到其中一个",-1),Yn={class:"vtj-designer__slots"},Kn=["onClick"],Xn=N({__name:"SlotPicker",props:{slots:{default:()=>[]}},emits:["pick"],setup(u,{emit:e}){const t=u,l=k(!0),n=a=>{e("pick",a)};return(a,i)=>(c(),y(se,{title:"提示",width:"600px",height:"200px",modelValue:l.value,"onUpdate:modelValue":i[0]||(i[0]=r=>l.value=r)},{default:m(()=>[Wn,T("div",Yn,[(c(!0),V(M,null,F(t.slots,r=>(c(),V("div",{onClick:o=>n(r),class:"vtj-designer__slot"},H(r.name),9,Kn))),256))])]),_:1},8,["modelValue"]))}}),Zn=(u,e=!0)=>{const{top:t,height:l,width:n,left:a}=u||{};if(l>100&&n>200)return"inner";let i,r;return r=t>30?"top":"bottom",i=e||a<300&&n<300?"left":"right",[i,r].join("-")},Qn=u=>{const{rect:e,type:t}=u,{left:l,width:n,top:a,height:i}=e,r={left:l,width:n,top:a,height:i};switch(t){case"left":r.left=0,r.width=0;break;case"right":r.left=r.left+r.width-4,r.width=0;break;case"bottom":r.top=r.top+r.height-4,r.height=0;break;case"top":r.height=0;break}return r},ot=(u,e)=>{if(!e)return null;const{left:t,top:l,width:n,height:a}=u==="dropping"?Qn(e):e.rect,i={left:`${t}px`,top:`${l}px`,width:`${n}px`,height:`${a}px`};return ae(z({},e),{style:i,position:Zn(e.rect,u!=="selected")})};let Me;function me(u){if(Me||!u)return Me;De(()=>{u.dispose()});const e=R(()=>ot("hover",u.hover.value)),t=R(()=>ot("dropping",u.dropping.value)),l=R(()=>ot("selected",u.selected.value)),n=i=>{const{type:r,node:o}=i;if(!o){u.selected.value=null,u.hover.value=null;return}switch(r){case"remove":u.selected.value=null;case"copy":u.setSelected(o);break;case"move":u.setSelected(o);break;case"hover":u.setHover(o);break;case"selected":u.setSelected(o);break}},a=k("pc");return w.on(dl,i=>{a.value=i}),w.on(Dt,i=>{u.setSelected(i)}),w.on(Tt,i=>{u.setHover(i)}),w.on(xe,i=>{u.hover.value=null,u.selected.value=null}),w.on(pl,i=>O(this,null,function*(){yield Nt(100),u.hover.value=null,i&&l.value&&u.setSelected(l.value.node)})),w.on(U,()=>O(this,null,function*(){yield Nt(100),l.value&&u.setSelected(l.value.node)})),Me={designer:u,hover:e,dropping:t,selected:l,onAction:n,viewportMode:a},Me}function es(u){return new Promise((e,t)=>{const l=Xt(Xn,{slots:u,onClose:()=>{l.unmount(),t(void 0)},onPick:n=>{l.unmount(),e(n)}});l.mount(document.createElement("div"))})}function ts(u,e){var f,d,_,g,v;const t={state:(f=u.value)==null?void 0:f.removeState.bind(u.value),computed:(d=u.value)==null?void 0:d.removeComputed.bind(u.value),methods:(_=u.value)==null?void 0:_.removeMethods.bind(u.value),watch:(g=u.value)==null?void 0:g.removeWatch.bind(u.value),lifeCycles:(v=u.value)==null?void 0:v.removeLifeCycles.bind(u.value)},l=k(!1),n=k(Symbol()),a=k();return{list:R(()=>{var b,E;if(e==="watch")return(((b=u.value)==null?void 0:b.watch)||[]).map(S=>({title:S.source.value,model:S}));{const S=(E=u.value)==null?void 0:E[e];return Object.entries(S!=null?S:{}).map(([C,P])=>({title:C,model:{name:C,value:P}}))}}),visible:l,data:a,onAdd:b=>{n.value=Symbol(),a.value=null,l.value=!0},onEdit:b=>{n.value=Symbol(),a.value=z({},b),l.value=!0},onRemove:b=>O(this,null,function*(){if(yield ue.confirm("是否确定删除?","提示",{type:"warning"}).catch(()=>!1)){const S=t[e];S&&S(e==="watch"?b:b.name)}}),keyRef:n}}const ls={block:{type:Object,default:null},data:{type:Object},type:{type:String,default:"state"},title:{type:String,default:""},nameLabel:{type:String,default:""},valueLabel:{type:String,default:""},dataType:{type:String,default:"JSExpression"},defaults:{type:String,default:""}};function ns(u){const e={name:"",value:{type:u.dataType,value:u.defaults}},t={state:u.block.setState.bind(u.block),computed:u.block.setComputed.bind(u.block),methods:u.block.setMethods.bind(u.block),lifeCycles:u.block.setLifeCycles.bind(u.block)},l=k(),n=k(),a=k(),i=R(()=>u.data?`编辑${u.title}`:`新增${u.title}`),r={name:[{required:!0,message:`${u.title}名称为必填项`}]},o=R(()=>!!u.data),p=be(u.data||we(e));xt(()=>{Object.assign(p,u.data||we(e))});const f=_=>u.data?!1:!!u.block[u.type][_];return{defaultJsData:e,title:i,model:p,formRef:l,dialogRef:n,editorRef:a,rules:r,disabled:o,onSubmit:()=>O(this,null,function*(){if(yield l.value.validate().catch(()=>!1)){if(f(p.name)){ge.warning({title:"提示",message:"已存在相同名称，请更换！"});return}const g=a.value.getEditor().getValue(),v=u.block.runtimeContext;v&&he(ae(z({},p.value),{value:g}),v)&&(p.value.value=g,t[u.type](p.name,p.value),n.value.close())}})}}const ss={block:{type:Object,default:null},data:{type:Object}};function as(u){const e={source:{type:"JSFunction",value:"() => { }"},immediate:!1,deep:!1,handler:{type:"JSFunction",value:"() => { }"}},t=k(),l=k(),n=k(),a=k(),i=R(()=>u.data?"编辑 Watch":"新增 Watch"),r=be(u.data||we(e));return xt(()=>{Object.assign(r,u.data||we(e))}),{title:i,model:r,onSubmit:()=>O(this,null,function*(){const p=u.block.runtimeContext,f=n.value.getEditor().getValue(),d=a.value.getEditor().getValue();p&&he(ae(z({},r.source),{value:f}),p)&&he(ae(z({},r.handler),{value:d}),p)&&(r.source.value=f,r.handler.value=d,u.block.setWatch(z({},r)),l.value.close())}),dialogRef:l,sourceRef:n,handlerRef:a,formRef:t}}function os(u,e){const{selected:t}=me(),l=R(()=>{var i;return(i=t.value)==null?void 0:i.node}),n=R(()=>{var A;const i=[];if(!u.value)return i;const r=u.value.runtimeContext,o=r==null?void 0:r.__context_refs[(A=l.value)==null?void 0:A.id],f=u.value.runtimeContext===o?[]:Object.keys(o||{}).map(C=>`this.${C}`);f.length&&i.push({title:"上下文",items:f});const d=u.value.inject.map(C=>`this.${C.name}`);d.length&&i.push({title:"注入",items:d});const _=u.value.props.map(C=>typeof C=="string"?`this.$props.${C}`:`this.$props.${C.name}`);_.length&&i.push({title:"属性",items:_});const g=Object.keys(u.value.state).map(C=>`this.state.${C}`);g.length&&i.push({title:"状态",items:g});const v=Object.keys(u.value.computed).map(C=>`this.${C}.value`);v.length&&i.push({title:"计算属性",items:v});const b=Object.keys(u.value.methods).map(C=>`this.${C}`);b.length&&i.push({title:"方法",items:b});const E=Object.keys(u.value.dataSources).map(C=>`this.${C}`);E.length&&i.push({title:"数据源",items:E});const S=Object.keys((r==null?void 0:r.$refs)||{}).map(C=>`this.$refs.${C}`);return S.length&&i.push({title:"refs",items:S}),i}),a=R(()=>{if(!e.value)return n.value;const i=e.value.toLowerCase(),r=[];return n.value.forEach(o=>{const p=o.items.filter(f=>f.toLowerCase().includes(i));p.length&&r.push({title:o.title,items:p})}),r});return{options:n,searchResult:a}}function is(u,e){const t=[{name:"InputSetter",label:"文本"},{name:"ExpressionSetter",label:"表达式"}],l=k();te(u,d=>O(this,null,function*(){d?l.value=(yield e.getBlockDescription(d.from))||void 0:l.value=void 0}),{immediate:!0});const n=R(()=>!u.value||!nt(u.value)?[]:[{name:"key",setters:t,value:u.value.getPropValue("key")},{name:"ref",setters:t,value:u.value.getPropValue("ref")},{name:"class",label:"class",setters:t,value:u.value.getPropValue("class")},{name:"style",label:"样式",setters:[{name:"JSONSetter",label:"JSON"},{name:"ExpressionSetter",label:"表达式"}],value:u.value.getPropValue("style")},{name:"children",label:"文本",title:"如设置组件文本，将清空子组件",setters:t,value:Array.isArray(u.value.children)?"":u.value.children}]),a=R(()=>{if(!u.value||!nt(u.value))return[];const d=l.value||e.componentMap[u.value.name]||e.elementsMap[u.value.name];return d?(d.props||[]).map(g=>{var v;return ae(z({},g),{value:(v=u.value.getPropValue(g.name))!=null?v:g.defaultValue})}):[]}),i=d=>n.value.some(_=>_.name===d)||a.value.some(_=>_.name===d),r=R(()=>!u.value||!nt(u.value)?[]:Object.keys(u.value.props).filter(d=>!i(d)).map(d=>({name:d,setters:"InputSetter",value:u.value.getPropValue(d)})));return{commonProps:n,componentProps:a,onChange:(d,_)=>{d==="children"?u.value.setChildren(_):u.value.setProp(d,_)},customProps:r,addCustom:d=>{d&&u.value.setProp(d,"")},isExist:i,removeProp:d=>{u.value.removeProp(d)},blockDescription:l}}function rs(u,e){const t=k();te(u,i=>O(this,null,function*(){i?t.value=(yield e.getBlockDescription(i.from))||void 0:t.value=void 0}),{immediate:!0});const l=R(()=>{var r;if(ee(u.value))return[];const i=((r=u.value)==null?void 0:r.events)||{};return wl.map(o=>({name:o,event:i[o]}))}),n=R(()=>{var r;if(ee(u.value))return[];const i=((r=u.value)==null?void 0:r.events)||{};return xl.map(o=>({name:o,event:i[o]}))}),a=R(()=>{var o,p,f;if(ee(u.value))return[];const i=((o=u.value)==null?void 0:o.events)||{};return(((p=t.value)==null?void 0:p.events)||((f=e.componentMap[u.value.name])==null?void 0:f.events)||[]).map(d=>{const _=typeof d=="string"?d:d.name;return{name:_,event:i[_]}})});return{mouseEventList:l,keyboardEventList:n,componentEventList:a}}class Ae{constructor(e,t,l){$(this,"isUnset",!1);this.name=e,this.value=t,this.defaultValue=l,this.setValue(t)}setValue(e){this.value=e,this.isUnset=this.value===this.defaultValue}getValue(){var e;return(e=this.value)!=null?e:this.defaultValue}static toDsl(e={}){return Object.entries(e).reduce((t,[l,n])=>(n.isUnset||(t[l]=n.getValue()),t),{})}static parse(e={}){return Object.entries(e).reduce((t,[l,n])=>(t[l]=new Ae(l,n),t),{})}}class Re{constructor(e){$(this,"id");$(this,"name","");$(this,"arg");$(this,"modifiers");$(this,"value");$(this,"iterator");this.id=e.id||Se(),this.update(e)}update(e){const{name:t,arg:l,modifiers:n,value:a,iterator:i}=e;this.name=t,this.arg=l,this.modifiers=n,this.value=a,this.iterator=i}static parse(e=[]){return e.map(t=>new Re(t))}static toDsl(e=[]){return e.map(t=>{const{name:l,arg:n,modifiers:a,value:i,iterator:r,id:o}=t;return{id:o,name:l,arg:n,modifiers:a,value:i,iterator:r}})}}class Ne{constructor(e,t){$(this,"handler");$(this,"modifiers",{});this.name=e;const{handler:l}=t;this.handler=l,this.update(t)}update(e){const{handler:t,modifiers:l={}}=e;this.handler=t,this.modifiers=l}static toDsl(e){return Object.entries(e).reduce((t,[l,n])=>{const{handler:a,modifiers:i}=n;return t[l]={handler:a,modifiers:i},t},{})}static parse(e={}){return Object.entries(e).reduce((t,[l,n])=>(t[l]=new Ne(l,n),t),{})}}const Ce=class Ce{constructor(e,t=null){$(this,"__VTJ_NODE__",!0);$(this,"id");$(this,"name");$(this,"from");$(this,"invisible",!1);$(this,"props",{});$(this,"children","");$(this,"slot");$(this,"directives",[]);$(this,"events",{});$(this,"disposed",!1);$(this,"root",null);$(this,"lock",!1);this.schema=e,this.parent=t;const{id:l,name:n,from:a=""}=e;this.id=l||Se(),this.name=n,this.from=a,t&&(this.root=ee(t)?t:t.root),this.update(e,!0),Ce.nodes[this.id]=this}update(e,t=!1){Object.assign(this.schema,e);const{children:l,slot:n,props:a,directives:i,events:r}=e;this.invisible=!!e.invisible,this.setChildren(l,t),this.setSlot(n,t),this.props=Ae.parse(a),this.directives=Re.parse(i),this.events=Ne.parse(r)}dispose(){const{children:e,disposed:t}=this;t||(Array.isArray(e)&&e.forEach(l=>l.dispose()),this.parent&&this.parent.removeChild(this),this.parent=null,this.root=null,this.disposed=!0,delete Ce.nodes[this.id])}toDsl(){const{id:e,name:t,from:l,invisible:n,slot:a,children:i,props:r,directives:o,events:p}=this,f=Array.isArray(i)?i.filter(d=>!d.invisible).map(d=>d.toDsl()):i;return ae(z({},this.schema),{id:e,name:t,from:l,invisible:n,slot:a,children:f,props:Ae.toDsl(r),directives:Re.toDsl(o),events:Ne.toDsl(p)})}setChildren(e="",t=!1){const{disposed:l}=this;l||(Array.isArray(e)?this.children=e.map(n=>new Ce(n,this)):this.children=e,t||w.emit(U,this))}setSlot(e,t=!1){this.slot=typeof e=="string"?{name:e,params:[]}:e,t||w.emit(U,this)}setProp(e,t){const l=this.props[e];l?l.setValue(t):this.props[e]=new Ae(e,t),w.emit(U,this)}removeProp(e){delete this.props[e],w.emit(U,this)}getPropValue(e){const t=this.props[e];if(t)return t.getValue()}setEvent(e,t){const l=this.events[e];l?l.update(t):this.events[e]=new Ne(e,t),w.emit(U,this)}removeEvent(e){delete this.events[e],w.emit(U,this)}setDirective(e){const t=this.directives.findIndex(l=>l.id===e.id);t>=0?this.directives.splice(t,1,e):this.directives.push(e),w.emit(U,this)}removeDirective(e){const t=this.directives.findIndex(l=>l.id===e.id);t>=0&&this.directives.splice(t,1),w.emit(U,this)}appendChild(e){const{children:t,disposed:l}=this;l||(e.parent=this,e.root=this.root,Array.isArray(t)?t.push(e):this.children=[e],w.emit(U,this))}insertChild(e,t=0){const{children:l,disposed:n}=this;n||(e.parent=this,e.root=this.root,Array.isArray(l)?l.splice(t,0,e):this.children=[e],w.emit(U,this))}removeChild(e){const{children:t,disposed:l}=this;if(l||!Array.isArray(t))return;const n=t.findIndex(a=>a===e);e.parent=null,e.root=null,t.splice(n,1),w.emit(U,this)}insertAfter(e){if(!this.parent)return;const t=this.parent.children;if(Array.isArray(t)){e.parent=this.parent,e.root=this.root;const l=t.indexOf(this);t.splice(l+1,0,e),w.emit(U,this.parent)}}insertBefore(e){if(!this.parent)return;const t=this.parent.children;if(Array.isArray(t)){e.parent=this.parent,e.root=this.root;const l=t.indexOf(this);t.splice(l,0,e),w.emit(U,this.parent)}}moveNext(){const e=this.parent;if(!e)return;const t=e.children;if(Array.isArray(t)){const l=t.indexOf(this);l>-1&&l<t.length-1&&(t.splice(l,1),t.splice(l+1,0,this),w.emit(U,e))}}movePrev(){const e=this.parent;if(!e)return;const t=e.children;if(Array.isArray(t)){const l=t.indexOf(this);l>0&&(t.splice(l,1),t.splice(l-1,0,this),w.emit(U,e))}}copy(){if(!this.parent)return;const e=this.toDsl();delete e.id;const t=new Ce(e);return this.insertAfter(t),t}};$(Ce,"nodes",{});let Le=Ce;const Ut=["name","title","inject","state","lifeCycles","methods","computed","watch","css","props","emits","slots","transform","dataSources"];class it{constructor(e){$(this,"__VTJ_BLOCK__",!0);$(this,"id");$(this,"name","");$(this,"title","");$(this,"inject",[]);$(this,"state",{});$(this,"lifeCycles",{});$(this,"methods",{});$(this,"computed",{});$(this,"watch",[]);$(this,"css","");$(this,"props",[]);$(this,"emits",[]);$(this,"slots",[]);$(this,"transform",{});$(this,"dataSources",{});$(this,"children",[]);$(this,"lock",!1);$(this,"invisible",!1);$(this,"disposed",!1);$(this,"parent",null);$(this,"root",null);$(this,"runtimeContext");const{id:t}=e;this.id=t||Se(),this.init(e)}init(e){for(const l of Ut){const n=e[l];n&&(this[l]=n)}const{children:t=[]}=e;this.children=t.map(l=>new Le(l,this))}dispose(){this.children.map(e=>e.dispose()),this.runtimeContext=void 0,this.disposed=!0}toDsl(){const{__VTJ_BLOCK__:e,id:t,children:l}=this,n=Ut.reduce((a,i)=>(a[i]=this[i],a),{});return ae(z({},n),{__VTJ_BLOCK__:e,id:t,children:l.map(a=>a.toDsl())})}appendChild(e,t,l){t?l==="left"||l==="top"?t.insertBefore(e):l==="right"||l==="bottom"?t.insertAfter(e):t.appendChild(e):(e.parent=this,e.root=this,this.children.push(e),w.emit(U,this))}removeChild(e){if(e.parent===this){const t=this.children.findIndex(l=>l.id===e.id||l===e);t>-1&&(e.parent=null,e.root=null,this.children.splice(t,1),w.emit(U,this))}else e.parent&&e.parent.removeChild(e)}allowDrop(e,t,l){return O(this,null,function*(){if(ee(t))return!0;const n=l.componentMap,a=(yield l.getBlockDescription(t.from))||n[t.name];if(!a||!e)return!0;const{parentIncludes:i=!0,name:r}=e,{childIncludes:o=!0}=a,p=i===!0||Array.isArray(i)&&i.includes(t.name),f=o===!0||Array.isArray(o)&&o.includes(r);return p&&f})}move(e,t,l){this.removeChild(e),ee(t)?t.appendChild(e):this.appendChild(e,t,l)}setState(e,t){this.state[e]=t,w.emit(U,this)}removeState(e){delete this.state[e],w.emit(U,this)}setComputed(e,t){this.computed[e]=t,w.emit(U,this)}removeComputed(e){delete this.computed[e],w.emit(U,this)}setMethods(e,t){this.methods[e]=t,w.emit(U,this)}removeMethods(e){delete this.methods[e],w.emit(U,this)}setLifeCycles(e,t){this.lifeCycles[e]=t,w.emit(U,this)}removeLifeCycles(e){delete this.lifeCycles[e],w.emit(U,this)}setWatch(e){e.id=e.id||Se();const t=this.watch.findIndex(l=>l.id&&l.id===e.id||l===e);t>-1?this.watch.splice(t,1,e):this.watch.push(e),w.emit(U,this)}removeWatch(e){const t=this.watch.findIndex(l=>l.id&&l.id===e.id||l===e);t>-1&&(this.watch.splice(t,1),w.emit(U,this))}setCss(e){this.css=e,w.emit(U,this)}setProp(e){const t=this.props.findIndex(l=>typeof l=="string"?l===e.name:l.name===e.name);t>-1?this.props.splice(t,1,e):this.props.push(e),w.emit(U,this)}removeProp(e){const t=this.props.findIndex(l=>typeof l=="string"?l===e.name:l.name===e.name);t>-1&&(this.props.splice(t,1),w.emit(U,this))}setEmit(e){const t=this.emits.findIndex(l=>l===e);t>-1?this.emits.splice(t,1,e):this.emits.push(e),w.emit(U,this)}removeEmit(e){const t=this.emits.findIndex(l=>l===e);t>-1&&(this.emits.splice(t,1),w.emit(U,this))}setSlot(e){const t=this.slots.findIndex(l=>l===e);t>-1?this.slots.splice(t,1,e):this.slots.push(e),w.emit(U,this)}removeSlot(e){const t=this.slots.findIndex(l=>l===e);t>-1&&(this.slots.splice(t,1),w.emit(U,this))}setInject(e){const t=this.inject.findIndex(l=>l.name===e.name);t>-1?this.inject.splice(t,1,e):this.inject.push(e),w.emit(U,this)}removeInject(e){const t=this.inject.findIndex(l=>l.name===e.name);t>-1&&(this.inject.splice(t,1),w.emit(U,this))}setDataSource(e){this.dataSources[e.name]=e,w.emit(U,this)}removeDataSource(e){delete this.dataSources[e],w.emit(U,this)}}class us{constructor(e,t=[]){$(this,"__VTJ_PROJECT__",!0);$(this,"id","");$(this,"name","");$(this,"description","");$(this,"homepageId","");$(this,"dependencies",k([]));$(this,"pages",k([]));$(this,"blocks",k([]));$(this,"apis",k([]));$(this,"current",k(null));this.source=t,this.load(e)}load(e){const{id:t,description:l="",name:n="",homepageId:a="",dependencies:i=[],pages:r=[],blocks:o=[],apis:p=[]}=e||{};this.id=t||Se(),this.description=l,this.name=n,this.homepageId=a,this.dependencies.value=this.mergeDeps(i,this.source),this.pages.value=r,this.blocks.value=o,this.apis.value=p}update(e){const t=this.toDsl();Object.assign(t,e),this.load(t),w.emit(pe,t)}activeFile(e){this.current.value=e?new it(e):null,w.emit(ri,this.current.value)}mergeDeps(e,t){const l=e.filter(i=>!!i.official),n=e.filter(i=>!i.official);return t.map(i=>{const r=l.find(o=>o.package===i.package);return Object.assign(i,r||{})}).concat(n)}setDeps(e){const t=this.dependencies.value,l=t.findIndex(n=>n.package===e.package);l>-1?t.splice(l,1,z(z({},t[l]),e)):t.push(Qe(e)),w.emit(pe,this.toDsl())}removeDeps(e){const t=this.dependencies.value,l=t.findIndex(n=>n.package===e.package);l>-1&&(t.splice(l,1),w.emit(pe,this.toDsl()))}toDsl(){const{id:e,description:t,name:l,homepageId:n,dependencies:a,pages:i,blocks:r,apis:o,__VTJ_PROJECT__:p}=this;return{__VTJ_PROJECT__:p,__VTJ_VERSION__:al,__VTJ_DATE__:Date.now().toString(),id:e,description:t,name:l,homepageId:n,dependencies:s(a),pages:s(i),blocks:s(r),apis:s(o)}}findPage(e){const t=(l,n=[])=>{for(const a of n){if(a.id===l)return a;if(a.children&&a.children.length){const i=t(l,a.children);if(i)return i}}};return t(e,this.pages.value)}getPages(){return jl(this.pages.value)}getHomePage(){return this.getPages().find(t=>!!t.home)}clearHomePage(){this.getPages().forEach(t=>{t.home=!1})}addPage(e,t){const{name:l,title:n,isDir:a,home:i}=e,r=new it({name:l,title:n}),o=r.toDsl();if(e.id=o.id,i&&(this.clearHomePage(),e.home=!0),a&&(e.children=[]),t){const p=this.findPage(t);p&&(p.children?p.children.push(e):p.children=[e])}else this.pages.value.push(e);return a||w.emit(Ge,o),w.emit(pe,this.toDsl()),r}updatePage(e,t){if(e.id){const l=this.findPage(e.id);l&&(Object.assign(l,e),l.home&&(this.clearHomePage(),l.home=!0),t&&(t.name=l.name,t.title=l.title,w.emit(mt,t)),w.emit(pe,this.toDsl()))}}copyPage(e,t,l){var p;const n=Se(),a=ae(z({},e),{id:n}),i=ae(z({},t),{id:n}),r=l?((p=this.findPage(l))==null?void 0:p.children)||[]:this.pages.value,o=r.findIndex(f=>f.id===e.id);r.splice(o,0,a),w.emit(Ge,i),w.emit(pe,this.toDsl())}removePage(e){var l;const t=(n,a)=>{const i=a.findIndex(r=>r.id===n);if(i>=0){a.splice(i,1);return}for(const r of a)if(r.children&&r.children.length)return t(n,r.children)};t(e,this.pages.value),((l=this.current.value)==null?void 0:l.id)===e&&(this.current.value=null),w.emit(ft,e),w.emit(pe,this.toDsl())}addBlock(e){const t=new it(e),l=t.toDsl(),{id:n,name:a,title:i}=l,r={id:n,name:a,title:i};return this.blocks.value.push(r),w.emit(Ge,l),w.emit(pe,this.toDsl()),t}updateBlock(e,t){const{id:l}=e;Object.assign(t,e);const n=this.blocks.value,a=n.findIndex(i=>i.id===l);a>-1&&(n.splice(a,1,e),w.emit(mt,t),w.emit(pe,this.toDsl()))}removeBlock(e){var n;const t=this.blocks.value,l=t.findIndex(a=>a.id===e);l>-1&&(((n=this.current.value)==null?void 0:n.id)===e&&this.activeFile(null),t.splice(l,1),w.emit(ft,e),w.emit(pe,this.toDsl()))}findBlock(e){return this.blocks.value.find(t=>t.id===e)}existBlockName(e){return this.blocks.value.some(t=>t.name===e.name&&t.id!==e.id)}getFile(e){const t=this.findBlock(e);return t||this.findPage(e)}isPage(e){return typeof(e==null?void 0:e.isDir)=="boolean"}setApi(e){const t=this.apis.value,l=t.findIndex(n=>n.name===e.name);l>-1?t.splice(l,1,e):t.push(e),w.emit(pe,this.toDsl())}removeApi(e){const t=this.apis.value,l=t.findIndex(n=>n.name===e);l>-1&&(t.splice(l,1),w.emit(pe,this.toDsl()))}}class cs{constructor(e){$(this,"index",-1);$(this,"list",[]);$(this,"max");$(this,"blockId");const{history:t,max:l=50}=e;this.blockId=t.blockId,this.max=l,this.refresh(t.items||[])}refresh(e){this.index=-1,this.list=Zt(e)}go(){const{index:e,list:t}=this;if(e<0)return;--this.index;const l=t[this.index];l&&(w.emit(ci,l),w.emit($e,l))}back(){const{index:e,list:t}=this;if(e>=t.length-1)return;e<0&&(this.index=0),++this.index;const l=t[this.index];l&&(w.emit(di,l),w.emit($e,l))}push(e){const{max:t,list:l,blockId:n}=this,a={id:Se(),title:new Date().toLocaleString(),block:we(e)};l.unshift(a),l.length>t&&(this.list=l.splice(t)),this.index=-1,w.emit(pi,{blockId:n,item:a}),w.emit(Ke,this.toDsl())}load(e){const t=this.list.findIndex(l=>l.id===e);t>=0&&(this.index=t,w.emit($e,this.list[t]))}remove(e){const t=this.list.findIndex(a=>a.id===e),{list:l,blockId:n}=this;if(t>-1){const a=l.splice(t,1);t===this.index?this.index=-1:this.index>=l.length&&(this.index=l.length-1),w.emit(vi,{blockId:n,item:a[0]}),w.emit(Ke,this.toDsl())}}toDsl(){const{blockId:e,list:t}=this;return{blockId:e,items:Qe(t)}}}const Mt=(u,e)=>new Re({name:u,value:void 0,iterator:e}),ds=(u="modelValue")=>new Re({name:"vModel",value:void 0,arg:u});function ps(u){if(!u)return[];const{props:e=[],events:t=[]}=u;if(e.length&&t.length){const l=t.filter(n=>(typeof n=="string"?n:n.name).startsWith("onUpdate:")).map(n=>n=typeof n=="string"?n:n.name);return l.length?e.filter(n=>l.some(a=>a.includes(n.name))):[]}return[]}function vs(u,e){const t=v=>R(()=>u.value&&(u.value.directives||[]).find(b=>b.name===v)||Mt(v)),l=R(()=>ps(e.value)),n=()=>R(()=>l.value.map(v=>(u.value.directives||[]).find(b=>b.name==="vModel"&&b.arg==v.name)||ds(v.name))),a=t("vIf"),i=t("vShow"),r=t("vBind"),o=t("vFor"),p=n(),f={vIf:a,vShow:i,vBind:r,vFor:o};return{directives:f,vIf:a,vShow:i,vBind:r,vFor:o,vModels:p,onValueChange:(v,b)=>{const E=f[v];b?(E.value.value=b,u.value.setDirective(E.value)):(E.value.value=void 0,u.value.removeDirective(E.value))},onForChange:(v,b)=>{if(v==="value"){b?(o.value.value=b,u.value.setDirective(o.value)):u.value.removeDirective(o.value);return}(v==="item"||v==="index")&&(o.value.iterator=ae(z({},o.value.iterator),{[v]:b||void 0}),u.value.setDirective(o.value))},onModelChange:(v,b)=>{const E=parseInt(v),S=p.value[E];S&&(b?(S.value=b,u.value.setDirective(S)):(S.value=void 0,u.value.removeDirective(S)))}}}function ms(u){const e=k(),t=k(),l=k(),n=k(0),a=k(0),i=()=>{const{innerWidth:o,innerHeight:p}=window,{left:f=0,top:d=0,width:_=0,height:g=0}=e.value,v=Math.max((o-_)/2,0),b=Math.max((p-g)/2,0);return{x:v,y:b}},r=o=>{const{innerWidth:p,innerHeight:f}=window,{width:d=0,height:_=0}=t.value.getBoundingClientRect();n.value=Math.max(0,o.x),o.x>p-d&&(n.value=Math.min(o.x,p-d)),a.value=Math.max(0,o.y),o.y>f-_&&(a.value=Math.min(o.y,f-_))};return te(u,o=>{const p=o==null?void 0:o.panel;if(p){t.value=p,l.value=o==null?void 0:o.header,e.value=p.getBoundingClientRect();const f=i();n.value=f.x,a.value=f.y,Cn(t,{initialValue:i(),handle:l,onMove:d=>{r(d)}})}}),{x:n,y:a}}const Ve=N({name:"WidgetRenderer",props:{name:String,type:[String,Object],props:Object,disabled:Boolean,extendProps:Object,order:Number,visible:{type:Boolean,default:!0}},setup(u,{slots:e}){const t=wt(It),l=k(u.visible),n=R(()=>u.type&&(t!=null&&t.skeleton)?t==null?void 0:t.skeleton.getComponent(u.type):null);return te(()=>u.visible,a=>{a&&(l.value=a)},{immediate:!0}),et(()=>{const a=t==null?void 0:t.skeleton;if(u.name&&a){const i=hn();a.widgetInstances[u.name]=i==null?void 0:i.refs[u.name]}}),De(()=>{const a=t==null?void 0:t.skeleton;u.name&&a&&delete a.widgetInstances[u.name]}),()=>n.value&&!u.disabled&&l.value?Qt(n.value,z({ref:u.name,name:u.name,extendProps:u.extendProps,order:u.order,style:{display:u.visible?"":"none"}},u.props)):null}}),Ft=N({__name:"InputSetter",setup(u){return(e,t)=>(c(),y(s(W),K({clearable:""},e.$attrs),null,16))}}),Jt=N({__name:"SelectSetter",props:{options:{default:()=>[]}},setup(u){const e=u;return(t,l)=>(c(),y(s(Ze),We(jt(t.$attrs)),{default:m(()=>[(c(!0),V(M,null,F(e.options,n=>(c(),y(s(Xe),K({key:n.label},n),null,16))),128))]),_:1},16))}}),fs="{{",hs="}}",_s=N({__name:"ExpressionSetter",props:{modelValue:{default:()=>({type:"JSExpression",value:""})}},emits:["change"],setup(u,{emit:e}){const t=u,{project:l}=Y(),n=r=>{var p;const o=(p=l.current.value)==null?void 0:p.runtimeContext;return he(r,o)},a=k(t.modelValue.value);te(()=>t.modelValue.value,r=>{a.value=r});const i=r=>{const o={type:"JSExpression",value:r};n(o)&&e("change",o)};return(r,o)=>(c(),y(s(W),{class:"vtj-expression-setter",modelValue:a.value,"onUpdate:modelValue":o[0]||(o[0]=p=>a.value=p),onChange:i},{prefix:m(()=>[q(H(fs))]),suffix:m(()=>[q(H(hs))]),_:1},8,["modelValue"]))}}),de=_n(()=>Vn(()=>import("./Editor-f85f8dad.js"),["./Editor-f85f8dad.js","./monaco-editor-919908db.js","./monaco-editor-456639a7.css","./@vue-74e1d4f0.js","./Editor-51e536fd.css"],import.meta.url)),gs=T("i",{class:"vtj-icon-more"},null,-1),bs={key:0,class:"vtj-tabs__check"},Rt=N({__name:"Tabs",props:{items:{default:()=>[]},modelValue:{},more:{},stretch:{type:Boolean},checkable:{type:Boolean}},emits:["update:modelValue","more","tab-remove"],setup(u,{emit:e}){var i,r;const t=u,l=k((r=t.modelValue||((i=t.items[0])==null?void 0:i.name))!=null?r:"");te(l,()=>{e("update:modelValue",l.value)}),te(()=>t.modelValue,o=>{l.value=o});const n=o=>{e("more",o)},a=o=>{e("tab-remove",o)};return(o,p)=>(c(),y(fe,K({class:"vtj-tabs"},o.$attrs),{title:m(()=>[h(s(dt),{type:"card",modelValue:l.value,"onUpdate:modelValue":p[0]||(p[0]=f=>l.value=f),onTabRemove:a,stretch:t.stretch},{default:m(()=>[(c(!0),V(M,null,F(t.items,f=>(c(),y(s(ct),{key:f.name,label:f.label,name:f.name,closable:f.closable,lazy:""},null,8,["label","name","closable"]))),128))]),_:1},8,["modelValue","stretch"])]),tools:m(()=>[t.more?(c(),y(s(yt),{key:0,"hide-on-click":!1,size:"small",placement:"bottom-end",onCommand:n},{dropdown:m(()=>[h(s(Et),null,{default:m(()=>[(c(!0),V(M,null,F(t.more,f=>(c(),y(s(kt),{key:f.name,command:f},{default:m(()=>[t.checkable?(c(),V("span",bs,[T("i",{class:X(`${f.checked?"vtj-icon-check":"none"}`)},null,2)])):x("",!0),q(" "+H(f.label),1)]),_:2},1032,["command"]))),128))]),_:1})]),default:m(()=>[gs]),_:1})):x("",!0)]),default:m(()=>[ne(o.$slots,"default")]),_:3},16))}});const zt=N({__name:"Icon",props:{icon:{},label:{},active:{type:Boolean,default:!1},open:{type:Boolean,default:!1}},emits:["click"],setup(u,{emit:e}){const t=u,l=R(()=>({"is-active":t.active,"is-open":t.open})),n=()=>{e("click")};return(a,i)=>(c(),y(s(Wt),{effect:"dark",placement:"right",content:a.label,"show-after":600},{default:m(()=>[T("div",{class:X(["vtj-icon",l.value]),onClick:n},[T("i",{class:X(a.icon)},null,2)],2)]),_:1},8,["content"]))}}),oe=N({__name:"SubPanel",setup(u){return(e,t)=>(c(),y(fe,K({class:"vtj-sub-panel"},e.$attrs),Kt({default:m(()=>[ne(e.$slots,"default")]),_:2},[e.$slots.footer?{name:"footer",fn:m(()=>[ne(e.$slots,"footer")]),key:"0"}:void 0]),1040))}});const ys=["onClick"],ks={class:"vtj-data-item__title"},Es={class:"vtj-data-item__action"},Vs=["onClick"],Cs=["onClick"],Ss={key:0,class:"vtj-data-item__body"},ce=N({__name:"DataItem",props:{title:{default:""},content:{default:""},editable:{type:Boolean,default:!1},removable:{type:Boolean,default:!1},active:{type:Boolean,default:!1},collapsible:{type:Boolean,default:!1},clickable:{type:Boolean,default:!1},collapsed:{type:Boolean,default:!1},background:{type:Boolean,default:!0}},emits:["click","remove","edit"],setup(u,{emit:e}){const t=u,l=k(t.collapsed),n=()=>{e("edit")},a=()=>{e("remove")},i=()=>{t.clickable?e("click"):r()},r=()=>{t.collapsible&&(l.value=!l.value)};return(o,p)=>(c(),V("div",{class:X(["vtj-data-item",{"is-current":t.active}])},[T("div",{class:X(["vtj-data-item__header",{"is-pointer":t.clickable||t.collapsible,"is-bg":t.background}]),onClick:i},[t.collapsible?(c(),V("i",{key:0,class:X(["vtj-icon-greater arrow",{open:!l.value}]),onClick:Z(r,["stop"])},null,10,ys)):x("",!0),T("div",ks,[ne(o.$slots,"title",{},()=>[q(H(t.title),1)])]),T("div",Es,[ne(o.$slots,"action"),t.editable?(c(),V("i",{key:0,class:"vtj-icon-edit",title:"编辑",onClick:Z(n,["stop"])},null,8,Vs)):x("",!0),t.removable?(c(),V("i",{key:1,class:"vtj-icon-remove",title:"删除",onClick:Z(a,["stop"])},null,8,Cs)):x("",!0)])],2),t.content||o.$slots.default?Ee((c(),V("div",Ss,[ne(o.$slots,"default",{},()=>[q(H(t.content),1)])],512)),[[je,!l.value]]):x("",!0)],2))}});const ws={class:"vtj-context-viewer"},xs=["onClick"],js=N({__name:"ContextViewer",emits:["pick"],setup(u,{emit:e}){const{copy:t}=el({}),{project:l}=Y(),n=R(()=>{var d;return(d=l.current.value)==null?void 0:d.runtimeContext}),a=["$provider","$apis","$components","context"],i=d=>{const _=d.value,g=st(_);return g==="Object"||g==="Module"?Object.keys(_||{}).length===0:g==="Array"?_.length===0:!0},r=(d,_="this")=>typeof d=="object"?Array.isArray(d)?d.map((g,v)=>{const b=`[${v}]`;return{label:b,value:g,type:st(g),path:`${_}${b}`}}):Object.entries(d).map(([g,v])=>({label:g,value:v,type:st(v),path:`${_}.${g}`})).filter(g=>!g.label.startsWith("__")&&!a.includes(g.label)):[],o=(d,_)=>{if(d.level===0)_(r(n.value));else{const g=Qe(d.data.value);_(r(g,d.data.path))}},p=d=>{t(d.path),ve.success({message:"已经复制到粘贴板"})},f=d=>{e("pick",d.path)};return(d,_)=>(c(),V("div",ws,[n.value?(c(),y(s(Vt),{key:0,lazy:"",load:o,"expand-on-click-node":!1,props:{isLeaf:i}},{default:m(({data:g})=>[h(s(ce),{title:g.label,clickable:"",onClick:v=>f(g)},{action:m(()=>[T("i",{class:"vtj-icon-copy",title:"复制",onClick:Z(v=>p(g),["stop"])},null,8,xs)]),_:2},1032,["title","onClick"])]),_:1},8,["props"])):x("",!0)]))}});const $s={key:0,class:"vtj-binder__common"},Rs=["onClick"],Ds={class:"vtj-binder__footer"},tt=N({__name:"Binder",props:{clearable:{type:Boolean,default:!0}},emits:["submit","cancel","remove","pick"],setup(u,{expose:e,emit:t}){const l=u,n=[{name:"common",label:"常用"},{name:"viewer",label:"高级"}],a=k("common"),{project:i}=Y(),r=k(""),{searchResult:o}=os(i.current,r),{copy:p}=el({}),f=k(),d=()=>{t("submit")},_=()=>{t("cancel"),f.value.close()},g=()=>{t("remove")},v=S=>{t("pick",S)},b=S=>{p(S),ve.success({message:"已经复制到粘贴板"})};return e({close:()=>{f.value.close()}}),(S,A)=>(c(),y(se,{ref_key:"dialogRef",ref:f,"body-padding":!1,width:"1000px",height:"600px"},{default:m(()=>[h(s(vt),{class:"vtj-binder"},{default:m(()=>[h(s(pt),null,{default:m(()=>[h(Rt,{items:n,modelValue:a.value,"onUpdate:modelValue":A[1]||(A[1]=C=>a.value=C)},{default:m(()=>[a.value==="common"?(c(),V("div",$s,[h(s(W),{modelValue:r.value,"onUpdate:modelValue":A[0]||(A[0]=C=>r.value=C),size:"small",clearable:"","prefix-icon":s(ll),placeholder:"筛选可用项"},null,8,["modelValue","prefix-icon"]),(c(!0),V(M,null,F(s(o),C=>(c(),V("div",null,[h(s(Ct),{"border-style":"dotted"},{default:m(()=>[q(H(C.title),1)]),_:2},1024),(c(!0),V(M,null,F(C.items,P=>(c(),y(ce,{clickable:"",title:P,onClick:j=>v(P)},{action:m(()=>[T("i",{class:"vtj-icon-copy",title:"复制",onClick:Z(j=>b(P),["stop"])},null,8,Rs)]),_:2},1032,["title","onClick"]))),256))]))),256)),s(o).length?x("",!0):(c(),y(s(le),{key:0}))])):x("",!0),a.value==="viewer"?(c(),y(js,{key:1,onPick:v})):x("",!0)]),_:1},8,["modelValue"])]),_:1}),h(s(Yt),null,{default:m(()=>[h(fe,{title:null},{footer:m(()=>[T("div",Ds,[T("span",null,[l.clearable?(c(),y(s(re),{key:0,size:"default",type:"warning",onClick:g},{default:m(()=>[q(" 移除绑定 ")]),_:1})):x("",!0)]),T("span",null,[h(s(re),{size:"default",onClick:_},{default:m(()=>[q("取消")]),_:1}),h(s(re),{size:"default",type:"primary",onClick:d},{default:m(()=>[q(" 确定 ")]),_:1})])])]),default:m(()=>[ne(S.$slots,"default")]),_:3})]),_:3})]),_:3})]),_:3},512))}});const Ts=N({__name:"VarBinder",props:{value:{default:""},defaults:{default:""},type:{default:"JSExpression"}},emits:["submit"],setup(u,{emit:e}){const t=u,{project:l}=Y(),n=k(t.value||t.defaults),a=R(()=>`绑定内容 [ ${t.type} ]`),i=k(),r=k(),o=d=>{var g;const _=(g=l.current.value)==null?void 0:g.runtimeContext;return he({value:d,type:t.type},_)},p=()=>{const d=i.value.getEditor().getValue().trim();d?o(d)&&(e("submit",{type:t.type,value:d}),r.value.close()):ge.warning({message:"请输入绑定内容"})},f=d=>{var g;((g=i.value)==null?void 0:g.getEditor())&&(n.value=d)};return(d,_)=>(c(),y(tt,{ref_key:"binderRef",ref:r,title:"变量绑定",onSubmit:p,onPick:f},{default:m(()=>[h(s(Q),{class:"vtj-var-binder","label-position":"top"},{default:m(()=>[h(s(J),{label:a.value},{default:m(()=>[h(s(de),{ref_key:"editorRef",ref:i,"model-value":n.value,width:"100%",height:"100%",dark:""},null,8,["model-value"])]),_:1},8,["label"])]),_:1})]),_:1},512))}});const Is=N({__name:"EventBinder",props:{name:{},event:{},node:{}},emits:["submit","remove"],setup(u,{emit:e}){var v,b,E;const t=u,{assets:l,project:n}=Y(),a=k(),i=k(),r=k(Object.keys(((v=t.event)==null?void 0:v.modifiers)||{})),o=R(()=>{var C;const S=(C=t.node)==null?void 0:C.name;if(!S)return[];const A=l.componentMap[S];if(A&&A.events){const P=A.events.find(j=>j===t.name||j.name===t.name);if(P&&P.params)return P.params||[]}return[]}),p=k(((E=(b=t.event)==null?void 0:b.handler)==null?void 0:E.value)||`(${o.value.join(", ")}) => {\r
\r
}`),f=S=>{var C;const A=(C=n.current.value)==null?void 0:C.runtimeContext;return he({value:S,type:"JSFunction"},A)},d=()=>{const S=a.value.getEditor().getValue().trim();if(S){if(f(S)){const A={handler:{type:"JSFunction",value:S},modifiers:r.value.reduce((C,P)=>(C[P]=!0,C),{})};e("submit",A),i.value.close()}}else ge.warning({message:"请输入绑定内容"})},_=S=>{var C;((C=a.value)==null?void 0:C.getEditor())&&(p.value=S)},g=()=>{e("remove",t.name)};return(S,A)=>(c(),y(tt,{ref_key:"binderRef",ref:i,title:"事件绑定",subtitle:t.name,onSubmit:d,onPick:_,onRemove:g},{default:m(()=>[h(s(Q),{class:"vtj-event-binder","label-position":"top"},{default:m(()=>[h(s(J),{label:"事件修饰符"},{default:m(()=>[h(s(Gl),{modelValue:r.value,"onUpdate:modelValue":A[0]||(A[0]=C=>r.value=C)},{default:m(()=>[(c(!0),V(M,null,F(s($l),C=>(c(),y(s(ql),{key:C,label:C},null,8,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),h(s(J),{label:"事件处理函数"},{default:m(()=>[h(s(de),{ref_key:"editorRef",ref:a,width:"100%",height:"360px",dark:"","model-value":p.value},null,8,["model-value"])]),_:1})]),_:1})]),_:1},8,["subtitle"]))}});const As=["draggable","onDragstart","onClick","title"],Ns=["src"],Ps={key:1,class:"vtj-components__name"},Os={key:2,class:"vtj-components__footer"},Ls=["onClick"],Bs=["onClick"],He=N({__name:"ComponentList",props:{list:{default:()=>[]},span:{default:6},editable:{type:Boolean},removable:{type:Boolean},active:{},type:{}},emits:["edit","remove","click"],setup(u,{emit:e}){const t=u;function l(o,p){return O(this,null,function*(){t.type==="Schema"&&(o.from={type:"Schema",id:o.id}),w.emit(gt,o)})}function n(){w.emit(bt)}function a(o){e("edit",o)}function i(o){e("remove",o)}function r(o){e("click",o)}return(o,p)=>t.list.length?(c(),y(s(Yl),{key:0,class:"vtj-components__box",gutter:10},{default:m(()=>[(c(!0),V(M,null,F(t.list,f=>(c(),y(s(Wl),{span:t.span},{default:m(()=>[T("div",{class:X(["vtj-components__item",{"is-active":t.active&&t.active(f)}]),draggable:!(t.active&&t.active(f)),onDragstart:d=>l(f),onDragend:n,onClick:d=>r(f),title:f.name},[f.icon?(c(),V("img",{key:0,src:f.icon,alt:""},null,8,Ns)):(c(),V("span",Ps,H(f.name),1)),T("span",null,H(f.title),1),t.editable||t.removable?(c(),V("div",Os,[t.editable?(c(),V("i",{key:0,onClick:Z(d=>a(f),["stop"]),class:"vtj-icon-edit"},null,8,Ls)):x("",!0),t.removable?(c(),V("i",{key:1,onClick:Z(d=>i(f),["stop"]),class:"vtj-icon-remove"},null,8,Bs)):x("",!0)])):x("",!0)],42,As)]),_:2},1032,["span"]))),256))]),_:1})):(c(),y(s(le),{key:1,description:"暂无数据","image-size":60}))}});const Us={key:0,class:"vtj-list-panel__search"},Ms=T("i",{class:"vtj-icon-search"},null,-1),il=N({__name:"ListPanel",props:{search:{type:[Boolean,Object],default:!1},tabs:{default:void 0},columnWidth:{default:100}},emits:["search-change"],setup(u,{emit:e}){var r,o;const t=u,l=k(null),n=k(6),a=k("");te(a,()=>{e("search-change",a.value)});const i=k((o=(r=t.tabs)==null?void 0:r[0])==null?void 0:o.name);return tl(l,p=>{const f=p[0],{width:d}=f.contentRect,_=Math.min(Math.floor(d/120),24);n.value=Math.floor(24/_)}),(p,f)=>(c(),y(fe,{class:"vtj-list-panel",ref_key:"panel",ref:l},{default:m(()=>[t.search?(c(),V("div",Us,[h(s(W),K({size:"small"},p.search,{modelValue:a.value,"onUpdate:modelValue":f[0]||(f[0]=d=>a.value=d),clearable:""}),{prefix:m(()=>[Ms]),_:1},16,["modelValue"])])):x("",!0),t.search&&a.value?(c(),y(s(dt),{key:1},{default:m(()=>[h(s(ct),{label:"搜索结果"},{default:m(()=>[ne(p.$slots,"search",{search:a.value,span:n.value})]),_:3})]),_:3})):x("",!0),Ee(h(s(dt),{modelValue:i.value,"onUpdate:modelValue":f[1]||(f[1]=d=>i.value=d),class:"vtj-list-panel__tabs"},{default:m(()=>[(c(!0),V(M,null,F(t.tabs,d=>(c(),y(s(ct),{key:d.name,label:d.label,name:d.name,lazy:""},{default:m(()=>[ne(p.$slots,"tab",{tab:d,span:n.value},()=>[d.component?(c(),y($t(d.component),K({key:0,tab:d.name,currentTab:i.value,search:a.value,span:n.value},d.props),null,16,["tab","currentTab","search","span"])):x("",!0)])]),_:2},1032,["label","name"]))),128))]),_:3},8,["modelValue"]),[[je,t.tabs&&!a.value]]),ne(p.$slots,"default",{currentTab:i.value,search:a.value,span:n.value})]),_:3},512))}});const Fs=N({__name:"JSONSetter",props:{modelValue:{type:[Boolean,String,Number,null,Array,Object],default:void 0}},emits:["change"],setup(u,{emit:e}){const t=u,l=k(),n=k(typeof t.modelValue=="object"?JSON.stringify(t.modelValue,null,2):void 0),a=R(()=>!!n.value),i=k(!1),r=d=>{let _=!0;try{if(typeof JSON.parse(d)!="object")throw new Error(`"${d}" is not a JSON`)}catch(g){_=!1,ge.error({title:"代码错误",message:(g==null?void 0:g.message)||g})}return _},o=()=>{var _;const d=(_=l.value)==null?void 0:_.getEditor();if(d){const g=d.getValue();r(g)&&(n.value=g,e("change",JSON.parse(g)),i.value=!1)}},p=()=>{n.value="",e("change",void 0),i.value=!1},f=()=>{i.value=!0};return(d,_)=>(c(),V("div",{class:X(["vtj-json-setter",{"is-active":a.value}])},[h(s(W),K({readonly:"",onFocus:f,"model-value":"JSON","suffix-icon":s(nl)},d.$attrs),null,16,["suffix-icon"]),i.value?(c(),y(s(se),{key:0,modelValue:i.value,"onUpdate:modelValue":_[0]||(_[0]=g=>i.value=g),title:"JSON",width:"1000px",height:"600px",cancel:"",submit:"",clear:"",onSubmit:o,onClear:p},{default:m(()=>[h(s(de),{ref_key:"codeEditor",ref:l,height:"100%",lang:"json",dark:"","model-value":n.value},null,8,["model-value"])]),_:1},8,["modelValue"])):x("",!0)],2))}});const Js=N({__name:"FunctionSetter",props:{modelValue:{default:()=>({type:"JSFunction",value:""})}},emits:["change"],setup(u,{emit:e}){const t=u,l=k(),n=k(t.modelValue.value),a=k(!1),i=R(()=>!!n.value),r=()=>{var d;const f=(d=l.value)==null?void 0:d.getEditor();if(f){const _=f.getValue(),g={type:"JSFunction",value:_};he(g,{})&&(n.value=_,e("change",g),a.value=!1)}},o=()=>{n.value="",e("change",void 0),a.value=!1},p=()=>{a.value=!0};return(f,d)=>(c(),V("div",{class:X(["vtj-function-setter",{"is-active":i.value}])},[h(s(W),K({readonly:"",onFocus:p,"model-value":"JSFunction","suffix-icon":s(nl)},f.$attrs),null,16,["suffix-icon"]),a.value?(c(),y(s(se),{key:0,modelValue:a.value,"onUpdate:modelValue":d[0]||(d[0]=_=>a.value=_),title:"JSFunction",width:"1000px",height:"600px",cancel:"",submit:"",clear:"",onSubmit:r,onClear:o},{default:m(()=>[h(s(de),{ref_key:"codeEditor",ref:l,height:"100%","model-value":n.value,dark:""},null,8,["model-value"])]),_:1},8,["modelValue"])):x("",!0)],2))}});const zs=N({__name:"BooleanSetter",setup(u){return(e,t)=>(c(),y(s(ke),K(e.$attrs,{"model-value":!!e.$attrs.modelValue}),null,16,["model-value"]))}}),Hs=N({__name:"ColorSetter",setup(u){return(e,t)=>(c(),y(s(Kl),We(jt(e.$attrs)),null,16))}}),Gs=N({__name:"NumberSetter",props:{modelValue:{}},emits:["change"],setup(u,{emit:e}){const t=u,l=R(()=>qe(t.modelValue)?void 0:Number(t.modelValue||0)),n=a=>{e("change",a)};return(a,i)=>(c(),y(s(Xl),K({class:"vtj-number-setter","controls-position":"right","model-value":l.value},a.$attrs,{onChange:n}),null,16,["model-value"]))}}),qs={class:"vtj-icon-setter"},Ws={class:"vtj-icon-setter__content"},Ys={class:"vtj-icon-setter__list"},rl=N({__name:"IconSetter",props:{modelValue:{default:""}},emits:["change","update:modelValue"],setup(u,{emit:e}){const t=u,l=k(!1),n=k(t.modelValue),a=k(""),i=R(()=>rt[t.modelValue]||t.modelValue),r=R(()=>{const _=Object.entries(rt);return a.value?_.filter(g=>g[0].toLowerCase().includes(a.value)):_}),o=_=>{n.value=_},p=()=>{e("change",n.value),e("update:modelValue",n.value),l.value=!1},f=()=>{n.value="",e("change",""),e("update:modelValue",""),l.value=!1},d=()=>{l.value=!0};return(_,g)=>(c(),V("div",qs,[h(s(W),{size:"small",readonly:"",placeholder:"请选择图标","model-value":t.modelValue,"suffix-icon":s(Sn),onFocus:d},{prepend:m(()=>[h(s(ut),{icon:i.value},null,8,["icon"])]),_:1},8,["model-value","suffix-icon"]),l.value?(c(),y(s(se),{key:0,title:"图标选择器",width:"1000px",height:"600px",cancel:"",submit:"",clear:"",modelValue:l.value,"onUpdate:modelValue":g[1]||(g[1]=v=>l.value=v),onSubmit:p,onClear:f},{default:m(()=>[T("div",Ws,[h(s(W),{size:"small","prefix-icon":s(ll),clearable:"",modelValue:a.value,"onUpdate:modelValue":g[0]||(g[0]=v=>a.value=v),placeholder:"请输入查询关键字"},null,8,["prefix-icon","modelValue"]),T("div",Ys,[(c(!0),V(M,null,F(r.value,v=>(c(),y(s(ut),{icon:v[1],onClick:b=>o(v[0]),class:X({"is-active":n.value===v[0]})},null,8,["icon","onClick","class"]))),256)),r.value.length===0?(c(),y(s(le),{key:0})):x("",!0)])])]),_:1},8,["modelValue"])):x("",!0)]))}});const Ht={StringSetter:Ft,InputSetter:Ft,SelectSetter:Jt,OptionSetter:Jt,ExpressionSetter:_s,JSONSetter:Fs,FunctionSetter:Js,BooleanSetter:zs,ColorSetter:Hs,NumberSetter:Gs,IconSetter:rl},ul={string:["InputSetter","SelectSetter"],number:["NumberSetter"],boolean:["BooleanSetter"],object:["JSONSetter"],function:["FunctionSetter"],array:["JSONSetter"],JSFunction:["FunctionSetter"],JSExpression:["ExpressionSetter"]},Ks={key:1},Xs={class:"vtj-setter__content"},Zs={key:0,class:"vtj-setter__input"},Qs={class:"vtj-setter__action"},ea=T("i",{class:"vtj-icon-switch",title:"切换设置器"},null,-1),ta={key:0,class:"vtj-icon-check"},la={key:1,class:"vtj-icon-placeholder"},na="{{",sa="}}",aa=N({__name:"SetterView",props:{name:{},label:{default:""},title:{},setters:{},variable:{type:Boolean,default:!0},value:{},options:{default:()=>[]},defaultSetter:{},removable:{type:Boolean}},emits:["change","remove"],setup(u,{emit:e}){const t=u,l=k(!1),n=k(""),a=k(t.setters.find(E=>E.name===t.defaultSetter)||t.setters[0]),i=k(t.value),r=R(()=>!!qe(i.value)),o={[a.value.name]:i.value},p=E=>{var S;o[a.value.name]=i.value,a.value=E,i.value=(S=o[E.name])!=null?S:void 0,f(i.value)};te(()=>t.value,()=>{i.value=t.value}),te(()=>t.defaultSetter,()=>{a.value=t.setters.find(E=>E.name===t.defaultSetter)||t.setters[0]});const f=E=>{e("change",E)},d=()=>{e("remove",t.name)},_=()=>{l.value=!0,n.value=qe(i.value)?i.value.value:""},g=()=>{l.value=!1,n.value=""},v=E=>{o[a.value.name]=i.value,i.value=E,e("change",E),g()},b=()=>{g(),i.value=void 0,e("change","")};return(E,S)=>(c(),y(s(J),{class:"vtj-setter",size:"small","label-positon":"left"},{label:m(()=>[t.title?(c(),y(s(Wt),{key:0,placement:"top-start",content:t.title},{default:m(()=>[q(H(t.label||t.name),1)]),_:1},8,["content"])):(c(),V("span",Ks,H(t.label||t.name),1))]),default:m(()=>[T("div",Xs,[a.value?(c(),V("div",Zs,[r.value?x("",!0):(c(),y($t(a.value.component),K({key:0},a.value.props,{options:t.options,modelValue:i.value,"onUpdate:modelValue":S[0]||(S[0]=A=>i.value=A),onChange:f,disabled:r.value}),null,16,["options","modelValue","disabled"])),r.value?(c(),y(s(W),{key:1,class:"vtj-expression-setter",disabled:"","model-value":"JSExpression"},{prefix:m(()=>[q(H(na))]),suffix:m(()=>[q(H(sa))]),_:1})):x("",!0)])):x("",!0),T("div",Qs,[t.variable?(c(),V("i",{key:0,onClick:_,class:X(["vtj-icon-vars",{"is-active":r.value}]),title:"绑定变量"},null,2)):x("",!0),t.setters.length>1?(c(),y(s(yt),{key:1,disabled:r.value,size:"small","popper-class":"vtj-setter-switch",onCommand:p},{dropdown:m(()=>[h(s(Et),null,{default:m(()=>[(c(!0),V(M,null,F(t.setters,A=>(c(),y(s(kt),{command:A,key:A.name},{default:m(()=>[A.name==a.value.name?(c(),V("i",ta)):(c(),V("i",la)),q(" "+H(A.label),1)]),_:2},1032,["command"]))),128))]),_:1})]),default:m(()=>[ea]),_:1},8,["disabled"])):x("",!0),t.removable?(c(),V("i",{key:2,onClick:d,class:"vtj-icon-remove",title:"删除"})):x("",!0)])]),l.value?(c(),y(Ts,{key:0,type:"JSExpression",value:n.value,modelValue:l.value,"onUpdate:modelValue":S[1]||(S[1]=A=>l.value=A),onSubmit:v,onRemove:b},null,8,["value","modelValue"])):x("",!0)]),_:1}))}});const _e=N({name:"SetterRenderer",props:{name:String,label:String,title:String,value:{type:[String,Object,Array,Number,Boolean],default:void 0},setters:{type:[String,Object,Array],required:!0,default(){return[]}},options:{type:Array,default(){return[]}},variable:{type:Boolean,default:!0},removable:{type:Boolean,default:!1}},computed:{computedSetters(){return(Array.isArray(this.setters)?this.setters:[this.setters]).map(e=>{let t;if(typeof e=="string")return t=this.getComopnent(e),{component:Ye(t),name:e,label:e,props:{}};{const l=e;return t=l.component||this.getComopnent(l.name),{component:Ye(t),name:l.name,label:l.label||l.name,props:l.props}}})},computedOptions(){return(this.options||[]).map(e=>typeof e=="string"?{label:e,value:e}:e)},defaultSetter(){var n,a;const{value:u,computedSetters:e}=this;let t=typeof u;t==="object"&&(Array.isArray(u)?t="array":qe(u)?t="JSExpression":Rl(u)&&(t="JSFunction"));const l=ul[t]||[];return l.length?(n=e.find(i=>l.includes(i.name))||e[0])==null?void 0:n.name:(a=e[0])==null?void 0:a.name}},render(){const{name:u,label:e,title:t,value:l,computedSetters:n,computedOptions:a,variable:i,changeValue:r,defaultSetter:o,removable:p,onRemove:f}=this;return Qt(aa,{name:u,label:e,title:t,setters:n,defaultSetter:o,variable:i,value:l,removable:p,options:a,onChange:r,onRemove:f})},emits:["change","remove"],methods:{getComopnent(u){return typeof u=="string"?Ht[u]||Ht.InputSetter:u},changeValue(u){this.$emit("change",this.name,u)},onRemove(u){this.$emit("remove",u)}}}),oa={class:"vtj-action"},ia=N({__name:"action",setup(u){const{regions:e}=Y(),t=R(()=>e.value.action);return(l,n)=>(c(),V("div",oa,[(c(!0),V(M,null,F(t.value,a=>(c(),y(s(Ve),K({key:a.name},z({},a)),null,16))),128))]))}});const ra={};function ua(u,e){return c(),V("div",null,"Empty")}const ca=Gt(ra,[["render",ua]]),da=["title","src"],pa={key:1},va=N({__name:"Logo",props:{icon:{},text:{default:"Vtj"},link:{}},setup(u,{expose:e}){const t=u,l=()=>{t.link&&(location.href=t.link)};return e({props:t}),(n,a)=>(c(),V("div",{class:"vtj-logo",onClick:l},[t.icon?(c(),V("img",{key:0,title:t.text,class:"vtj-logo__icon",src:t.icon},null,8,da)):(c(),V("span",pa,H(t.text),1))]))}});const ma=T("div",null,"多个资源可换行输入",-1),fa=N({__name:"Dependencies",setup(u){const{project:e}=Y(),t=[{name:"add",icon:"vtj-icon-plus"}],l={package:{required:!0,message:"包名不能为空"},version:{required:!0,message:"版本不能为空"},library:{required:!0,message:"导出变量名称不能为空"},urls:{required:!0,message:"资源URL不能为空"}},n=k(),a=k(),i=k(!1),r=k(!1),o=R(()=>e.dependencies.value),p=v=>{e.setDeps(v)},f=()=>{i.value=!0,r.value=!1,n.value={package:"",version:"",library:"",urls:"",assetsUrl:"",assetsLibrary:""}},d=v=>{i.value=!0,r.value=!0,n.value={package:v.package,version:v.version,library:v.library,urls:v.urls.join(`
`),assetsUrl:v.assetsUrl||"",assetsLibrary:v.assetsLibrary||""}},_=v=>{ue.confirm("确定删除该依赖项？","提示",{type:"warning"}).then(()=>{e.removeDeps(v)})},g=()=>{a.value.validate(v=>{var D,L;if(!v)return;const{version:b,library:E,urls:S,assetsUrl:A,assetsLibrary:C}=n.value;if(!((D=n.value)!=null&&D.package))return;const P={package:(L=n.value)==null?void 0:L.package,version:b,library:E,urls:S.trim().split(`
`),assetsUrl:A,assetsLibrary:C};e.dependencies.value.find(I=>I.package===P.package)&&!r.value?ve.warning({message:"已存在相同名称的依赖包"}):(e.setDeps(Qe(P)),i.value=!1)})};return(v,b)=>(c(),y(fe,{class:"vtj-deps",title:"依赖管理",tools:t,onToolClick:f},{default:m(()=>[(c(!0),V(M,null,F(o.value,E=>(c(),y(ce,{key:E.package,removable:!E.official,editable:!E.official,class:X({"vtj-deps__disabled":!E.enabled}),onEdit:S=>d(E),onRemove:S=>_(E)},{action:m(()=>[!E.required&&E.official?(c(),y(s(ke),{key:0,size:"small",modelValue:E.enabled,"onUpdate:modelValue":S=>E.enabled=S,onChange:S=>p(E)},null,8,["modelValue","onUpdate:modelValue","onChange"])):x("",!0)]),title:m(()=>[q(H(E.package)+"@"+H(E.version),1)]),_:2},1032,["removable","editable","class","onEdit","onRemove"]))),128)),i.value?(c(),y(se,{key:0,modelValue:i.value,"onUpdate:modelValue":b[6]||(b[6]=E=>i.value=E),title:`${r.value?"编辑":"新增"}依赖`,width:"1000px",height:"500px",submit:"",cancel:"",onSubmit:g},{default:m(()=>[n.value?(c(),y(s(Q),{key:0,ref_key:"form",ref:a,size:"small","label-width":"80px",model:n.value,rules:l},{default:m(()=>[h(s(J),{label:"npm包名",prop:"package"},{default:m(()=>[h(s(W),{modelValue:n.value.package,"onUpdate:modelValue":b[0]||(b[0]=E=>n.value.package=E),modelModifiers:{trim:!0},readonly:r.value,disabled:r.value},null,8,["modelValue","readonly","disabled"])]),_:1}),h(s(J),{label:"版本号",prop:"version"},{default:m(()=>[h(s(W),{modelValue:n.value.version,"onUpdate:modelValue":b[1]||(b[1]=E=>n.value.version=E),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1}),h(s(J),{label:"导出名称",prop:"library"},{default:m(()=>[h(s(W),{modelValue:n.value.library,"onUpdate:modelValue":b[2]||(b[2]=E=>n.value.library=E),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1}),h(s(J),{label:"资源URL",prop:"urls"},{default:m(()=>[h(s(W),{type:"textarea",rows:5,modelValue:n.value.urls,"onUpdate:modelValue":b[3]||(b[3]=E=>n.value.urls=E)},null,8,["modelValue"]),ma]),_:1}),h(s(J),{label:"资产URL",prop:"assetsUrl"},{default:m(()=>[h(s(W),{modelValue:n.value.assetsUrl,"onUpdate:modelValue":b[4]||(b[4]=E=>n.value.assetsUrl=E),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1}),h(s(J),{label:"资产名称",prop:"assetsLibrary"},{default:m(()=>[h(s(W),{modelValue:n.value.assetsLibrary,"onUpdate:modelValue":b[5]||(b[5]=E=>n.value.assetsLibrary=E),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])):x("",!0)]),_:1},8,["modelValue","title"])):x("",!0)]),_:1}))}}),ha=N({__name:"Viewport",props:{mode:{default:"pc"},width:{},height:{}},setup(u){const e=u,t={width:390,height:844},l={width:1180,height:820},n=R(()=>[`is-${e.mode}`]),a=R(()=>{if(e.mode==="pc")return 1;const r=e.mode==="mobile"?t:l,{width:o,height:p}=r,f=o>0?(e.width||0)/o:1,d=p>0?(e.height||0)/p:1;return Math.min(f,d)}),i=R(()=>{if(e.mode==="pc")return{};const r=e.mode==="mobile"?t:l,{width:o,height:p}=r;return{width:`${o}px`,height:`${p}px`,left:"50%",top:"50%",transform:`translate(-50%, -50%) scale(${a.value})`}});return(r,o)=>(c(),V("div",{class:X(["vtj-viewport",n.value]),style:Je(i.value)},[ne(r.$slots,"default")],6))}});const _a={class:"vtj-actions__layers"},ga=T("i",{class:"vtj-icon-layers"},null,-1),ba={key:0,class:"vtj-actions__tools"},ya=N({__name:"Actions",props:{position:{default:"left-top"},node:{},title:{default:""},path:{default:()=>[]}},emits:["action"],setup(u,{emit:e}){const t=u,l=R(()=>ee(t.node)),n=R(()=>t.path);function a(_){return ee(_)?"Block":"Node"}function i(){if(t.node.lock){ve.warning({message:"该节点已被锁定，不能删除"});return}ue.confirm("确定删除吗？","提示",{type:"warning"}).then(()=>{t.node.dispose(),Ue(()=>{e("action",{type:"remove"})})})}function r(){t.node.moveNext(),Ue(()=>{e("action",{type:"move",next:!0,node:t.node})})}function o(){t.node.movePrev(),Ue(()=>{e("action",{type:"move",prev:!0,node:t.node})})}function p(){const _=t.node.copy();Ue(()=>{e("action",{type:"copy",node:_})})}function f(_){e("action",{type:"hover",node:_})}function d(_){e("action",{type:"selected",node:_})}return(_,g)=>(c(),V("div",{class:X(["vtj-actions",[`is-${t.position}`]])},[T("div",_a,[h(s(yt),{size:"small",onCommand:d},{dropdown:m(()=>[n.value&&n.value.length?(c(),y(s(Et),{key:0},{default:m(()=>[(c(!0),V(M,null,F(n.value,v=>(c(),y(s(kt),{key:v.id,command:v,onMouseenter:b=>f(v)},{default:m(()=>[q(H(v.name)+" ",1),T("i",{class:X(`is-${a(v)}`)},H(a(v)),3)]),_:2},1032,["command","onMouseenter"]))),128))]),_:1})):x("",!0)]),default:m(()=>[T("div",null,[ga,q(H(t.title),1)])]),_:1})]),l.value?x("",!0):(c(),V("div",ba,[T("i",{class:"vtj-icon-arrow-up",title:"向前移动",onClick:o}),T("i",{class:"vtj-icon-arrow-down",title:"向后移动",onClick:r}),T("i",{onClick:p,class:"vtj-icon-copy",title:"复制"}),T("i",{onClick:i,class:"vtj-icon-remove",title:"删除"})]))],2))}});const ka={key:1,class:"vtj-designer__placeholder"},Ea=N({__name:"Designer",setup(u,{expose:e}){const{engine:t}=Y(),l=k(),n=k(),a=k({width:0,height:0});tl(n,S=>{const A=S[0];a.value=A.contentRect});const i=new bi(t,l,es),{hover:r,dropping:o,selected:p,onAction:f,viewportMode:d}=me(i),_=t.project.current,g=R(()=>{var S;return((S=_.value)==null?void 0:S.children.length)===0}),v=R(()=>{var S;return ee((S=r.value)==null?void 0:S.node)}),b=R(()=>{var S;return ee((S=p.value)==null?void 0:S.node)}),E=R(()=>{var C;const{width:S=0,height:A=0}=((C=p.value)==null?void 0:C.rect)||{};return S>0||A>0});return e({designer:i,selected:p}),(S,A)=>(c(),V("div",{ref_key:"container",ref:n,class:"vtj-designer"},[Ee(h(ha,{mode:s(d),width:a.value.width,height:a.value.height},{default:m(()=>[T("iframe",{ref_key:"iframe",ref:l,frameborder:"0"},null,512),s(o)?(c(),V("div",{key:0,class:X(["vtj-designer__dropping","is-inner"]),style:Je(s(o).style)},null,4)):x("",!0),s(r)?(c(),V("div",{key:1,class:"vtj-designer__hover",style:Je(s(r).style)},[Ee(T("span",{class:X(["vtj-designer__hover-title",`is-${s(r).position}`])},[q(H(s(r).node.name)+": ",1),T("i",null,H(s(r).node.id),1)],2),[[je,!v.value]])],4)):x("",!0),s(p)?Ee((c(),V("div",{key:2,class:"vtj-designer__selected",style:Je(s(p).style)},[b.value?x("",!0):(c(),y(ya,{key:0,title:s(p).node.name,node:s(p).node,path:s(p).path,position:s(p).position,onAction:s(f)},null,8,["title","node","path","position","onAction"]))],4)),[[je,E.value]]):x("",!0)]),_:1},8,["mode","width","height"]),[[je,s(_)]]),s(_)?x("",!0):(c(),y(s(le),{key:0,description:"请在文档管理器新建或打开文件"})),g.value?(c(),V("div",ka," 您可以拖拽组件放置到这里 ")):x("",!0)],512))}});const Va=N({__name:"Components",setup(u){const e={placeholder:"搜索组件"},{engine:t}=Y(),{componentGroups:l,components:n}=t.assets||{},a=R(()=>{const _={};return l&&l.forEach(g=>{_[g.name]=g}),_}),i=R(()=>l?l.map(_=>{var g;return{label:`${_.label} (${_.count})`,name:_.name,disabled:!((g=_.children)!=null&&g.length)}}):[]),r=(_=[])=>_.map((g,v)=>v),o=be({});xt(()=>{const _=i.value.reduce((g,v)=>(g[v.name]=r(a.value[v.name].children),g),{});Object.assign(o,_)});const{searchKey:p,searchResult:f}=Un(n),d=_=>{p.value=_};return(_,g)=>(c(),y(il,{class:"vtj-components",title:"组件库",search:e,tabs:i.value,onSearchChange:d},{search:m(({span:v})=>[h(He,{list:s(f),span:v},null,8,["list","span"])]),tab:m(({tab:v,span:b})=>{var E,S;return[a.value[v.name].components?(c(),y(He,{key:0,list:a.value[v.name].components,span:b},null,8,["list","span"])):x("",!0),(E=a.value[v.name].children)!=null&&E.length?(c(),y(s(Zl),{key:1,modelValue:o[v.name],"onUpdate:modelValue":A=>o[v.name]=A},{default:m(()=>[(c(!0),V(M,null,F(a.value[v.name].children,(A,C)=>(c(),y(s(Ql),{key:A.name,title:`${A.label} (${A.count})`,name:C},{default:m(()=>[h(He,{list:A.components,span:b},null,8,["list","span"])]),_:2},1032,["title","name"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):x("",!0),!a.value[v.name].components&&((S=a.value[v.name].children)==null?void 0:S.length)===0?(c(),y(s(le),{key:2,description:"暂无数据"})):x("",!0)]}),default:m(()=>[!s(l)||s(l).length===0?(c(),y(s(le),{key:0,description:"暂无数据"})):x("",!0)]),_:1},8,["tabs"]))}});const Ca=["onClick"],Sa=["onClick"],wa={class:"vtj-pages__name"},xa={key:0,class:"vtj-pages__home"},ja=N({__name:"Pages",setup(u){const{project:e,engine:t}=Y(),l=[{name:"add",icon:"vtj-icon-plus"}],n={name:[{required:!0,message:"名称为必填项"}],title:[{required:!0,message:"标题为必填项"}]},a=R(()=>e.pages.value),i=j=>{var D;return j===((D=e.current.value)==null?void 0:D.id)},r={id:"",name:"",title:"",isDir:!1,icon:"",mask:!0,home:!1,hidden:!1},o=k(),p=k(!1),f=k(),d=k(),_=j=>O(this,null,function*(){if(j.isDir)return;const D=j.id,L=yield t.service.getFile(D);e.activeFile(L)}),g=()=>{d.value=void 0,o.value=z({},r),p.value=!0},v=j=>{d.value=j.id,o.value=z({},r),p.value=!0},b=j=>{o.value=z({},j),p.value=!0},E=(j,D)=>O(this,null,function*(){var B;const L=j.id,I=(B=D.parent)==null?void 0:B.data.id,G=yield t.service.getFile(L);e.copyPage(j,G,I)}),S=j=>O(this,null,function*(){if(!j.id)return;if(j.children&&j.children.length>0){ve.warning({message:"该目录有子页面文件，不能删除。"});return}(yield ue.confirm("确定删除？","提示",{type:"warning"}).catch(L=>!1))&&e.removePage(j.id)}),A=()=>O(this,null,function*(){if(yield f.value.validate().catch(D=>!1)){if(o.value.id){const D=o.value.isDir?void 0:yield t.service.getFile(o.value.id);e.updatePage(o.value,D)}else{const D=e.addPage(o.value,d.value);!e.current.value&&!o.value.isDir&&e.activeFile(D.toDsl())}p.value=!1}}),C=(j,D,L)=>L==="inner"?!!D.data.isDir:!0,P=()=>{e.update({pages:a.value})};return(j,D)=>(c(),y(s(fe),{title:"页面管理",tools:l,onToolClick:g},{default:m(()=>[a.value.length===0?(c(),y(s(le),{key:0,description:"您还没创建文件"})):x("",!0),a.value.length?(c(),y(s(Vt),{key:1,"node-key":"id","default-expand-all":!0,data:a.value,draggable:"","allow-drop":C,onNodeDrop:P,class:"vtj-pages-items"},{default:m(({node:L,data:I})=>[h(s(ce),{title:I.title,active:i(I.id),onClick:G=>_(I),onEdit:G=>b(I),onRemove:G=>S(I),clickable:!I.isDir,editable:"",removable:""},{action:m(()=>[I.isDir?(c(),V("i",{key:0,onClick:Z(G=>v(I),["stop"]),class:"vtj-icon-plus",title:"新增"},null,8,Ca)):x("",!0),I.isDir?x("",!0):(c(),V("i",{key:1,onClick:Z(G=>E(I,L),["stop"]),class:"vtj-icon-copy",title:"复制"},null,8,Sa))]),title:m(()=>[h(s(ut),{icon:s(rt)[I.icon]||I.icon},null,8,["icon"]),q(" "+H(I.title)+" ",1),T("i",wa,H(I.name),1),I.home?(c(),V("span",xa,"首页 ")):x("",!0)]),_:2},1032,["title","active","onClick","onEdit","onRemove","clickable"])]),_:1},8,["data"])):x("",!0),p.value?(c(),y(s(se),{key:2,modelValue:p.value,"onUpdate:modelValue":D[7]||(D[7]=L=>p.value=L),width:"600px",title:o.value.id?"修改页面":"新增页面",submit:"",cancel:"",onSubmit:A},{default:m(()=>[h(s(Q),{ref_key:"formRef",ref:f,model:o.value,rules:n,size:"small","label-position":"right","label-width":"80px"},{default:m(()=>[h(s(J),{label:"类型",prop:"isDir"},{default:m(()=>[h(s(St),{modelValue:o.value.isDir,"onUpdate:modelValue":D[0]||(D[0]=L=>o.value.isDir=L),disabled:!!o.value.id},{default:m(()=>[h(s(Ie),{label:!1},{default:m(()=>[q("页面")]),_:1}),h(s(Ie),{label:!0},{default:m(()=>[q("目录")]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1}),h(s(J),{label:"标题描述",prop:"title"},{default:m(()=>[h(s(W),{modelValue:o.value.title,"onUpdate:modelValue":D[1]||(D[1]=L=>o.value.title=L)},null,8,["modelValue"])]),_:1}),h(s(J),{label:"名称编码",prop:"name"},{default:m(()=>[h(s(W),{modelValue:o.value.name,"onUpdate:modelValue":D[2]||(D[2]=L=>o.value.name=L)},null,8,["modelValue"])]),_:1}),h(s(J),{label:"菜单图标",prop:"icon"},{default:m(()=>[h(rl,{modelValue:o.value.icon,"onUpdate:modelValue":D[3]||(D[3]=L=>o.value.icon=L)},null,8,["modelValue"])]),_:1}),o.value.isDir?x("",!0):(c(),y(s(J),{key:0,label:"包含母版",prop:"mask"},{default:m(()=>[h(s(ke),{modelValue:o.value.mask,"onUpdate:modelValue":D[4]||(D[4]=L=>o.value.mask=L)},null,8,["modelValue"])]),_:1})),o.value.isDir?x("",!0):(c(),y(s(J),{key:1,label:"站点首页",prop:"mask"},{default:m(()=>[h(s(ke),{modelValue:o.value.home,"onUpdate:modelValue":D[5]||(D[5]=L=>o.value.home=L)},null,8,["modelValue"])]),_:1})),o.value.isDir?x("",!0):(c(),y(s(J),{key:2,label:"隐藏菜单",prop:"mask"},{default:m(()=>[h(s(ke),{modelValue:o.value.hidden,"onUpdate:modelValue":D[6]||(D[6]=L=>o.value.hidden=L)},null,8,["modelValue"])]),_:1}))]),_:1},8,["model"])]),_:1},8,["modelValue","title"])):x("",!0)]),_:1}))}});const $a=N({__name:"Blocks",setup(u){const{project:e,engine:t}=Y(),l=[{name:"add",icon:"vtj-icon-plus"}],n={id:"",name:"",title:""},a={name:[{required:!0,message:"请输入组件名称",trigger:"blur"}],title:[{required:!0,message:"请输入标题备注",trigger:"blur"}]},i=k(),r=k(),o=R(()=>e.blocks.value),p=k(!1),f=E=>{var S;return E.id===((S=e.current.value)==null?void 0:S.id)},d=()=>{r.value=z({},n),p.value=!0},_=()=>O(this,null,function*(){if(yield i.value.validate().catch(S=>!1)){if(e.existBlockName(r.value)){ve.warning({message:"已存在相同名称的区块，请更换名称"});return}if(r.value.id){const S=yield t.service.getFile(r.value.id);e.updateBlock(r.value,S)}else e.addBlock(r.value);p.value=!1}}),g=E=>{r.value=E,p.value=!0},v=E=>O(this,null,function*(){(yield ue.confirm("确定删除？","提示",{type:"warning"}))&&e.removeBlock(E.id)}),b=E=>O(this,null,function*(){const S=E.id,A=yield t.service.getFile(S);e.activeFile(A)});return(E,S)=>(c(),y(s(il),{title:"区块管理",tools:l,onToolClick:d},{default:m(({span:A})=>[h(s(He),{list:o.value,span:A,active:f,type:"Schema",editable:"",removable:"",onEdit:g,onRemove:v,onClick:b},null,8,["list","span"]),p.value?(c(),y(s(se),{key:0,modelValue:p.value,"onUpdate:modelValue":S[2]||(S[2]=C=>p.value=C),title:r.value.id?"修改":"新增",width:"500px",submit:"",cancel:"",onSubmit:_},{default:m(()=>[h(s(Q),{ref_key:"formRef",ref:i,size:"small",model:r.value,rules:a},{default:m(()=>[h(s(J),{label:"组件名称",prop:"name"},{default:m(()=>[h(s(W),{modelValue:r.value.name,"onUpdate:modelValue":S[0]||(S[0]=C=>r.value.name=C)},null,8,["modelValue"])]),_:1}),h(s(J),{label:"标题备注",prop:"title"},{default:m(()=>[h(s(W),{modelValue:r.value.title,"onUpdate:modelValue":S[1]||(S[1]=C=>r.value.title=C)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])):x("",!0)]),_:1}))}}),Ra=T("i",{class:"vtj-icon-pc"},null,-1),Da=T("i",{class:"vtj-icon-phone"},null,-1),Ta=T("i",{class:"vtj-icon-pad"},null,-1),Ia=T("i",{class:"vtj-icon-undo"},null,-1),Aa=T("i",{class:"vtj-icon-redo"},null,-1),Na=N({__name:"Toolbar",setup(u){const{engine:e}=Y(),t=k("pc"),l=R(()=>{const{index:o=0,list:p=[]}=e.simulator.history.value||{};return o<p.length-1}),n=R(()=>{const{index:o=0,list:p=[]}=e.simulator.history.value||{};return o>0}),a=()=>{var o;(o=e.simulator.history.value)==null||o.back()},i=()=>{var o;(o=e.simulator.history.value)==null||o.go()},r=o=>{w.emit(dl,o)};return(o,p)=>(c(),V("div",null,[h(s(St),{size:"small",modelValue:t.value,"onUpdate:modelValue":p[0]||(p[0]=f=>t.value=f),onChange:r},{default:m(()=>[h(s(Ie),{label:"pc"},{default:m(()=>[Ra]),_:1}),h(s(Ie),{label:"mobile"},{default:m(()=>[Da]),_:1}),h(s(Ie),{label:"pad"},{default:m(()=>[Ta]),_:1})]),_:1},8,["modelValue"]),x("",!0),h(s(en),null,{default:m(()=>[h(s(re),{type:"default",size:"small",onClick:a,disabled:!l.value},{default:m(()=>[Ia]),_:1},8,["disabled"]),h(s(re),{type:"default",size:"small",onClick:i,disabled:!n.value},{default:m(()=>[Aa]),_:1},8,["disabled"])]),_:1})]))}});const Pa={key:0,class:"vtj-outline__actions"},Oa=["onClick"],La=["onClick"],Ba=["onClick"],Ua=["onClick"],Ma=["onClick"],Fa=["onClick"],Ja={class:"vtj-outline__status"},za={key:0,class:"vtj-icon-invisible",title:"不可见"},Ha={key:1,class:"vtj-icon-lock",title:"已锁定"},Ga=N({__name:"Outline",setup(u){const{engine:e,project:t,assets:l}=Y(),n=R(()=>{var C;return(C=e.skeleton.widgetInstances.designer)==null?void 0:C.designer}),a=C=>C.root===null,i=k([]);function r(C){return ee(C)?"Block":C.slot&&C.slot.name?`#${C.slot.name}`:"Node"}function o(C){const P=[];return C.forEach(j=>{const D={id:j.id,label:j.name,nodeType:r(j),node:j,children:[]};Array.isArray(j.children)&&(D.children=o(j.children)),P.push(D)}),P}function p(){i.value=t.current.value?o([t.current.value]):[]}te(t.current,p,{immediate:!0}),w.on(U,p),De(()=>{w.off(U,p)});const f=(C,P,j)=>O(this,null,function*(){const D=C.data,I=P.data.node,G=t.current.value;if(!G||!n.value||!I)return;const B=D.node;B.slot=yield n.value.getDropSlot(j==="inner"?I:I.parent);const ie={before:"left",after:"right"}[j]||"inner";G.move(B,I,ie),w.emit(xe,B)}),d=C=>{const P=C.data;return ee(P.node)||P.node.lock?!1:P.node.name!=="template"},_=(C,P,j)=>{const D=C.data,L=P.data;if(L.node.lock||ee(L.node)&&["prev","next"].includes(j))return!1;const I=t.current.value;if(!I)return!1;const G=l.componentMap[D.node.name];if(j==="inner")return I.allowDrop(G,L.node,l);{const B=L.node.parent;return B&&I.allowDrop(G,B,l)}},g=(C,P)=>{C.invisible=P,w.emit(U,C),w.emit(xe,C)},v=(C,P)=>{C.lock=P,w.emit(U,C),w.emit(xe,C)},b=C=>{const P=C==null?void 0:C.node;!P||P.invisible||w.emit(Dt,P)},E=C=>{var D,L,I;const P=(D=C.target)==null?void 0:D.__vueParentComponent;if(!P)return;const j=(I=(L=P.ctx)==null?void 0:L.node)==null?void 0:I.data;j&&(j.node.invisible||w.emit(Tt,j.node))},S=C=>{C.copy(),w.emit(xe,C)},A=C=>{ue.confirm("确定删除吗？","提示",{type:"warning"}).then(()=>{C.dispose(),w.emit(xe,C)})};return(C,P)=>(c(),y(fe,{title:"大纲树",class:"vtj-outline"},{default:m(()=>[h(s(Vt),{data:i.value,"node-key":"id","default-expand-all":"",draggable:"","empty-text":"请新建或打开文件","expand-on-click-node":!1,"allow-drop":_,"allow-drag":d,onCurrentChange:b,onNodeDrop:f,onMouseover:E},{default:m(({data:j})=>[(c(),V("div",{key:j.node.id,class:"vtj-outline__item"},[T("span",null,[q(H(j.label)+": ",1),T("i",{class:X(`is-${j.nodeType}`)},H(j.nodeType),3)]),a(j.node)?x("",!0):(c(),V("span",Pa,[j.node.lock?x("",!0):(c(),V("i",{key:0,onClick:Z(D=>v(j.node,!0),["stop"]),class:"vtj-icon-lock",title:"锁定"},null,8,Oa)),j.node.lock?(c(),V("i",{key:1,onClick:Z(D=>v(j.node,!1),["stop"]),class:"vtj-icon-unlock",title:"解锁"},null,8,La)):x("",!0),!j.node.invisible&&!j.node.lock?(c(),V("i",{key:2,onClick:Z(D=>g(j.node,!0),["stop"]),class:"vtj-icon-invisible",title:"设置隐藏"},null,8,Ba)):x("",!0),j.node.invisible&&!j.node.lock?(c(),V("i",{key:3,onClick:Z(D=>g(j.node,!1),["stop"]),class:"vtj-icon-visible",title:"设置显示"},null,8,Ua)):x("",!0),j.node.root!==j.node&&!j.node.lock?(c(),V("i",{key:4,onClick:D=>S(j.node),class:"vtj-icon-copy",title:"复制"},null,8,Ma)):x("",!0),j.node.root!==j.node&&!j.node.lock?(c(),V("i",{key:5,onClick:Z(D=>A(j.node),["stop"]),class:"vtj-icon-remove",title:"删除"},null,8,Fa)):x("",!0)])),T("span",Ja,[j.node.invisible?(c(),V("i",za)):x("",!0),j.node.lock?(c(),V("i",Ha)):x("",!0)])]))]),_:1},8,["data"])]),_:1}))}});const qa={class:"vtj-setting-panel"},Wa=N({__name:"Properties",setup(u){const{assets:e}=Y(),{selected:t}=me(),l=R(()=>{var A;return(A=t.value)==null?void 0:A.node}),{commonProps:n,componentProps:a,onChange:i,isExist:r,addCustom:o,customProps:p,removeProp:f}=is(l,e),d=[{name:"add",icon:"vtj-icon-plus"}],_={name:[{required:!0,message:"熟悉名称为必填项"}]},g=be({name:""}),v=k(!1),b=A=>{v.value=!0,g.name=""},E=()=>{const A=Object.keys(l.value.props);g.name&&!r(g.name)&&!A.includes(g.name)?(o(g.name),v.value=!1):ge.warning({message:"已存在该属性名称"})},S=A=>O(this,null,function*(){(yield ue.confirm("确定删除?","提示",{type:"warning"}).catch(P=>!1))&&f(A)});return(A,C)=>(c(),V("div",qa,[h(s(oe),{title:"通用属性"},{default:m(()=>[h(s(Q),{size:"small","label-width":"100px",onKeydown:C[0]||(C[0]=ze(Z(()=>{},["prevent","stop"]),["enter"]))},{default:m(()=>[(c(!0),V(M,null,F(s(n),P=>(c(),y(s(_e),K({key:`${P.name}_${l.value.id}`},P,{onChange:s(i)}),null,16,["onChange"]))),128))]),_:1})]),_:1}),s(a).length?(c(),y(s(oe),{key:0,title:"组件属性"},{default:m(()=>[h(s(Q),{size:"small","label-width":"100px",onKeydown:C[1]||(C[1]=ze(Z(()=>{},["prevent","stop"]),["enter"]))},{default:m(()=>[(c(!0),V(M,null,F(s(a),P=>(c(),y(s(_e),K({key:`${P.name}_${l.value.id}`},P,{onChange:s(i)}),null,16,["onChange"]))),128))]),_:1})]),_:1})):x("",!0),h(s(oe),{title:"自定义属性",tools:d,onToolClick:b},{default:m(()=>[h(s(Q),{size:"small","label-width":"100px",onKeydown:C[2]||(C[2]=ze(Z(()=>{},["prevent","stop"]),["enter"]))},{default:m(()=>[(c(!0),V(M,null,F(s(p),P=>(c(),y(s(_e),K({key:`${P.name}_${l.value.id}`},P,{removable:"",onChange:s(i),onRemove:S}),null,16,["onChange"]))),128))]),_:1})]),_:1}),h(s(se),{modelValue:v.value,"onUpdate:modelValue":C[4]||(C[4]=P=>v.value=P),title:"新增属性",width:"400px",submit:"",cancel:"",onSubmit:E},{default:m(()=>[h(s(Q),{ref:"formRef",size:"small",rules:_,model:g},{default:m(()=>[h(s(J),{label:"属性名称",prop:"name"},{default:m(()=>[h(s(W),{modelValue:g.name,"onUpdate:modelValue":C[3]||(C[3]=P=>g.name=P)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]))}});const Ya={class:"vtj-setting-panel vtj-events"},Ka=N({__name:"Events",setup(u){const{assets:e}=Y(),{selected:t}=me(),l=R(()=>{var g;return(g=t.value)==null?void 0:g.node}),{mouseEventList:n,keyboardEventList:a,componentEventList:i}=rs(l,e),r=k(!1),o=k(),p=k(Symbol()),f=g=>{p.value=Symbol(),o.value=g,r.value=!0},d=g=>{o.value&&l.value.setEvent(o.value.name,g)},_=g=>O(this,null,function*(){(yield ue.confirm("确定删除事件绑定？","提示",{type:"warning"}).catch(b=>!1))&&(l.value.removeEvent(g),o.value=null,r.value=!1)});return(g,v)=>(c(),V("div",Ya,[h(s(oe),{title:"组件事件"},{default:m(()=>[(c(!0),V(M,null,F(s(i),b=>(c(),y(s(ce),{title:b.name,active:!!b.event,removable:!!b.event,background:!1,editable:"",clickable:"",onClick:E=>f(b),onEdit:E=>f(b),onRemove:E=>_(b.name)},null,8,["title","active","removable","onClick","onEdit","onRemove"]))),256)),s(i).length===0?(c(),y(s(le),{key:0,"image-size":50,description:"该组件无自带事件"})):x("",!0)]),_:1}),h(s(oe),{title:"鼠标事件"},{default:m(()=>[(c(!0),V(M,null,F(s(n),b=>(c(),y(s(ce),{title:b.name,active:!!b.event,removable:!!b.event,background:!1,editable:"",clickable:"",onClick:E=>f(b),onEdit:E=>f(b),onRemove:E=>_(b.name)},null,8,["title","active","removable","onClick","onEdit","onRemove"]))),256))]),_:1}),h(s(oe),{title:"键盘事件"},{default:m(()=>[(c(!0),V(M,null,F(s(a),b=>(c(),y(s(ce),{title:b.name,active:!!b.event,removable:!!b.event,background:!1,editable:"",clickable:"",onClick:E=>f(b),onEdit:E=>f(b),onRemove:E=>_(b.name)},null,8,["title","active","removable","onClick","onEdit","onRemove"]))),256))]),_:1}),o.value?(c(),y(s(Is),K({key:p.value,modelValue:r.value,"onUpdate:modelValue":v[0]||(v[0]=b=>r.value=b),node:l.value},o.value,{onSubmit:d,onRemove:_}),null,16,["modelValue","node"])):x("",!0)]))}}),Xa=N({__name:"JSDataDialog",props:ls,setup(u){const e=u,{title:t,model:l,formRef:n,dialogRef:a,editorRef:i,rules:r,onSubmit:o,disabled:p}=ns(e),f=d=>{l.value.value=d};return(d,_)=>(c(),y(s(tt),K({ref_key:"dialogRef",ref:a,title:s(t),width:"1000px",height:"600px",clearable:!1},d.$attrs,{onSubmit:s(o),onPick:f}),{default:m(()=>[h(s(Q),{ref_key:"formRef",ref:n,size:"small","label-position":"top",model:s(l),rules:s(r)},{default:m(()=>[h(s(J),{label:e.nameLabel,prop:"name"},{default:m(()=>[d.type==="lifeCycles"?(c(),y(s(Ze),{key:0,modelValue:s(l).name,"onUpdate:modelValue":_[0]||(_[0]=g=>s(l).name=g),disabled:s(p)},{default:m(()=>[(c(!0),V(M,null,F(s(Dl),g=>(c(),y(s(Xe),{label:g,value:g},null,8,["label","value"]))),256))]),_:1},8,["modelValue","disabled"])):(c(),y(s(W),{key:1,modelValue:s(l).name,"onUpdate:modelValue":_[1]||(_[1]=g=>s(l).name=g),disabled:s(p)},null,8,["modelValue","disabled"]))]),_:1},8,["label"]),h(s(J),{label:e.valueLabel},{default:m(()=>[h(s(de),{ref_key:"editorRef",ref:i,border:!0,height:"380px",width:"100%",dark:"","model-value":s(l).value.value},null,8,["model-value"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},16,["title","onSubmit"]))}}),Za=N({__name:"WatchDataDialog",props:ss,setup(u){const e=u,{title:t,model:l,onSubmit:n,dialogRef:a,sourceRef:i,handlerRef:r,formRef:o}=as(e),p=f=>{l.handler.value=f};return(f,d)=>(c(),y(s(tt),K({ref_key:"dialogRef",ref:a,title:s(t),width:"1000px",height:"600px",clearable:!1},f.$attrs,{onSubmit:s(n),onPick:p}),{default:m(()=>[h(s(Q),{ref_key:"formRef",ref:o,size:"small","label-position":"top"},{default:m(()=>[h(s(J),{label:"侦听源 [ JSFunction ]",prop:"source"},{default:m(()=>[h(s(de),{ref_key:"sourceRef",ref:i,border:!0,height:"100px",width:"100%",dark:"","model-value":s(l).source.value},null,8,["model-value"])]),_:1}),h(s(J),{label:"deep",prop:"deep"},{default:m(()=>[h(s(ke),{modelValue:s(l).deep,"onUpdate:modelValue":d[0]||(d[0]=_=>s(l).deep=_)},null,8,["modelValue"])]),_:1}),h(s(J),{label:"immediate",prop:"immediate"},{default:m(()=>[h(s(ke),{modelValue:s(l).immediate,"onUpdate:modelValue":d[1]||(d[1]=_=>s(l).immediate=_)},null,8,["modelValue"])]),_:1}),h(s(J),{label:"处理函数 [ JSFunction ]",prop:"handler"},{default:m(()=>[h(s(de),{ref_key:"handlerRef",ref:r,border:!0,height:"180px",width:"100%",dark:"","model-value":s(l).handler.value},null,8,["model-value"])]),_:1})]),_:1},512)]),_:1},16,["title","onSubmit"]))}}),Te=N({__name:"BlockScriptGroup",props:{block:{},type:{},dataType:{},title:{},nameLabel:{},valueLabel:{},defaults:{}},setup(u){const e=u,t=R(()=>e.block),l=[{name:"add",icon:"vtj-icon-plus"}],{data:n,list:a,onAdd:i,onEdit:r,onRemove:o,visible:p,keyRef:f}=ts(t,e.type);return(d,_)=>(c(),y(s(oe),{title:e.title,tools:l,onToolClick:s(i)},{default:m(()=>[h(s(Q),{size:"small","label-width":"100px",onKeydown:_[0]||(_[0]=ze(Z(()=>{},["prevent","stop"]),["enter"]))},{default:m(()=>[(c(!0),V(M,null,F(s(a),g=>(c(),y(s(ce),{title:g.title,background:!1,editable:"",clickable:"",removable:"",onClick:v=>s(r)(g.model),onEdit:v=>s(r)(g.model),onRemove:v=>s(o)(g.model)},null,8,["title","onClick","onEdit","onRemove"]))),256)),s(a).length?x("",!0):(c(),y(s(le),{key:0,"image-size":40}))]),_:1}),s(p)&&e.type!=="watch"?(c(),y(Xa,{key:s(f),block:t.value,data:s(n),title:e.title,type:e.type,nameLabel:e.nameLabel,valueLabel:e.valueLabel,dataType:e.dataType,defaults:e.defaults,modelValue:s(p),"onUpdate:modelValue":_[1]||(_[1]=g=>Bt(p)?p.value=g:null)},null,8,["block","data","title","type","nameLabel","valueLabel","dataType","defaults","modelValue"])):x("",!0),s(p)&&e.type==="watch"?(c(),y(Za,{key:s(f),block:t.value,data:s(n),modelValue:s(p),"onUpdate:modelValue":_[2]||(_[2]=g=>Bt(p)?p.value=g:null)},null,8,["block","data","modelValue"])):x("",!0)]),_:1},8,["title","onToolClick"]))}}),Qa={class:"vtj-setting-panel"},eo=N({__name:"BlockScript",setup(u){const{selected:e}=me(),t=R(()=>{var l;return(l=e.value)==null?void 0:l.node});return(l,n)=>(c(),V("div",Qa,[h(Te,{title:"状态数据",type:"state",block:t.value,nameLabel:"状态数据名称",valueLabel:"状态初始值 [ JSExpression ]","data-type":"JSExpression",defaults:"null"},null,8,["block"]),h(Te,{title:"计算属性",type:"computed",block:t.value,nameLabel:"计算属性名称",valueLabel:"计算函数 [ JSFunction ]","data-type":"JSFunction",defaults:"() => { }"},null,8,["block"]),h(Te,{title:"组件方法",type:"methods",block:t.value,nameLabel:"方法名称",valueLabel:"方法函数 [ JSFunction ]","data-type":"JSFunction",defaults:"() => { }"},null,8,["block"]),h(Te,{title:"生命周期",type:"lifeCycles",block:t.value,nameLabel:"名称",valueLabel:"函数 [ JSFunction ]","data-type":"JSFunction",defaults:"() => { }"},null,8,["block"]),h(Te,{title:"Watch",type:"watch","data-type":"JSFunction",block:t.value},null,8,["block"])]))}});const to=N({__name:"Css",setup(u){const{selected:e}=me(),t=R(()=>{var i;return(i=e.value)==null?void 0:i.node}),l=[{name:"save",icon:"vtj-icon-np-save"}],n=k(),a=(i=!1)=>{var o;const r=(o=n.value)==null?void 0:o.getEditor().getValue();r!==t.value.css&&(t.value.setCss(r),i&&ve.success({message:"保存成功"}))};return(i,r)=>(c(),y(s(fe),{class:"vtj-setting-css",title:null,"body-padding":!1},{default:m(()=>[t.value?(c(),y(s(oe),{key:0,title:"CSS",tools:l,onToolClick:r[0]||(r[0]=o=>a(!0))},{default:m(()=>[h(s(de),{ref_key:"editorRef",ref:n,height:"100%",lang:"css",dark:"","model-value":t.value.css,onBlur:a},null,8,["model-value"])]),_:1})):x("",!0)]),_:1}))}});const lo={class:"vtj-schema"},no=N({__name:"Schema",setup(u){const{project:e,emitter:t}=Y(),l=k(""),n=k(),a=[{name:"save",icon:"vtj-icon-np-save"}],i=()=>{e.current.value?l.value=JSON.stringify(e.current.value.toDsl(),null,2):l.value=""},r=()=>O(this,null,function*(){if(!e.current.value)return;const o=n.value.getEditor().getValue();if(o){if(!(yield ue.confirm("手动修改DSL有风险，可能导致页面无法加载，请确认您的操作无误。","提示",{type:"warning"}).catch(f=>!1)))return;try{const f=JSON.parse(o);e.activeFile(f),t.emit(U,e.current.value),ve.success({message:"修改成功"})}catch(f){ge.warning({message:f.message,title:"代码错误"})}}});return t.on(U,i),te(e.current,i),et(()=>{i()}),De(()=>{t.off(U,i)}),(o,p)=>(c(),V("div",lo,[h(s(oe),{class:"vtj-schema__panel",subtitle:"手动修改DSL有风险，可能导致页面无法加载，请确认您的操作无误。","body-padding":!1,tools:a,onToolClick:r},{default:m(()=>[h(s(de),{ref_key:"editorRef",ref:n,height:"100%",lang:"json",dark:"","model-value":l.value},null,8,["model-value"])]),_:1})]))}});const so=T("i",{class:"vtj-icon-refresh"},null,-1),ao=T("i",{class:"vtj-icon-setting"},null,-1),oo=T("i",{class:"vtj-icon-outline"},null,-1),io=N({__name:"Actions",props:{coder:{type:Boolean,default:!1}},setup(u){const e=u,{project:t,engine:l,emitter:n}=Y(),a=k(!1),i=()=>{var _;if(t.current.value){const{designer:g}=me();g.selected.value=null,(_=l.simulator.renderer)==null||_.render(t.current.value)}else ve.warning({message:"请先打开文件"})},r=()=>{var g;const _=(g=t.current.value)==null?void 0:g.id;if(_){const v=t.getFile(_);n.emit(vl,v)}else ve.warning({message:"请先打开文件"})},o=()=>{if(t.current.value){const{designer:_}=me();_.setSelected(t.current.value);const g=Oe(l.skeleton.regionInstances.setting);g&&g.change(0)}else ve.warning({message:"请先打开文件"})},p=()=>{t.current.value?Oe(l.skeleton.regionInstances.apps).setCurrentWidget("outline"):ve.warning({message:"请先打开文件"})},f=()=>{n.emit(fl,a)},d=()=>{const _=t.getHomePage();if(!_){ve.warning({message:"请先设置项目首页"});return}n.emit(ml,_)};return(_,g)=>(c(),V("div",null,[h(s(re),{onClick:i,type:"default",size:"small",title:"刷新"},{default:m(()=>[so]),_:1}),h(s(re),{type:"default",size:"small",title:"页面设置",onClick:o},{default:m(()=>[ao]),_:1}),h(s(re),{type:"default",size:"small",title:"页面大纲树",onClick:p},{default:m(()=>[oo]),_:1}),h(s(Ct),{direction:"vertical"}),h(s(re),{type:"primary",size:"small",icon:s(wn),onClick:d},{default:m(()=>[q(" 浏览 ")]),_:1},8,["icon"]),h(s(re),{type:"success",size:"small",onClick:r},{default:m(()=>[q("预览")]),_:1}),e.coder?(c(),y(s(re),{key:0,type:"warning",size:"small",onClick:f,loading:a.value},{default:m(()=>[q(" 出码 ")]),_:1},8,["loading"])):x("",!0)]))}});const ro={class:"vtj-setting-panel vtj-directives"},uo=N({__name:"Directives",setup(u){const{assets:e}=Y(),{selected:t}=me(),l=R(()=>{var v;return(v=t.value)==null?void 0:v.node}),n=R(()=>e.componentMap[l.value.name]),a=v=>v.arg?typeof v.arg=="string"?v.arg:Tl(v.arg,{}):"modelValue",{vIf:i,vShow:r,vBind:o,vFor:p,vModels:f,onValueChange:d,onForChange:_,onModelChange:g}=vs(l,n);return(v,b)=>(c(),V("div",ro,[h(s(oe),{title:"内置指令"},{default:m(()=>[h(s(Q),{"label-width":"80px"},{default:m(()=>[h(s(_e),{name:"vIf",label:"v-if",setters:"ExpressionSetter",value:s(i).value,onChange:s(d)},null,8,["value","onChange"]),h(s(_e),{name:"vShow",label:"v-show",value:s(r).value,setters:"ExpressionSetter",onChange:s(d)},null,8,["value","onChange"]),h(s(_e),{name:"vBind",label:"v-bind",setters:"ExpressionSetter",value:s(o).value,onChange:s(d)},null,8,["value","onChange"])]),_:1})]),_:1}),h(s(oe),{title:"循环"},{default:m(()=>[h(s(Q),{"label-width":"80px"},{default:m(()=>{var E,S;return[h(s(_e),{name:"value",label:"循环数据",setters:"ExpressionSetter",value:s(p).value,onChange:s(_)},null,8,["value","onChange"]),h(s(_e),{name:"item",label:"迭代变量名",setters:{name:"InputSetter",props:{placeholder:"item"}},value:(E=s(p).iterator)==null?void 0:E.item,onChange:s(_)},null,8,["value","onChange"]),h(s(_e),{name:"index",label:"索引变量名",setters:{name:"InputSetter",props:{placeholder:"index"}},value:(S=s(p).iterator)==null?void 0:S.index,onChange:s(_)},null,8,["value","onChange"])]}),_:1})]),_:1}),s(f).length?(c(),y(s(oe),{key:0,title:"双向绑定"},{default:m(()=>[(c(!0),V(M,null,F(s(f),(E,S)=>(c(),y(s(ce),{title:`v-model: ${a(E)}`},{default:m(()=>[h(s(Q),{"label-width":"80px"},{default:m(()=>[h(s(_e),{name:S.toString(),label:"绑定变量",value:E.value,setters:"ExpressionSetter",onChange:s(g)},null,8,["name","value","onChange"])]),_:2},1024)]),_:2},1032,["title"]))),256))]),_:1})):x("",!0)]))}}),co=N({__name:"BlockDefineProps",props:{formData:{},block:{}},setup(u){const e=u,t=R(()=>e.formData?"编辑属性":"新增属性"),l={name:[{required:!0,message:"属性名称为必填项"}]},n=k(),a=k(),i=k(),r=be(e.formData||{name:"",type:"",required:!1,default:{type:"JSExpression",value:""}}),o=()=>O(this,null,function*(){if(yield n.value.validate().catch(f=>!1)){const f=i.value.getEditor().getValue();r.default.value=f,he(r.default,{})&&(e.block.setProp(Oe(r)),a.value.close())}});return(p,f)=>(c(),y(s(se),{ref_key:"dialogRef",ref:a,title:t.value,width:"1000px",height:"600px",submit:"",cancel:"",onSubmit:o},{default:m(()=>[h(s(Q),{ref_key:"formRef",ref:n,model:r,rules:l,size:"small","label-position":"top",class:"vtj-block-props__form"},{default:m(()=>[h(s(J),{label:"属性名称",prop:"name"},{default:m(()=>[h(s(W),{modelValue:r.name,"onUpdate:modelValue":f[0]||(f[0]=d=>r.name=d),disabled:!!e.formData},null,8,["modelValue","disabled"])]),_:1}),h(s(J),{label:"数据类型",prop:"type"},{default:m(()=>[h(s(Ze),{modelValue:r.type,"onUpdate:modelValue":f[1]||(f[1]=d=>r.type=d),multiple:""},{default:m(()=>[(c(!0),V(M,null,F(s(Il),d=>(c(),y(s(Xe),{value:d,label:d},null,8,["value","label"]))),256))]),_:1},8,["modelValue"])]),_:1}),h(s(J),{label:"是否必须",prop:"required"},{default:m(()=>[h(s(ke),{modelValue:r.required,"onUpdate:modelValue":f[2]||(f[2]=d=>r.required=d)},null,8,["modelValue"])]),_:1}),h(s(J),{label:"默认值 [ JSExpression ]",prop:"default"},{default:m(()=>[h(s(de),{ref_key:"editorRef",ref:i,height:"250px","model-value":r.default.value||"",border:"",dark:""},null,8,["model-value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"]))}});const po=N({__name:"BlockDefineEmits",props:{block:{},formData:{}},setup(u){const e=u,t=be(e.formData||{name:""}),l={name:[{required:!0,message:"事件名称为必填项"}]},n=k(),a=k(),i=()=>O(this,null,function*(){(yield a.value.validate().catch(o=>!1))&&(e.block.setEmit(t.name),n.value.close())});return(r,o)=>(c(),y(s(se),{ref_key:"dialogRef",ref:n,title:"新增事件",width:"400px",height:"150px",submit:"",cancel:"",onSubmit:i},{default:m(()=>[h(s(Q),{ref_key:"formRef",ref:a,model:t,rules:l,size:"small"},{default:m(()=>[h(s(J),{label:"事件名称",prop:"name"},{default:m(()=>[h(s(W),{modelValue:t.name,"onUpdate:modelValue":o[0]||(o[0]=p=>t.name=p)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},512))}}),vo=N({__name:"BlockDefineSlots",props:{block:{},formData:{}},setup(u){const e=u,t=be(e.formData||{name:""}),l={name:[{required:!0,message:"插槽名称为必填项"}]},n=k(),a=k(),i=()=>O(this,null,function*(){(yield a.value.validate().catch(o=>!1))&&(e.block.setSlot(t.name),n.value.close())});return(r,o)=>(c(),y(s(se),{ref_key:"dialogRef",ref:n,title:"新增插槽",width:"400px",height:"150px",submit:"",cancel:"",onSubmit:i},{default:m(()=>[h(s(Q),{ref_key:"formRef",ref:a,model:t,rules:l,size:"small"},{default:m(()=>[h(s(J),{label:"插槽名称",prop:"name"},{default:m(()=>[h(s(W),{modelValue:t.name,"onUpdate:modelValue":o[0]||(o[0]=p=>t.name=p)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},512))}}),mo=N({__name:"BlockInject",props:{block:{},formData:{}},setup(u){const e=u,t=R(()=>e.formData?"编辑注入":"新增注入"),l=be(e.formData||{name:"",from:"",default:{type:"JSExpression",value:""}}),n={name:[{required:!0,message:"注入名称为必填项"}]},a=k(),i=k(),r=k(),o=()=>O(this,null,function*(){if(yield r.value.validate().catch(f=>!1)){const f=i.value.getEditor().getValue();l.default.value=f,he(l.default,{})&&(e.block.setInject(Oe(l)),a.value.close())}});return(p,f)=>(c(),y(s(se),{ref_key:"dialogRef",ref:a,title:t.value,width:"1000px",height:"600px",submit:"",cancel:"",onSubmit:o},{default:m(()=>[h(s(Q),{ref_key:"formRef",ref:r,model:l,rules:n,size:"small","label-position":"top"},{default:m(()=>[h(s(J),{label:"注入名称",prop:"name"},{default:m(()=>[h(s(W),{modelValue:l.name,"onUpdate:modelValue":f[0]||(f[0]=d=>l.name=d),disabled:!!e.formData},null,8,["modelValue","disabled"])]),_:1}),h(s(J),{label:"来源名称",prop:"from"},{default:m(()=>[typeof l.from=="string"?(c(),y(s(W),{key:0,modelValue:l.from,"onUpdate:modelValue":f[1]||(f[1]=d=>l.from=d)},null,8,["modelValue"])):x("",!0)]),_:1}),h(s(J),{label:"默认值",prop:"from"},{default:m(()=>[h(s(de),{ref_key:"editorRef",ref:i,"model-value":l.default.value||"",dark:"",border:"",height:"300px"},null,8,["model-value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"]))}}),fo={key:0,class:"vtj-setting-panel vtj-advanced"},ho=N({__name:"Advanced",setup(u){const{selected:e}=me(),t=R(()=>{var G;const I=(G=e.value)==null?void 0:G.node;return ee(I)?I:null}),l=[{name:"add",icon:"vtj-icon-plus"}],n=R(()=>{var I;return t.value?(I=t.value.props)==null?void 0:I.map(G=>typeof G=="string"?{name:G,required:!1,type:void 0,default:{type:"JSExpression",value:""}}:z({default:{type:"JSExpression",value:""},required:!1,type:void 0},G)):[]}),a=R(()=>{var I;return((I=t.value)==null?void 0:I.emits)||[]}),i=R(()=>{var I;return((I=t.value)==null?void 0:I.slots)||[]}),r=R(()=>{var I;return t.value?(I=t.value.inject)==null?void 0:I.map(G=>z({from:"",default:{type:"JSExpression",value:""}},G)):[]}),o=k(!1),p=k(),f=k(!1),d=k(!1),_=k(),g=k(),v=()=>{p.value=void 0,o.value=!0},b=I=>{p.value=I,o.value=!0},E=I=>O(this,null,function*(){var B;(yield ue.confirm("确定删除","提示",{type:"warning"}).catch(ie=>!1))&&((B=t.value)==null||B.removeProp(I))}),S=()=>{f.value=!0},A=I=>O(this,null,function*(){var B;(yield ue.confirm("确定删除","提示",{type:"warning"}).catch(ie=>!1))&&((B=t.value)==null||B.removeEmit(I))}),C=()=>{d.value=!0},P=I=>O(this,null,function*(){var B;(yield ue.confirm("确定删除","提示",{type:"warning"}).catch(ie=>!1))&&((B=t.value)==null||B.removeSlot(I))}),j=()=>{g.value=void 0,_.value=!0},D=I=>O(this,null,function*(){var B;(yield ue.confirm("确定删除","提示",{type:"warning"}).catch(ie=>!1))&&((B=t.value)==null||B.removeInject(I))}),L=I=>O(this,null,function*(){g.value=I,_.value=!0});return(I,G)=>t.value?(c(),V("div",fo,[h(s(oe),{title:"属性",tools:l,onToolClick:v},{default:m(()=>[(c(!0),V(M,null,F(n.value,B=>(c(),y(s(ce),{title:B.name,editable:"",removable:"",clickable:"",onRemove:ie=>E(B),onClick:ie=>b(B),onEdit:ie=>b(B)},null,8,["title","onRemove","onClick","onEdit"]))),256)),n.value.length===0?(c(),y(s(le),{key:0,"image-size":50})):x("",!0),o.value?(c(),y(co,{key:1,block:t.value,"form-data":p.value,modelValue:o.value,"onUpdate:modelValue":G[0]||(G[0]=B=>o.value=B)},null,8,["block","form-data","modelValue"])):x("",!0)]),_:1}),h(s(oe),{title:"事件",tools:l,onToolClick:S},{default:m(()=>[(c(!0),V(M,null,F(a.value,B=>(c(),y(s(ce),{title:B,removable:"",onRemove:ie=>A(B)},null,8,["title","onRemove"]))),256)),a.value.length===0?(c(),y(s(le),{key:0,"image-size":50})):x("",!0),f.value?(c(),y(po,{key:1,modelValue:f.value,"onUpdate:modelValue":G[1]||(G[1]=B=>f.value=B),block:t.value},null,8,["modelValue","block"])):x("",!0)]),_:1}),h(s(oe),{title:"插槽",tools:l,onToolClick:C},{default:m(()=>[(c(!0),V(M,null,F(i.value,B=>(c(),y(s(ce),{title:B,removable:"",onRemove:ie=>P(B)},null,8,["title","onRemove"]))),256)),i.value.length===0?(c(),y(s(le),{key:0,"image-size":50})):x("",!0),d.value?(c(),y(vo,{key:1,modelValue:d.value,"onUpdate:modelValue":G[2]||(G[2]=B=>d.value=B),block:t.value},null,8,["modelValue","block"])):x("",!0)]),_:1}),h(s(oe),{title:"注入",tools:l,onToolClick:j},{default:m(()=>[(c(!0),V(M,null,F(r.value,B=>(c(),y(s(ce),{title:B.name,editable:"",removable:"",clickable:"",onRemove:ie=>D(B),onClick:ie=>L(B),onEdit:ie=>L(B)},null,8,["title","onRemove","onClick","onEdit"]))),256)),r.value.length===0?(c(),y(s(le),{key:0,"image-size":50})):x("",!0),_.value?(c(),y(mo,{key:1,modelValue:_.value,"onUpdate:modelValue":G[3]||(G[3]=B=>_.value=B),"form-data":g.value,block:t.value},null,8,["modelValue","form-data","block"])):x("",!0)]),_:1})])):x("",!0)}}),_o={class:"vtj-switcher"},go=T("i",{class:"vtj-icon-back vtj-switcher__back"},null,-1),bo={key:1},yo=N({__name:"Switcher",props:{link:{}},setup(u){const e=u,{project:t}=Y(),l=R(()=>{var a;return(a=t.current.value)==null?void 0:a.title}),n=()=>{e.link&&(location.href=e.link)};return(a,i)=>(c(),V("div",_o,[h(s(re),{size:"small",round:"",onClick:n},{default:m(()=>[go,T("span",null,H(s(t).name),1),l.value?(c(),y(s(Ct),{key:0,direction:"vertical"})):x("",!0),l.value?(c(),V("span",bo,H(l.value),1)):x("",!0)]),_:1})]))}});const ko=["src"],Eo=N({__name:"Docs",props:{url:{default:"https://element-plus.org/zh-CN/"}},setup(u){const e=u,t=k();let l=null;et(()=>{var a;l||(l=tn.service({target:(a=t.value)==null?void 0:a.$el}))}),De(()=>{l.close(),l=null});const n=()=>{l.close()};return(a,i)=>(c(),y(fe,{ref_key:"panel",ref:t,title:null,class:"vtj-docs","body-padding":!1},{default:m(()=>[T("iframe",{ref:"frame",src:e.url,onLoad:n},null,40,ko)]),_:1},512))}});const Vo=N({__name:"ApiDialogForm",props:{model:{},project:{}},setup(u){const e=u,t={name:"",title:"",url:"",method:"GET",settings:{type:"JSExpression",value:""}},l=k(we(e.model||z({},t))),n=k(),a=k(),i=k(),r={name:[{required:!0,message:"接口名称为必填项"}],title:[{required:!0,message:"标题描述为必填项"}],url:[{required:!0,message:"请求地址为必填项"}]},o=R(()=>e.model?"编辑Api":"新增Api"),p=()=>O(this,null,function*(){if(yield n.value.validate().catch(d=>!1)){const d=a.value.getEditor().getValue();l.value.settings.value=d,he(l.value.settings,{})&&(e.project.setApi(l.value),i.value.close())}});return(f,d)=>(c(),y(s(se),{ref_key:"dialogRef",ref:i,width:"1000px",height:"600px",title:o.value,submit:"",cancel:"",onSubmit:p},{default:m(()=>[h(s(Q),{ref_key:"formRef",ref:n,size:"small",model:l.value,rules:r,"label-position":"top"},{default:m(()=>[h(s(J),{label:"接口名称",prop:"name"},{default:m(()=>[h(s(W),{modelValue:l.value.name,"onUpdate:modelValue":d[0]||(d[0]=_=>l.value.name=_),disabled:!!e.model},null,8,["modelValue","disabled"])]),_:1}),h(s(J),{label:"标题描述",prop:"title"},{default:m(()=>[h(s(W),{modelValue:l.value.title,"onUpdate:modelValue":d[1]||(d[1]=_=>l.value.title=_)},null,8,["modelValue"])]),_:1}),h(s(J),{label:"接口地址",prop:"url"},{default:m(()=>[h(s(W),{modelValue:l.value.url,"onUpdate:modelValue":d[2]||(d[2]=_=>l.value.url=_)},null,8,["modelValue"])]),_:1}),h(s(J),{label:"请求类型",prop:"method"},{default:m(()=>[h(s(St),{modelValue:l.value.method,"onUpdate:modelValue":d[3]||(d[3]=_=>l.value.method=_)},{default:m(()=>[(c(!0),V(M,null,F(s(Al),_=>(c(),y(s(ln),{label:_},null,8,["label"]))),256))]),_:1},8,["modelValue"])]),_:1}),h(s(J),{label:"请求配置 [ JSExpression ]",prop:"settings"},{default:m(()=>{var _;return[h(s(de),{ref_key:"editorRef",ref:a,"model-value":(_=l.value.settings)==null?void 0:_.value,border:"",dark:"",height:"180px"},null,8,["model-value"])]}),_:1})]),_:1},8,["model"])]),_:1},8,["title"]))}}),Co={class:"vtj-apis__name"},So=N({__name:"Apis",setup(u){const{project:e}=Y(),t=[{name:"add",icon:"vtj-icon-plus"}],l=R(()=>e.apis.value),n=k(),a=k(!1),i=()=>{n.value=void 0,a.value=!0},r=p=>{n.value=p,a.value=!0},o=p=>O(this,null,function*(){(yield ue.confirm("确定删除?","提示",{type:"warning"}).catch(d=>!1))&&e.removeApi(p.name)});return(p,f)=>(c(),y(s(fe),{class:"vtj-apis",title:"Api管理",tools:t,onToolClick:i},{default:m(()=>[l.value.length?x("",!0):(c(),y(s(le),{key:0,"image-size":50})),(c(!0),V(M,null,F(l.value,d=>(c(),y(s(ce),{editable:"",removable:"",clickable:"",onClick:_=>r(d),onEdit:_=>r(d),onRemove:_=>o(d)},{title:m(()=>[q(H(d.title)+" ",1),T("i",Co,H(d.name),1)]),_:2},1032,["onClick","onEdit","onRemove"]))),256)),a.value?(c(),y(Vo,{key:1,modelValue:a.value,"onUpdate:modelValue":f[0]||(f[0]=d=>a.value=d),model:n.value,project:s(e)},null,8,["modelValue","model","project"])):x("",!0)]),_:1}))}});const wo={class:"vtj-data-source-from__label-name"},xo=N({__name:"ApiDataSourceForm",props:{model:{},block:{}},setup(u){const e=u,{project:t}=Y(),l={type:"api",detail:"",name:"",title:"",transform:{type:"JSFunction",value:""},test:{type:"JSFunction",value:""}},n=k(we(e.model||z({},l))),a=R(()=>t.apis.value),i={name:[{required:!0,message:"调用名称为必填项"}],title:[{required:!0,message:"备注描述为必填项"}],detail:[{required:!0,message:"选择引用api"}]},r=R(()=>e.model?"编辑数据源":"新增数据源"),o=k(),p=k(),f=k(),d=k(),_=k(!1),g=k(!1),v=k(""),b=P=>{const j=a.value.find(D=>D.name===P);j&&(n.value.name=j.name,n.value.title=j.title,n.value.test.value=`() => this.${j.name}()`)},E=(P,j)=>{const D=(...L)=>O(this,null,function*(){var ie;const G=yield((ie=j.runtimeContext)==null?void 0:ie.$apis[P.detail]).apply(this,L),B=Pt(P.transform,{});return B?B(G):G});return{[P.name]:D}},S=()=>O(this,null,function*(){if(yield o.value.validate().catch(j=>!1)){const j=p.value.getEditor().getValue();n.value.transform.value=j;const D=f.value.getEditor().getValue();return n.value.test.value=D,(!j||he(n.value.transform,e.block.runtimeContext))&&he(n.value.test,z(z({},e.block.runtimeContext),E(n.value,e.block)))}return!1}),A=()=>O(this,null,function*(){(yield S())&&(e.block.setDataSource(n.value),d.value.close())}),C=()=>O(this,null,function*(){if(yield S()){if(!n.value.test.value){ge.warning({message:"无测试用例",title:"提示"});return}const P=E(n.value,e.block);g.value=!0,v.value="";try{const D=yield Pt(n.value.test,P)().catch(L=>L);v.value=typeof D=="object"?JSON.stringify(D,null,2):"",_.value=!0}catch(j){ge.warning({message:j.message,title:"运行错误"})}g.value=!1}});return(P,j)=>(c(),y(s(se),{ref_key:"dialogRef",ref:d,class:"vtj-data-source-from",title:r.value,width:"1000px",height:"600px",submit:"",cancel:"",onSubmit:A},{action:m(()=>[h(s(re),{size:"default",type:"warning",onClick:C,loading:g.value},{default:m(()=>[q(" 运行测试用例 ")]),_:1},8,["loading"])]),default:m(()=>[h(s(Q),{ref_key:"formRef",ref:o,size:"small","label-position":"right","label-width":"80px",model:n.value,rules:i},{default:m(()=>[h(s(J),{label:"Api",prop:"detail"},{default:m(()=>[h(s(Ze),{modelValue:n.value.detail,"onUpdate:modelValue":j[0]||(j[0]=D=>n.value.detail=D),onChange:b,disabled:!!e.model},{default:m(()=>[(c(!0),V(M,null,F(a.value,D=>(c(),y(s(Xe),{label:D.title,value:D.name},{default:m(()=>[q(H(D.title)+" ",1),T("i",wo,H(D.name),1)]),_:2},1032,["label","value"]))),256))]),_:1},8,["modelValue","disabled"])]),_:1}),h(s(J),{label:"调用名称",prop:"name"},{default:m(()=>[h(s(W),{modelValue:n.value.name,"onUpdate:modelValue":j[1]||(j[1]=D=>n.value.name=D),disabled:!!e.model},null,8,["modelValue","disabled"])]),_:1}),h(s(J),{label:"备注描述",prop:"title"},{default:m(()=>[h(s(W),{modelValue:n.value.title,"onUpdate:modelValue":j[2]||(j[2]=D=>n.value.title=D)},null,8,["modelValue"])]),_:1}),h(s(J),{label:"转换函数",prop:"transform"},{default:m(()=>[h(s(de),{ref_key:"transformRef",ref:p,border:"",dark:"",height:"200px","model-value":n.value.transform.value},null,8,["model-value"])]),_:1}),h(s(J),{label:"测试用例"},{default:m(()=>[h(s(de),{ref_key:"testRef",ref:f,border:"",dark:"",height:"120px","model-value":n.value.test.value},null,8,["model-value"])]),_:1})]),_:1},8,["model"]),h(s(nn),{modelValue:_.value,"onUpdate:modelValue":j[3]||(j[3]=D=>_.value=D),title:"测试用例运行结果",direction:"btt","append-to-body":"",size:"80%"},{default:m(()=>[h(s(de),{"model-value":v.value,border:"",dark:"",height:"100%",lang:"json"},null,8,["model-value"])]),_:1},8,["modelValue"])]),_:1},8,["title"]))}});const jo={class:"vtj-data-sources__subtitle"},$o=N({__name:"DataSources",setup(u){const{selected:e}=me(),t=R(()=>{var f;return(f=e.value)==null?void 0:f.node}),l=R(()=>{var f;return Object.values(((f=t.value)==null?void 0:f.dataSources)||{}).filter(d=>d.type==="api")}),n=[{name:"add",icon:"vtj-icon-plus"}],a=k(),i=k(),r=()=>{i.value=void 0,a.value=!0},o=f=>{i.value=f,a.value=!0},p=f=>O(this,null,function*(){(yield ue.confirm("确定删除？","提示",{type:"warning"}).catch(_=>!1))&&t.value.removeDataSource(f.name)});return(f,d)=>(c(),y(s(fe),{class:"vtj-data-sources",title:null,"body-padding":!1},{default:m(()=>[h(s(oe),{title:"Api",tools:n,onToolClick:r},{default:m(()=>[l.value.length===0?(c(),y(s(le),{key:0,"image-size":50})):x("",!0),(c(!0),V(M,null,F(l.value,_=>(c(),y(s(ce),{editable:"",removable:"",clickable:"",onClick:g=>o(_),onEdit:g=>o(_),onRemove:g=>p(_)},{title:m(()=>[q(H(_.title)+" ",1),T("i",jo,H(_.name),1)]),_:2},1032,["onClick","onEdit","onRemove"]))),256))]),_:1}),a.value?(c(),y(xo,{key:0,modelValue:a.value,"onUpdate:modelValue":d[0]||(d[0]=_=>a.value=_),model:i.value,block:t.value},null,8,["modelValue","model","block"])):x("",!0)]),_:1}))}});const Ro=N({__name:"History",setup(u){const{engine:e}=Y(),t=R(()=>{var i;return((i=e.simulator.history.value)==null?void 0:i.list)||[]}),l=R(()=>`(共 ${t.value.length} 条)`),n=i=>O(this,null,function*(){var o;(yield ue.confirm("确定删除?","提示",{type:"warning"}).catch(p=>!1))&&((o=e.simulator.history.value)==null||o.remove(i.id))}),a=i=>{var r;(r=e.simulator.history.value)==null||r.load(i.id)};return(i,r)=>(c(),y(s(fe),{title:"历史记录",subtitle:l.value,class:"vtj-histroy"},{default:m(()=>[t.value.length===0?(c(),y(s(le),{key:0,"image-size":50})):x("",!0),(c(!0),V(M,null,F(t.value,(o,p)=>{var f;return c(),y(s(ce),{title:o.title,active:((f=s(e).simulator.history.value)==null?void 0:f.index)===p,onRemove:d=>n(o),onClick:d=>a(o),removable:"",clickable:""},null,8,["title","active","onRemove","onClick"])}),256))]),_:1},8,["subtitle"]))}}),Do=N({__name:"NodePath",setup(u){const{selected:e}=me(),t=R(()=>{var i;return(((i=e.value)==null?void 0:i.path)||[]).slice(0).reverse()}),l=a=>{w.emit(Dt,a)},n=a=>{w.emit(Tt,a)};return(a,i)=>s(e)?(c(),y(s(an),{key:0,class:"vtj-nodepath","separator-icon":s(xn)},{default:m(()=>[(c(!0),V(M,null,F(t.value,r=>(c(),y(s(sn),{onClick:o=>l(r),onMouseover:o=>n(r)},{default:m(()=>[q(H(r.name),1)]),_:2},1032,["onClick","onMouseover"]))),256))]),_:1},8,["separator-icon"])):x("",!0)}});const To={class:"vtj-about"},Io={class:"vtj-about__logo"},Ao=["src"],No=T("div",{class:"vtj-about__name"},[T("h3",null,"VTJEngine")],-1),Po={class:"vtj-about__footer"},Oo=N({__name:"About",setup(u){return(e,t)=>(c(),V("div",To,[T("div",Io,[h(s(on),{value:s(al)},{default:m(()=>[T("img",{src:s(ol)},null,8,Ao)]),_:1},8,["value"])]),No,T("div",Po,[h(s(rn),{href:"http://vtj.pro",type:"primary",target:"_blank"},{default:m(()=>[q(" http://vtj.pro ")]),_:1})])]))}});const Pe={Empty:ca,Logo:va,Dependencies:fa,Designer:Ea,Components:Va,Pages:ja,Blocks:$a,Toolbar:Na,Outline:Ga,Properties:Wa,Events:Ka,BlockScript:eo,Css:to,Schema:no,Actions:io,Directives:uo,Advanced:ho,Switcher:yo,Docs:Eo,Apis:So,DataSources:$o,History:Ro,NodePath:Do,About:Oo},Lo={class:"vtj-apps"},Bo={class:"vtj-apps__header"},Uo={class:"vtj-apps__top"},Mo={class:"vtj-apps__bottom"},Fo={class:"vtj-apps__panels"},Jo=N({__name:"apps",setup(u,{expose:e}){const{regions:t,config:l}=Y(),n=R(()=>t.value.apps),a=k(null),i=k(null),r=k(),o=k(),p=R(()=>n.value.filter(v=>{var b;return!v.disabled&&((b=v.trigger)==null?void 0:b.type)==="panel"})),f=R(()=>n.value.filter(v=>{var b;return!v.disabled&&((b=v.trigger)==null?void 0:b.type)!=="panel"}));function d(v){const b=n.value.find(E=>E.name===v);b&&(a.value=b,i.value=b)}const _=v=>{a.value=v,i.value=i.value===v?null:v},g=v=>{var b,E,S;if(((b=v.trigger)==null?void 0:b.type)==="link"){window.open((E=v.props)==null?void 0:E.url);return}((S=v.trigger)==null?void 0:S.type)==="dialog"&&(r.value=Ye(Pe[v.type]||Pe.Empty),o.value=ae(z(z({},v.trigger),v.props),{visible:!0}))};return te(i,v=>{w.emit(cl,!!v)}),l.activeApp&&d(l.activeApp),e({setCurrentWidget:d}),(v,b)=>(c(),V("div",Lo,[T("div",Bo,[T("div",Uo,[(c(!0),V(M,null,F(p.value,E=>{var S,A;return c(),y(zt,{key:`trigger-${E.name}`,icon:(S=E.trigger)==null?void 0:S.icon,label:(A=E.trigger)==null?void 0:A.label,active:a.value===E,open:i.value===E,onClick:C=>_(E)},null,8,["icon","label","active","open","onClick"])}),128))]),T("div",Mo,[(c(!0),V(M,null,F(f.value,E=>{var S,A;return c(),y(zt,{key:`trigger-${E.name}`,icon:(S=E.trigger)==null?void 0:S.icon,label:(A=E.trigger)==null?void 0:A.label,onClick:C=>g(E)},null,8,["icon","label","onClick"])}),128))])]),Ee(T("div",Fo,[(c(!0),V(M,null,F(p.value,E=>(c(),y(gn,{key:E.name},[a.value===E?(c(),y(s(Ve),We(K({key:0},z({},E))),null,16)):x("",!0)],1024))),128))],512),[[je,!!i.value]]),r.value?(c(),y(se,K({key:0},o.value,{modelValue:o.value.visible,"onUpdate:modelValue":b[0]||(b[0]=E=>o.value.visible=E)}),{default:m(()=>[(c(),y($t(r.value),We(jt(o.value)),null,16))]),_:1},16,["modelValue"])):x("",!0)]))}});const zo={class:"vtj-brand"},Ho=N({__name:"brand",setup(u){const{regions:e}=Y(),t=R(()=>e.value.brand);return(l,n)=>(c(),V("div",zo,[(c(!0),V(M,null,F(t.value,a=>(c(),y(s(Ve),K({key:a.name},z({},a)),null,16))),128))]))}});const Go={key:0,class:"vtj-setting"},qo={key:0,class:"vtj-setting__header"},Wo={class:"vtj-setting__path"},Yo=T("i",{class:"vtj-icon-layers"},null,-1),Ko=T("i",{class:"vtj-icon-help"},null,-1),Xo=N({__name:"setting",setup(u,{expose:e}){var _;const{engine:t,regions:l}=Y(),{selected:n}=me(),{setting:a}=l.value||{},i=R(()=>{var g;return ee((g=n.value)==null?void 0:g.node)?"Block":"Node"}),r=R(()=>a.filter(g=>!g.disabled&&g.group===i.value).map(g=>{var v;return{name:g.name,label:((v=g.trigger)==null?void 0:v.label)||g.name,closable:!1}})),o=k((_=r.value[0])==null?void 0:_.name);te(n,(g,v)=>{(g==null?void 0:g.node.id)!==(v==null?void 0:v.node.id)&&p(0)});const p=(g=0)=>{var v;o.value=(v=r.value[g])==null?void 0:v.name};e({currentTab:o,tabs:r,change:p});const f=R(()=>{var v;const g=(v=n.value)==null?void 0:v.node;if(g){const b=t.assets.componentMap[g.name];return b==null?void 0:b.doc}return null}),d=()=>{if(f.value){const g=Oe(t.skeleton.regionInstances.workspace);g&&g.openTab("docs",{url:f.value})}};return(g,v)=>s(n)&&s(n).node?(c(),V("div",Go,[i.value==="Node"?(c(),V("div",qo,[T("div",Wo,[Yo,T("span",null,[q(H(s(n).node.name.fileName||s(n).node.name)+": ",1),T("i",null,H(s(n).node.id),1)])]),f.value?(c(),V("div",{key:0,class:"vtj-setting__doc",onClick:d},[Ko,q(" 帮助 ")])):x("",!0)])):x("",!0),s(n).node.lock?x("",!0):(c(),y(Rt,{key:1,class:"vtj-setting__tabs",items:r.value,modelValue:o.value,"onUpdate:modelValue":v[0]||(v[0]=b=>o.value=b),stretch:"","body-padding":!1},{default:m(()=>[(c(!0),V(M,null,F(s(a),b=>(c(),y(s(Ve),K({key:b.name},z({},b),{visible:b.name===o.value}),null,16,["visible"]))),128))]),_:1},8,["items","modelValue"])),s(n).node.lock?(c(),y(s(le),{key:2,"image-size":1,description:"组件已被锁定，不能更改设置。"})):x("",!0)])):(c(),y(s(le),{key:1,description:"请在左侧画布选中节点"}))}});const Zo={class:"vtj-status"},Qo={class:"vtj-status__left"},ei={class:"vtj-status__right"},ti=N({__name:"status",setup(u){const{regions:e}=Y(),t=R(()=>e.value.status),l=R(()=>t.value.filter(a=>!a.disabled&&!a.trigger)),n=R(()=>t.value.filter(a=>!a.disabled&&!!a.trigger));return(a,i)=>(c(),V("div",Zo,[T("div",Qo,[(c(!0),V(M,null,F(l.value,r=>(c(),y(s(Ve),K({key:r.name},z({},r)),null,16))),128))]),T("div",ei,[(c(!0),V(M,null,F(n.value,r=>(c(),y(s(Ve),K({key:r.name},z({},r)),null,16))),128))])]))}});const li={class:"vtj-toolbar"},ni=N({__name:"toolbar",setup(u){const{regions:e}=Y(),t=R(()=>e.value.toolbar);return(l,n)=>(c(),V("div",li,[(c(!0),V(M,null,F(t.value,a=>(c(),y(s(Ve),K({key:a.name},z({},a)),null,16))),128))]))}});const si=N({__name:"workspace",setup(u,{expose:e}){var g;const{regions:t,emitter:l}=Y(),n=R(()=>t.value.workspace),a=n.value.filter(v=>v.name==="designer").map(v=>{var b;return{name:v.name,label:((b=v.trigger)==null?void 0:b.label)||v.name}}),i=k(n.value.filter(v=>!v.disabled&&v.name!=="designer").map(v=>{var b;return{name:v.name,label:((b=v.trigger)==null?void 0:b.label)||v.name,checked:!1,closable:!0}})),r=R(()=>{const v=i.value.filter(b=>!!b.checked);return v.unshift(a[0]),v}),o=k((g=r.value[0])==null?void 0:g.name);te(o,v=>{l.emit(pl,v==="designer")});const p=v=>{const b=i.value.find(E=>E.name===v);b&&(b.checked=!1),v===o.value&&(o.value=r.value[0].name)},f=k({}),d=(v,b)=>{const E=i.value.find(S=>S.name===v);E&&(f.value[v]=b,E.checked=!0),o.value=v},_=v=>{v.checked=!v.checked,v.checked?o.value=v.name:o.value===v.name&&(o.value="designer")};return e({openTab:d}),(v,b)=>(c(),y(s(Rt),{class:"vtj-workspace",items:r.value,modelValue:o.value,"onUpdate:modelValue":b[0]||(b[0]=E=>o.value=E),more:i.value,onTabRemove:p,onMore:_,checkable:""},{default:m(()=>[(c(!0),V(M,null,F(n.value,E=>(c(),y(s(Ve),K({key:E.name},z(z({},E),f.value[E.name]),{visible:E.name===o.value}),null,16,["visible"]))),128))]),_:1},8,["items","modelValue","more"]))}});const ai=N({__name:"App",props:{engine:{}},setup(u,{expose:e}){const t=u,l=k(),n=k(),a=k(),i=k(),r=k(),o=k(),p=k();k(),k();const f=k(!1),d=k(!0);t.engine.skeleton.regionInstances={brand:l,toolbar:n,action:a,status:i,setting:r,workspace:o,apps:p};const _={dirs:["e"],maxWidth:600},g={dirs:["w"],maxWidth:600};function v(b){f.value=b}return w.on(cl,b=>{v(!b)}),bn(It,t.engine),e({setLeftCollapsed:v,showSetting:d}),(b,E)=>(c(),y(s(pn),{locale:s(dn)},{default:m(()=>[h(s(vt),{class:"vtj-layout"},{default:m(()=>[h(s(un),{class:"vtj-layout__header",height:"36px"},{default:m(()=>[h(s(Ho),{ref_key:"brand",ref:l},null,512),h(s(ni),{ref_key:"toolbar",ref:n},null,512),h(s(ia),{ref_key:"action",ref:a},null,512)]),_:1}),h(s(vt),{class:"vtj-layout__wrapper"},{default:m(()=>[Ee((c(),y(s(pt),{width:"400px",class:X(["vtj-layout__left",{"is-collapsed":f.value}])},{default:m(()=>[h(s(Jo),{ref_key:"apps",ref:p},null,512)]),_:1},8,["class"])),[[s(Ot),_]]),h(s(Yt),{class:"vtj-layout__main"},{default:m(()=>[h(s(si),{ref_key:"workspace",ref:o},null,512)]),_:1}),d.value?Ee((c(),y(s(pt),{key:0,width:"350px",class:"vtj-layout__right"},{default:m(()=>[h(s(Xo),{ref_key:"setting",ref:r},null,512)]),_:1})),[[s(Ot),g]]):x("",!0)]),_:1}),h(s(cn),{class:"vtj-layout__footer",height:"20px"},{default:m(()=>[h(s(ti),{ref_key:"status",ref:i},null,512)]),_:1})]),_:1})]),_:1},8,["locale"]))}});const oi=["brand","toolbar","action","status","apps","workspace","setting"];class ii{constructor(e){$(this,"widgets");$(this,"widgetInstances",{});$(this,"regions");$(this,"regionInstances",{});this.widgets=be(e),this.regions=R(()=>oi.reduce((t,l)=>(t[l]=this.getWidgets(l),t),{}))}load(e){e.forEach(t=>{this.add(t)})}get(e){return this.widgets.find(t=>t.name===e)}set(e,t){const l=this.get(e);l&&sl(l,t)}add(e){!!this.get(e.name)?this.set(e.name,e):this.widgets.push(e)}remove(e){const t=this.widgets.findIndex(l=>l.name===e);if(t>=0){const l=this.widgets[t];l.disabled=!0,this.widgets.splice(t,1)}}getComponent(e){return e?Nl(e)?Pe[e]||Pe.Empty:e:Pe.Empty}getWidgets(e){return this.widgets.filter(t=>t.region===e).sort((t,l)=>(t.order||0)-(l.order||0))}dispose(){this.widgetInstances={},this.regionInstances={}}}const w=En(),cl="EVENT_SKELETON_LEFT_COLLAPSED_CHANGE",pe="EVENT_PROJECT_UPDATE",ri="EVENT_PROJECT_ACTIVE_FILE",Ge="EVENT_FILE_CREATE",mt="EVENT_FILE_UPDATE",ft="EVENT_FILE_REMOVE",ht="EVENT_ASSETS_LOADED",ui="EVENT_SIMULATOR_OPEN",_t="EVENT_SIMULATOR_READY",gt="EVENT_COMPONENETS_DRAG_START",bt="EVENT_COMPONENETS_DRAG_END",U="EVENT_NODE_CHANGE",dl="EVENT_VIEWPORT_MODE_CHANGE",Dt="EVENT_OUTLINE_SELECTED",Tt="EVENT_OUTLINE_HOVER",xe="EVENT_OUTLINE_CHANGE",pl="EVENT_DESIGNER_ACTIVE_CHANGE",vl="EVENT_ACTION_PREVIEW",ml="EVENT_ACTION_HOME",fl="EVENT_ACTION_CODER",ci="EVENT_HISTORY_GO",di="EVENT_HISTORY_BACK",$e="EVENT_HISTORY_CHANGE",pi="EVENT_HISTORY_PUSH",vi="EVENT_HISTORY_REMOVE",Ke="EVENT_HISTORY_SAVE",mi=[{id:"elements",category:"特殊元素"},{id:"components",category:"内置组件"}],hl=[{name:"component",title:"动态组件",categoryId:"elements",doc:"https://cn.vuejs.org/api/built-in-special-elements.html#component",props:[{name:"is",label:"组件名",setters:"InputSetter"}],snippet:{children:"组件文本内容示例",props:{is:"div"}}},{name:"slot",title:"插槽",categoryId:"elements",doc:"https://cn.vuejs.org/api/built-in-special-elements.html#slot",props:[{name:"name",label:"名称",defaultValue:"default",setters:"InputSetter"}],snippet:{children:"插槽默认内容"}}],Fe=[...hl,{name:"Transition",title:"过渡效果",categoryId:"components",package:"vue",doc:"https://cn.vuejs.org/api/built-in-components.html#transition",props:[{name:"name",label:"名称",defaultValue:"",title:"用于自动生成过渡 CSS class 名",setters:"InputSetter"},{name:"css",label:"应用CSS",defaultValue:!0,title:"是否应用 CSS 过渡 class",setters:"BooleanSetter"},{name:"type",label:"事件类型",defaultValue:void 0,title:"指定要等待的过渡事件类型来确定过渡结束的时间，默认情况下会自动检测持续时间较长的类型",setters:"SelectSetter",options:["transition","animation"]},{name:"duration",label:"持续时间",defaultValue:void 0,title:"显式指定过渡的持续时间",setters:["NumberSetter","JSONSetter"]},{name:"mode",label:"时序",defaultValue:"default",title:"控制离开/进入过渡的时序。",setters:"SelectSetter",options:["in-out","out-in","default"]},{name:"appear",label:"使用过渡",defaultValue:!1,title:"是否对初始渲染使用过渡",setters:"BooleanSetter"},{name:"enterFromClass",label:"enterFromClass",defaultValue:void 0,setters:"InputSetter"},{name:"enterActiveClass",label:"enterActiveClass",defaultValue:void 0,setters:"InputSetter"},{name:"enterToClass",label:"enterToClass",defaultValue:void 0,setters:"InputSetter"},{name:"appearFromClass",label:"appearFromClass",defaultValue:void 0,setters:"InputSetter"},{name:"appearActiveClass",label:"appearActiveClass",defaultValue:void 0,setters:"InputSetter"},{name:"appearToClass",label:"appearToClass",defaultValue:void 0,setters:"InputSetter"},{name:"leaveFromClass",label:"leaveFromClass",defaultValue:void 0,setters:"InputSetter"},{name:"leaveActiveClass",label:"leaveActiveClass",defaultValue:void 0,setters:"InputSetter"},{name:"leaveToClass",label:"leaveToClass",defaultValue:void 0,setters:"InputSetter"}],events:["before-enter","before-leave","enter","leave","appear","after-enter","after-leave","after-appear","enter-cancelled","leave-cancelled","ppear-cancelled"],snippet:{children:"Transition"}},{name:"TransitionGroup",title:"过渡效果组",package:"vue",categoryId:"components",doc:"https://cn.vuejs.org/api/built-in-components.html#transitiongroup",props:[{name:"name",label:"名称",defaultValue:"",title:"用于自动生成过渡 CSS class 名",setters:"InputSetter"},{name:"tag",label:"标签名",defaultValue:void 0,title:"如果未定义，则渲染为片段 (fragment)",setters:"InputSetter"},{name:"moveClass",label:"moveClass",defaultValue:void 0,title:"用于自定义过渡期间被应用的 CSS class。",setters:"InputSetter"},{name:"css",label:"应用CSS",defaultValue:!0,title:"是否应用 CSS 过渡 class",setters:"BooleanSetter"},{name:"type",label:"事件类型",defaultValue:void 0,title:"指定要等待的过渡事件类型来确定过渡结束的时间，默认情况下会自动检测持续时间较长的类型",setters:"SelectSetter",options:["transition","animation"]},{name:"duration",label:"持续时间",defaultValue:void 0,title:"显式指定过渡的持续时间",setters:["NumberSetter","JSONSetter"]},{name:"appear",label:"使用过渡",defaultValue:!1,title:"是否对初始渲染使用过渡",setters:"BooleanSetter"},{name:"enterFromClass",label:"enterFromClass",defaultValue:void 0,setters:"InputSetter"},{name:"enterActiveClass",label:"enterActiveClass",defaultValue:void 0,setters:"InputSetter"},{name:"enterToClass",label:"enterToClass",defaultValue:void 0,setters:"InputSetter"},{name:"appearFromClass",label:"appearFromClass",defaultValue:void 0,setters:"InputSetter"},{name:"appearActiveClass",label:"appearActiveClass",defaultValue:void 0,setters:"InputSetter"},{name:"appearToClass",label:"appearToClass",defaultValue:void 0,setters:"InputSetter"},{name:"leaveFromClass",label:"leaveFromClass",defaultValue:void 0,setters:"InputSetter"},{name:"leaveActiveClass",label:"leaveActiveClass",defaultValue:void 0,setters:"InputSetter"},{name:"leaveToClass",label:"leaveToClass",defaultValue:void 0,setters:"InputSetter"}],events:["before-enter","before-leave","enter","leave","appear","after-enter","after-leave","after-appear","enter-cancelled","leave-cancelled","ppear-cancelled"],snippet:{children:"TransitionGroup"}},{name:"KeepAlive",title:"缓存切换组件",package:"vue",categoryId:"components",doc:"https://cn.vuejs.org/api/built-in-components.html#keepalive",props:[{name:"include",label:"匹配包含",title:"如果指定，则只有与 `include` 名称, 匹配的组件才会被缓存。",setters:["InputSetter","JSONSetter"]},{name:"exclude",label:"匹配排除",title:"任何名称与 `exclude` 匹配的组件都不会被缓存。",setters:["InputSetter","JSONSetter"]},{name:"max",label:"最大缓存数",title:"最多可以缓存多少组件实例。",setters:["InputSetter"]}]},{name:"Teleport",title:"传送组件",package:"vue",categoryId:"components",doc:"https://cn.vuejs.org/api/built-in-components.html#teleport",props:[{name:"to",label:"目标容器",title:"指定目标容器,可以是选择器或实际元素",setters:["InputSetter"]},{name:"disabled",label:"目标容器",title:"当值为 `true` 时，内容将保留在其原始位置, 而不是移动到目标容器中, 可以动态更改",setters:["BooleanSetter"]}]},{name:"Suspense",title:"异步依赖",package:"vue",categoryId:"components",doc:"https://cn.vuejs.org/api/built-in-components.html#suspense",props:[{name:"timeout",label:"timeout",setters:["InputSetter"]}]}];class fi{constructor(e,t){$(this,"unwatch");$(this,"packages",[]);$(this,"elements",[...hl]);$(this,"elementsMap",{});$(this,"components",[...Fe]);$(this,"componentMap",{});$(this,"componentGroups",[]);$(this,"isReady",!1);this.service=e,this.project=t,t&&(this.unwatch=te(t.dependencies,l=>this.load(l),{deep:!0})),this.elementsMap=this.parseMap(this.elements,!1)}clear(){this.components=[...Fe],this.componentMap={},this.componentGroups=[]}getCateoryComponents(e,t){const l=t.filter(n=>n.categoryId===e.id&&n.hidden!==!0);return{name:e.id,label:e.category,count:l.length,components:l}}parseGroups(e){const t=[];for(let l of e){const{categories:n,components:a,label:i,name:r,library:o,names:p}=l;if(!n||!a)continue;const f=n.map(g=>this.getCateoryComponents(g,a)),d=f.reduce((g,v)=>v.count+g,0),_={name:l.name,label:i||r,library:o,names:p,count:d,children:f};t.push(_)}return t}parseMap(e,t=!0){const l={};if(t)for(const n of e)n.package&&(l[n.name]=n);else for(const n of e)l[n.name]=n;return l}load(e){return O(this,null,function*(){this.packages=e,this.isReady=!1;const t=e.filter(r=>!!r.assetsUrl&&r.enabled);this.clear();const l=[{name:"vue",label:"内置",names:Fe.map(r=>r.name),library:"Vue",components:Fe,categories:mi}];for(const r of t){const o=yield Pl(r.assetsUrl,{},{name:r.assetsLibrary,script:!0}).catch(p=>null);o&&(o.name=o.name||r.assetsLibrary,o.library=r.library,o.names=(o.components||[]).map(p=>p.name),l.push(o),this.components=this.components.concat(o.components||[]))}this.componentGroups=this.parseGroups(l),this.componentMap=this.parseMap(this.components),this.isReady=!0,w.emit(ht);const{components:n,componentGroups:a,componentMap:i}=this;return{components:n,componentGroups:a,componentMap:i}})}getBlockDescription(e){return O(this,null,function*(){if(!e||typeof e=="string")return null;const t=e.type==="Schema"?e.id:null;if(!t)return null;const l=yield this.service.getFile(t);if(!l)return null;const{id:n,name:a,slots:i,props:r,emits:o}=l,p=d=>{const _=Array.isArray(d)?d:[d];let g=[];for(const v of _)g=g.concat(ul[v.toLowerCase()]||[]);return g};return{id:n,name:a,childIncludes:i!=null&&i.length?void 0:!1,props:(r||[]).map(d=>typeof d=="string"?{name:d}:{name:d.name,type:d.type,setters:p(d.type)}),events:o,slots:i}})}dispose(){this.clear(),this.unwatch&&this.unwatch()}}class hi{constructor(e,t,l){$(this,"app",null);$(this,"dsl",null);$(this,"onNodeChangeProxy");this.env=e,this.service=t,this.history=l,this.onNodeChangeProxy=this.onNodeChange.bind(this)}install(e={},t={}){const l=Object.values(e);this.app&&(Object.assign(this.app.config.globalProperties,t),this.app.config.errorHandler=(n,a,i)=>{const o=`[ ${a==null?void 0:a.$options.name}] ${(n==null?void 0:n.message)||n||"未知错误"}`;console.error({err:n,instance:a,info:i}),ge.error({title:"运行错误",message:o})},l.forEach(n=>{var a;(typeof n=="function"||n.install)&&((a=this.app)==null||a.use(n))}))}render(e){this.app&&this.dispose();const{Vue:t,container:l,components:n,libs:a,apis:i,window:r,globals:o}=this.env,p=Ol({getFile:this.service.getFile,options:{Vue:t,block:e,components:n,libs:a,apis:i,window:r}});this.dsl=t.reactive(e.toDsl());const f=Ll({Vue:t,dsl:this.dsl,block:e,components:n,libs:a,apis:i,window:r,loader:p});this.app=t.createApp(f),this.install(a,o),this.app.mount(l),w.on(U,this.onNodeChangeProxy)}onNodeChange(e){if(ee(e))this.render(e);else if(this.dsl){const t=e.toDsl();this.updateChild(t,this.dsl)}this.dsl&&this.history.value&&this.history.value.push(this.dsl)}updateChild(e,t){const l=t.children||[];if(Array.isArray(l))for(let n=0;n<l.length;n++){const a=l[n];if(a.id===e.id){l.splice(n,1,e);return}else this.updateChild(e,a)}}dispose(){this.app&&(this.app.unmount(),this.app=null),this.dsl=null,w.off(U,this.onNodeChangeProxy)}}class _i{constructor(e){$(this,"unwatches",[]);$(this,"iframe",null);$(this,"contentWindow",null);$(this,"project");$(this,"renderer",null);$(this,"assets");$(this,"service");$(this,"globals");$(this,"history",k(null));$(this,"isReady",!1);const{project:t,assets:l,service:n,globals:a}=e;this.project=t,this.assets=l,this.service=n,this.globals=a,w.on(ht,()=>this.open()),w.on(Ke,i=>this.service.saveHistory(i)),w.on($e,i=>{var o;const r=t.current.value;r&&(r.init(i.block),(o=this.renderer)==null||o.render(r))}),this.unwatches.push(te(t.current,i=>O(this,null,function*(){var r,o;i?(yield this.loadHistory(i),(r=this.renderer)==null||r.render(i)):(this.history.value=null,(o=this.renderer)==null||o.dispose())})))}loadHistory(e){return O(this,null,function*(){const t=yield this.service.getHistory(e.id);this.history.value=new cs({history:{blockId:e.id,items:t}})})}init(e){te(e,t=>{t&&(this.iframe=t,this.assets.isReady&&this.open())})}open(){if(!this.iframe)return;this.isReady=!1,this.contentWindow=this.iframe.contentWindow,this.contentWindow.__simulator__=this;const e=this.contentWindow.document;w.emit(ui,e);const{scripts:t,css:l}=this.parseDependencies();e.open(),e.write(`
     <!DOCTYPE html>
     <html lang="zh-CN">
       <head>
       <meta charset="utf-8">
       <meta name="viewport"
             content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0,viewport-fit=cover"/>
         <style>
            html, body {
              background: #fff;
              padding: 0;
              margin: 0;
              min-height: 100vh;
              width: 100%;
              height: 100%;
              font-size:12px;
            }
         </style>
         ${Bl(l)}
         ${Ul(t)}
       </head>
       <body> 
       </body>
       <script>
       __simulator__.ready();
     <\/script> 
     </html>
    `),e.close()}parseDependencies(){const e=this.project.dependencies.value.filter(n=>n.enabled),t=[],l=[];return e.forEach(({urls:n})=>{n==null||n.forEach(a=>{Ml(a)&&t.push(a),Fl(a)&&l.push(a)})}),{scripts:t,css:l}}parseApis(){return this.project.apis.value.reduce((t,l)=>(t[l.name]=Jl(l),t),{})}createEnv(){const{contentWindow:e,assets:t,globals:l}=this,n=this.project.dependencies.value,a=t.componentGroups,i={window:e,Vue:null,libs:{},components:{},apis:this.parseApis(),container:e==null?void 0:e.document.body,globals:l};return n.filter(r=>!!r.enabled).forEach(({library:r})=>{const o=e[r];if(o){i.libs[r]=o,r===Lt&&(i[Lt]=o);const p=a.find(d=>d.library===r);((p==null?void 0:p.names)||[]).forEach(d=>{i.components[d]=o[d]})}}),i}ready(){var l,n;this.isReady=!0,(l=this.renderer)==null||l.dispose(),this.renderer=null;const e=this.project.current.value,t=this.createEnv();this.renderer=new hi(t,this.service,this.history),e&&this.renderer.render(e),w.emit(_t,(n=this.contentWindow)==null?void 0:n.document)}dispose(){var e;(e=this.renderer)==null||e.dispose(),this.contentWindow=null,this.iframe=null,this.renderer=null,this.history.value=null,this.unwatches.forEach(t=>t()),w.off(ht),w.off(Ke),w.off($e)}}const It=Symbol("VtjEngine");class gi{constructor(e,t={}){$(this,"config");$(this,"skeleton");$(this,"app");$(this,"service");$(this,"emitter",w);$(this,"project");$(this,"assets");$(this,"simulator");const{config:l={},service:n=new qt,project:a,globals:i={}}=t;this.service=n,this.config=Bn(On,l),this.skeleton=new ii(this.config.widgets||[]),this.project=Zt(new us(a,this.config.dependencies)),this.assets=new fi(this.service,this.project),this.simulator=new _i({project:this.project,assets:this.assets,service:this.service,globals:i}),this.app=Xt(ai,{engine:Ye(this)}),this.bindListeners(),this.loadProject(this.project.toDsl()),et(()=>{var r;this.app.mount((r=s(e))!=null?r:document.body)}),De(()=>{this.dispose()})}loadProject(e){return O(this,null,function*(){const{service:t,project:l}=this,n=yield t.getProject(e||{name:"未命名项目"});l.load(n)})}bindListeners(){const{emitter:e,service:t}=this;e.on(pe,l=>t.updateProject(l)),e.on(Ge,l=>t.createFile(l)),e.on(mt,l=>t.updateFile(l)),e.on(ft,l=>t.removeFile(l)),e.on(U,()=>{const l=this.project.current.value;l&&t.updateFile(l.toDsl())})}dispose(){this.emitter.all.clear(),this.skeleton.dispose(),this.assets.dispose(),this.simulator.dispose(),this.app.unmount()}}class bi{constructor(e,t,l){$(this,"draggingComponent",null);$(this,"document",null);$(this,"proxied",{});$(this,"hover",at(null));$(this,"dropping",at(null));$(this,"selected",at(null));this.engine=e,this.iframe=t,this.slotPicker=l,e.simulator.init(t),w.on(_t,n=>{this.bindEvents(n)}),w.on(gt,n=>{this.draggingComponent=n}),w.on(bt,()=>{this.draggingComponent=null}),w.on($e,()=>{this.selected.value=null,this.hover.value=null}),te(e.project.current,()=>{this.selected.value=null,this.hover.value=null})}dispose(){this.engine.simulator.dispose(),w.off(_t),w.off(gt),w.off(bt),this.document&&(this.unbindEvents(this.document),this.document=null)}getNodeByElement(e){var l;const t=(l=e.__vtj__)!=null?l:"";return Le.nodes[t]||null}getElementByNode(e){return!this.document||!e?null:ee(e)?this.document.body:Array.from(this.document.querySelectorAll("*")).find(l=>l.__vtj__===e.id)}getDropType(e,t,l){const{left:n,top:a,width:i,height:r}=e;return t>=n&&t<=n+i*.2?"left":t>=n+i*.8&&t<=n+i?"right":l>=a&&l<=a+r*.2?"top":l>=a+r*.8&&l<=a+r?"bottom":"inner"}getElementAndNode(e){const{engine:t,document:l}=this,n=e.composedPath(),a=this.findVtjElement(n)||(l==null?void 0:l.body),i=a?this.getNodeByElement(a)||t.project.current.value:null;return{el:a,node:i,path:n}}onDragOver(e){const{el:t,node:l}=this.getElementAndNode(e);if(l&&t&&this.allowDrop(l)){e.preventDefault();const n=t.getBoundingClientRect();this.dropping.value={el:t,node:l,rect:n,type:this.getDropType(n,e.clientX,e.clientY),path:[]}}else this.dropping.value=null}onMouseOver(e){const{el:t,node:l}=this.getElementAndNode(e);if(t&&l){const n=t.getBoundingClientRect();this.hover.value={el:t,node:l,rect:n,type:"inner",path:[]}}}onLeave(e){this.hover.value=null,this.dropping.value=null}createNodeDsl(e){const{name:t,snippet:l={},from:n}=e;return ae(z({},l),{name:t,from:n||e.package})}getDropSlot(e){return O(this,null,function*(){var o;if(!e)return;const{engine:t,slotPicker:l}=this,n=t.assets.componentMap,a=(yield t.assets.getBlockDescription(e.from))||n[e.name];if(!(a!=null&&a.slots))return;const i=((a==null?void 0:a.slots)||["default"]).map(p=>typeof p=="string"?{name:p,params:[]}:{name:p.name,params:p.params||[]});if(i.length===0)return;if(i.length===1)return i[0];const r=yield l(i).catch(p=>{});if(!(r&&r.name==="default"&&(!r.params||((o=r.params)==null?void 0:o.length)===0)))return r})}onDrop(e){return O(this,null,function*(){e.preventDefault();const{engine:t,draggingComponent:l,dropping:n}=this,a=t.project.current.value;if(!a||!l||!n.value)return;const{el:i,node:r}=this.getElementAndNode(e);if(!i||!r||!this.allowDrop(r))return;const o=this.createNodeDsl(l),p=new Le(o),f=n.value.type;p.slot=yield this.getDropSlot(f==="inner"?r:r.parent),ee(r)?a.appendChild(p):a.appendChild(p,r,f)})}onSelected(e){const{el:t,node:l,path:n}=this.getElementAndNode(e);if(t&&l){const a=t.getBoundingClientRect();this.selected.value={el:t,node:l,rect:a,path:this.getNodePath(n),type:this.getDropType(a,e.clientX,e.clientY)}}}onViewChange(){this.updateRect()}updateRect(){const e=s(this.selected),t=s(this.hover);if(e){const l=e.el.getBoundingClientRect();this.selected.value=ae(z({},e),{rect:l})}if(t){const l=t.el.getBoundingClientRect();this.hover.value=ae(z({},t),{rect:l})}}getNodePath(e){const l=e.filter(a=>this.isVtjElement(a)&&this.isCurrentContext(a)).map(a=>this.getNodeByElement(a)),n=this.engine.project.current.value;return n&&l.push(n),l}isVtjElement(e){return!!e.__vtj__}isCurrentContext(e){var n,a;const t=(n=this.engine.project.current.value)==null?void 0:n.id,l=(a=e.__context__)==null?void 0:a.__id;return t===l}findVtjElement(e){return e.find(t=>this.isVtjElement(t)&&this.isCurrentContext(t))}bind(e,t){let l=this.proxied[t];return l||(l=e.bind(this),this.proxied[t]=l),l}bindEvents(e){this.document&&this.unbindEvents(this.document);const t=this.engine.simulator.contentWindow;e.addEventListener("mouseover",this.bind(this.onMouseOver,"onMouseOver")),e.addEventListener("mouseleave",this.bind(this.onLeave,"onLeave")),e.addEventListener("dragover",this.bind(this.onDragOver,"onDragOver")),e.addEventListener("dragleave",this.bind(this.onLeave,"onLeave")),e.addEventListener("drop",this.bind(this.onDrop,"onDrop")),e.addEventListener("click",this.bind(this.onSelected,"onSelected")),e.addEventListener("scroll",this.bind(this.onViewChange,"onViewChange")),t==null||t.addEventListener("resize",this.bind(this.onViewChange,"onViewChange")),this.document=e}unbindEvents(e){const t=this.engine.simulator.contentWindow;e.removeEventListener("mouseover",this.bind(this.onMouseOver,"onMouseOver")),e.removeEventListener("mouseleave",this.bind(this.onLeave,"onLeave")),e.removeEventListener("dragover",this.bind(this.onDragOver,"onDragOver")),e.removeEventListener("dragleave",this.bind(this.onLeave,"onLeave")),e.removeEventListener("drop",this.bind(this.onDrop,"onDrop")),e.removeEventListener("click",this.bind(this.onSelected,"onSelected")),e.removeEventListener("scroll",this.bind(this.onViewChange,"onViewChange")),t==null||t.removeEventListener("resize",this.bind(this.onViewChange,"onViewChange")),this.document=null}allowDrop(e){const{draggingComponent:t,engine:l}=this;if(!t)return!0;const n=l.project.current.value;return n&&n.allowDrop(t,e,l.assets)}setHover(e){const t=this.getElementByNode(e);if(!t)return;const l=t.getBoundingClientRect();this.hover.value={el:t,node:e,rect:l,type:"inner",path:[]}}setSelected(e){if(!this.document)return;const t=this.getElementByNode(e)||this.document.createElement("span"),l=t.getBoundingClientRect();this.selected.value={el:t,node:e,rect:l,path:this.findPathByNode(e),type:"inner"}}findPathByNode(e){const t=[e];if(ee(e))return t;let l=e;for(;l.parent&&l.parent!==l;)l=l.parent,l!==e&&t.unshift(l);return t.reverse()}}const yi=u=>(yn("data-v-f21cba19"),u=u(),kn(),u),ki={class:"vtj-ide"},Ei={class:"file-list"},Vi={key:1},Ci=yi(()=>T("div",{class:"error-tip"}," 错误日志已保存. 这可能是系统的bug。您可以把日志提交给作者协助解决。 ",-1)),Si=N({__name:"index",setup(u){return O(this,null,function*(){const e=k(!1),t=k(!1),l=k([]),n=k(null),a=k(!1),i=k();wt("VTJ_PROVIDER_OPTIONS",null);const o={project:{base:location.pathname,home:"/startup"}},{project:p,raw:f=!1,service:d="storage",debug:_}=o||{},{id:g="ide",name:v="IDE",base:b="/",mode:E="hash",page:S="/page",preview:A="/preview",home:C="/"}=p||{},P=()=>`${b}${E==="hash"?"#":""}${C}`,j=new gi(i,{service:d==="file"?new jn:new qt,config:{widgets:[{name:"switcher",props:{link:P()}},{name:"actions",props:{coder:!0}}]},project:{id:g,name:v},globals:{$route:El(),$router:Vl()}});return j.emitter.on(vl,D=>{const L=E==="hash"?"#":"";let I="";zl(D)?I=f?`${b}${L}${A}/${D.id}`:`${b}${L}${S}/${D.id}`:I=`${b}${L}${A}/${D.id}`,window.open(I)}),j.emitter.on(ml,D=>{const I=`${b}${E==="hash"?"#":""}${C}`;window.open(I)}),j.emitter.on(fl,D=>O(this,null,function*(){if(d==="storage"){D.value=!1,e.value=!0;return}t.value=!0,a.value=!0,l.value=[],n.value=null;const L=j.project.toDsl(),I=j.assets.componentMap,G=j.assets.packages;l.value=yield Hl({type:"projectCoder",data:{debug:_,project:L,assets:{componentMap:I,packages:G}}}).catch(B=>(n.value=B.data,console.log(B),[])),a.value=!1})),(D,L)=>(c(),V("div",ki,[T("div",{ref_key:"container",ref:i,class:"container"},null,512),h(s(se),{modelValue:e.value,"onUpdate:modelValue":L[0]||(L[0]=I=>e.value=I),title:"温馨提示",width:"500px",height:"180px"},{default:m(()=>[h(s(Be),{title:"当前设计器是Storage模式，不支持出码功能",type:"warning",closable:!1,description:"可以使用以下命令下载完整版本体验"}),h(s(Be),{class:"npm-command",closable:!1,type:"info",title:"npm create vtj@latest -- -t web"})]),_:1},8,["modelValue"]),h(s(se),{modelValue:t.value,"onUpdate:modelValue":L[1]||(L[1]=I=>t.value=I),title:"出码结果",width:"800px",height:"400px"},{default:m(()=>[h(s(vn),{rows:3,animated:"",loading:a.value},{default:m(()=>[n.value?x("",!0):(c(),y(s(Be),{key:0,closable:!1,type:"success",title:`输出文件数: ${l.value.length}`},null,8,["title"])),T("div",Ei,[(c(!0),V(M,null,F(l.value,I=>(c(),V("div",null,H(I),1))),256))]),n.value?(c(),V("div",Vi,[h(s(Be),{closable:!1,type:"error",title:"出码失败",description:n.value.msg},null,8,["description"]),Ci])):x("",!0)]),_:1},8,["loading"])]),_:1},8,["modelValue"])]))})}});const Mi=Gt(Si,[["__scopeId","data-v-f21cba19"]]);export{Mi as default};
