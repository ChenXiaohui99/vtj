var bl=Object.defineProperty,yl=Object.defineProperties;var kl=Object.getOwnPropertyDescriptors;var At=Object.getOwnPropertySymbols;var El=Object.prototype.hasOwnProperty,Vl=Object.prototype.propertyIsEnumerable;var lt=(u,e,t)=>e in u?bl(u,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):u[e]=t,z=(u,e)=>{for(var t in e||(e={}))El.call(e,t)&&lt(u,t,e[t]);if(At)for(var t of At(e))Vl.call(e,t)&&lt(u,t,e[t]);return u},ae=(u,e)=>yl(u,kl(e));var $=(u,e,t)=>(lt(u,typeof e!="symbol"?e+"":e,t),t);var O=(u,e,t)=>new Promise((l,s)=>{var a=o=>{try{r(t.next(o))}catch(v){s(v)}},i=o=>{try{r(t.throw(o))}catch(v){s(v)}},r=o=>o.done?l(o.value):Promise.resolve(o.value).then(a,i);r((t=t.apply(u,e)).next())});import{b as Cl,u as Sl}from"./vue-router-a9d75a6b.js";import{S as wl,e as xl,f as rt,g as he,i as st,h as ee,M as jl,K as $l,j as Se,k as Rl,t as nt,E as Dl,l as qe,V as ut,m as ct,n as Tl,_ as Gt,L as Il,p as Al,D as Nl,A as Pl,o as Nt,v as Pt,q as Ol,r as Ll,s as Bl,w as Ul,x as Ml,y as Fl,z as Jl,B as zl,C as Hl,F as Ot,G as qt,u as Gl,H as ql,I as Lt,J as Wl}from"./index-ff2b7a92.js";import{s as ge,a as oe,r as ue,l as W,x as Xe,y as Ze,n as dt,p as pt,i as kt,h as Et,g as Vt,j as Wt,A as Ct,u as pe,B as vt,E as St,m as le,C as Yt,D as mt,F as J,G as Q,H as Yl,I as Kl,J as Xl,K as Zl,k as ke,L as Ql,M as es,N as ts,O as ls,P as wt,Q as Ie,w as ss,v as ns,R as as,S as os,T as is,U as rs,c as us,V as cs,W as ds,X as ps,z as vs,Y as ms,Z as Be,_ as fs}from"./element-plus-63f6df9d.js";import{E as Kt,e as E,m as R,I as N,o as c,c as V,a as T,a3 as Z,T as x,J as se,X as M,ae as F,R as X,U as q,V as H,a2 as hs,M as y,W as h,aj as Xt,O as m,K,a7 as _s,u as n,Z as De,ap as Zt,_ as be,w as xt,f as te,a9 as Qe,ar as Qt,i as et,af as el,h as gs,ah as We,ai as jt,aJ as bs,P as Ee,Q as je,S as $t,b5 as Ye,a0 as Je,n as Ue,ad as ze,k as Bt,bt as Oe,aw as ys,H as ks,s as at,bg as Es,be as Vs}from"./@vue-74e1d4f0.js";import{m as Cs}from"./mitt-f7ef348c.js";import{_ as Ss}from"./monaco-editor-919908db.js";import{h as ws,p as tl,q as ll}from"./@vueuse-33fff3de.js";import{y as sl,G as nl,f as xs,I as js,e as $s}from"./@element-plus-db3256f2.js";import{m as al,l as we}from"./lodash-es-1922f8b4.js";import"./vue-c69ca412.js";import"./axios-4cbcee7f.js";import"./async-validator-b6b8d38d.js";import"./@ctrl-b0f23ca4.js";import"./@popperjs-7c8154ca.js";const ol="0.6.4",ye=xl({url:"/vtj/base.json",method:"post",settings:{type:"json",validSuccess:!0,originResponse:!1,validate:u=>{var e;return((e=u.data)==null?void 0:e.code)===0},showError:u=>{ge.error({message:u||"未知错误"})}}});class Rs extends wl{getProject(e){return O(this,null,function*(){const t=e.id;return(yield ye({type:"getProject",data:t}).catch(s=>null))||(yield this.createProject(e))})}createProject(e){return O(this,null,function*(){const t=e.id,l=e.name||"未命名项目",s=ae(z({},e),{id:t,name:l});return yield ye({type:"createProject",data:s}).catch(a=>null),s})}updateProject(e){return O(this,null,function*(){if(!e.id)return!1;const t=yield this.getProject(e),l=Object.assign(t,e);return!!this.createProject(l)})}createFile(e){return O(this,null,function*(){const t=e.id,l=ae(z({},e),{id:t});return yield ye({type:"createFile",data:l}),l})}updateFile(e){return O(this,null,function*(){return e.id?!!this.createFile(e):!1})}getFile(e){return O(this,null,function*(){return yield ye({type:"getFile",data:e}).catch(t=>null)})}removeFile(e){return O(this,null,function*(){return yield ye({type:"removeHistory",data:e}),yield ye({type:"removeFile",data:e}),!0})}saveHistory(e){return O(this,null,function*(){const{blockId:t,items:l}=e;return yield ye({type:"saveHistory",data:{blockId:t,items:l}}),!0})}getHistory(e){return O(this,null,function*(){return yield ye({type:"getHistory",data:e}).catch(t=>[])})}}const il=""+new URL("logo-32adf494.png",import.meta.url).href,Ds=[{name:"logo",type:"Logo",region:"brand",props:{text:"Tj",icon:il}},{name:"switcher",type:"Switcher",region:"brand",props:{link:"/"}}],Ts=[{name:"toolbar",type:"Toolbar",region:"toolbar"}],Is=[{name:"actions",type:"Actions",region:"action"}],As=[{name:"pages",type:"Pages",region:"apps",order:1,trigger:{icon:"vtj-icon-document",label:"页面",type:"panel"}},{name:"blocks",type:"Blocks",region:"apps",order:2,trigger:{icon:"vtj-icon-components",label:"区块",type:"panel"}},{name:"components",type:"Components",region:"apps",order:3,trigger:{icon:"vtj-icon-block",label:"组件库",type:"panel"},props:{title:"组件库"}},{name:"outline",type:"Outline",region:"apps",order:4,trigger:{icon:"vtj-icon-outline",label:"大纲树",type:"panel"}},{name:"history",type:"History",region:"apps",order:4,trigger:{icon:"vtj-icon-history",label:"历史记录",type:"panel"}},{name:"api",type:"Apis",region:"apps",order:4,trigger:{icon:"vtj-icon-api",label:"Api管理",type:"panel"}},{name:"packages",type:"Dependencies",region:"apps",order:6,trigger:{icon:"vtj-icon-category",label:"依赖管理",type:"panel"}},{name:"about",type:"About",region:"apps",props:{title:"关于",width:"500px",height:"300px"},trigger:{icon:"vtj-icon-info",label:"关于",type:"dialog"}}],Ns=[{package:"vue",version:"3.3.4",library:"Vue",urls:["./libs/vue.global.js"],required:!0,official:!0,enabled:!0},{package:"@vueuse/core",version:"latest",library:"VueUse",urls:["./libs/vueuse.shared.iife.min.js","./libs/vueuse.core.iife.min.js"],required:!1,official:!0,enabled:!1},{package:"element-plus",version:"latest",library:"ElementPlus",urls:["./libs/element-plus.index.css","./libs/element-plus.full.min.js"],assetsUrl:"./libs/element-plus-assets.js",assetsLibrary:"ElementPlusAssets",required:!1,official:!0,enabled:!0},{package:"@element-plus/icons-vue",version:"latest",library:"ElementPlusIconsVue",urls:["./libs/element-plus-icons-vue.js"],required:!1,official:!0,enabled:!0},{package:"@vtj/utils",version:"latest",library:"VtjUtils",urls:["./libs/vtj-utils.js"],required:!1,official:!0,enabled:!0},{package:"@vtj/icons",version:"latest",library:"VtjIcons",urls:["./libs/vtj-icons.css","./libs/vtj-icons.js"],required:!1,official:!0,enabled:!0},{package:"@vtj/ui",version:"latest",library:"VtjUI",urls:["./libs/vtj-ui.css","./libs/vtj-ui.js"],assetsUrl:"./libs/vtj-ui-assets.js",assetsLibrary:"VtjUIAssets",required:!1,official:!0,enabled:!0}],Ps=[{name:"designer",type:"Designer",region:"workspace",disabled:!1,order:0,trigger:{label:"设计视图",type:"tab"}},{name:"schema",type:"Schema",region:"workspace",disabled:!1,order:1,trigger:{label:"Schema",type:"tab",closable:!0}},{name:"docs",type:"Docs",region:"workspace",disabled:!1,order:2,props:{url:"https://element-plus.org/zh-CN/"},trigger:{label:"帮助中心",type:"tab",closable:!0}}],Os=[{name:"properties",type:"Properties",region:"setting",group:"Node",trigger:{label:"属性",type:"tab"}},{name:"events",type:"Events",region:"setting",group:"Node",trigger:{label:"事件",type:"tab"}},{name:"directives",type:"Directives",region:"setting",group:"Node",trigger:{label:"指令",type:"tab"}},{name:"script",type:"BlockScript",region:"setting",group:"Block",trigger:{label:"设置",type:"tab"}},{name:"dataSources",type:"DataSources",region:"setting",group:"Block",trigger:{label:"数据源",type:"tab"}},{name:"css",type:"Css",region:"setting",group:"Block",trigger:{label:"样式",type:"tab"}},{name:"advanced",type:"Advanced",region:"setting",group:"Block",trigger:{label:"定义",type:"tab"}}],Ls=[{name:"nodePath",type:"NodePath",region:"status",props:{}}],Bs={activeApp:"pages",widgets:[...Ds,...Ts,...Is,...As,...Ps,...Os,...Ls],dependencies:Ns};function Us(u,e){const t=u.slice(0);return e.forEach(l=>{const s=t.findIndex(a=>a.name===l.name);s>-1?t.splice(s,1,al(t[s],l)):t.push(l)}),t}function Ms(u,e){const t=Us(u.widgets||[],(e==null?void 0:e.widgets)||[]);return Object.assign({},u,e||{},{widgets:t})}function Y(){const u=Kt(It);return{engine:u,regions:u.skeleton.regions,config:u.config,emitter:u.emitter,project:u.project,assets:u.assets}}function Fs(u){const e=E(""),t=R(()=>{const l=e.value.toLowerCase();return!l||!u?[]:u.filter(s=>{var a;return s.name.toLowerCase().includes(l)||((a=s.title)==null?void 0:a.toLowerCase().includes(l))})});return{searchKey:e,searchResult:t}}const Js=["onClick"],zs={key:1,class:"vtj-panel__header"},Hs={class:"vtj-panel__title"},Gs={key:1,class:"vtj-panel__subtitle"},qs={key:0,class:"vtj-panel__tools"},Ws=["onClick"],Ys={key:0,class:"vtj-panel__footer"},fe=N({__name:"Panel",props:{icon:{},title:{},subtitle:{},tools:{},bodyPadding:{type:Boolean,default:!0},back:{type:Boolean}},emits:["tool-click","back"],setup(u,{expose:e,emit:t}){const l=u,s=E(),a=E();function i(o){t("tool-click",o)}function r(){t("back")}return e({panel:s,header:a}),(o,v)=>(c(),V("div",{class:"vtj-panel",ref_key:"panel",ref:s},[T("div",{ref_key:"header",ref:a,class:"vtj-panel__header-wrapper"},[l.back?(c(),V("i",{key:0,onClick:Z(r,["stop"]),class:"vtj-panel__back vtj-icon-arrow-left"},null,8,Js)):x("",!0),o.title!==null?(c(),V("div",zs,[se(o.$slots,"title",{},()=>[T("div",Hs,[o.icon?(c(),V("i",{key:0,class:X(["vtj-panel__icon",o.icon])},null,2)):x("",!0),q(" "+H(o.title)+" ",1),o.subtitle?(c(),V("span",Gs,H(o.subtitle),1)):x("",!0)])]),o.tools&&o.tools.length||o.$slots.tools?(c(),V("div",qs,[(c(!0),V(M,null,F(o.tools,f=>(c(),V("i",{key:f.name,class:X(f.icon),onClick:d=>i(f)},null,10,Ws))),128)),se(o.$slots,"tools")])):x("",!0)])):x("",!0)],512),T("div",{class:X(["vtj-panel__body",{"is-padding":l.bodyPadding}])},[se(o.$slots,"default")],2),o.$slots.footer?(c(),V("div",Ys,[se(o.$slots,"footer")])):x("",!0)],512))}});const ne=N({__name:"Dialog",props:{modelValue:{type:Boolean,default:!0},modal:{type:Boolean,default:!0},width:{default:"80%"},height:{},top:{default:"40%"},cancel:{type:Boolean,default:!1},submit:{type:Boolean,default:!1},clear:{type:Boolean,default:!1},closable:{type:Boolean,default:!0}},emits:["close","update:modelValue","submit","clear"],setup(u,{expose:e,emit:t}){const l=u,s=hs(),a=E(),i=R(()=>{const p=[...s.tools||[]];return l.closable&&p.push({name:"close",icon:"vtj-icon-close"}),p}),{x:r,y:o}=_n(a),v=R(()=>({width:l.width,height:l.height,left:`${r.value}px`,top:`${o.value}px`})),f=p=>{p.name==="close"&&(t("update:modelValue",!1),t("close"))};function d(){t("update:modelValue",!1),t("close")}function _(){t("submit")}function g(){t("clear")}return e({close:d}),(p,b)=>l.modelValue?(c(),y(_s,{key:0,to:"body"},[T("div",{class:"vtj-dialog__modal",onMousemove:b[0]||(b[0]=Z(()=>{},["stop"]))},null,32),h(fe,K({ref_key:"panelRef",ref:a,onMousemove:b[1]||(b[1]=Z(()=>{},["stop"])),class:"vtj-dialog"},p.$attrs,{tools:i.value,style:v.value,draggable:"",onToolClick:f}),Xt({default:m(()=>[se(p.$slots,"default")]),_:2},[p.$slots.footer||p.cancel||p.submit||p.clear?{name:"footer",fn:m(()=>[se(p.$slots,"footer",{},()=>[T("div",null,[se(p.$slots,"action"),p.clear?(c(),y(n(oe),{key:0,type:"warning",size:"default",class:"vtj-dialog__clear",onClick:g},{default:m(()=>[q(" 清除绑定 ")]),_:1})):x("",!0)]),T("div",null,[p.cancel?(c(),y(n(oe),{key:0,onClick:d,size:"default"},{default:m(()=>[q(" 取消 ")]),_:1})):x("",!0),p.submit?(c(),y(n(oe),{key:1,type:"primary",onClick:_,size:"default"},{default:m(()=>[q(" 确定 ")]),_:1})):x("",!0)])])]),key:"0"}:void 0]),1040,["tools","style"])])):x("",!0)}});const Ks=T("div",null,"该组件支持多个插槽，请选择放置到其中一个",-1),Xs={class:"vtj-designer__slots"},Zs=["onClick"],Qs=N({__name:"SlotPicker",props:{slots:{default:()=>[]}},emits:["pick"],setup(u,{emit:e}){const t=u,l=E(!0),s=a=>{e("pick",a)};return(a,i)=>(c(),y(ne,{title:"提示",width:"600px",height:"200px",modelValue:l.value,"onUpdate:modelValue":i[0]||(i[0]=r=>l.value=r)},{default:m(()=>[Ks,T("div",Xs,[(c(!0),V(M,null,F(t.slots,r=>(c(),V("div",{onClick:o=>s(r),class:"vtj-designer__slot"},H(r.name),9,Zs))),256))])]),_:1},8,["modelValue"]))}}),en=(u,e=!0)=>{const{top:t,height:l,width:s,left:a}=u||{};if(l>100&&s>200)return"inner";let i,r;return r=t>30?"top":"bottom",i=e||a<300&&s<300?"left":"right",[i,r].join("-")},tn=u=>{const{rect:e,type:t}=u,{left:l,width:s,top:a,height:i}=e,r={left:l,width:s,top:a,height:i};switch(t){case"left":r.left=0,r.width=0;break;case"right":r.left=r.left+r.width-4,r.width=0;break;case"bottom":r.top=r.top+r.height-4,r.height=0;break;case"top":r.height=0;break}return r},ot=(u,e)=>{if(!e)return null;const{left:t,top:l,width:s,height:a}=u==="dropping"?tn(e):e.rect,i={left:`${t}px`,top:`${l}px`,width:`${s}px`,height:`${a}px`};return ae(z({},e),{style:i,position:en(e.rect,u!=="selected")})};let Me;function me(u){if(Me||!u)return Me;De(()=>{u.dispose()});const e=R(()=>ot("hover",u.hover.value)),t=R(()=>ot("dropping",u.dropping.value)),l=R(()=>ot("selected",u.selected.value)),s=i=>{const{type:r,node:o}=i;if(!o){u.selected.value=null,u.hover.value=null;return}switch(r){case"remove":u.selected.value=null;case"copy":u.setSelected(o);break;case"move":u.setSelected(o);break;case"hover":u.setHover(o);break;case"selected":u.setSelected(o);break}},a=E("pc");return w.on(pl,i=>{a.value=i}),w.on(Dt,i=>{u.setSelected(i)}),w.on(Tt,i=>{u.setHover(i)}),w.on(xe,i=>{u.hover.value=null,u.selected.value=null}),w.on(vl,i=>O(this,null,function*(){yield rt(100),u.hover.value=null,i&&l.value&&u.setSelected(l.value.node)})),w.on(U,()=>O(this,null,function*(){yield rt(100),l.value&&u.setSelected(l.value.node)})),Me={designer:u,hover:e,dropping:t,selected:l,onAction:s,viewportMode:a},Me}function ln(u){return new Promise((e,t)=>{const l=Zt(Qs,{slots:u,onClose:()=>{l.unmount(),t(void 0)},onPick:s=>{l.unmount(),e(s)}});l.mount(document.createElement("div"))})}function sn(u,e){var f,d,_,g,p;const t={state:(f=u.value)==null?void 0:f.removeState.bind(u.value),computed:(d=u.value)==null?void 0:d.removeComputed.bind(u.value),methods:(_=u.value)==null?void 0:_.removeMethods.bind(u.value),watch:(g=u.value)==null?void 0:g.removeWatch.bind(u.value),lifeCycles:(p=u.value)==null?void 0:p.removeLifeCycles.bind(u.value)},l=E(!1),s=E(Symbol()),a=E();return{list:R(()=>{var b,k;if(e==="watch")return(((b=u.value)==null?void 0:b.watch)||[]).map(S=>({title:S.source.value,model:S}));{const S=(k=u.value)==null?void 0:k[e];return Object.entries(S!=null?S:{}).map(([C,P])=>({title:C,model:{name:C,value:P}}))}}),visible:l,data:a,onAdd:b=>{s.value=Symbol(),a.value=null,l.value=!0},onEdit:b=>{s.value=Symbol(),a.value=z({},b),l.value=!0},onRemove:b=>O(this,null,function*(){if(yield ue.confirm("是否确定删除?","提示",{type:"warning"}).catch(()=>!1)){const S=t[e];S&&S(e==="watch"?b:b.name)}}),keyRef:s}}const nn={block:{type:Object,default:null},data:{type:Object},type:{type:String,default:"state"},title:{type:String,default:""},nameLabel:{type:String,default:""},valueLabel:{type:String,default:""},dataType:{type:String,default:"JSExpression"},defaults:{type:String,default:""}};function an(u){const e={name:"",value:{type:u.dataType,value:u.defaults}},t={state:u.block.setState.bind(u.block),computed:u.block.setComputed.bind(u.block),methods:u.block.setMethods.bind(u.block),lifeCycles:u.block.setLifeCycles.bind(u.block)},l=E(),s=E(),a=E(),i=R(()=>u.data?`编辑${u.title}`:`新增${u.title}`),r={name:[{required:!0,message:`${u.title}名称为必填项`}]},o=R(()=>!!u.data),v=be(u.data||we(e));xt(()=>{Object.assign(v,u.data||we(e))});const f=_=>u.data?!1:!!u.block[u.type][_];return{defaultJsData:e,title:i,model:v,formRef:l,dialogRef:s,editorRef:a,rules:r,disabled:o,onSubmit:()=>O(this,null,function*(){if(yield l.value.validate().catch(()=>!1)){if(f(v.name)){ge.warning({title:"提示",message:"已存在相同名称，请更换！"});return}const g=a.value.getEditor().getValue(),p=u.block.runtimeContext;p&&he(ae(z({},v.value),{value:g}),p)&&(v.value.value=g,t[u.type](v.name,v.value),s.value.close())}})}}const on={block:{type:Object,default:null},data:{type:Object}};function rn(u){const e={source:{type:"JSFunction",value:"() => { }"},immediate:!1,deep:!1,handler:{type:"JSFunction",value:"() => { }"}},t=E(),l=E(),s=E(),a=E(),i=R(()=>u.data?"编辑 Watch":"新增 Watch"),r=be(u.data||we(e));return xt(()=>{Object.assign(r,u.data||we(e))}),{title:i,model:r,onSubmit:()=>O(this,null,function*(){const v=u.block.runtimeContext,f=s.value.getEditor().getValue(),d=a.value.getEditor().getValue();v&&he(ae(z({},r.source),{value:f}),v)&&he(ae(z({},r.handler),{value:d}),v)&&(r.source.value=f,r.handler.value=d,u.block.setWatch(z({},r)),l.value.close())}),dialogRef:l,sourceRef:s,handlerRef:a,formRef:t}}function un(u,e){const{selected:t}=me(),l=R(()=>{var i;return(i=t.value)==null?void 0:i.node}),s=R(()=>{var A;const i=[];if(!u.value)return i;const r=u.value.runtimeContext,o=r==null?void 0:r.__context_refs[(A=l.value)==null?void 0:A.id],f=u.value.runtimeContext===o?[]:Object.keys(o||{}).map(C=>`this.${C}`);f.length&&i.push({title:"上下文",items:f});const d=u.value.inject.map(C=>`this.${C.name}`);d.length&&i.push({title:"注入",items:d});const _=u.value.props.map(C=>typeof C=="string"?`this.$props.${C}`:`this.$props.${C.name}`);_.length&&i.push({title:"属性",items:_});const g=Object.keys(u.value.state).map(C=>`this.state.${C}`);g.length&&i.push({title:"状态",items:g});const p=Object.keys(u.value.computed).map(C=>`this.${C}.value`);p.length&&i.push({title:"计算属性",items:p});const b=Object.keys(u.value.methods).map(C=>`this.${C}`);b.length&&i.push({title:"方法",items:b});const k=Object.keys(u.value.dataSources).map(C=>`this.${C}`);k.length&&i.push({title:"数据源",items:k});const S=Object.keys((r==null?void 0:r.$refs)||{}).map(C=>`this.$refs.${C}`);return S.length&&i.push({title:"refs",items:S}),i}),a=R(()=>{if(!e.value)return s.value;const i=e.value.toLowerCase(),r=[];return s.value.forEach(o=>{const v=o.items.filter(f=>f.toLowerCase().includes(i));v.length&&r.push({title:o.title,items:v})}),r});return{options:s,searchResult:a}}function cn(u,e){const t=[{name:"InputSetter",label:"文本"},{name:"ExpressionSetter",label:"表达式"}],l=E();te(u,d=>O(this,null,function*(){d?l.value=(yield e.getBlockDescription(d.from))||void 0:l.value=void 0}),{immediate:!0});const s=R(()=>!u.value||!st(u.value)?[]:[{name:"key",setters:t,value:u.value.getPropValue("key")},{name:"ref",setters:t,value:u.value.getPropValue("ref")},{name:"class",label:"class",setters:t,value:u.value.getPropValue("class")},{name:"style",label:"样式",setters:[{name:"JSONSetter",label:"JSON"},{name:"ExpressionSetter",label:"表达式"}],value:u.value.getPropValue("style")},{name:"children",label:"文本",title:"如设置组件文本，将清空子组件",setters:t,value:Array.isArray(u.value.children)?"":u.value.children}]),a=R(()=>{if(!u.value||!st(u.value))return[];const d=l.value||e.componentMap[u.value.name]||e.elementsMap[u.value.name];return d?(d.props||[]).map(g=>{var p;return ae(z({},g),{value:(p=u.value.getPropValue(g.name))!=null?p:g.defaultValue})}):[]}),i=d=>s.value.some(_=>_.name===d)||a.value.some(_=>_.name===d),r=R(()=>!u.value||!st(u.value)?[]:Object.keys(u.value.props).filter(d=>!i(d)).map(d=>({name:d,setters:"InputSetter",value:u.value.getPropValue(d)})));return{commonProps:s,componentProps:a,onChange:(d,_)=>{d==="children"?u.value.setChildren(_):u.value.setProp(d,_)},customProps:r,addCustom:d=>{d&&u.value.setProp(d,"")},isExist:i,removeProp:d=>{u.value.removeProp(d)},blockDescription:l}}function dn(u,e){const t=E();te(u,i=>O(this,null,function*(){i?t.value=(yield e.getBlockDescription(i.from))||void 0:t.value=void 0}),{immediate:!0});const l=R(()=>{var r;if(ee(u.value))return[];const i=((r=u.value)==null?void 0:r.events)||{};return jl.map(o=>({name:o,event:i[o]}))}),s=R(()=>{var r;if(ee(u.value))return[];const i=((r=u.value)==null?void 0:r.events)||{};return $l.map(o=>({name:o,event:i[o]}))}),a=R(()=>{var o,v,f;if(ee(u.value))return[];const i=((o=u.value)==null?void 0:o.events)||{};return(((v=t.value)==null?void 0:v.events)||((f=e.componentMap[u.value.name])==null?void 0:f.events)||[]).map(d=>{const _=typeof d=="string"?d:d.name;return{name:_,event:i[_]}})});return{mouseEventList:l,keyboardEventList:s,componentEventList:a}}class Ae{constructor(e,t,l){$(this,"isUnset",!1);this.name=e,this.value=t,this.defaultValue=l,this.setValue(t)}setValue(e){this.value=e,this.isUnset=this.value===this.defaultValue}getValue(){var e;return(e=this.value)!=null?e:this.defaultValue}static toDsl(e={}){return Object.entries(e).reduce((t,[l,s])=>(s.isUnset||(t[l]=s.getValue()),t),{})}static parse(e={}){return Object.entries(e).reduce((t,[l,s])=>(t[l]=new Ae(l,s),t),{})}}class Re{constructor(e){$(this,"id");$(this,"name","");$(this,"arg");$(this,"modifiers");$(this,"value");$(this,"iterator");this.id=e.id||Se(),this.update(e)}update(e){const{name:t,arg:l,modifiers:s,value:a,iterator:i}=e;this.name=t,this.arg=l,this.modifiers=s,this.value=a,this.iterator=i}static parse(e=[]){return e.map(t=>new Re(t))}static toDsl(e=[]){return e.map(t=>{const{name:l,arg:s,modifiers:a,value:i,iterator:r,id:o}=t;return{id:o,name:l,arg:s,modifiers:a,value:i,iterator:r}})}}class Ne{constructor(e,t){$(this,"handler");$(this,"modifiers",{});this.name=e;const{handler:l}=t;this.handler=l,this.update(t)}update(e){const{handler:t,modifiers:l={}}=e;this.handler=t,this.modifiers=l}static toDsl(e){return Object.entries(e).reduce((t,[l,s])=>{const{handler:a,modifiers:i}=s;return t[l]={handler:a,modifiers:i},t},{})}static parse(e={}){return Object.entries(e).reduce((t,[l,s])=>(t[l]=new Ne(l,s),t),{})}}const Ce=class Ce{constructor(e,t=null){$(this,"__VTJ_NODE__",!0);$(this,"id");$(this,"name");$(this,"from");$(this,"invisible",!1);$(this,"props",{});$(this,"children","");$(this,"slot");$(this,"directives",[]);$(this,"events",{});$(this,"disposed",!1);$(this,"root",null);$(this,"lock",!1);this.schema=e,this.parent=t;const{id:l,name:s,from:a=""}=e;this.id=l||Se(),this.name=s,this.from=a,t&&(this.root=ee(t)?t:t.root),this.update(e,!0),Ce.nodes[this.id]=this}update(e,t=!1){Object.assign(this.schema,e);const{children:l,slot:s,props:a,directives:i,events:r}=e;this.invisible=!!e.invisible,this.setChildren(l,t),this.setSlot(s,t),this.props=Ae.parse(a),this.directives=Re.parse(i),this.events=Ne.parse(r)}dispose(){const{children:e,disposed:t}=this;t||(Array.isArray(e)&&e.forEach(l=>l.dispose()),this.parent&&this.parent.removeChild(this),this.parent=null,this.root=null,this.disposed=!0,delete Ce.nodes[this.id])}toDsl(){const{id:e,name:t,from:l,invisible:s,slot:a,children:i,props:r,directives:o,events:v}=this,f=Array.isArray(i)?i.filter(d=>!d.invisible).map(d=>d.toDsl()):i;return ae(z({},this.schema),{id:e,name:t,from:l,invisible:s,slot:a,children:f,props:Ae.toDsl(r),directives:Re.toDsl(o),events:Ne.toDsl(v)})}setChildren(e="",t=!1){const{disposed:l}=this;l||(Array.isArray(e)?this.children=e.map(s=>new Ce(s,this)):this.children=e,t||w.emit(U,this))}setSlot(e,t=!1){this.slot=typeof e=="string"?{name:e,params:[]}:e,t||w.emit(U,this)}setProp(e,t){const l=this.props[e];l?l.setValue(t):this.props[e]=new Ae(e,t),w.emit(U,this)}removeProp(e){delete this.props[e],w.emit(U,this)}getPropValue(e){const t=this.props[e];if(t)return t.getValue()}setEvent(e,t){const l=this.events[e];l?l.update(t):this.events[e]=new Ne(e,t),w.emit(U,this)}removeEvent(e){delete this.events[e],w.emit(U,this)}setDirective(e){const t=this.directives.findIndex(l=>l.id===e.id);t>=0?this.directives.splice(t,1,e):this.directives.push(e),w.emit(U,this)}removeDirective(e){const t=this.directives.findIndex(l=>l.id===e.id);t>=0&&this.directives.splice(t,1),w.emit(U,this)}appendChild(e){const{children:t,disposed:l}=this;l||(e.parent=this,e.root=this.root,Array.isArray(t)?t.push(e):this.children=[e],w.emit(U,this))}insertChild(e,t=0){const{children:l,disposed:s}=this;s||(e.parent=this,e.root=this.root,Array.isArray(l)?l.splice(t,0,e):this.children=[e],w.emit(U,this))}removeChild(e){const{children:t,disposed:l}=this;if(l||!Array.isArray(t))return;const s=t.findIndex(a=>a===e);e.parent=null,e.root=null,t.splice(s,1),w.emit(U,this)}insertAfter(e){if(!this.parent)return;const t=this.parent.children;if(Array.isArray(t)){e.parent=this.parent,e.root=this.root;const l=t.indexOf(this);t.splice(l+1,0,e),w.emit(U,this.parent)}}insertBefore(e){if(!this.parent)return;const t=this.parent.children;if(Array.isArray(t)){e.parent=this.parent,e.root=this.root;const l=t.indexOf(this);t.splice(l,0,e),w.emit(U,this.parent)}}moveNext(){const e=this.parent;if(!e)return;const t=e.children;if(Array.isArray(t)){const l=t.indexOf(this);l>-1&&l<t.length-1&&(t.splice(l,1),t.splice(l+1,0,this),w.emit(U,e))}}movePrev(){const e=this.parent;if(!e)return;const t=e.children;if(Array.isArray(t)){const l=t.indexOf(this);l>0&&(t.splice(l,1),t.splice(l-1,0,this),w.emit(U,e))}}copy(){if(!this.parent)return;const e=this.toDsl();delete e.id;const t=new Ce(e);return this.insertAfter(t),t}};$(Ce,"nodes",{});let Le=Ce;const Ut=["name","title","inject","state","lifeCycles","methods","computed","watch","css","props","emits","slots","transform","dataSources"];class it{constructor(e){$(this,"__VTJ_BLOCK__",!0);$(this,"id");$(this,"name","");$(this,"title","");$(this,"inject",[]);$(this,"state",{});$(this,"lifeCycles",{});$(this,"methods",{});$(this,"computed",{});$(this,"watch",[]);$(this,"css","");$(this,"props",[]);$(this,"emits",[]);$(this,"slots",[]);$(this,"transform",{});$(this,"dataSources",{});$(this,"children",[]);$(this,"lock",!1);$(this,"invisible",!1);$(this,"disposed",!1);$(this,"parent",null);$(this,"root",null);$(this,"runtimeContext");const{id:t}=e;this.id=t||Se(),this.init(e)}init(e){for(const l of Ut){const s=e[l];s&&(this[l]=s)}const{children:t=[]}=e;this.children=t.map(l=>new Le(l,this))}dispose(){this.children.map(e=>e.dispose()),this.runtimeContext=void 0,this.disposed=!0}toDsl(){const{__VTJ_BLOCK__:e,id:t,children:l}=this,s=Ut.reduce((a,i)=>(a[i]=this[i],a),{});return ae(z({},s),{__VTJ_BLOCK__:e,id:t,children:l.map(a=>a.toDsl())})}appendChild(e,t,l){t?l==="left"||l==="top"?t.insertBefore(e):l==="right"||l==="bottom"?t.insertAfter(e):t.appendChild(e):(e.parent=this,e.root=this,this.children.push(e),w.emit(U,this))}removeChild(e){if(e.parent===this){const t=this.children.findIndex(l=>l.id===e.id||l===e);t>-1&&(e.parent=null,e.root=null,this.children.splice(t,1),w.emit(U,this))}else e.parent&&e.parent.removeChild(e)}allowDrop(e,t,l){return O(this,null,function*(){if(ee(t))return!0;const s=l.componentMap,a=(yield l.getBlockDescription(t.from))||s[t.name];if(!a||!e)return!0;const{parentIncludes:i=!0,name:r}=e,{childIncludes:o=!0}=a,v=i===!0||Array.isArray(i)&&i.includes(t.name),f=o===!0||Array.isArray(o)&&o.includes(r);return v&&f})}move(e,t,l){this.removeChild(e),ee(t)?t.appendChild(e):this.appendChild(e,t,l)}setState(e,t){this.state[e]=t,w.emit(U,this)}removeState(e){delete this.state[e],w.emit(U,this)}setComputed(e,t){this.computed[e]=t,w.emit(U,this)}removeComputed(e){delete this.computed[e],w.emit(U,this)}setMethods(e,t){this.methods[e]=t,w.emit(U,this)}removeMethods(e){delete this.methods[e],w.emit(U,this)}setLifeCycles(e,t){this.lifeCycles[e]=t,w.emit(U,this)}removeLifeCycles(e){delete this.lifeCycles[e],w.emit(U,this)}setWatch(e){e.id=e.id||Se();const t=this.watch.findIndex(l=>l.id&&l.id===e.id||l===e);t>-1?this.watch.splice(t,1,e):this.watch.push(e),w.emit(U,this)}removeWatch(e){const t=this.watch.findIndex(l=>l.id&&l.id===e.id||l===e);t>-1&&(this.watch.splice(t,1),w.emit(U,this))}setCss(e){this.css=e,w.emit(U,this)}setProp(e){const t=this.props.findIndex(l=>typeof l=="string"?l===e.name:l.name===e.name);t>-1?this.props.splice(t,1,e):this.props.push(e),w.emit(U,this)}removeProp(e){const t=this.props.findIndex(l=>typeof l=="string"?l===e.name:l.name===e.name);t>-1&&(this.props.splice(t,1),w.emit(U,this))}setEmit(e){const t=this.emits.findIndex(l=>l===e);t>-1?this.emits.splice(t,1,e):this.emits.push(e),w.emit(U,this)}removeEmit(e){const t=this.emits.findIndex(l=>l===e);t>-1&&(this.emits.splice(t,1),w.emit(U,this))}setSlot(e){const t=this.slots.findIndex(l=>l===e);t>-1?this.slots.splice(t,1,e):this.slots.push(e),w.emit(U,this)}removeSlot(e){const t=this.slots.findIndex(l=>l===e);t>-1&&(this.slots.splice(t,1),w.emit(U,this))}setInject(e){const t=this.inject.findIndex(l=>l.name===e.name);t>-1?this.inject.splice(t,1,e):this.inject.push(e),w.emit(U,this)}removeInject(e){const t=this.inject.findIndex(l=>l.name===e.name);t>-1&&(this.inject.splice(t,1),w.emit(U,this))}setDataSource(e){this.dataSources[e.name]=e,w.emit(U,this)}removeDataSource(e){delete this.dataSources[e],w.emit(U,this)}}class pn{constructor(e,t=[]){$(this,"__VTJ_PROJECT__",!0);$(this,"id","");$(this,"name","");$(this,"description","");$(this,"homepageId","");$(this,"dependencies",E([]));$(this,"pages",E([]));$(this,"blocks",E([]));$(this,"apis",E([]));$(this,"current",E(null));this.source=t,this.load(e)}load(e){const{id:t,description:l="",name:s="",homepageId:a="",dependencies:i=[],pages:r=[],blocks:o=[],apis:v=[]}=e||{};this.id=t||Se(),this.description=l,this.name=s,this.homepageId=a,this.dependencies.value=this.mergeDeps(i,this.source),this.pages.value=r,this.blocks.value=o,this.apis.value=v}update(e){const t=this.toDsl();Object.assign(t,e),this.load(t),w.emit(ve,t)}activeFile(e){this.current.value=e?new it(e):null,w.emit(di,this.current.value)}mergeDeps(e,t){const l=e.filter(i=>!!i.official),s=e.filter(i=>!i.official);return t.map(i=>{const r=l.find(o=>o.package===i.package);return Object.assign(i,r||{})}).concat(s)}setDeps(e){const t=this.dependencies.value,l=t.findIndex(s=>s.package===e.package);l>-1?t.splice(l,1,z(z({},t[l]),e)):t.push(Qe(e)),w.emit(ve,this.toDsl())}removeDeps(e){const t=this.dependencies.value,l=t.findIndex(s=>s.package===e.package);l>-1&&(t.splice(l,1),w.emit(ve,this.toDsl()))}toDsl(){const{id:e,description:t,name:l,homepageId:s,dependencies:a,pages:i,blocks:r,apis:o,__VTJ_PROJECT__:v}=this;return{__VTJ_PROJECT__:v,__VTJ_VERSION__:ol,__VTJ_DATE__:Date.now().toString(),id:e,description:t,name:l,homepageId:s,dependencies:n(a),pages:n(i),blocks:n(r),apis:n(o)}}findPage(e){const t=(l,s=[])=>{for(const a of s){if(a.id===l)return a;if(a.children&&a.children.length){const i=t(l,a.children);if(i)return i}}};return t(e,this.pages.value)}getPages(){return Rl(this.pages.value)}getHomePage(){return this.getPages().find(t=>!!t.home)}clearHomePage(){this.getPages().forEach(t=>{t.home=!1})}addPage(e,t){const{name:l,title:s,isDir:a,home:i}=e,r=new it({name:l,title:s}),o=r.toDsl();if(e.id=o.id,i&&(this.clearHomePage(),e.home=!0),a&&(e.children=[]),t){const v=this.findPage(t);v&&(v.children?v.children.push(e):v.children=[e])}else this.pages.value.push(e);return a||w.emit(Ge,o),w.emit(ve,this.toDsl()),r}updatePage(e,t){if(e.id){const l=this.findPage(e.id);l&&(Object.assign(l,e),l.home&&(this.clearHomePage(),l.home=!0),t&&(t.name=l.name,t.title=l.title,w.emit(ft,t)),w.emit(ve,this.toDsl()))}}copyPage(e,t,l){var v;const s=Se(),a=ae(z({},e),{id:s}),i=ae(z({},t),{id:s}),r=l?((v=this.findPage(l))==null?void 0:v.children)||[]:this.pages.value,o=r.findIndex(f=>f.id===e.id);r.splice(o,0,a),w.emit(Ge,i),w.emit(ve,this.toDsl())}removePage(e){var l;const t=(s,a)=>{const i=a.findIndex(r=>r.id===s);if(i>=0){a.splice(i,1);return}for(const r of a)if(r.children&&r.children.length)return t(s,r.children)};t(e,this.pages.value),((l=this.current.value)==null?void 0:l.id)===e&&(this.current.value=null),w.emit(ht,e),w.emit(ve,this.toDsl())}addBlock(e){const t=new it(e),l=t.toDsl(),{id:s,name:a,title:i}=l,r={id:s,name:a,title:i};return this.blocks.value.push(r),w.emit(Ge,l),w.emit(ve,this.toDsl()),t}updateBlock(e,t){const{id:l}=e;Object.assign(t,e);const s=this.blocks.value,a=s.findIndex(i=>i.id===l);a>-1&&(s.splice(a,1,e),w.emit(ft,t),w.emit(ve,this.toDsl()))}removeBlock(e){var s;const t=this.blocks.value,l=t.findIndex(a=>a.id===e);l>-1&&(((s=this.current.value)==null?void 0:s.id)===e&&this.activeFile(null),t.splice(l,1),w.emit(ht,e),w.emit(ve,this.toDsl()))}findBlock(e){return this.blocks.value.find(t=>t.id===e)}existBlockName(e){return this.blocks.value.some(t=>t.name===e.name&&t.id!==e.id)}getFile(e){const t=this.findBlock(e);return t||this.findPage(e)}isPage(e){return typeof(e==null?void 0:e.isDir)=="boolean"}setApi(e){const t=this.apis.value,l=t.findIndex(s=>s.name===e.name);l>-1?t.splice(l,1,e):t.push(e),w.emit(ve,this.toDsl())}removeApi(e){const t=this.apis.value,l=t.findIndex(s=>s.name===e);l>-1&&(t.splice(l,1),w.emit(ve,this.toDsl()))}}class vn{constructor(e){$(this,"index",-1);$(this,"list",[]);$(this,"max");$(this,"blockId");const{history:t,max:l=50}=e;this.blockId=t.blockId,this.max=l,this.refresh(t.items||[])}refresh(e){this.index=-1,this.list=Qt(e)}go(){const{index:e,list:t}=this;if(e<0)return;--this.index;const l=t[this.index];l&&(w.emit(vi,l),w.emit($e,l))}back(){const{index:e,list:t}=this;if(e>=t.length-1)return;e<0&&(this.index=0),++this.index;const l=t[this.index];l&&(w.emit(mi,l),w.emit($e,l))}push(e){const{max:t,list:l,blockId:s}=this,a={id:Se(),title:new Date().toLocaleString(),block:we(e)};l.unshift(a),l.length>t&&(this.list=l.splice(t)),this.index=-1,w.emit(fi,{blockId:s,item:a}),w.emit(Ke,this.toDsl())}load(e){const t=this.list.findIndex(l=>l.id===e);t>=0&&(this.index=t,w.emit($e,this.list[t]))}remove(e){const t=this.list.findIndex(a=>a.id===e),{list:l,blockId:s}=this;if(t>-1){const a=l.splice(t,1);t===this.index?this.index=-1:this.index>=l.length&&(this.index=l.length-1),w.emit(hi,{blockId:s,item:a[0]}),w.emit(Ke,this.toDsl())}}toDsl(){const{blockId:e,list:t}=this;return{blockId:e,items:Qe(t)}}}const Mt=(u,e)=>new Re({name:u,value:void 0,iterator:e}),mn=(u="modelValue")=>new Re({name:"vModel",value:void 0,arg:u});function fn(u){if(!u)return[];const{props:e=[],events:t=[]}=u;if(e.length&&t.length){const l=t.filter(s=>(typeof s=="string"?s:s.name).startsWith("onUpdate:")).map(s=>s=typeof s=="string"?s:s.name);return l.length?e.filter(s=>l.some(a=>a.includes(s.name))):[]}return[]}function hn(u,e){const t=p=>R(()=>u.value&&(u.value.directives||[]).find(b=>b.name===p)||Mt(p)),l=R(()=>fn(e.value)),s=()=>R(()=>l.value.map(p=>(u.value.directives||[]).find(b=>b.name==="vModel"&&b.arg==p.name)||mn(p.name))),a=t("vIf"),i=t("vShow"),r=t("vBind"),o=t("vFor"),v=s(),f={vIf:a,vShow:i,vBind:r,vFor:o};return{directives:f,vIf:a,vShow:i,vBind:r,vFor:o,vModels:v,onValueChange:(p,b)=>{const k=f[p];b?(k.value.value=b,u.value.setDirective(k.value)):(k.value.value=void 0,u.value.removeDirective(k.value))},onForChange:(p,b)=>{if(p==="value"){b?(o.value.value=b,u.value.setDirective(o.value)):u.value.removeDirective(o.value);return}(p==="item"||p==="index")&&(o.value.iterator=ae(z({},o.value.iterator),{[p]:b||void 0}),u.value.setDirective(o.value))},onModelChange:(p,b)=>{const k=parseInt(p),S=v.value[k];S&&(b?(S.value=b,u.value.setDirective(S)):(S.value=void 0,u.value.removeDirective(S)))}}}function _n(u){const e=E(),t=E(),l=E(),s=E(0),a=E(0),i=()=>{const{innerWidth:o,innerHeight:v}=window,{left:f=0,top:d=0,width:_=0,height:g=0}=e.value,p=Math.max((o-_)/2,0),b=Math.max((v-g)/2,0);return{x:p,y:b}},r=o=>{const{innerWidth:v,innerHeight:f}=window,{width:d=0,height:_=0}=t.value.getBoundingClientRect();s.value=Math.max(0,o.x),o.x>v-d&&(s.value=Math.min(o.x,v-d)),a.value=Math.max(0,o.y),o.y>f-_&&(a.value=Math.min(o.y,f-_))};return te(u,o=>{const v=o==null?void 0:o.panel;if(v){t.value=v,l.value=o==null?void 0:o.header,e.value=v.getBoundingClientRect();const f=i();s.value=f.x,a.value=f.y,ws(t,{initialValue:i(),handle:l,onMove:d=>{r(d)}})}}),{x:s,y:a}}const Ve=N({name:"WidgetRenderer",props:{name:String,type:[String,Object],props:Object,disabled:Boolean,extendProps:Object,order:Number,visible:{type:Boolean,default:!0}},setup(u,{slots:e}){const t=Kt(It),l=E(u.visible),s=R(()=>u.type&&(t!=null&&t.skeleton)?t==null?void 0:t.skeleton.getComponent(u.type):null);return te(()=>u.visible,a=>{a&&(l.value=a)},{immediate:!0}),et(()=>{const a=t==null?void 0:t.skeleton;if(u.name&&a){const i=gs();a.widgetInstances[u.name]=i==null?void 0:i.refs[u.name]}}),De(()=>{const a=t==null?void 0:t.skeleton;u.name&&a&&delete a.widgetInstances[u.name]}),()=>s.value&&!u.disabled&&l.value?el(s.value,z({ref:u.name,name:u.name,extendProps:u.extendProps,order:u.order,style:{display:u.visible?"":"none"}},u.props)):null}}),Ft=N({__name:"InputSetter",setup(u){return(e,t)=>(c(),y(n(W),K({clearable:""},e.$attrs),null,16))}}),Jt=N({__name:"SelectSetter",props:{options:{default:()=>[]}},setup(u){const e=u;return(t,l)=>(c(),y(n(Ze),We(jt(t.$attrs)),{default:m(()=>[(c(!0),V(M,null,F(e.options,s=>(c(),y(n(Xe),K({key:s.label},s),null,16))),128))]),_:1},16))}}),gn="{{",bn="}}",yn=N({__name:"ExpressionSetter",props:{modelValue:{default:()=>({type:"JSExpression",value:""})}},emits:["change"],setup(u,{emit:e}){const t=u,{project:l}=Y(),s=r=>{var v;const o=(v=l.current.value)==null?void 0:v.runtimeContext;return he(r,o)},a=E(t.modelValue.value);te(()=>t.modelValue.value,r=>{a.value=r});const i=r=>{const o={type:"JSExpression",value:r};s(o)&&e("change",o)};return(r,o)=>(c(),y(n(W),{class:"vtj-expression-setter",modelValue:a.value,"onUpdate:modelValue":o[0]||(o[0]=v=>a.value=v),onChange:i},{prefix:m(()=>[q(H(gn))]),suffix:m(()=>[q(H(bn))]),_:1},8,["modelValue"]))}}),de=bs(()=>Ss(()=>import("./Editor-f85f8dad.js"),["./Editor-f85f8dad.js","./monaco-editor-919908db.js","./monaco-editor-456639a7.css","./@vue-74e1d4f0.js","./Editor-51e536fd.css"],import.meta.url)),kn=T("i",{class:"vtj-icon-more"},null,-1),En={key:0,class:"vtj-tabs__check"},Rt=N({__name:"Tabs",props:{items:{default:()=>[]},modelValue:{},more:{},stretch:{type:Boolean},checkable:{type:Boolean}},emits:["update:modelValue","more","tab-remove"],setup(u,{emit:e}){var i,r;const t=u,l=E((r=t.modelValue||((i=t.items[0])==null?void 0:i.name))!=null?r:"");te(l,()=>{e("update:modelValue",l.value)}),te(()=>t.modelValue,o=>{l.value=o});const s=o=>{e("more",o)},a=o=>{e("tab-remove",o)};return(o,v)=>(c(),y(fe,K({class:"vtj-tabs"},o.$attrs),{title:m(()=>[h(n(pt),{type:"card",modelValue:l.value,"onUpdate:modelValue":v[0]||(v[0]=f=>l.value=f),onTabRemove:a,stretch:t.stretch},{default:m(()=>[(c(!0),V(M,null,F(t.items,f=>(c(),y(n(dt),{key:f.name,label:f.label,name:f.name,closable:f.closable,lazy:""},null,8,["label","name","closable"]))),128))]),_:1},8,["modelValue","stretch"])]),tools:m(()=>[t.more?(c(),y(n(kt),{key:0,"hide-on-click":!1,size:"small",placement:"bottom-end",onCommand:s},{dropdown:m(()=>[h(n(Vt),null,{default:m(()=>[(c(!0),V(M,null,F(t.more,f=>(c(),y(n(Et),{key:f.name,command:f},{default:m(()=>[t.checkable?(c(),V("span",En,[T("i",{class:X(`${f.checked?"vtj-icon-check":"none"}`)},null,2)])):x("",!0),q(" "+H(f.label),1)]),_:2},1032,["command"]))),128))]),_:1})]),default:m(()=>[kn]),_:1})):x("",!0)]),default:m(()=>[se(o.$slots,"default")]),_:3},16))}});const zt=N({__name:"Icon",props:{icon:{},label:{},active:{type:Boolean,default:!1},open:{type:Boolean,default:!1}},emits:["click"],setup(u,{emit:e}){const t=u,l=R(()=>({"is-active":t.active,"is-open":t.open})),s=()=>{e("click")};return(a,i)=>(c(),y(n(Wt),{effect:"dark",placement:"right",content:a.label,"show-after":600},{default:m(()=>[T("div",{class:X(["vtj-icon",l.value]),onClick:s},[T("i",{class:X(a.icon)},null,2)],2)]),_:1},8,["content"]))}}),ie=N({__name:"SubPanel",setup(u){return(e,t)=>(c(),y(fe,K({class:"vtj-sub-panel"},e.$attrs),Xt({default:m(()=>[se(e.$slots,"default")]),_:2},[e.$slots.footer?{name:"footer",fn:m(()=>[se(e.$slots,"footer")]),key:"0"}:void 0]),1040))}});const Vn=["onClick"],Cn={class:"vtj-data-item__title"},Sn={class:"vtj-data-item__action"},wn=["onClick"],xn=["onClick"],jn={key:0,class:"vtj-data-item__body"},ce=N({__name:"DataItem",props:{title:{default:""},content:{default:""},editable:{type:Boolean,default:!1},removable:{type:Boolean,default:!1},active:{type:Boolean,default:!1},collapsible:{type:Boolean,default:!1},clickable:{type:Boolean,default:!1},collapsed:{type:Boolean,default:!1},background:{type:Boolean,default:!0}},emits:["click","remove","edit"],setup(u,{emit:e}){const t=u,l=E(t.collapsed),s=()=>{e("edit")},a=()=>{e("remove")},i=()=>{t.clickable?e("click"):r()},r=()=>{t.collapsible&&(l.value=!l.value)};return(o,v)=>(c(),V("div",{class:X(["vtj-data-item",{"is-current":t.active}])},[T("div",{class:X(["vtj-data-item__header",{"is-pointer":t.clickable||t.collapsible,"is-bg":t.background}]),onClick:i},[t.collapsible?(c(),V("i",{key:0,class:X(["vtj-icon-greater arrow",{open:!l.value}]),onClick:Z(r,["stop"])},null,10,Vn)):x("",!0),T("div",Cn,[se(o.$slots,"title",{},()=>[q(H(t.title),1)])]),T("div",Sn,[se(o.$slots,"action"),t.editable?(c(),V("i",{key:0,class:"vtj-icon-edit",title:"编辑",onClick:Z(s,["stop"])},null,8,wn)):x("",!0),t.removable?(c(),V("i",{key:1,class:"vtj-icon-remove",title:"删除",onClick:Z(a,["stop"])},null,8,xn)):x("",!0)])],2),t.content||o.$slots.default?Ee((c(),V("div",jn,[se(o.$slots,"default",{},()=>[q(H(t.content),1)])],512)),[[je,!l.value]]):x("",!0)],2))}});const $n={class:"vtj-context-viewer"},Rn=["onClick"],Dn=N({__name:"ContextViewer",emits:["pick"],setup(u,{emit:e}){const{copy:t}=tl({}),{project:l}=Y(),s=R(()=>{var d;return(d=l.current.value)==null?void 0:d.runtimeContext}),a=["$provider","$apis","$components","context"],i=d=>{const _=d.value,g=nt(_);return g==="Object"||g==="Module"?Object.keys(_||{}).length===0:g==="Array"?_.length===0:!0},r=(d,_="this")=>typeof d=="object"?Array.isArray(d)?d.map((g,p)=>{const b=`[${p}]`;return{label:b,value:g,type:nt(g),path:`${_}${b}`}}):Object.entries(d).map(([g,p])=>({label:g,value:p,type:nt(p),path:`${_}.${g}`})).filter(g=>!g.label.startsWith("__")&&!a.includes(g.label)):[],o=(d,_)=>{if(d.level===0)_(r(s.value));else{const g=Qe(d.data.value);_(r(g,d.data.path))}},v=d=>{t(d.path),pe.success({message:"已经复制到粘贴板"})},f=d=>{e("pick",d.path)};return(d,_)=>(c(),V("div",$n,[s.value?(c(),y(n(Ct),{key:0,lazy:"",load:o,"expand-on-click-node":!1,props:{isLeaf:i}},{default:m(({data:g})=>[h(n(ce),{title:g.label,clickable:"",onClick:p=>f(g)},{action:m(()=>[T("i",{class:"vtj-icon-copy",title:"复制",onClick:Z(p=>v(g),["stop"])},null,8,Rn)]),_:2},1032,["title","onClick"])]),_:1},8,["props"])):x("",!0)]))}});const Tn={key:0,class:"vtj-binder__common"},In=["onClick"],An={class:"vtj-binder__footer"},tt=N({__name:"Binder",props:{clearable:{type:Boolean,default:!0}},emits:["submit","cancel","remove","pick"],setup(u,{expose:e,emit:t}){const l=u,s=[{name:"common",label:"常用"},{name:"viewer",label:"高级"}],a=E("common"),{project:i}=Y(),r=E(""),{searchResult:o}=un(i.current,r),{copy:v}=tl({}),f=E(),d=()=>{t("submit")},_=()=>{t("cancel"),f.value.close()},g=()=>{t("remove")},p=S=>{t("pick",S)},b=S=>{v(S),pe.success({message:"已经复制到粘贴板"})};return e({close:()=>{f.value.close()}}),(S,A)=>(c(),y(ne,{ref_key:"dialogRef",ref:f,"body-padding":!1,width:"1000px",height:"600px"},{default:m(()=>[h(n(mt),{class:"vtj-binder"},{default:m(()=>[h(n(vt),null,{default:m(()=>[h(Rt,{items:s,modelValue:a.value,"onUpdate:modelValue":A[1]||(A[1]=C=>a.value=C)},{default:m(()=>[a.value==="common"?(c(),V("div",Tn,[h(n(W),{modelValue:r.value,"onUpdate:modelValue":A[0]||(A[0]=C=>r.value=C),size:"small",clearable:"","prefix-icon":n(sl),placeholder:"筛选可用项"},null,8,["modelValue","prefix-icon"]),(c(!0),V(M,null,F(n(o),C=>(c(),V("div",null,[h(n(St),{"border-style":"dotted"},{default:m(()=>[q(H(C.title),1)]),_:2},1024),(c(!0),V(M,null,F(C.items,P=>(c(),y(ce,{clickable:"",title:P,onClick:j=>p(P)},{action:m(()=>[T("i",{class:"vtj-icon-copy",title:"复制",onClick:Z(j=>b(P),["stop"])},null,8,In)]),_:2},1032,["title","onClick"]))),256))]))),256)),n(o).length?x("",!0):(c(),y(n(le),{key:0}))])):x("",!0),a.value==="viewer"?(c(),y(Dn,{key:1,onPick:p})):x("",!0)]),_:1},8,["modelValue"])]),_:1}),h(n(Yt),null,{default:m(()=>[h(fe,{title:null},{footer:m(()=>[T("div",An,[T("span",null,[l.clearable?(c(),y(n(oe),{key:0,size:"default",type:"warning",onClick:g},{default:m(()=>[q(" 移除绑定 ")]),_:1})):x("",!0)]),T("span",null,[h(n(oe),{size:"default",onClick:_},{default:m(()=>[q("取消")]),_:1}),h(n(oe),{size:"default",type:"primary",onClick:d},{default:m(()=>[q(" 确定 ")]),_:1})])])]),default:m(()=>[se(S.$slots,"default")]),_:3})]),_:3})]),_:3})]),_:3},512))}});const Nn=N({__name:"VarBinder",props:{value:{default:""},defaults:{default:""},type:{default:"JSExpression"}},emits:["submit"],setup(u,{emit:e}){const t=u,{project:l}=Y(),s=E(t.value||t.defaults),a=R(()=>`绑定内容 [ ${t.type} ]`),i=E(),r=E(),o=d=>{var g;const _=(g=l.current.value)==null?void 0:g.runtimeContext;return he({value:d,type:t.type},_)},v=()=>{const d=i.value.getEditor().getValue().trim();d?o(d)&&(e("submit",{type:t.type,value:d}),r.value.close()):ge.warning({message:"请输入绑定内容"})},f=d=>{var g;((g=i.value)==null?void 0:g.getEditor())&&(s.value=d)};return(d,_)=>(c(),y(tt,{ref_key:"binderRef",ref:r,title:"变量绑定",onSubmit:v,onPick:f},{default:m(()=>[h(n(Q),{class:"vtj-var-binder","label-position":"top"},{default:m(()=>[h(n(J),{label:a.value},{default:m(()=>[h(n(de),{ref_key:"editorRef",ref:i,"model-value":s.value,width:"100%",height:"100%",dark:""},null,8,["model-value"])]),_:1},8,["label"])]),_:1})]),_:1},512))}});const Pn=N({__name:"EventBinder",props:{name:{},event:{},node:{}},emits:["submit","remove"],setup(u,{emit:e}){var p,b,k;const t=u,{assets:l,project:s}=Y(),a=E(),i=E(),r=E(Object.keys(((p=t.event)==null?void 0:p.modifiers)||{})),o=R(()=>{var C;const S=(C=t.node)==null?void 0:C.name;if(!S)return[];const A=l.componentMap[S];if(A&&A.events){const P=A.events.find(j=>j===t.name||j.name===t.name);if(P&&P.params)return P.params||[]}return[]}),v=E(((k=(b=t.event)==null?void 0:b.handler)==null?void 0:k.value)||`(${o.value.join(", ")}) => {\r
\r
}`),f=S=>{var C;const A=(C=s.current.value)==null?void 0:C.runtimeContext;return he({value:S,type:"JSFunction"},A)},d=()=>{const S=a.value.getEditor().getValue().trim();if(S){if(f(S)){const A={handler:{type:"JSFunction",value:S},modifiers:r.value.reduce((C,P)=>(C[P]=!0,C),{})};e("submit",A),i.value.close()}}else ge.warning({message:"请输入绑定内容"})},_=S=>{var C;((C=a.value)==null?void 0:C.getEditor())&&(v.value=S)},g=()=>{e("remove",t.name)};return(S,A)=>(c(),y(tt,{ref_key:"binderRef",ref:i,title:"事件绑定",subtitle:t.name,onSubmit:d,onPick:_,onRemove:g},{default:m(()=>[h(n(Q),{class:"vtj-event-binder","label-position":"top"},{default:m(()=>[h(n(J),{label:"事件修饰符"},{default:m(()=>[h(n(Yl),{modelValue:r.value,"onUpdate:modelValue":A[0]||(A[0]=C=>r.value=C)},{default:m(()=>[(c(!0),V(M,null,F(n(Dl),C=>(c(),y(n(Kl),{key:C,label:C},null,8,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),h(n(J),{label:"事件处理函数"},{default:m(()=>[h(n(de),{ref_key:"editorRef",ref:a,width:"100%",height:"360px",dark:"","model-value":v.value},null,8,["model-value"])]),_:1})]),_:1})]),_:1},8,["subtitle"]))}});const On=["draggable","onDragstart","onClick","title"],Ln=["src"],Bn={key:1,class:"vtj-components__name"},Un={key:2,class:"vtj-components__footer"},Mn=["onClick"],Fn=["onClick"],He=N({__name:"ComponentList",props:{list:{default:()=>[]},span:{default:6},editable:{type:Boolean},removable:{type:Boolean},active:{},type:{}},emits:["edit","remove","click"],setup(u,{emit:e}){const t=u;function l(o,v){return O(this,null,function*(){t.type==="Schema"&&(o.from={type:"Schema",id:o.id}),w.emit(bt,o)})}function s(){w.emit(yt)}function a(o){e("edit",o)}function i(o){e("remove",o)}function r(o){e("click",o)}return(o,v)=>t.list.length?(c(),y(n(Zl),{key:0,class:"vtj-components__box",gutter:10},{default:m(()=>[(c(!0),V(M,null,F(t.list,f=>(c(),y(n(Xl),{span:t.span},{default:m(()=>[T("div",{class:X(["vtj-components__item",{"is-active":t.active&&t.active(f)}]),draggable:!(t.active&&t.active(f)),onDragstart:d=>l(f),onDragend:s,onClick:d=>r(f),title:f.name},[f.icon?(c(),V("img",{key:0,src:f.icon,alt:""},null,8,Ln)):(c(),V("span",Bn,H(f.name),1)),T("span",null,H(f.title),1),t.editable||t.removable?(c(),V("div",Un,[t.editable?(c(),V("i",{key:0,onClick:Z(d=>a(f),["stop"]),class:"vtj-icon-edit"},null,8,Mn)):x("",!0),t.removable?(c(),V("i",{key:1,onClick:Z(d=>i(f),["stop"]),class:"vtj-icon-remove"},null,8,Fn)):x("",!0)])):x("",!0)],42,On)]),_:2},1032,["span"]))),256))]),_:1})):(c(),y(n(le),{key:1,description:"暂无数据","image-size":60}))}});const Jn={key:0,class:"vtj-list-panel__search"},zn=T("i",{class:"vtj-icon-search"},null,-1),rl=N({__name:"ListPanel",props:{search:{type:[Boolean,Object],default:!1},tabs:{default:void 0},columnWidth:{default:100}},emits:["search-change"],setup(u,{emit:e}){var r,o;const t=u,l=E(null),s=E(6),a=E("");te(a,()=>{e("search-change",a.value)});const i=E((o=(r=t.tabs)==null?void 0:r[0])==null?void 0:o.name);return ll(l,v=>{const f=v[0],{width:d}=f.contentRect,_=Math.min(Math.floor(d/120),24);s.value=Math.floor(24/_)}),(v,f)=>(c(),y(fe,{class:"vtj-list-panel",ref_key:"panel",ref:l},{default:m(()=>[t.search?(c(),V("div",Jn,[h(n(W),K({size:"small"},v.search,{modelValue:a.value,"onUpdate:modelValue":f[0]||(f[0]=d=>a.value=d),clearable:""}),{prefix:m(()=>[zn]),_:1},16,["modelValue"])])):x("",!0),t.search&&a.value?(c(),y(n(pt),{key:1},{default:m(()=>[h(n(dt),{label:"搜索结果"},{default:m(()=>[se(v.$slots,"search",{search:a.value,span:s.value})]),_:3})]),_:3})):x("",!0),Ee(h(n(pt),{modelValue:i.value,"onUpdate:modelValue":f[1]||(f[1]=d=>i.value=d),class:"vtj-list-panel__tabs"},{default:m(()=>[(c(!0),V(M,null,F(t.tabs,d=>(c(),y(n(dt),{key:d.name,label:d.label,name:d.name,lazy:""},{default:m(()=>[se(v.$slots,"tab",{tab:d,span:s.value},()=>[d.component?(c(),y($t(d.component),K({key:0,tab:d.name,currentTab:i.value,search:a.value,span:s.value},d.props),null,16,["tab","currentTab","search","span"])):x("",!0)])]),_:2},1032,["label","name"]))),128))]),_:3},8,["modelValue"]),[[je,t.tabs&&!a.value]]),se(v.$slots,"default",{currentTab:i.value,search:a.value,span:s.value})]),_:3},512))}});const Hn=N({__name:"JSONSetter",props:{modelValue:{type:[Boolean,String,Number,null,Array,Object],default:void 0}},emits:["change"],setup(u,{emit:e}){const t=u,l=E(),s=E(typeof t.modelValue=="object"?JSON.stringify(t.modelValue,null,2):void 0),a=R(()=>!!s.value),i=E(!1),r=d=>{let _=!0;try{if(typeof JSON.parse(d)!="object")throw new Error(`"${d}" is not a JSON`)}catch(g){_=!1,ge.error({title:"代码错误",message:(g==null?void 0:g.message)||g})}return _},o=()=>{var _;const d=(_=l.value)==null?void 0:_.getEditor();if(d){const g=d.getValue();r(g)&&(s.value=g,e("change",JSON.parse(g)),i.value=!1)}},v=()=>{s.value="",e("change",void 0),i.value=!1},f=()=>{i.value=!0};return(d,_)=>(c(),V("div",{class:X(["vtj-json-setter",{"is-active":a.value}])},[h(n(W),K({readonly:"",onFocus:f,"model-value":"JSON","suffix-icon":n(nl)},d.$attrs),null,16,["suffix-icon"]),i.value?(c(),y(n(ne),{key:0,modelValue:i.value,"onUpdate:modelValue":_[0]||(_[0]=g=>i.value=g),title:"JSON",width:"1000px",height:"600px",cancel:"",submit:"",clear:"",onSubmit:o,onClear:v},{default:m(()=>[h(n(de),{ref_key:"codeEditor",ref:l,height:"100%",lang:"json",dark:"","model-value":s.value},null,8,["model-value"])]),_:1},8,["modelValue"])):x("",!0)],2))}});const Gn=N({__name:"FunctionSetter",props:{modelValue:{default:()=>({type:"JSFunction",value:""})}},emits:["change"],setup(u,{emit:e}){const t=u,l=E(),s=E(t.modelValue.value),a=E(!1),i=R(()=>!!s.value),r=()=>{var d;const f=(d=l.value)==null?void 0:d.getEditor();if(f){const _=f.getValue(),g={type:"JSFunction",value:_};he(g,{})&&(s.value=_,e("change",g),a.value=!1)}},o=()=>{s.value="",e("change",void 0),a.value=!1},v=()=>{a.value=!0};return(f,d)=>(c(),V("div",{class:X(["vtj-function-setter",{"is-active":i.value}])},[h(n(W),K({readonly:"",onFocus:v,"model-value":"JSFunction","suffix-icon":n(nl)},f.$attrs),null,16,["suffix-icon"]),a.value?(c(),y(n(ne),{key:0,modelValue:a.value,"onUpdate:modelValue":d[0]||(d[0]=_=>a.value=_),title:"JSFunction",width:"1000px",height:"600px",cancel:"",submit:"",clear:"",onSubmit:r,onClear:o},{default:m(()=>[h(n(de),{ref_key:"codeEditor",ref:l,height:"100%","model-value":s.value,dark:""},null,8,["model-value"])]),_:1},8,["modelValue"])):x("",!0)],2))}});const qn=N({__name:"BooleanSetter",setup(u){return(e,t)=>(c(),y(n(ke),K(e.$attrs,{"model-value":!!e.$attrs.modelValue}),null,16,["model-value"]))}}),Wn=N({__name:"ColorSetter",setup(u){return(e,t)=>(c(),y(n(Ql),We(jt(e.$attrs)),null,16))}}),Yn=N({__name:"NumberSetter",props:{modelValue:{}},emits:["change"],setup(u,{emit:e}){const t=u,l=R(()=>qe(t.modelValue)?void 0:Number(t.modelValue||0)),s=a=>{e("change",a)};return(a,i)=>(c(),y(n(es),K({class:"vtj-number-setter","controls-position":"right","model-value":l.value},a.$attrs,{onChange:s}),null,16,["model-value"]))}}),Kn={class:"vtj-icon-setter"},Xn={class:"vtj-icon-setter__content"},Zn={class:"vtj-icon-setter__list"},ul=N({__name:"IconSetter",props:{modelValue:{default:""}},emits:["change","update:modelValue"],setup(u,{emit:e}){const t=u,l=E(!1),s=E(t.modelValue),a=E(""),i=R(()=>ut[t.modelValue]||t.modelValue),r=R(()=>{const _=Object.entries(ut);return a.value?_.filter(g=>g[0].toLowerCase().includes(a.value)):_}),o=_=>{s.value=_},v=()=>{e("change",s.value),e("update:modelValue",s.value),l.value=!1},f=()=>{s.value="",e("change",""),e("update:modelValue",""),l.value=!1},d=()=>{l.value=!0};return(_,g)=>(c(),V("div",Kn,[h(n(W),{size:"small",readonly:"",placeholder:"请选择图标","model-value":t.modelValue,"suffix-icon":n(xs),onFocus:d},{prepend:m(()=>[h(n(ct),{icon:i.value},null,8,["icon"])]),_:1},8,["model-value","suffix-icon"]),l.value?(c(),y(n(ne),{key:0,title:"图标选择器",width:"1000px",height:"600px",cancel:"",submit:"",clear:"",modelValue:l.value,"onUpdate:modelValue":g[1]||(g[1]=p=>l.value=p),onSubmit:v,onClear:f},{default:m(()=>[T("div",Xn,[h(n(W),{size:"small","prefix-icon":n(sl),clearable:"",modelValue:a.value,"onUpdate:modelValue":g[0]||(g[0]=p=>a.value=p),placeholder:"请输入查询关键字"},null,8,["prefix-icon","modelValue"]),T("div",Zn,[(c(!0),V(M,null,F(r.value,p=>(c(),y(n(ct),{icon:p[1],onClick:b=>o(p[0]),class:X({"is-active":s.value===p[0]})},null,8,["icon","onClick","class"]))),256)),r.value.length===0?(c(),y(n(le),{key:0})):x("",!0)])])]),_:1},8,["modelValue"])):x("",!0)]))}});const Ht={StringSetter:Ft,InputSetter:Ft,SelectSetter:Jt,OptionSetter:Jt,ExpressionSetter:yn,JSONSetter:Hn,FunctionSetter:Gn,BooleanSetter:qn,ColorSetter:Wn,NumberSetter:Yn,IconSetter:ul},cl={string:["InputSetter","SelectSetter"],number:["NumberSetter"],boolean:["BooleanSetter"],object:["JSONSetter"],function:["FunctionSetter"],array:["JSONSetter"],JSFunction:["FunctionSetter"],JSExpression:["ExpressionSetter"]},Qn={key:1},ea={class:"vtj-setter__content"},ta={key:0,class:"vtj-setter__input"},la={class:"vtj-setter__action"},sa=T("i",{class:"vtj-icon-switch",title:"切换设置器"},null,-1),na={key:0,class:"vtj-icon-check"},aa={key:1,class:"vtj-icon-placeholder"},oa="{{",ia="}}",ra=N({__name:"SetterView",props:{name:{},label:{default:""},title:{},setters:{},variable:{type:Boolean,default:!0},value:{},options:{default:()=>[]},defaultSetter:{},removable:{type:Boolean}},emits:["change","remove"],setup(u,{emit:e}){const t=u,l=E(!1),s=E(""),a=E(t.setters.find(k=>k.name===t.defaultSetter)||t.setters[0]),i=E(t.value),r=R(()=>!!qe(i.value)),o={[a.value.name]:i.value},v=k=>{var S;o[a.value.name]=i.value,a.value=k,i.value=(S=o[k.name])!=null?S:void 0,f(i.value)};te(()=>t.value,()=>{i.value=t.value}),te(()=>t.defaultSetter,()=>{a.value=t.setters.find(k=>k.name===t.defaultSetter)||t.setters[0]});const f=k=>{e("change",k)},d=()=>{e("remove",t.name)},_=()=>{l.value=!0,s.value=qe(i.value)?i.value.value:""},g=()=>{l.value=!1,s.value=""},p=k=>{o[a.value.name]=i.value,i.value=k,e("change",k),g()},b=()=>{g(),i.value=void 0,e("change","")};return(k,S)=>(c(),y(n(J),{class:"vtj-setter",size:"small","label-positon":"left"},{label:m(()=>[t.title?(c(),y(n(Wt),{key:0,placement:"top-start",content:t.title},{default:m(()=>[q(H(t.label||t.name),1)]),_:1},8,["content"])):(c(),V("span",Qn,H(t.label||t.name),1))]),default:m(()=>[T("div",ea,[a.value?(c(),V("div",ta,[r.value?x("",!0):(c(),y($t(a.value.component),K({key:0},a.value.props,{options:t.options,modelValue:i.value,"onUpdate:modelValue":S[0]||(S[0]=A=>i.value=A),onChange:f,disabled:r.value}),null,16,["options","modelValue","disabled"])),r.value?(c(),y(n(W),{key:1,class:"vtj-expression-setter",disabled:"","model-value":"JSExpression"},{prefix:m(()=>[q(H(oa))]),suffix:m(()=>[q(H(ia))]),_:1})):x("",!0)])):x("",!0),T("div",la,[t.variable?(c(),V("i",{key:0,onClick:_,class:X(["vtj-icon-vars",{"is-active":r.value}]),title:"绑定变量"},null,2)):x("",!0),t.setters.length>1?(c(),y(n(kt),{key:1,disabled:r.value,size:"small","popper-class":"vtj-setter-switch",onCommand:v},{dropdown:m(()=>[h(n(Vt),null,{default:m(()=>[(c(!0),V(M,null,F(t.setters,A=>(c(),y(n(Et),{command:A,key:A.name},{default:m(()=>[A.name==a.value.name?(c(),V("i",na)):(c(),V("i",aa)),q(" "+H(A.label),1)]),_:2},1032,["command"]))),128))]),_:1})]),default:m(()=>[sa]),_:1},8,["disabled"])):x("",!0),t.removable?(c(),V("i",{key:2,onClick:d,class:"vtj-icon-remove",title:"删除"})):x("",!0)])]),l.value?(c(),y(Nn,{key:0,type:"JSExpression",value:s.value,modelValue:l.value,"onUpdate:modelValue":S[1]||(S[1]=A=>l.value=A),onSubmit:p,onRemove:b},null,8,["value","modelValue"])):x("",!0)]),_:1}))}});const _e=N({name:"SetterRenderer",props:{name:String,label:String,title:String,value:{type:[String,Object,Array,Number,Boolean],default:void 0},setters:{type:[String,Object,Array],required:!0,default(){return[]}},options:{type:Array,default(){return[]}},variable:{type:Boolean,default:!0},removable:{type:Boolean,default:!1}},computed:{computedSetters(){return(Array.isArray(this.setters)?this.setters:[this.setters]).map(e=>{let t;if(typeof e=="string")return t=this.getComopnent(e),{component:Ye(t),name:e,label:e,props:{}};{const l=e;return t=l.component||this.getComopnent(l.name),{component:Ye(t),name:l.name,label:l.label||l.name,props:l.props}}})},computedOptions(){return(this.options||[]).map(e=>typeof e=="string"?{label:e,value:e}:e)},defaultSetter(){var s,a;const{value:u,computedSetters:e}=this;let t=typeof u;t==="object"&&(Array.isArray(u)?t="array":qe(u)?t="JSExpression":Tl(u)&&(t="JSFunction"));const l=cl[t]||[];return l.length?(s=e.find(i=>l.includes(i.name))||e[0])==null?void 0:s.name:(a=e[0])==null?void 0:a.name}},render(){const{name:u,label:e,title:t,value:l,computedSetters:s,computedOptions:a,variable:i,changeValue:r,defaultSetter:o,removable:v,onRemove:f}=this;return el(ra,{name:u,label:e,title:t,setters:s,defaultSetter:o,variable:i,value:l,removable:v,options:a,onChange:r,onRemove:f})},emits:["change","remove"],methods:{getComopnent(u){return typeof u=="string"?Ht[u]||Ht.InputSetter:u},changeValue(u){this.$emit("change",this.name,u)},onRemove(u){this.$emit("remove",u)}}}),ua={class:"vtj-action"},ca=N({__name:"action",setup(u){const{regions:e}=Y(),t=R(()=>e.value.action);return(l,s)=>(c(),V("div",ua,[(c(!0),V(M,null,F(t.value,a=>(c(),y(n(Ve),K({key:a.name},z({},a)),null,16))),128))]))}});const da={};function pa(u,e){return c(),V("div",null,"Empty")}const va=Gt(da,[["render",pa]]),ma=["title","src"],fa={key:1},ha=N({__name:"Logo",props:{icon:{},text:{default:"Vtj"},link:{}},setup(u,{expose:e}){const t=u,l=()=>{t.link&&(location.href=t.link)};return e({props:t}),(s,a)=>(c(),V("div",{class:"vtj-logo",onClick:l},[t.icon?(c(),V("img",{key:0,title:t.text,class:"vtj-logo__icon",src:t.icon},null,8,ma)):(c(),V("span",fa,H(t.text),1))]))}});const _a=T("div",null,"多个资源可换行输入",-1),ga=N({__name:"Dependencies",setup(u){const{project:e}=Y(),t=[{name:"add",icon:"vtj-icon-plus"}],l={package:{required:!0,message:"包名不能为空"},version:{required:!0,message:"版本不能为空"},library:{required:!0,message:"导出变量名称不能为空"},urls:{required:!0,message:"资源URL不能为空"}},s=E(),a=E(),i=E(!1),r=E(!1),o=R(()=>e.dependencies.value),v=p=>{e.setDeps(p)},f=()=>{i.value=!0,r.value=!1,s.value={package:"",version:"",library:"",urls:"",assetsUrl:"",assetsLibrary:""}},d=p=>{i.value=!0,r.value=!0,s.value={package:p.package,version:p.version,library:p.library,urls:p.urls.join(`
`),assetsUrl:p.assetsUrl||"",assetsLibrary:p.assetsLibrary||""}},_=p=>{ue.confirm("确定删除该依赖项？","提示",{type:"warning"}).then(()=>{e.removeDeps(p)})},g=()=>{a.value.validate(p=>{var D,L;if(!p)return;const{version:b,library:k,urls:S,assetsUrl:A,assetsLibrary:C}=s.value;if(!((D=s.value)!=null&&D.package))return;const P={package:(L=s.value)==null?void 0:L.package,version:b,library:k,urls:S.trim().split(`
`),assetsUrl:A,assetsLibrary:C};e.dependencies.value.find(I=>I.package===P.package)&&!r.value?pe.warning({message:"已存在相同名称的依赖包"}):(e.setDeps(Qe(P)),i.value=!1)})};return(p,b)=>(c(),y(fe,{class:"vtj-deps",title:"依赖管理",tools:t,onToolClick:f},{default:m(()=>[(c(!0),V(M,null,F(o.value,k=>(c(),y(ce,{key:k.package,removable:!k.official,editable:!k.official,class:X({"vtj-deps__disabled":!k.enabled}),onEdit:S=>d(k),onRemove:S=>_(k)},{action:m(()=>[!k.required&&k.official?(c(),y(n(ke),{key:0,size:"small",modelValue:k.enabled,"onUpdate:modelValue":S=>k.enabled=S,onChange:S=>v(k)},null,8,["modelValue","onUpdate:modelValue","onChange"])):x("",!0)]),title:m(()=>[q(H(k.package)+"@"+H(k.version),1)]),_:2},1032,["removable","editable","class","onEdit","onRemove"]))),128)),i.value?(c(),y(ne,{key:0,modelValue:i.value,"onUpdate:modelValue":b[6]||(b[6]=k=>i.value=k),title:`${r.value?"编辑":"新增"}依赖`,width:"1000px",height:"500px",submit:"",cancel:"",onSubmit:g},{default:m(()=>[s.value?(c(),y(n(Q),{key:0,ref_key:"form",ref:a,size:"small","label-width":"80px",model:s.value,rules:l},{default:m(()=>[h(n(J),{label:"npm包名",prop:"package"},{default:m(()=>[h(n(W),{modelValue:s.value.package,"onUpdate:modelValue":b[0]||(b[0]=k=>s.value.package=k),modelModifiers:{trim:!0},readonly:r.value,disabled:r.value},null,8,["modelValue","readonly","disabled"])]),_:1}),h(n(J),{label:"版本号",prop:"version"},{default:m(()=>[h(n(W),{modelValue:s.value.version,"onUpdate:modelValue":b[1]||(b[1]=k=>s.value.version=k),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1}),h(n(J),{label:"导出名称",prop:"library"},{default:m(()=>[h(n(W),{modelValue:s.value.library,"onUpdate:modelValue":b[2]||(b[2]=k=>s.value.library=k),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1}),h(n(J),{label:"资源URL",prop:"urls"},{default:m(()=>[h(n(W),{type:"textarea",rows:5,modelValue:s.value.urls,"onUpdate:modelValue":b[3]||(b[3]=k=>s.value.urls=k)},null,8,["modelValue"]),_a]),_:1}),h(n(J),{label:"资产URL",prop:"assetsUrl"},{default:m(()=>[h(n(W),{modelValue:s.value.assetsUrl,"onUpdate:modelValue":b[4]||(b[4]=k=>s.value.assetsUrl=k),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1}),h(n(J),{label:"资产名称",prop:"assetsLibrary"},{default:m(()=>[h(n(W),{modelValue:s.value.assetsLibrary,"onUpdate:modelValue":b[5]||(b[5]=k=>s.value.assetsLibrary=k),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])):x("",!0)]),_:1},8,["modelValue","title"])):x("",!0)]),_:1}))}}),ba=N({__name:"Viewport",props:{mode:{default:"pc"},width:{},height:{}},setup(u){const e=u,t={width:390,height:844},l={width:1180,height:820},s=R(()=>[`is-${e.mode}`]),a=R(()=>{if(e.mode==="pc")return 1;const r=e.mode==="mobile"?t:l,{width:o,height:v}=r,f=o>0?(e.width||0)/o:1,d=v>0?(e.height||0)/v:1;return Math.min(f,d)}),i=R(()=>{if(e.mode==="pc")return{};const r=e.mode==="mobile"?t:l,{width:o,height:v}=r;return{width:`${o}px`,height:`${v}px`,left:"50%",top:"50%",transform:`translate(-50%, -50%) scale(${a.value})`}});return(r,o)=>(c(),V("div",{class:X(["vtj-viewport",s.value]),style:Je(i.value)},[se(r.$slots,"default")],6))}});const ya={class:"vtj-actions__layers"},ka=T("i",{class:"vtj-icon-layers"},null,-1),Ea={key:0,class:"vtj-actions__tools"},Va=N({__name:"Actions",props:{position:{default:"left-top"},node:{},title:{default:""},path:{default:()=>[]}},emits:["action"],setup(u,{emit:e}){const t=u,l=R(()=>ee(t.node)),s=R(()=>t.path);function a(_){return ee(_)?"Block":"Node"}function i(){if(t.node.lock){pe.warning({message:"该节点已被锁定，不能删除"});return}ue.confirm("确定删除吗？","提示",{type:"warning"}).then(()=>{t.node.dispose(),Ue(()=>{e("action",{type:"remove"})})})}function r(){t.node.moveNext(),Ue(()=>{e("action",{type:"move",next:!0,node:t.node})})}function o(){t.node.movePrev(),Ue(()=>{e("action",{type:"move",prev:!0,node:t.node})})}function v(){const _=t.node.copy();Ue(()=>{e("action",{type:"copy",node:_})})}function f(_){e("action",{type:"hover",node:_})}function d(_){e("action",{type:"selected",node:_})}return(_,g)=>(c(),V("div",{class:X(["vtj-actions",[`is-${t.position}`]])},[T("div",ya,[h(n(kt),{size:"small",onCommand:d},{dropdown:m(()=>[s.value&&s.value.length?(c(),y(n(Vt),{key:0},{default:m(()=>[(c(!0),V(M,null,F(s.value,p=>(c(),y(n(Et),{key:p.id,command:p,onMouseenter:b=>f(p)},{default:m(()=>[q(H(p.name)+" ",1),T("i",{class:X(`is-${a(p)}`)},H(a(p)),3)]),_:2},1032,["command","onMouseenter"]))),128))]),_:1})):x("",!0)]),default:m(()=>[T("div",null,[ka,q(H(t.title),1)])]),_:1})]),l.value?x("",!0):(c(),V("div",Ea,[T("i",{class:"vtj-icon-arrow-up",title:"向前移动",onClick:o}),T("i",{class:"vtj-icon-arrow-down",title:"向后移动",onClick:r}),T("i",{onClick:v,class:"vtj-icon-copy",title:"复制"}),T("i",{onClick:i,class:"vtj-icon-remove",title:"删除"})]))],2))}});const Ca={key:1,class:"vtj-designer__placeholder"},Sa=N({__name:"Designer",setup(u,{expose:e}){const{engine:t}=Y(),l=E(),s=E(),a=E({width:0,height:0});ll(s,S=>{const A=S[0];a.value=A.contentRect});const i=new Ei(t,l,ln),{hover:r,dropping:o,selected:v,onAction:f,viewportMode:d}=me(i),_=t.project.current,g=R(()=>{var S;return((S=_.value)==null?void 0:S.children.length)===0}),p=R(()=>{var S;return ee((S=r.value)==null?void 0:S.node)}),b=R(()=>{var S;return ee((S=v.value)==null?void 0:S.node)}),k=R(()=>{var C;const{width:S=0,height:A=0}=((C=v.value)==null?void 0:C.rect)||{};return S>0||A>0});return e({designer:i,selected:v}),(S,A)=>(c(),V("div",{ref_key:"container",ref:s,class:"vtj-designer"},[Ee(h(ba,{mode:n(d),width:a.value.width,height:a.value.height},{default:m(()=>[T("iframe",{ref_key:"iframe",ref:l,frameborder:"0"},null,512),n(o)?(c(),V("div",{key:0,class:X(["vtj-designer__dropping","is-inner"]),style:Je(n(o).style)},null,4)):x("",!0),n(r)?(c(),V("div",{key:1,class:"vtj-designer__hover",style:Je(n(r).style)},[Ee(T("span",{class:X(["vtj-designer__hover-title",`is-${n(r).position}`])},[q(H(n(r).node.name)+": ",1),T("i",null,H(n(r).node.id),1)],2),[[je,!p.value]])],4)):x("",!0),n(v)?Ee((c(),V("div",{key:2,class:"vtj-designer__selected",style:Je(n(v).style)},[b.value?x("",!0):(c(),y(Va,{key:0,title:n(v).node.name,node:n(v).node,path:n(v).path,position:n(v).position,onAction:n(f)},null,8,["title","node","path","position","onAction"]))],4)),[[je,k.value]]):x("",!0)]),_:1},8,["mode","width","height"]),[[je,n(_)]]),n(_)?x("",!0):(c(),y(n(le),{key:0,description:"请在文档管理器新建或打开文件"})),g.value?(c(),V("div",Ca," 您可以拖拽组件放置到这里 ")):x("",!0)],512))}});const wa=N({__name:"Components",setup(u){const e={placeholder:"搜索组件"},{engine:t}=Y(),{componentGroups:l,components:s}=t.assets||{},a=R(()=>{const _={};return l&&l.forEach(g=>{_[g.name]=g}),_}),i=R(()=>l?l.map(_=>{var g;return{label:`${_.label} (${_.count})`,name:_.name,disabled:!((g=_.children)!=null&&g.length)}}):[]),r=(_=[])=>_.map((g,p)=>p),o=be({});xt(()=>{const _=i.value.reduce((g,p)=>(g[p.name]=r(a.value[p.name].children),g),{});Object.assign(o,_)});const{searchKey:v,searchResult:f}=Fs(s),d=_=>{v.value=_};return(_,g)=>(c(),y(rl,{class:"vtj-components",title:"组件库",search:e,tabs:i.value,onSearchChange:d},{search:m(({span:p})=>[h(He,{list:n(f),span:p},null,8,["list","span"])]),tab:m(({tab:p,span:b})=>{var k,S;return[a.value[p.name].components?(c(),y(He,{key:0,list:a.value[p.name].components,span:b},null,8,["list","span"])):x("",!0),(k=a.value[p.name].children)!=null&&k.length?(c(),y(n(ts),{key:1,modelValue:o[p.name],"onUpdate:modelValue":A=>o[p.name]=A},{default:m(()=>[(c(!0),V(M,null,F(a.value[p.name].children,(A,C)=>(c(),y(n(ls),{key:A.name,title:`${A.label} (${A.count})`,name:C},{default:m(()=>[h(He,{list:A.components,span:b},null,8,["list","span"])]),_:2},1032,["title","name"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):x("",!0),!a.value[p.name].components&&((S=a.value[p.name].children)==null?void 0:S.length)===0?(c(),y(n(le),{key:2,description:"暂无数据"})):x("",!0)]}),default:m(()=>[!n(l)||n(l).length===0?(c(),y(n(le),{key:0,description:"暂无数据"})):x("",!0)]),_:1},8,["tabs"]))}});const xa=["onClick"],ja=["onClick"],$a={class:"vtj-pages__name"},Ra={key:0,class:"vtj-pages__home"},Da=N({__name:"Pages",setup(u){const{project:e,engine:t}=Y(),l=[{name:"add",icon:"vtj-icon-plus"}],s={name:[{required:!0,message:"名称为必填项"}],title:[{required:!0,message:"标题为必填项"}]},a=R(()=>e.pages.value),i=j=>{var D;return j===((D=e.current.value)==null?void 0:D.id)},r={id:"",name:"",title:"",isDir:!1,icon:"",mask:!0,home:!1,hidden:!1},o=E(),v=E(!1),f=E(),d=E(),_=j=>O(this,null,function*(){if(j.isDir)return;const D=j.id,L=yield t.service.getFile(D);e.activeFile(L)}),g=()=>{d.value=void 0,o.value=z({},r),v.value=!0},p=j=>{d.value=j.id,o.value=z({},r),v.value=!0},b=j=>{o.value=z({},j),v.value=!0},k=(j,D)=>O(this,null,function*(){var B;const L=j.id,I=(B=D.parent)==null?void 0:B.data.id,G=yield t.service.getFile(L);e.copyPage(j,G,I)}),S=j=>O(this,null,function*(){if(!j.id)return;if(j.children&&j.children.length>0){pe.warning({message:"该目录有子页面文件，不能删除。"});return}(yield ue.confirm("确定删除？","提示",{type:"warning"}).catch(L=>!1))&&e.removePage(j.id)}),A=()=>O(this,null,function*(){if(yield f.value.validate().catch(D=>!1)){if(o.value.id){const D=o.value.isDir?void 0:yield t.service.getFile(o.value.id);e.updatePage(o.value,D)}else{const D=e.addPage(o.value,d.value);!e.current.value&&!o.value.isDir&&e.activeFile(D.toDsl())}v.value=!1}}),C=(j,D,L)=>L==="inner"?!!D.data.isDir:!0,P=()=>{e.update({pages:a.value})};return(j,D)=>(c(),y(n(fe),{title:"页面管理",tools:l,onToolClick:g},{default:m(()=>[a.value.length===0?(c(),y(n(le),{key:0,description:"您还没创建文件"})):x("",!0),a.value.length?(c(),y(n(Ct),{key:1,"node-key":"id","default-expand-all":!0,data:a.value,draggable:"","allow-drop":C,onNodeDrop:P,class:"vtj-pages-items"},{default:m(({node:L,data:I})=>[h(n(ce),{title:I.title,active:i(I.id),onClick:G=>_(I),onEdit:G=>b(I),onRemove:G=>S(I),clickable:!I.isDir,editable:"",removable:""},{action:m(()=>[I.isDir?(c(),V("i",{key:0,onClick:Z(G=>p(I),["stop"]),class:"vtj-icon-plus",title:"新增"},null,8,xa)):x("",!0),I.isDir?x("",!0):(c(),V("i",{key:1,onClick:Z(G=>k(I,L),["stop"]),class:"vtj-icon-copy",title:"复制"},null,8,ja))]),title:m(()=>[h(n(ct),{icon:n(ut)[I.icon]||I.icon},null,8,["icon"]),q(" "+H(I.title)+" ",1),T("i",$a,H(I.name),1),I.home?(c(),V("span",Ra,"首页 ")):x("",!0)]),_:2},1032,["title","active","onClick","onEdit","onRemove","clickable"])]),_:1},8,["data"])):x("",!0),v.value?(c(),y(n(ne),{key:2,modelValue:v.value,"onUpdate:modelValue":D[7]||(D[7]=L=>v.value=L),width:"600px",title:o.value.id?"修改页面":"新增页面",submit:"",cancel:"",onSubmit:A},{default:m(()=>[h(n(Q),{ref_key:"formRef",ref:f,model:o.value,rules:s,size:"small","label-position":"right","label-width":"80px"},{default:m(()=>[h(n(J),{label:"类型",prop:"isDir"},{default:m(()=>[h(n(wt),{modelValue:o.value.isDir,"onUpdate:modelValue":D[0]||(D[0]=L=>o.value.isDir=L),disabled:!!o.value.id},{default:m(()=>[h(n(Ie),{label:!1},{default:m(()=>[q("页面")]),_:1}),h(n(Ie),{label:!0},{default:m(()=>[q("目录")]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1}),h(n(J),{label:"标题描述",prop:"title"},{default:m(()=>[h(n(W),{modelValue:o.value.title,"onUpdate:modelValue":D[1]||(D[1]=L=>o.value.title=L)},null,8,["modelValue"])]),_:1}),h(n(J),{label:"名称编码",prop:"name"},{default:m(()=>[h(n(W),{modelValue:o.value.name,"onUpdate:modelValue":D[2]||(D[2]=L=>o.value.name=L)},null,8,["modelValue"])]),_:1}),h(n(J),{label:"菜单图标",prop:"icon"},{default:m(()=>[h(ul,{modelValue:o.value.icon,"onUpdate:modelValue":D[3]||(D[3]=L=>o.value.icon=L)},null,8,["modelValue"])]),_:1}),o.value.isDir?x("",!0):(c(),y(n(J),{key:0,label:"包含母版",prop:"mask"},{default:m(()=>[h(n(ke),{modelValue:o.value.mask,"onUpdate:modelValue":D[4]||(D[4]=L=>o.value.mask=L)},null,8,["modelValue"])]),_:1})),o.value.isDir?x("",!0):(c(),y(n(J),{key:1,label:"站点首页",prop:"mask"},{default:m(()=>[h(n(ke),{modelValue:o.value.home,"onUpdate:modelValue":D[5]||(D[5]=L=>o.value.home=L)},null,8,["modelValue"])]),_:1})),o.value.isDir?x("",!0):(c(),y(n(J),{key:2,label:"隐藏菜单",prop:"mask"},{default:m(()=>[h(n(ke),{modelValue:o.value.hidden,"onUpdate:modelValue":D[6]||(D[6]=L=>o.value.hidden=L)},null,8,["modelValue"])]),_:1}))]),_:1},8,["model"])]),_:1},8,["modelValue","title"])):x("",!0)]),_:1}))}});const Ta=N({__name:"Blocks",setup(u){const{project:e,engine:t}=Y(),l=[{name:"add",icon:"vtj-icon-plus"}],s={id:"",name:"",title:""},a={name:[{required:!0,message:"请输入组件名称",trigger:"blur"}],title:[{required:!0,message:"请输入标题备注",trigger:"blur"}]},i=E(),r=E(),o=R(()=>e.blocks.value),v=E(!1),f=k=>{var S;return k.id===((S=e.current.value)==null?void 0:S.id)},d=()=>{r.value=z({},s),v.value=!0},_=()=>O(this,null,function*(){if(yield i.value.validate().catch(S=>!1)){if(e.existBlockName(r.value)){pe.warning({message:"已存在相同名称的区块，请更换名称"});return}if(r.value.id){const S=yield t.service.getFile(r.value.id);e.updateBlock(r.value,S)}else e.addBlock(r.value);v.value=!1}}),g=k=>{r.value=k,v.value=!0},p=k=>O(this,null,function*(){(yield ue.confirm("确定删除？","提示",{type:"warning"}))&&e.removeBlock(k.id)}),b=k=>O(this,null,function*(){const S=k.id,A=yield t.service.getFile(S);e.activeFile(A)});return(k,S)=>(c(),y(n(rl),{title:"区块管理",tools:l,onToolClick:d},{default:m(({span:A})=>[h(n(He),{list:o.value,span:A,active:f,type:"Schema",editable:"",removable:"",onEdit:g,onRemove:p,onClick:b},null,8,["list","span"]),v.value?(c(),y(n(ne),{key:0,modelValue:v.value,"onUpdate:modelValue":S[2]||(S[2]=C=>v.value=C),title:r.value.id?"修改":"新增",width:"500px",submit:"",cancel:"",onSubmit:_},{default:m(()=>[h(n(Q),{ref_key:"formRef",ref:i,size:"small",model:r.value,rules:a},{default:m(()=>[h(n(J),{label:"组件名称",prop:"name"},{default:m(()=>[h(n(W),{modelValue:r.value.name,"onUpdate:modelValue":S[0]||(S[0]=C=>r.value.name=C)},null,8,["modelValue"])]),_:1}),h(n(J),{label:"标题备注",prop:"title"},{default:m(()=>[h(n(W),{modelValue:r.value.title,"onUpdate:modelValue":S[1]||(S[1]=C=>r.value.title=C)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])):x("",!0)]),_:1}))}}),Ia=T("i",{class:"vtj-icon-pc"},null,-1),Aa=T("i",{class:"vtj-icon-phone"},null,-1),Na=T("i",{class:"vtj-icon-pad"},null,-1),Pa=T("i",{class:"vtj-icon-undo"},null,-1),Oa=T("i",{class:"vtj-icon-redo"},null,-1),La=N({__name:"Toolbar",setup(u){const{engine:e}=Y(),t=E("pc"),l=R(()=>{const{index:o=0,list:v=[]}=e.simulator.history.value||{};return o<v.length-1}),s=R(()=>{const{index:o=0,list:v=[]}=e.simulator.history.value||{};return o>0}),a=()=>{var o;(o=e.simulator.history.value)==null||o.back()},i=()=>{var o;(o=e.simulator.history.value)==null||o.go()},r=o=>{w.emit(pl,o)};return(o,v)=>(c(),V("div",null,[h(n(wt),{size:"small",modelValue:t.value,"onUpdate:modelValue":v[0]||(v[0]=f=>t.value=f),onChange:r},{default:m(()=>[h(n(Ie),{label:"pc"},{default:m(()=>[Ia]),_:1}),h(n(Ie),{label:"mobile"},{default:m(()=>[Aa]),_:1}),h(n(Ie),{label:"pad"},{default:m(()=>[Na]),_:1})]),_:1},8,["modelValue"]),x("",!0),h(n(ss),null,{default:m(()=>[h(n(oe),{type:"default",size:"small",onClick:a,disabled:!l.value},{default:m(()=>[Pa]),_:1},8,["disabled"]),h(n(oe),{type:"default",size:"small",onClick:i,disabled:!s.value},{default:m(()=>[Oa]),_:1},8,["disabled"])]),_:1})]))}});const Ba={key:0,class:"vtj-outline__actions"},Ua=["onClick"],Ma=["onClick"],Fa=["onClick"],Ja=["onClick"],za=["onClick"],Ha=["onClick"],Ga={class:"vtj-outline__status"},qa={key:0,class:"vtj-icon-invisible",title:"不可见"},Wa={key:1,class:"vtj-icon-lock",title:"已锁定"},Ya=N({__name:"Outline",setup(u){const{engine:e,project:t,assets:l}=Y(),s=R(()=>{var C;return(C=e.skeleton.widgetInstances.designer)==null?void 0:C.designer}),a=C=>C.root===null,i=E([]);function r(C){return ee(C)?"Block":C.slot&&C.slot.name?`#${C.slot.name}`:"Node"}function o(C){const P=[];return C.forEach(j=>{const D={id:j.id,label:j.name,nodeType:r(j),node:j,children:[]};Array.isArray(j.children)&&(D.children=o(j.children)),P.push(D)}),P}function v(){i.value=t.current.value?o([t.current.value]):[]}te(t.current,v,{immediate:!0}),w.on(U,v),De(()=>{w.off(U,v)});const f=(C,P,j)=>O(this,null,function*(){const D=C.data,I=P.data.node,G=t.current.value;if(!G||!s.value||!I)return;const B=D.node;B.slot=yield s.value.getDropSlot(j==="inner"?I:I.parent);const re={before:"left",after:"right"}[j]||"inner";G.move(B,I,re),w.emit(xe,B)}),d=C=>{const P=C.data;return ee(P.node)||P.node.lock?!1:P.node.name!=="template"},_=(C,P,j)=>{const D=C.data,L=P.data;if(L.node.lock||ee(L.node)&&["prev","next"].includes(j))return!1;const I=t.current.value;if(!I)return!1;const G=l.componentMap[D.node.name];if(j==="inner")return I.allowDrop(G,L.node,l);{const B=L.node.parent;return B&&I.allowDrop(G,B,l)}},g=(C,P)=>{C.invisible=P,w.emit(U,C),w.emit(xe,C)},p=(C,P)=>{C.lock=P,w.emit(U,C),w.emit(xe,C)},b=C=>{const P=C==null?void 0:C.node;!P||P.invisible||w.emit(Dt,P)},k=C=>{var D,L,I;const P=(D=C.target)==null?void 0:D.__vueParentComponent;if(!P)return;const j=(I=(L=P.ctx)==null?void 0:L.node)==null?void 0:I.data;j&&(j.node.invisible||w.emit(Tt,j.node))},S=C=>{C.copy(),w.emit(xe,C)},A=C=>{ue.confirm("确定删除吗？","提示",{type:"warning"}).then(()=>{C.dispose(),w.emit(xe,C)})};return(C,P)=>(c(),y(fe,{title:"大纲树",class:"vtj-outline"},{default:m(()=>[h(n(Ct),{data:i.value,"node-key":"id","default-expand-all":"",draggable:"","empty-text":"请新建或打开文件","expand-on-click-node":!1,"allow-drop":_,"allow-drag":d,onCurrentChange:b,onNodeDrop:f,onMouseover:k},{default:m(({data:j})=>[(c(),V("div",{key:j.node.id,class:"vtj-outline__item"},[T("span",null,[q(H(j.label)+": ",1),T("i",{class:X(`is-${j.nodeType}`)},H(j.nodeType),3)]),a(j.node)?x("",!0):(c(),V("span",Ba,[j.node.lock?x("",!0):(c(),V("i",{key:0,onClick:Z(D=>p(j.node,!0),["stop"]),class:"vtj-icon-lock",title:"锁定"},null,8,Ua)),j.node.lock?(c(),V("i",{key:1,onClick:Z(D=>p(j.node,!1),["stop"]),class:"vtj-icon-unlock",title:"解锁"},null,8,Ma)):x("",!0),!j.node.invisible&&!j.node.lock?(c(),V("i",{key:2,onClick:Z(D=>g(j.node,!0),["stop"]),class:"vtj-icon-invisible",title:"设置隐藏"},null,8,Fa)):x("",!0),j.node.invisible&&!j.node.lock?(c(),V("i",{key:3,onClick:Z(D=>g(j.node,!1),["stop"]),class:"vtj-icon-visible",title:"设置显示"},null,8,Ja)):x("",!0),j.node.root!==j.node&&!j.node.lock?(c(),V("i",{key:4,onClick:D=>S(j.node),class:"vtj-icon-copy",title:"复制"},null,8,za)):x("",!0),j.node.root!==j.node&&!j.node.lock?(c(),V("i",{key:5,onClick:Z(D=>A(j.node),["stop"]),class:"vtj-icon-remove",title:"删除"},null,8,Ha)):x("",!0)])),T("span",Ga,[j.node.invisible?(c(),V("i",qa)):x("",!0),j.node.lock?(c(),V("i",Wa)):x("",!0)])]))]),_:1},8,["data"])]),_:1}))}});const Ka={class:"vtj-setting-panel"},Xa=N({__name:"Properties",setup(u){const{assets:e}=Y(),{selected:t}=me(),l=R(()=>{var A;return(A=t.value)==null?void 0:A.node}),{commonProps:s,componentProps:a,onChange:i,isExist:r,addCustom:o,customProps:v,removeProp:f}=cn(l,e),d=[{name:"add",icon:"vtj-icon-plus"}],_={name:[{required:!0,message:"熟悉名称为必填项"}]},g=be({name:""}),p=E(!1),b=A=>{p.value=!0,g.name=""},k=()=>{const A=Object.keys(l.value.props);g.name&&!r(g.name)&&!A.includes(g.name)?(o(g.name),p.value=!1):ge.warning({message:"已存在该属性名称"})},S=A=>O(this,null,function*(){(yield ue.confirm("确定删除?","提示",{type:"warning"}).catch(P=>!1))&&f(A)});return(A,C)=>(c(),V("div",Ka,[h(n(ie),{title:"通用属性"},{default:m(()=>[h(n(Q),{size:"small","label-width":"100px",onKeydown:C[0]||(C[0]=ze(Z(()=>{},["prevent","stop"]),["enter"]))},{default:m(()=>[(c(!0),V(M,null,F(n(s),P=>(c(),y(n(_e),K({key:`${P.name}_${l.value.id}`},P,{onChange:n(i)}),null,16,["onChange"]))),128))]),_:1})]),_:1}),n(a).length?(c(),y(n(ie),{key:0,title:"组件属性"},{default:m(()=>[h(n(Q),{size:"small","label-width":"100px",onKeydown:C[1]||(C[1]=ze(Z(()=>{},["prevent","stop"]),["enter"]))},{default:m(()=>[(c(!0),V(M,null,F(n(a),P=>(c(),y(n(_e),K({key:`${P.name}_${l.value.id}`},P,{onChange:n(i)}),null,16,["onChange"]))),128))]),_:1})]),_:1})):x("",!0),h(n(ie),{title:"自定义属性",tools:d,onToolClick:b},{default:m(()=>[h(n(Q),{size:"small","label-width":"100px",onKeydown:C[2]||(C[2]=ze(Z(()=>{},["prevent","stop"]),["enter"]))},{default:m(()=>[(c(!0),V(M,null,F(n(v),P=>(c(),y(n(_e),K({key:`${P.name}_${l.value.id}`},P,{removable:"",onChange:n(i),onRemove:S}),null,16,["onChange"]))),128))]),_:1})]),_:1}),h(n(ne),{modelValue:p.value,"onUpdate:modelValue":C[4]||(C[4]=P=>p.value=P),title:"新增属性",width:"400px",submit:"",cancel:"",onSubmit:k},{default:m(()=>[h(n(Q),{ref:"formRef",size:"small",rules:_,model:g},{default:m(()=>[h(n(J),{label:"属性名称",prop:"name"},{default:m(()=>[h(n(W),{modelValue:g.name,"onUpdate:modelValue":C[3]||(C[3]=P=>g.name=P)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]))}});const Za={class:"vtj-setting-panel vtj-events"},Qa=N({__name:"Events",setup(u){const{assets:e}=Y(),{selected:t}=me(),l=R(()=>{var g;return(g=t.value)==null?void 0:g.node}),{mouseEventList:s,keyboardEventList:a,componentEventList:i}=dn(l,e),r=E(!1),o=E(),v=E(Symbol()),f=g=>{v.value=Symbol(),o.value=g,r.value=!0},d=g=>{o.value&&l.value.setEvent(o.value.name,g)},_=g=>O(this,null,function*(){(yield ue.confirm("确定删除事件绑定？","提示",{type:"warning"}).catch(b=>!1))&&(l.value.removeEvent(g),o.value=null,r.value=!1)});return(g,p)=>(c(),V("div",Za,[h(n(ie),{title:"组件事件"},{default:m(()=>[(c(!0),V(M,null,F(n(i),b=>(c(),y(n(ce),{title:b.name,active:!!b.event,removable:!!b.event,background:!1,editable:"",clickable:"",onClick:k=>f(b),onEdit:k=>f(b),onRemove:k=>_(b.name)},null,8,["title","active","removable","onClick","onEdit","onRemove"]))),256)),n(i).length===0?(c(),y(n(le),{key:0,"image-size":50,description:"该组件无自带事件"})):x("",!0)]),_:1}),h(n(ie),{title:"鼠标事件"},{default:m(()=>[(c(!0),V(M,null,F(n(s),b=>(c(),y(n(ce),{title:b.name,active:!!b.event,removable:!!b.event,background:!1,editable:"",clickable:"",onClick:k=>f(b),onEdit:k=>f(b),onRemove:k=>_(b.name)},null,8,["title","active","removable","onClick","onEdit","onRemove"]))),256))]),_:1}),h(n(ie),{title:"键盘事件"},{default:m(()=>[(c(!0),V(M,null,F(n(a),b=>(c(),y(n(ce),{title:b.name,active:!!b.event,removable:!!b.event,background:!1,editable:"",clickable:"",onClick:k=>f(b),onEdit:k=>f(b),onRemove:k=>_(b.name)},null,8,["title","active","removable","onClick","onEdit","onRemove"]))),256))]),_:1}),o.value?(c(),y(n(Pn),K({key:v.value,modelValue:r.value,"onUpdate:modelValue":p[0]||(p[0]=b=>r.value=b),node:l.value},o.value,{onSubmit:d,onRemove:_}),null,16,["modelValue","node"])):x("",!0)]))}}),eo=N({__name:"JSDataDialog",props:nn,setup(u){const e=u,{title:t,model:l,formRef:s,dialogRef:a,editorRef:i,rules:r,onSubmit:o,disabled:v}=an(e),f=d=>{l.value.value=d};return(d,_)=>(c(),y(n(tt),K({ref_key:"dialogRef",ref:a,title:n(t),width:"1000px",height:"600px",clearable:!1},d.$attrs,{onSubmit:n(o),onPick:f}),{default:m(()=>[h(n(Q),{ref_key:"formRef",ref:s,size:"small","label-position":"top",model:n(l),rules:n(r)},{default:m(()=>[h(n(J),{label:e.nameLabel,prop:"name"},{default:m(()=>[d.type==="lifeCycles"?(c(),y(n(Ze),{key:0,modelValue:n(l).name,"onUpdate:modelValue":_[0]||(_[0]=g=>n(l).name=g),disabled:n(v)},{default:m(()=>[(c(!0),V(M,null,F(n(Il),g=>(c(),y(n(Xe),{label:g,value:g},null,8,["label","value"]))),256))]),_:1},8,["modelValue","disabled"])):(c(),y(n(W),{key:1,modelValue:n(l).name,"onUpdate:modelValue":_[1]||(_[1]=g=>n(l).name=g),disabled:n(v)},null,8,["modelValue","disabled"]))]),_:1},8,["label"]),h(n(J),{label:e.valueLabel},{default:m(()=>[h(n(de),{ref_key:"editorRef",ref:i,border:!0,height:"380px",width:"100%",dark:"","model-value":n(l).value.value},null,8,["model-value"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},16,["title","onSubmit"]))}}),to=N({__name:"WatchDataDialog",props:on,setup(u){const e=u,{title:t,model:l,onSubmit:s,dialogRef:a,sourceRef:i,handlerRef:r,formRef:o}=rn(e),v=f=>{l.handler.value=f};return(f,d)=>(c(),y(n(tt),K({ref_key:"dialogRef",ref:a,title:n(t),width:"1000px",height:"600px",clearable:!1},f.$attrs,{onSubmit:n(s),onPick:v}),{default:m(()=>[h(n(Q),{ref_key:"formRef",ref:o,size:"small","label-position":"top"},{default:m(()=>[h(n(J),{label:"侦听源 [ JSFunction ]",prop:"source"},{default:m(()=>[h(n(de),{ref_key:"sourceRef",ref:i,border:!0,height:"100px",width:"100%",dark:"","model-value":n(l).source.value},null,8,["model-value"])]),_:1}),h(n(J),{label:"deep",prop:"deep"},{default:m(()=>[h(n(ke),{modelValue:n(l).deep,"onUpdate:modelValue":d[0]||(d[0]=_=>n(l).deep=_)},null,8,["modelValue"])]),_:1}),h(n(J),{label:"immediate",prop:"immediate"},{default:m(()=>[h(n(ke),{modelValue:n(l).immediate,"onUpdate:modelValue":d[1]||(d[1]=_=>n(l).immediate=_)},null,8,["modelValue"])]),_:1}),h(n(J),{label:"处理函数 [ JSFunction ]",prop:"handler"},{default:m(()=>[h(n(de),{ref_key:"handlerRef",ref:r,border:!0,height:"180px",width:"100%",dark:"","model-value":n(l).handler.value},null,8,["model-value"])]),_:1})]),_:1},512)]),_:1},16,["title","onSubmit"]))}}),Te=N({__name:"BlockScriptGroup",props:{block:{},type:{},dataType:{},title:{},nameLabel:{},valueLabel:{},defaults:{}},setup(u){const e=u,t=R(()=>e.block),l=[{name:"add",icon:"vtj-icon-plus"}],{data:s,list:a,onAdd:i,onEdit:r,onRemove:o,visible:v,keyRef:f}=sn(t,e.type);return(d,_)=>(c(),y(n(ie),{title:e.title,tools:l,onToolClick:n(i)},{default:m(()=>[h(n(Q),{size:"small","label-width":"100px",onKeydown:_[0]||(_[0]=ze(Z(()=>{},["prevent","stop"]),["enter"]))},{default:m(()=>[(c(!0),V(M,null,F(n(a),g=>(c(),y(n(ce),{title:g.title,background:!1,editable:"",clickable:"",removable:"",onClick:p=>n(r)(g.model),onEdit:p=>n(r)(g.model),onRemove:p=>n(o)(g.model)},null,8,["title","onClick","onEdit","onRemove"]))),256)),n(a).length?x("",!0):(c(),y(n(le),{key:0,"image-size":40}))]),_:1}),n(v)&&e.type!=="watch"?(c(),y(eo,{key:n(f),block:t.value,data:n(s),title:e.title,type:e.type,nameLabel:e.nameLabel,valueLabel:e.valueLabel,dataType:e.dataType,defaults:e.defaults,modelValue:n(v),"onUpdate:modelValue":_[1]||(_[1]=g=>Bt(v)?v.value=g:null)},null,8,["block","data","title","type","nameLabel","valueLabel","dataType","defaults","modelValue"])):x("",!0),n(v)&&e.type==="watch"?(c(),y(to,{key:n(f),block:t.value,data:n(s),modelValue:n(v),"onUpdate:modelValue":_[2]||(_[2]=g=>Bt(v)?v.value=g:null)},null,8,["block","data","modelValue"])):x("",!0)]),_:1},8,["title","onToolClick"]))}}),lo={class:"vtj-setting-panel"},so=N({__name:"BlockScript",setup(u){const{selected:e}=me(),t=R(()=>{var l;return(l=e.value)==null?void 0:l.node});return(l,s)=>(c(),V("div",lo,[h(Te,{title:"状态数据",type:"state",block:t.value,nameLabel:"状态数据名称",valueLabel:"状态初始值 [ JSExpression ]","data-type":"JSExpression",defaults:"null"},null,8,["block"]),h(Te,{title:"计算属性",type:"computed",block:t.value,nameLabel:"计算属性名称",valueLabel:"计算函数 [ JSFunction ]","data-type":"JSFunction",defaults:"() => { }"},null,8,["block"]),h(Te,{title:"组件方法",type:"methods",block:t.value,nameLabel:"方法名称",valueLabel:"方法函数 [ JSFunction ]","data-type":"JSFunction",defaults:"() => { }"},null,8,["block"]),h(Te,{title:"生命周期",type:"lifeCycles",block:t.value,nameLabel:"名称",valueLabel:"函数 [ JSFunction ]","data-type":"JSFunction",defaults:"() => { }"},null,8,["block"]),h(Te,{title:"Watch",type:"watch","data-type":"JSFunction",block:t.value},null,8,["block"])]))}});const no=N({__name:"Css",setup(u){const{selected:e}=me(),t=R(()=>{var i;return(i=e.value)==null?void 0:i.node}),l=[{name:"save",icon:"vtj-icon-np-save"}],s=E(),a=(i=!1)=>{var o;const r=(o=s.value)==null?void 0:o.getEditor().getValue();r!==t.value.css&&(t.value.setCss(r),i&&pe.success({message:"保存成功"}))};return(i,r)=>(c(),y(n(fe),{class:"vtj-setting-css",title:null,"body-padding":!1},{default:m(()=>[t.value?(c(),y(n(ie),{key:0,title:"CSS",tools:l,onToolClick:r[0]||(r[0]=o=>a(!0))},{default:m(()=>[h(n(de),{ref_key:"editorRef",ref:s,height:"100%",lang:"css",dark:"","model-value":t.value.css,onBlur:a},null,8,["model-value"])]),_:1})):x("",!0)]),_:1}))}});const ao={class:"vtj-schema"},oo=N({__name:"Schema",setup(u){const{project:e,emitter:t}=Y(),l=E(""),s=E(),a=[{name:"save",icon:"vtj-icon-np-save"}],i=()=>{e.current.value?l.value=JSON.stringify(e.current.value.toDsl(),null,2):l.value=""},r=()=>O(this,null,function*(){if(!e.current.value)return;const o=s.value.getEditor().getValue();if(o){if(!(yield ue.confirm("手动修改DSL有风险，可能导致页面无法加载，请确认您的操作无误。","提示",{type:"warning"}).catch(f=>!1)))return;try{const f=JSON.parse(o);e.activeFile(f),t.emit(U,e.current.value),pe.success({message:"修改成功"})}catch(f){ge.warning({message:f.message,title:"代码错误"})}}});return t.on(U,i),te(e.current,i),et(()=>{i()}),De(()=>{t.off(U,i)}),(o,v)=>(c(),V("div",ao,[h(n(ie),{class:"vtj-schema__panel",subtitle:"手动修改DSL有风险，可能导致页面无法加载，请确认您的操作无误。","body-padding":!1,tools:a,onToolClick:r},{default:m(()=>[h(n(de),{ref_key:"editorRef",ref:s,height:"100%",lang:"json",dark:"","model-value":l.value},null,8,["model-value"])]),_:1})]))}});const io=T("i",{class:"vtj-icon-refresh"},null,-1),ro=T("i",{class:"vtj-icon-setting"},null,-1),uo=T("i",{class:"vtj-icon-outline"},null,-1),co=N({__name:"Actions",props:{coder:{type:Boolean,default:!1},copy:{type:Boolean,default:!1}},setup(u){const e=u,{project:t,engine:l,emitter:s}=Y(),a=E(!1),i=E(!1),r=()=>{var p;if(t.current.value){const{designer:b}=me();b.selected.value=null,(p=l.simulator.renderer)==null||p.render(t.current.value)}else pe.warning({message:"请先打开文件"})},o=()=>{var b;const p=(b=t.current.value)==null?void 0:b.id;if(p){const k=t.getFile(p);s.emit(ml,k)}else pe.warning({message:"请先打开文件"})},v=()=>{if(t.current.value){const{designer:p}=me();p.setSelected(t.current.value);const b=Oe(l.skeleton.regionInstances.setting);b&&b.change(0)}else pe.warning({message:"请先打开文件"})},f=()=>{t.current.value?Oe(l.skeleton.regionInstances.apps).setCurrentWidget("outline"):pe.warning({message:"请先打开文件"})},d=()=>{s.emit(hl,a)},_=()=>{s.emit(_l,i)},g=()=>{const p=t.getHomePage();if(!p){pe.warning({message:"请先设置项目首页"});return}s.emit(fl,p)};return(p,b)=>(c(),V("div",null,[h(n(oe),{onClick:r,type:"default",size:"small",title:"刷新"},{default:m(()=>[io]),_:1}),h(n(oe),{type:"default",size:"small",title:"页面设置",onClick:v},{default:m(()=>[ro]),_:1}),h(n(oe),{type:"default",size:"small",title:"页面大纲树",onClick:f},{default:m(()=>[uo]),_:1}),h(n(St),{direction:"vertical"}),h(n(oe),{type:"primary",size:"small",icon:n(js),onClick:g},{default:m(()=>[q(" 浏览 ")]),_:1},8,["icon"]),h(n(oe),{type:"success",size:"small",onClick:o},{default:m(()=>[q("预览")]),_:1}),e.coder?(c(),y(n(oe),{key:0,type:"warning",size:"small",onClick:d,loading:a.value},{default:m(()=>[q(" 出码 ")]),_:1},8,["loading"])):x("",!0),e.copy?(c(),y(n(oe),{key:1,type:"danger",size:"small",onClick:_,loading:i.value},{default:m(()=>[q(" 复制 ")]),_:1},8,["loading"])):x("",!0)]))}});const po={class:"vtj-setting-panel vtj-directives"},vo=N({__name:"Directives",setup(u){const{assets:e}=Y(),{selected:t}=me(),l=R(()=>{var p;return(p=t.value)==null?void 0:p.node}),s=R(()=>e.componentMap[l.value.name]),a=p=>p.arg?typeof p.arg=="string"?p.arg:Al(p.arg,{}):"modelValue",{vIf:i,vShow:r,vBind:o,vFor:v,vModels:f,onValueChange:d,onForChange:_,onModelChange:g}=hn(l,s);return(p,b)=>(c(),V("div",po,[h(n(ie),{title:"内置指令"},{default:m(()=>[h(n(Q),{"label-width":"80px"},{default:m(()=>[h(n(_e),{name:"vIf",label:"v-if",setters:"ExpressionSetter",value:n(i).value,onChange:n(d)},null,8,["value","onChange"]),h(n(_e),{name:"vShow",label:"v-show",value:n(r).value,setters:"ExpressionSetter",onChange:n(d)},null,8,["value","onChange"]),h(n(_e),{name:"vBind",label:"v-bind",setters:"ExpressionSetter",value:n(o).value,onChange:n(d)},null,8,["value","onChange"])]),_:1})]),_:1}),h(n(ie),{title:"循环"},{default:m(()=>[h(n(Q),{"label-width":"80px"},{default:m(()=>{var k,S;return[h(n(_e),{name:"value",label:"循环数据",setters:"ExpressionSetter",value:n(v).value,onChange:n(_)},null,8,["value","onChange"]),h(n(_e),{name:"item",label:"迭代变量名",setters:{name:"InputSetter",props:{placeholder:"item"}},value:(k=n(v).iterator)==null?void 0:k.item,onChange:n(_)},null,8,["value","onChange"]),h(n(_e),{name:"index",label:"索引变量名",setters:{name:"InputSetter",props:{placeholder:"index"}},value:(S=n(v).iterator)==null?void 0:S.index,onChange:n(_)},null,8,["value","onChange"])]}),_:1})]),_:1}),n(f).length?(c(),y(n(ie),{key:0,title:"双向绑定"},{default:m(()=>[(c(!0),V(M,null,F(n(f),(k,S)=>(c(),y(n(ce),{title:`v-model: ${a(k)}`},{default:m(()=>[h(n(Q),{"label-width":"80px"},{default:m(()=>[h(n(_e),{name:S.toString(),label:"绑定变量",value:k.value,setters:"ExpressionSetter",onChange:n(g)},null,8,["name","value","onChange"])]),_:2},1024)]),_:2},1032,["title"]))),256))]),_:1})):x("",!0)]))}}),mo=N({__name:"BlockDefineProps",props:{formData:{},block:{}},setup(u){const e=u,t=R(()=>e.formData?"编辑属性":"新增属性"),l={name:[{required:!0,message:"属性名称为必填项"}]},s=E(),a=E(),i=E(),r=be(e.formData||{name:"",type:"",required:!1,default:{type:"JSExpression",value:""}}),o=()=>O(this,null,function*(){if(yield s.value.validate().catch(f=>!1)){const f=i.value.getEditor().getValue();r.default.value=f,he(r.default,{})&&(e.block.setProp(Oe(r)),a.value.close())}});return(v,f)=>(c(),y(n(ne),{ref_key:"dialogRef",ref:a,title:t.value,width:"1000px",height:"600px",submit:"",cancel:"",onSubmit:o},{default:m(()=>[h(n(Q),{ref_key:"formRef",ref:s,model:r,rules:l,size:"small","label-position":"top",class:"vtj-block-props__form"},{default:m(()=>[h(n(J),{label:"属性名称",prop:"name"},{default:m(()=>[h(n(W),{modelValue:r.name,"onUpdate:modelValue":f[0]||(f[0]=d=>r.name=d),disabled:!!e.formData},null,8,["modelValue","disabled"])]),_:1}),h(n(J),{label:"数据类型",prop:"type"},{default:m(()=>[h(n(Ze),{modelValue:r.type,"onUpdate:modelValue":f[1]||(f[1]=d=>r.type=d),multiple:""},{default:m(()=>[(c(!0),V(M,null,F(n(Nl),d=>(c(),y(n(Xe),{value:d,label:d},null,8,["value","label"]))),256))]),_:1},8,["modelValue"])]),_:1}),h(n(J),{label:"是否必须",prop:"required"},{default:m(()=>[h(n(ke),{modelValue:r.required,"onUpdate:modelValue":f[2]||(f[2]=d=>r.required=d)},null,8,["modelValue"])]),_:1}),h(n(J),{label:"默认值 [ JSExpression ]",prop:"default"},{default:m(()=>[h(n(de),{ref_key:"editorRef",ref:i,height:"250px","model-value":r.default.value||"",border:"",dark:""},null,8,["model-value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"]))}});const fo=N({__name:"BlockDefineEmits",props:{block:{},formData:{}},setup(u){const e=u,t=be(e.formData||{name:""}),l={name:[{required:!0,message:"事件名称为必填项"}]},s=E(),a=E(),i=()=>O(this,null,function*(){(yield a.value.validate().catch(o=>!1))&&(e.block.setEmit(t.name),s.value.close())});return(r,o)=>(c(),y(n(ne),{ref_key:"dialogRef",ref:s,title:"新增事件",width:"400px",height:"150px",submit:"",cancel:"",onSubmit:i},{default:m(()=>[h(n(Q),{ref_key:"formRef",ref:a,model:t,rules:l,size:"small"},{default:m(()=>[h(n(J),{label:"事件名称",prop:"name"},{default:m(()=>[h(n(W),{modelValue:t.name,"onUpdate:modelValue":o[0]||(o[0]=v=>t.name=v)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},512))}}),ho=N({__name:"BlockDefineSlots",props:{block:{},formData:{}},setup(u){const e=u,t=be(e.formData||{name:""}),l={name:[{required:!0,message:"插槽名称为必填项"}]},s=E(),a=E(),i=()=>O(this,null,function*(){(yield a.value.validate().catch(o=>!1))&&(e.block.setSlot(t.name),s.value.close())});return(r,o)=>(c(),y(n(ne),{ref_key:"dialogRef",ref:s,title:"新增插槽",width:"400px",height:"150px",submit:"",cancel:"",onSubmit:i},{default:m(()=>[h(n(Q),{ref_key:"formRef",ref:a,model:t,rules:l,size:"small"},{default:m(()=>[h(n(J),{label:"插槽名称",prop:"name"},{default:m(()=>[h(n(W),{modelValue:t.name,"onUpdate:modelValue":o[0]||(o[0]=v=>t.name=v)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},512))}}),_o=N({__name:"BlockInject",props:{block:{},formData:{}},setup(u){const e=u,t=R(()=>e.formData?"编辑注入":"新增注入"),l=be(e.formData||{name:"",from:"",default:{type:"JSExpression",value:""}}),s={name:[{required:!0,message:"注入名称为必填项"}]},a=E(),i=E(),r=E(),o=()=>O(this,null,function*(){if(yield r.value.validate().catch(f=>!1)){const f=i.value.getEditor().getValue();l.default.value=f,he(l.default,{})&&(e.block.setInject(Oe(l)),a.value.close())}});return(v,f)=>(c(),y(n(ne),{ref_key:"dialogRef",ref:a,title:t.value,width:"1000px",height:"600px",submit:"",cancel:"",onSubmit:o},{default:m(()=>[h(n(Q),{ref_key:"formRef",ref:r,model:l,rules:s,size:"small","label-position":"top"},{default:m(()=>[h(n(J),{label:"注入名称",prop:"name"},{default:m(()=>[h(n(W),{modelValue:l.name,"onUpdate:modelValue":f[0]||(f[0]=d=>l.name=d),disabled:!!e.formData},null,8,["modelValue","disabled"])]),_:1}),h(n(J),{label:"来源名称",prop:"from"},{default:m(()=>[typeof l.from=="string"?(c(),y(n(W),{key:0,modelValue:l.from,"onUpdate:modelValue":f[1]||(f[1]=d=>l.from=d)},null,8,["modelValue"])):x("",!0)]),_:1}),h(n(J),{label:"默认值",prop:"from"},{default:m(()=>[h(n(de),{ref_key:"editorRef",ref:i,"model-value":l.default.value||"",dark:"",border:"",height:"300px"},null,8,["model-value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"]))}}),go={key:0,class:"vtj-setting-panel vtj-advanced"},bo=N({__name:"Advanced",setup(u){const{selected:e}=me(),t=R(()=>{var G;const I=(G=e.value)==null?void 0:G.node;return ee(I)?I:null}),l=[{name:"add",icon:"vtj-icon-plus"}],s=R(()=>{var I;return t.value?(I=t.value.props)==null?void 0:I.map(G=>typeof G=="string"?{name:G,required:!1,type:void 0,default:{type:"JSExpression",value:""}}:z({default:{type:"JSExpression",value:""},required:!1,type:void 0},G)):[]}),a=R(()=>{var I;return((I=t.value)==null?void 0:I.emits)||[]}),i=R(()=>{var I;return((I=t.value)==null?void 0:I.slots)||[]}),r=R(()=>{var I;return t.value?(I=t.value.inject)==null?void 0:I.map(G=>z({from:"",default:{type:"JSExpression",value:""}},G)):[]}),o=E(!1),v=E(),f=E(!1),d=E(!1),_=E(),g=E(),p=()=>{v.value=void 0,o.value=!0},b=I=>{v.value=I,o.value=!0},k=I=>O(this,null,function*(){var B;(yield ue.confirm("确定删除","提示",{type:"warning"}).catch(re=>!1))&&((B=t.value)==null||B.removeProp(I))}),S=()=>{f.value=!0},A=I=>O(this,null,function*(){var B;(yield ue.confirm("确定删除","提示",{type:"warning"}).catch(re=>!1))&&((B=t.value)==null||B.removeEmit(I))}),C=()=>{d.value=!0},P=I=>O(this,null,function*(){var B;(yield ue.confirm("确定删除","提示",{type:"warning"}).catch(re=>!1))&&((B=t.value)==null||B.removeSlot(I))}),j=()=>{g.value=void 0,_.value=!0},D=I=>O(this,null,function*(){var B;(yield ue.confirm("确定删除","提示",{type:"warning"}).catch(re=>!1))&&((B=t.value)==null||B.removeInject(I))}),L=I=>O(this,null,function*(){g.value=I,_.value=!0});return(I,G)=>t.value?(c(),V("div",go,[h(n(ie),{title:"属性",tools:l,onToolClick:p},{default:m(()=>[(c(!0),V(M,null,F(s.value,B=>(c(),y(n(ce),{title:B.name,editable:"",removable:"",clickable:"",onRemove:re=>k(B),onClick:re=>b(B),onEdit:re=>b(B)},null,8,["title","onRemove","onClick","onEdit"]))),256)),s.value.length===0?(c(),y(n(le),{key:0,"image-size":50})):x("",!0),o.value?(c(),y(mo,{key:1,block:t.value,"form-data":v.value,modelValue:o.value,"onUpdate:modelValue":G[0]||(G[0]=B=>o.value=B)},null,8,["block","form-data","modelValue"])):x("",!0)]),_:1}),h(n(ie),{title:"事件",tools:l,onToolClick:S},{default:m(()=>[(c(!0),V(M,null,F(a.value,B=>(c(),y(n(ce),{title:B,removable:"",onRemove:re=>A(B)},null,8,["title","onRemove"]))),256)),a.value.length===0?(c(),y(n(le),{key:0,"image-size":50})):x("",!0),f.value?(c(),y(fo,{key:1,modelValue:f.value,"onUpdate:modelValue":G[1]||(G[1]=B=>f.value=B),block:t.value},null,8,["modelValue","block"])):x("",!0)]),_:1}),h(n(ie),{title:"插槽",tools:l,onToolClick:C},{default:m(()=>[(c(!0),V(M,null,F(i.value,B=>(c(),y(n(ce),{title:B,removable:"",onRemove:re=>P(B)},null,8,["title","onRemove"]))),256)),i.value.length===0?(c(),y(n(le),{key:0,"image-size":50})):x("",!0),d.value?(c(),y(ho,{key:1,modelValue:d.value,"onUpdate:modelValue":G[2]||(G[2]=B=>d.value=B),block:t.value},null,8,["modelValue","block"])):x("",!0)]),_:1}),h(n(ie),{title:"注入",tools:l,onToolClick:j},{default:m(()=>[(c(!0),V(M,null,F(r.value,B=>(c(),y(n(ce),{title:B.name,editable:"",removable:"",clickable:"",onRemove:re=>D(B),onClick:re=>L(B),onEdit:re=>L(B)},null,8,["title","onRemove","onClick","onEdit"]))),256)),r.value.length===0?(c(),y(n(le),{key:0,"image-size":50})):x("",!0),_.value?(c(),y(_o,{key:1,modelValue:_.value,"onUpdate:modelValue":G[3]||(G[3]=B=>_.value=B),"form-data":g.value,block:t.value},null,8,["modelValue","form-data","block"])):x("",!0)]),_:1})])):x("",!0)}}),yo={class:"vtj-switcher"},ko=T("i",{class:"vtj-icon-back vtj-switcher__back"},null,-1),Eo={key:1},Vo=N({__name:"Switcher",props:{link:{}},setup(u){const e=u,{project:t}=Y(),l=R(()=>{var a;return(a=t.current.value)==null?void 0:a.title}),s=()=>{e.link&&(location.href=e.link)};return(a,i)=>(c(),V("div",yo,[h(n(oe),{size:"small",round:"",onClick:s},{default:m(()=>[ko,T("span",null,H(n(t).name),1),l.value?(c(),y(n(St),{key:0,direction:"vertical"})):x("",!0),l.value?(c(),V("span",Eo,H(l.value),1)):x("",!0)]),_:1})]))}});const Co=["src"],So=N({__name:"Docs",props:{url:{default:"https://element-plus.org/zh-CN/"}},setup(u){const e=u,t=E();let l=null;et(()=>{var a;l||(l=ns.service({target:(a=t.value)==null?void 0:a.$el}))}),De(()=>{l.close(),l=null});const s=()=>{l.close()};return(a,i)=>(c(),y(fe,{ref_key:"panel",ref:t,title:null,class:"vtj-docs","body-padding":!1},{default:m(()=>[T("iframe",{ref:"frame",src:e.url,onLoad:s},null,40,Co)]),_:1},512))}});const wo=N({__name:"ApiDialogForm",props:{model:{},project:{}},setup(u){const e=u,t={name:"",title:"",url:"",method:"GET",settings:{type:"JSExpression",value:""}},l=E(we(e.model||z({},t))),s=E(),a=E(),i=E(),r={name:[{required:!0,message:"接口名称为必填项"}],title:[{required:!0,message:"标题描述为必填项"}],url:[{required:!0,message:"请求地址为必填项"}]},o=R(()=>e.model?"编辑Api":"新增Api"),v=()=>O(this,null,function*(){if(yield s.value.validate().catch(d=>!1)){const d=a.value.getEditor().getValue();l.value.settings.value=d,he(l.value.settings,{})&&(e.project.setApi(l.value),i.value.close())}});return(f,d)=>(c(),y(n(ne),{ref_key:"dialogRef",ref:i,width:"1000px",height:"600px",title:o.value,submit:"",cancel:"",onSubmit:v},{default:m(()=>[h(n(Q),{ref_key:"formRef",ref:s,size:"small",model:l.value,rules:r,"label-position":"top"},{default:m(()=>[h(n(J),{label:"接口名称",prop:"name"},{default:m(()=>[h(n(W),{modelValue:l.value.name,"onUpdate:modelValue":d[0]||(d[0]=_=>l.value.name=_),disabled:!!e.model},null,8,["modelValue","disabled"])]),_:1}),h(n(J),{label:"标题描述",prop:"title"},{default:m(()=>[h(n(W),{modelValue:l.value.title,"onUpdate:modelValue":d[1]||(d[1]=_=>l.value.title=_)},null,8,["modelValue"])]),_:1}),h(n(J),{label:"接口地址",prop:"url"},{default:m(()=>[h(n(W),{modelValue:l.value.url,"onUpdate:modelValue":d[2]||(d[2]=_=>l.value.url=_)},null,8,["modelValue"])]),_:1}),h(n(J),{label:"请求类型",prop:"method"},{default:m(()=>[h(n(wt),{modelValue:l.value.method,"onUpdate:modelValue":d[3]||(d[3]=_=>l.value.method=_)},{default:m(()=>[(c(!0),V(M,null,F(n(Pl),_=>(c(),y(n(as),{label:_},null,8,["label"]))),256))]),_:1},8,["modelValue"])]),_:1}),h(n(J),{label:"请求配置 [ JSExpression ]",prop:"settings"},{default:m(()=>{var _;return[h(n(de),{ref_key:"editorRef",ref:a,"model-value":(_=l.value.settings)==null?void 0:_.value,border:"",dark:"",height:"180px"},null,8,["model-value"])]}),_:1})]),_:1},8,["model"])]),_:1},8,["title"]))}}),xo={class:"vtj-apis__name"},jo=N({__name:"Apis",setup(u){const{project:e}=Y(),t=[{name:"add",icon:"vtj-icon-plus"}],l=R(()=>e.apis.value),s=E(),a=E(!1),i=()=>{s.value=void 0,a.value=!0},r=v=>{s.value=v,a.value=!0},o=v=>O(this,null,function*(){(yield ue.confirm("确定删除?","提示",{type:"warning"}).catch(d=>!1))&&e.removeApi(v.name)});return(v,f)=>(c(),y(n(fe),{class:"vtj-apis",title:"Api管理",tools:t,onToolClick:i},{default:m(()=>[l.value.length?x("",!0):(c(),y(n(le),{key:0,"image-size":50})),(c(!0),V(M,null,F(l.value,d=>(c(),y(n(ce),{editable:"",removable:"",clickable:"",onClick:_=>r(d),onEdit:_=>r(d),onRemove:_=>o(d)},{title:m(()=>[q(H(d.title)+" ",1),T("i",xo,H(d.name),1)]),_:2},1032,["onClick","onEdit","onRemove"]))),256)),a.value?(c(),y(wo,{key:1,modelValue:a.value,"onUpdate:modelValue":f[0]||(f[0]=d=>a.value=d),model:s.value,project:n(e)},null,8,["modelValue","model","project"])):x("",!0)]),_:1}))}});const $o={class:"vtj-data-source-from__label-name"},Ro=N({__name:"ApiDataSourceForm",props:{model:{},block:{}},setup(u){const e=u,{project:t}=Y(),l={type:"api",detail:"",name:"",title:"",transform:{type:"JSFunction",value:""},test:{type:"JSFunction",value:""}},s=E(we(e.model||z({},l))),a=R(()=>t.apis.value),i={name:[{required:!0,message:"调用名称为必填项"}],title:[{required:!0,message:"备注描述为必填项"}],detail:[{required:!0,message:"选择引用api"}]},r=R(()=>e.model?"编辑数据源":"新增数据源"),o=E(),v=E(),f=E(),d=E(),_=E(!1),g=E(!1),p=E(""),b=P=>{const j=a.value.find(D=>D.name===P);j&&(s.value.name=j.name,s.value.title=j.title,s.value.test.value=`() => this.${j.name}()`)},k=(P,j)=>{const D=(...L)=>O(this,null,function*(){var re;const G=yield((re=j.runtimeContext)==null?void 0:re.$apis[P.detail]).apply(this,L),B=Nt(P.transform,{});return B?B(G):G});return{[P.name]:D}},S=()=>O(this,null,function*(){if(yield o.value.validate().catch(j=>!1)){const j=v.value.getEditor().getValue();s.value.transform.value=j;const D=f.value.getEditor().getValue();return s.value.test.value=D,(!j||he(s.value.transform,e.block.runtimeContext))&&he(s.value.test,z(z({},e.block.runtimeContext),k(s.value,e.block)))}return!1}),A=()=>O(this,null,function*(){(yield S())&&(e.block.setDataSource(s.value),d.value.close())}),C=()=>O(this,null,function*(){if(yield S()){if(!s.value.test.value){ge.warning({message:"无测试用例",title:"提示"});return}const P=k(s.value,e.block);g.value=!0,p.value="";try{const D=yield Nt(s.value.test,P)().catch(L=>L);p.value=typeof D=="object"?JSON.stringify(D,null,2):"",_.value=!0}catch(j){ge.warning({message:j.message,title:"运行错误"})}g.value=!1}});return(P,j)=>(c(),y(n(ne),{ref_key:"dialogRef",ref:d,class:"vtj-data-source-from",title:r.value,width:"1000px",height:"600px",submit:"",cancel:"",onSubmit:A},{action:m(()=>[h(n(oe),{size:"default",type:"warning",onClick:C,loading:g.value},{default:m(()=>[q(" 运行测试用例 ")]),_:1},8,["loading"])]),default:m(()=>[h(n(Q),{ref_key:"formRef",ref:o,size:"small","label-position":"right","label-width":"80px",model:s.value,rules:i},{default:m(()=>[h(n(J),{label:"Api",prop:"detail"},{default:m(()=>[h(n(Ze),{modelValue:s.value.detail,"onUpdate:modelValue":j[0]||(j[0]=D=>s.value.detail=D),onChange:b,disabled:!!e.model},{default:m(()=>[(c(!0),V(M,null,F(a.value,D=>(c(),y(n(Xe),{label:D.title,value:D.name},{default:m(()=>[q(H(D.title)+" ",1),T("i",$o,H(D.name),1)]),_:2},1032,["label","value"]))),256))]),_:1},8,["modelValue","disabled"])]),_:1}),h(n(J),{label:"调用名称",prop:"name"},{default:m(()=>[h(n(W),{modelValue:s.value.name,"onUpdate:modelValue":j[1]||(j[1]=D=>s.value.name=D),disabled:!!e.model},null,8,["modelValue","disabled"])]),_:1}),h(n(J),{label:"备注描述",prop:"title"},{default:m(()=>[h(n(W),{modelValue:s.value.title,"onUpdate:modelValue":j[2]||(j[2]=D=>s.value.title=D)},null,8,["modelValue"])]),_:1}),h(n(J),{label:"转换函数",prop:"transform"},{default:m(()=>[h(n(de),{ref_key:"transformRef",ref:v,border:"",dark:"",height:"200px","model-value":s.value.transform.value},null,8,["model-value"])]),_:1}),h(n(J),{label:"测试用例"},{default:m(()=>[h(n(de),{ref_key:"testRef",ref:f,border:"",dark:"",height:"120px","model-value":s.value.test.value},null,8,["model-value"])]),_:1})]),_:1},8,["model"]),h(n(os),{modelValue:_.value,"onUpdate:modelValue":j[3]||(j[3]=D=>_.value=D),title:"测试用例运行结果",direction:"btt","append-to-body":"",size:"80%"},{default:m(()=>[h(n(de),{"model-value":p.value,border:"",dark:"",height:"100%",lang:"json"},null,8,["model-value"])]),_:1},8,["modelValue"])]),_:1},8,["title"]))}});const Do={class:"vtj-data-sources__subtitle"},To=N({__name:"DataSources",setup(u){const{selected:e}=me(),t=R(()=>{var f;return(f=e.value)==null?void 0:f.node}),l=R(()=>{var f;return Object.values(((f=t.value)==null?void 0:f.dataSources)||{}).filter(d=>d.type==="api")}),s=[{name:"add",icon:"vtj-icon-plus"}],a=E(),i=E(),r=()=>{i.value=void 0,a.value=!0},o=f=>{i.value=f,a.value=!0},v=f=>O(this,null,function*(){(yield ue.confirm("确定删除？","提示",{type:"warning"}).catch(_=>!1))&&t.value.removeDataSource(f.name)});return(f,d)=>(c(),y(n(fe),{class:"vtj-data-sources",title:null,"body-padding":!1},{default:m(()=>[h(n(ie),{title:"Api",tools:s,onToolClick:r},{default:m(()=>[l.value.length===0?(c(),y(n(le),{key:0,"image-size":50})):x("",!0),(c(!0),V(M,null,F(l.value,_=>(c(),y(n(ce),{editable:"",removable:"",clickable:"",onClick:g=>o(_),onEdit:g=>o(_),onRemove:g=>v(_)},{title:m(()=>[q(H(_.title)+" ",1),T("i",Do,H(_.name),1)]),_:2},1032,["onClick","onEdit","onRemove"]))),256))]),_:1}),a.value?(c(),y(Ro,{key:0,modelValue:a.value,"onUpdate:modelValue":d[0]||(d[0]=_=>a.value=_),model:i.value,block:t.value},null,8,["modelValue","model","block"])):x("",!0)]),_:1}))}});const Io=N({__name:"History",setup(u){const{engine:e}=Y(),t=R(()=>{var i;return((i=e.simulator.history.value)==null?void 0:i.list)||[]}),l=R(()=>`(共 ${t.value.length} 条)`),s=i=>O(this,null,function*(){var o;(yield ue.confirm("确定删除?","提示",{type:"warning"}).catch(v=>!1))&&((o=e.simulator.history.value)==null||o.remove(i.id))}),a=i=>{var r;(r=e.simulator.history.value)==null||r.load(i.id)};return(i,r)=>(c(),y(n(fe),{title:"历史记录",subtitle:l.value,class:"vtj-histroy"},{default:m(()=>[t.value.length===0?(c(),y(n(le),{key:0,"image-size":50})):x("",!0),(c(!0),V(M,null,F(t.value,(o,v)=>{var f;return c(),y(n(ce),{title:o.title,active:((f=n(e).simulator.history.value)==null?void 0:f.index)===v,onRemove:d=>s(o),onClick:d=>a(o),removable:"",clickable:""},null,8,["title","active","onRemove","onClick"])}),256))]),_:1},8,["subtitle"]))}}),Ao=N({__name:"NodePath",setup(u){const{selected:e}=me(),t=R(()=>{var i;return(((i=e.value)==null?void 0:i.path)||[]).slice(0).reverse()}),l=a=>{w.emit(Dt,a)},s=a=>{w.emit(Tt,a)};return(a,i)=>n(e)?(c(),y(n(rs),{key:0,class:"vtj-nodepath","separator-icon":n($s)},{default:m(()=>[(c(!0),V(M,null,F(t.value,r=>(c(),y(n(is),{onClick:o=>l(r),onMouseover:o=>s(r)},{default:m(()=>[q(H(r.name),1)]),_:2},1032,["onClick","onMouseover"]))),256))]),_:1},8,["separator-icon"])):x("",!0)}});const No={class:"vtj-about"},Po={class:"vtj-about__logo"},Oo=["src"],Lo=T("div",{class:"vtj-about__name"},[T("h3",null,"VTJEngine")],-1),Bo={class:"vtj-about__footer"},Uo=N({__name:"About",setup(u){return(e,t)=>(c(),V("div",No,[T("div",Po,[h(n(us),{value:n(ol)},{default:m(()=>[T("img",{src:n(il)},null,8,Oo)]),_:1},8,["value"])]),Lo,T("div",Bo,[h(n(cs),{href:"http://vtj.pro",type:"primary",target:"_blank"},{default:m(()=>[q(" http://vtj.pro ")]),_:1})])]))}});const Pe={Empty:va,Logo:ha,Dependencies:ga,Designer:Sa,Components:wa,Pages:Da,Blocks:Ta,Toolbar:La,Outline:Ya,Properties:Xa,Events:Qa,BlockScript:so,Css:no,Schema:oo,Actions:co,Directives:vo,Advanced:bo,Switcher:Vo,Docs:So,Apis:jo,DataSources:To,History:Io,NodePath:Ao,About:Uo},Mo={class:"vtj-apps"},Fo={class:"vtj-apps__header"},Jo={class:"vtj-apps__top"},zo={class:"vtj-apps__bottom"},Ho={class:"vtj-apps__panels"},Go=N({__name:"apps",setup(u,{expose:e}){const{regions:t,config:l}=Y(),s=R(()=>t.value.apps),a=E(null),i=E(null),r=E(),o=E(),v=R(()=>s.value.filter(p=>{var b;return!p.disabled&&((b=p.trigger)==null?void 0:b.type)==="panel"})),f=R(()=>s.value.filter(p=>{var b;return!p.disabled&&((b=p.trigger)==null?void 0:b.type)!=="panel"}));function d(p){const b=s.value.find(k=>k.name===p);b&&(a.value=b,i.value=b)}const _=p=>{a.value=p,i.value=i.value===p?null:p},g=p=>{var b,k,S;if(((b=p.trigger)==null?void 0:b.type)==="link"){window.open((k=p.props)==null?void 0:k.url);return}((S=p.trigger)==null?void 0:S.type)==="dialog"&&(r.value=Ye(Pe[p.type]||Pe.Empty),o.value=ae(z(z({},p.trigger),p.props),{visible:!0}))};return te(i,p=>{w.emit(dl,!!p)}),l.activeApp&&d(l.activeApp),e({setCurrentWidget:d}),(p,b)=>(c(),V("div",Mo,[T("div",Fo,[T("div",Jo,[(c(!0),V(M,null,F(v.value,k=>{var S,A;return c(),y(zt,{key:`trigger-${k.name}`,icon:(S=k.trigger)==null?void 0:S.icon,label:(A=k.trigger)==null?void 0:A.label,active:a.value===k,open:i.value===k,onClick:C=>_(k)},null,8,["icon","label","active","open","onClick"])}),128))]),T("div",zo,[(c(!0),V(M,null,F(f.value,k=>{var S,A;return c(),y(zt,{key:`trigger-${k.name}`,icon:(S=k.trigger)==null?void 0:S.icon,label:(A=k.trigger)==null?void 0:A.label,onClick:C=>g(k)},null,8,["icon","label","onClick"])}),128))])]),Ee(T("div",Ho,[(c(!0),V(M,null,F(v.value,k=>(c(),y(ys,{key:k.name},[a.value===k?(c(),y(n(Ve),We(K({key:0},z({},k))),null,16)):x("",!0)],1024))),128))],512),[[je,!!i.value]]),r.value?(c(),y(ne,K({key:0},o.value,{modelValue:o.value.visible,"onUpdate:modelValue":b[0]||(b[0]=k=>o.value.visible=k)}),{default:m(()=>[(c(),y($t(r.value),We(jt(o.value)),null,16))]),_:1},16,["modelValue"])):x("",!0)]))}});const qo={class:"vtj-brand"},Wo=N({__name:"brand",setup(u){const{regions:e}=Y(),t=R(()=>e.value.brand);return(l,s)=>(c(),V("div",qo,[(c(!0),V(M,null,F(t.value,a=>(c(),y(n(Ve),K({key:a.name},z({},a)),null,16))),128))]))}});const Yo={key:0,class:"vtj-setting"},Ko={key:0,class:"vtj-setting__header"},Xo={class:"vtj-setting__path"},Zo=T("i",{class:"vtj-icon-layers"},null,-1),Qo=T("i",{class:"vtj-icon-help"},null,-1),ei=N({__name:"setting",setup(u,{expose:e}){var _;const{engine:t,regions:l}=Y(),{selected:s}=me(),{setting:a}=l.value||{},i=R(()=>{var g;return ee((g=s.value)==null?void 0:g.node)?"Block":"Node"}),r=R(()=>a.filter(g=>!g.disabled&&g.group===i.value).map(g=>{var p;return{name:g.name,label:((p=g.trigger)==null?void 0:p.label)||g.name,closable:!1}})),o=E((_=r.value[0])==null?void 0:_.name);te(s,(g,p)=>{(g==null?void 0:g.node.id)!==(p==null?void 0:p.node.id)&&v(0)});const v=(g=0)=>{var p;o.value=(p=r.value[g])==null?void 0:p.name};e({currentTab:o,tabs:r,change:v});const f=R(()=>{var p;const g=(p=s.value)==null?void 0:p.node;if(g){const b=t.assets.componentMap[g.name];return b==null?void 0:b.doc}return null}),d=()=>{if(f.value){const g=Oe(t.skeleton.regionInstances.workspace);g&&g.openTab("docs",{url:f.value})}};return(g,p)=>n(s)&&n(s).node?(c(),V("div",Yo,[i.value==="Node"?(c(),V("div",Ko,[T("div",Xo,[Zo,T("span",null,[q(H(n(s).node.name.fileName||n(s).node.name)+": ",1),T("i",null,H(n(s).node.id),1)])]),f.value?(c(),V("div",{key:0,class:"vtj-setting__doc",onClick:d},[Qo,q(" 帮助 ")])):x("",!0)])):x("",!0),n(s).node.lock?x("",!0):(c(),y(Rt,{key:1,class:"vtj-setting__tabs",items:r.value,modelValue:o.value,"onUpdate:modelValue":p[0]||(p[0]=b=>o.value=b),stretch:"","body-padding":!1},{default:m(()=>[(c(!0),V(M,null,F(n(a),b=>(c(),y(n(Ve),K({key:b.name},z({},b),{visible:b.name===o.value}),null,16,["visible"]))),128))]),_:1},8,["items","modelValue"])),n(s).node.lock?(c(),y(n(le),{key:2,"image-size":1,description:"组件已被锁定，不能更改设置。"})):x("",!0)])):(c(),y(n(le),{key:1,description:"请在左侧画布选中节点"}))}});const ti={class:"vtj-status"},li={class:"vtj-status__left"},si={class:"vtj-status__right"},ni=N({__name:"status",setup(u){const{regions:e}=Y(),t=R(()=>e.value.status),l=R(()=>t.value.filter(a=>!a.disabled&&!a.trigger)),s=R(()=>t.value.filter(a=>!a.disabled&&!!a.trigger));return(a,i)=>(c(),V("div",ti,[T("div",li,[(c(!0),V(M,null,F(l.value,r=>(c(),y(n(Ve),K({key:r.name},z({},r)),null,16))),128))]),T("div",si,[(c(!0),V(M,null,F(s.value,r=>(c(),y(n(Ve),K({key:r.name},z({},r)),null,16))),128))])]))}});const ai={class:"vtj-toolbar"},oi=N({__name:"toolbar",setup(u){const{regions:e}=Y(),t=R(()=>e.value.toolbar);return(l,s)=>(c(),V("div",ai,[(c(!0),V(M,null,F(t.value,a=>(c(),y(n(Ve),K({key:a.name},z({},a)),null,16))),128))]))}});const ii=N({__name:"workspace",setup(u,{expose:e}){var g;const{regions:t,emitter:l}=Y(),s=R(()=>t.value.workspace),a=s.value.filter(p=>p.name==="designer").map(p=>{var b;return{name:p.name,label:((b=p.trigger)==null?void 0:b.label)||p.name}}),i=E(s.value.filter(p=>!p.disabled&&p.name!=="designer").map(p=>{var b;return{name:p.name,label:((b=p.trigger)==null?void 0:b.label)||p.name,checked:!1,closable:!0}})),r=R(()=>{const p=i.value.filter(b=>!!b.checked);return p.unshift(a[0]),p}),o=E((g=r.value[0])==null?void 0:g.name);te(o,p=>{l.emit(vl,p==="designer")});const v=p=>{const b=i.value.find(k=>k.name===p);b&&(b.checked=!1),p===o.value&&(o.value=r.value[0].name)},f=E({}),d=(p,b)=>{const k=i.value.find(S=>S.name===p);k&&(f.value[p]=b,k.checked=!0),o.value=p},_=p=>{p.checked=!p.checked,p.checked?o.value=p.name:o.value===p.name&&(o.value="designer")};return e({openTab:d}),(p,b)=>(c(),y(n(Rt),{class:"vtj-workspace",items:r.value,modelValue:o.value,"onUpdate:modelValue":b[0]||(b[0]=k=>o.value=k),more:i.value,onTabRemove:v,onMore:_,checkable:""},{default:m(()=>[(c(!0),V(M,null,F(s.value,k=>(c(),y(n(Ve),K({key:k.name},z(z({},k),f.value[k.name]),{visible:k.name===o.value}),null,16,["visible"]))),128))]),_:1},8,["items","modelValue","more"]))}});const ri=N({__name:"App",props:{engine:{}},setup(u,{expose:e}){const t=u,l=E(),s=E(),a=E(),i=E(),r=E(),o=E(),v=E();E(),E();const f=E(!1),d=E(!0);t.engine.skeleton.regionInstances={brand:l,toolbar:s,action:a,status:i,setting:r,workspace:o,apps:v};const _={dirs:["e"],maxWidth:600},g={dirs:["w"],maxWidth:600};function p(b){f.value=b}return w.on(dl,b=>{p(!b)}),ks(It,t.engine),e({setLeftCollapsed:p,showSetting:d}),(b,k)=>(c(),y(n(ms),{locale:n(vs)},{default:m(()=>[h(n(mt),{class:"vtj-layout"},{default:m(()=>[h(n(ds),{class:"vtj-layout__header",height:"36px"},{default:m(()=>[h(n(Wo),{ref_key:"brand",ref:l},null,512),h(n(oi),{ref_key:"toolbar",ref:s},null,512),h(n(ca),{ref_key:"action",ref:a},null,512)]),_:1}),h(n(mt),{class:"vtj-layout__wrapper"},{default:m(()=>[Ee((c(),y(n(vt),{width:"400px",class:X(["vtj-layout__left",{"is-collapsed":f.value}])},{default:m(()=>[h(n(Go),{ref_key:"apps",ref:v},null,512)]),_:1},8,["class"])),[[n(Pt),_]]),h(n(Yt),{class:"vtj-layout__main"},{default:m(()=>[h(n(ii),{ref_key:"workspace",ref:o},null,512)]),_:1}),d.value?Ee((c(),y(n(vt),{key:0,width:"350px",class:"vtj-layout__right"},{default:m(()=>[h(n(ei),{ref_key:"setting",ref:r},null,512)]),_:1})),[[n(Pt),g]]):x("",!0)]),_:1}),h(n(ps),{class:"vtj-layout__footer",height:"20px"},{default:m(()=>[h(n(ni),{ref_key:"status",ref:i},null,512)]),_:1})]),_:1})]),_:1},8,["locale"]))}});const ui=["brand","toolbar","action","status","apps","workspace","setting"];class ci{constructor(e){$(this,"widgets");$(this,"widgetInstances",{});$(this,"regions");$(this,"regionInstances",{});this.widgets=be(e),this.regions=R(()=>ui.reduce((t,l)=>(t[l]=this.getWidgets(l),t),{}))}load(e){e.forEach(t=>{this.add(t)})}get(e){return this.widgets.find(t=>t.name===e)}set(e,t){const l=this.get(e);l&&al(l,t)}add(e){!!this.get(e.name)?this.set(e.name,e):this.widgets.push(e)}remove(e){const t=this.widgets.findIndex(l=>l.name===e);if(t>=0){const l=this.widgets[t];l.disabled=!0,this.widgets.splice(t,1)}}getComponent(e){return e?Ol(e)?Pe[e]||Pe.Empty:e:Pe.Empty}getWidgets(e){return this.widgets.filter(t=>t.region===e).sort((t,l)=>(t.order||0)-(l.order||0))}dispose(){this.widgetInstances={},this.regionInstances={}}}const w=Cs(),dl="EVENT_SKELETON_LEFT_COLLAPSED_CHANGE",ve="EVENT_PROJECT_UPDATE",di="EVENT_PROJECT_ACTIVE_FILE",Ge="EVENT_FILE_CREATE",ft="EVENT_FILE_UPDATE",ht="EVENT_FILE_REMOVE",_t="EVENT_ASSETS_LOADED",pi="EVENT_SIMULATOR_OPEN",gt="EVENT_SIMULATOR_READY",bt="EVENT_COMPONENETS_DRAG_START",yt="EVENT_COMPONENETS_DRAG_END",U="EVENT_NODE_CHANGE",pl="EVENT_VIEWPORT_MODE_CHANGE",Dt="EVENT_OUTLINE_SELECTED",Tt="EVENT_OUTLINE_HOVER",xe="EVENT_OUTLINE_CHANGE",vl="EVENT_DESIGNER_ACTIVE_CHANGE",ml="EVENT_ACTION_PREVIEW",fl="EVENT_ACTION_HOME",hl="EVENT_ACTION_CODER",_l="EVENT_ACTION_COPY",vi="EVENT_HISTORY_GO",mi="EVENT_HISTORY_BACK",$e="EVENT_HISTORY_CHANGE",fi="EVENT_HISTORY_PUSH",hi="EVENT_HISTORY_REMOVE",Ke="EVENT_HISTORY_SAVE",_i=[{id:"elements",category:"特殊元素"},{id:"components",category:"内置组件"}],gl=[{name:"component",title:"动态组件",categoryId:"elements",doc:"https://cn.vuejs.org/api/built-in-special-elements.html#component",props:[{name:"is",label:"组件名",setters:"InputSetter"}],snippet:{children:"组件文本内容示例",props:{is:"div"}}},{name:"slot",title:"插槽",categoryId:"elements",doc:"https://cn.vuejs.org/api/built-in-special-elements.html#slot",props:[{name:"name",label:"名称",defaultValue:"default",setters:"InputSetter"}],snippet:{children:"插槽默认内容"}}],Fe=[...gl,{name:"Transition",title:"过渡效果",categoryId:"components",package:"vue",doc:"https://cn.vuejs.org/api/built-in-components.html#transition",props:[{name:"name",label:"名称",defaultValue:"",title:"用于自动生成过渡 CSS class 名",setters:"InputSetter"},{name:"css",label:"应用CSS",defaultValue:!0,title:"是否应用 CSS 过渡 class",setters:"BooleanSetter"},{name:"type",label:"事件类型",defaultValue:void 0,title:"指定要等待的过渡事件类型来确定过渡结束的时间，默认情况下会自动检测持续时间较长的类型",setters:"SelectSetter",options:["transition","animation"]},{name:"duration",label:"持续时间",defaultValue:void 0,title:"显式指定过渡的持续时间",setters:["NumberSetter","JSONSetter"]},{name:"mode",label:"时序",defaultValue:"default",title:"控制离开/进入过渡的时序。",setters:"SelectSetter",options:["in-out","out-in","default"]},{name:"appear",label:"使用过渡",defaultValue:!1,title:"是否对初始渲染使用过渡",setters:"BooleanSetter"},{name:"enterFromClass",label:"enterFromClass",defaultValue:void 0,setters:"InputSetter"},{name:"enterActiveClass",label:"enterActiveClass",defaultValue:void 0,setters:"InputSetter"},{name:"enterToClass",label:"enterToClass",defaultValue:void 0,setters:"InputSetter"},{name:"appearFromClass",label:"appearFromClass",defaultValue:void 0,setters:"InputSetter"},{name:"appearActiveClass",label:"appearActiveClass",defaultValue:void 0,setters:"InputSetter"},{name:"appearToClass",label:"appearToClass",defaultValue:void 0,setters:"InputSetter"},{name:"leaveFromClass",label:"leaveFromClass",defaultValue:void 0,setters:"InputSetter"},{name:"leaveActiveClass",label:"leaveActiveClass",defaultValue:void 0,setters:"InputSetter"},{name:"leaveToClass",label:"leaveToClass",defaultValue:void 0,setters:"InputSetter"}],events:["before-enter","before-leave","enter","leave","appear","after-enter","after-leave","after-appear","enter-cancelled","leave-cancelled","ppear-cancelled"],snippet:{children:"Transition"}},{name:"TransitionGroup",title:"过渡效果组",package:"vue",categoryId:"components",doc:"https://cn.vuejs.org/api/built-in-components.html#transitiongroup",props:[{name:"name",label:"名称",defaultValue:"",title:"用于自动生成过渡 CSS class 名",setters:"InputSetter"},{name:"tag",label:"标签名",defaultValue:void 0,title:"如果未定义，则渲染为片段 (fragment)",setters:"InputSetter"},{name:"moveClass",label:"moveClass",defaultValue:void 0,title:"用于自定义过渡期间被应用的 CSS class。",setters:"InputSetter"},{name:"css",label:"应用CSS",defaultValue:!0,title:"是否应用 CSS 过渡 class",setters:"BooleanSetter"},{name:"type",label:"事件类型",defaultValue:void 0,title:"指定要等待的过渡事件类型来确定过渡结束的时间，默认情况下会自动检测持续时间较长的类型",setters:"SelectSetter",options:["transition","animation"]},{name:"duration",label:"持续时间",defaultValue:void 0,title:"显式指定过渡的持续时间",setters:["NumberSetter","JSONSetter"]},{name:"appear",label:"使用过渡",defaultValue:!1,title:"是否对初始渲染使用过渡",setters:"BooleanSetter"},{name:"enterFromClass",label:"enterFromClass",defaultValue:void 0,setters:"InputSetter"},{name:"enterActiveClass",label:"enterActiveClass",defaultValue:void 0,setters:"InputSetter"},{name:"enterToClass",label:"enterToClass",defaultValue:void 0,setters:"InputSetter"},{name:"appearFromClass",label:"appearFromClass",defaultValue:void 0,setters:"InputSetter"},{name:"appearActiveClass",label:"appearActiveClass",defaultValue:void 0,setters:"InputSetter"},{name:"appearToClass",label:"appearToClass",defaultValue:void 0,setters:"InputSetter"},{name:"leaveFromClass",label:"leaveFromClass",defaultValue:void 0,setters:"InputSetter"},{name:"leaveActiveClass",label:"leaveActiveClass",defaultValue:void 0,setters:"InputSetter"},{name:"leaveToClass",label:"leaveToClass",defaultValue:void 0,setters:"InputSetter"}],events:["before-enter","before-leave","enter","leave","appear","after-enter","after-leave","after-appear","enter-cancelled","leave-cancelled","ppear-cancelled"],snippet:{children:"TransitionGroup"}},{name:"KeepAlive",title:"缓存切换组件",package:"vue",categoryId:"components",doc:"https://cn.vuejs.org/api/built-in-components.html#keepalive",props:[{name:"include",label:"匹配包含",title:"如果指定，则只有与 `include` 名称, 匹配的组件才会被缓存。",setters:["InputSetter","JSONSetter"]},{name:"exclude",label:"匹配排除",title:"任何名称与 `exclude` 匹配的组件都不会被缓存。",setters:["InputSetter","JSONSetter"]},{name:"max",label:"最大缓存数",title:"最多可以缓存多少组件实例。",setters:["InputSetter"]}]},{name:"Teleport",title:"传送组件",package:"vue",categoryId:"components",doc:"https://cn.vuejs.org/api/built-in-components.html#teleport",props:[{name:"to",label:"目标容器",title:"指定目标容器,可以是选择器或实际元素",setters:["InputSetter"]},{name:"disabled",label:"目标容器",title:"当值为 `true` 时，内容将保留在其原始位置, 而不是移动到目标容器中, 可以动态更改",setters:["BooleanSetter"]}]},{name:"Suspense",title:"异步依赖",package:"vue",categoryId:"components",doc:"https://cn.vuejs.org/api/built-in-components.html#suspense",props:[{name:"timeout",label:"timeout",setters:["InputSetter"]}]}];class gi{constructor(e,t){$(this,"unwatch");$(this,"packages",[]);$(this,"elements",[...gl]);$(this,"elementsMap",{});$(this,"components",[...Fe]);$(this,"componentMap",{});$(this,"componentGroups",[]);$(this,"isReady",!1);this.service=e,this.project=t,t&&(this.unwatch=te(t.dependencies,l=>this.load(l),{deep:!0})),this.elementsMap=this.parseMap(this.elements,!1)}clear(){this.components=[...Fe],this.componentMap={},this.componentGroups=[]}getCateoryComponents(e,t){const l=t.filter(s=>s.categoryId===e.id&&s.hidden!==!0);return{name:e.id,label:e.category,count:l.length,components:l}}parseGroups(e){const t=[];for(let l of e){const{categories:s,components:a,label:i,name:r,library:o,names:v}=l;if(!s||!a)continue;const f=s.map(g=>this.getCateoryComponents(g,a)),d=f.reduce((g,p)=>p.count+g,0),_={name:l.name,label:i||r,library:o,names:v,count:d,children:f};t.push(_)}return t}parseMap(e,t=!0){const l={};if(t)for(const s of e)s.package&&(l[s.name]=s);else for(const s of e)l[s.name]=s;return l}load(e){return O(this,null,function*(){this.packages=e,this.isReady=!1;const t=e.filter(r=>!!r.assetsUrl&&r.enabled);this.clear();const l=[{name:"vue",label:"内置",names:Fe.map(r=>r.name),library:"Vue",components:Fe,categories:_i}];for(const r of t){const o=yield Ll(r.assetsUrl,{},{name:r.assetsLibrary,script:!0}).catch(v=>null);o&&(o.name=o.name||r.assetsLibrary,o.library=r.library,o.names=(o.components||[]).map(v=>v.name),l.push(o),this.components=this.components.concat(o.components||[]))}this.componentGroups=this.parseGroups(l),this.componentMap=this.parseMap(this.components),this.isReady=!0,w.emit(_t);const{components:s,componentGroups:a,componentMap:i}=this;return{components:s,componentGroups:a,componentMap:i}})}getBlockDescription(e){return O(this,null,function*(){if(!e||typeof e=="string")return null;const t=e.type==="Schema"?e.id:null;if(!t)return null;const l=yield this.service.getFile(t);if(!l)return null;const{id:s,name:a,slots:i,props:r,emits:o}=l,v=d=>{const _=Array.isArray(d)?d:[d];let g=[];for(const p of _)g=g.concat(cl[p.toLowerCase()]||[]);return g};return{id:s,name:a,childIncludes:i!=null&&i.length?void 0:!1,props:(r||[]).map(d=>typeof d=="string"?{name:d}:{name:d.name,type:d.type,setters:v(d.type)}),events:o,slots:i}})}dispose(){this.clear(),this.unwatch&&this.unwatch()}}class bi{constructor(e,t,l){$(this,"app",null);$(this,"dsl",null);$(this,"onNodeChangeProxy");this.env=e,this.service=t,this.history=l,this.onNodeChangeProxy=this.onNodeChange.bind(this)}install(e={},t={}){const l=Object.values(e);this.app&&(Object.assign(this.app.config.globalProperties,t),this.app.config.errorHandler=(s,a,i)=>{const o=`[ ${a==null?void 0:a.$options.name}] ${(s==null?void 0:s.message)||s||"未知错误"}`;console.error({err:s,instance:a,info:i}),ge.error({title:"运行错误",message:o})},l.forEach(s=>{var a;(typeof s=="function"||s.install)&&((a=this.app)==null||a.use(s))}))}render(e){this.app&&this.dispose();const{Vue:t,container:l,components:s,libs:a,apis:i,window:r,globals:o}=this.env,v=Bl({getFile:this.service.getFile,options:{Vue:t,block:e,components:s,libs:a,apis:i,window:r}});this.dsl=t.reactive(e.toDsl());const f=Ul({Vue:t,dsl:this.dsl,block:e,components:s,libs:a,apis:i,window:r,loader:v});this.app=t.createApp(f),this.install(a,o),this.app.mount(l),w.on(U,this.onNodeChangeProxy)}onNodeChange(e){if(ee(e))this.render(e);else if(this.dsl){const t=e.toDsl();this.updateChild(t,this.dsl)}this.dsl&&this.history.value&&this.history.value.push(this.dsl)}updateChild(e,t){const l=t.children||[];if(Array.isArray(l))for(let s=0;s<l.length;s++){const a=l[s];if(a.id===e.id){l.splice(s,1,e);return}else this.updateChild(e,a)}}dispose(){this.app&&(this.app.unmount(),this.app=null),this.dsl=null,w.off(U,this.onNodeChangeProxy)}}class yi{constructor(e){$(this,"unwatches",[]);$(this,"iframe",null);$(this,"contentWindow",null);$(this,"project");$(this,"renderer",null);$(this,"assets");$(this,"service");$(this,"globals");$(this,"history",E(null));$(this,"isReady",!1);const{project:t,assets:l,service:s,globals:a}=e;this.project=t,this.assets=l,this.service=s,this.globals=a,w.on(_t,()=>this.open()),w.on(Ke,i=>this.service.saveHistory(i)),w.on($e,i=>{var o;const r=t.current.value;r&&(r.init(i.block),(o=this.renderer)==null||o.render(r))}),this.unwatches.push(te(t.current,i=>O(this,null,function*(){var r,o;i?(yield this.loadHistory(i),(r=this.renderer)==null||r.render(i)):(this.history.value=null,(o=this.renderer)==null||o.dispose())})))}loadHistory(e){return O(this,null,function*(){const t=yield this.service.getHistory(e.id);this.history.value=new vn({history:{blockId:e.id,items:t}})})}init(e){te(e,t=>{t&&(this.iframe=t,this.assets.isReady&&this.open())})}open(){if(!this.iframe)return;this.isReady=!1,this.contentWindow=this.iframe.contentWindow,this.contentWindow.__simulator__=this;const e=this.contentWindow.document;w.emit(pi,e);const{scripts:t,css:l}=this.parseDependencies();e.open(),e.write(`
     <!DOCTYPE html>
     <html lang="zh-CN">
       <head>
       <meta charset="utf-8">
       <meta name="viewport"
             content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0,viewport-fit=cover"/>
         <style>
            html, body {
              background: #fff;
              padding: 0;
              margin: 0;
              min-height: 100vh;
              width: 100%;
              height: 100%;
              font-size:12px;
            }
         </style>
         ${Ml(l)}
         ${Fl(t)}
       </head>
       <body> 
       </body>
       <script>
       __simulator__.ready();
     <\/script> 
     </html>
    `),e.close()}parseDependencies(){const e=this.project.dependencies.value.filter(s=>s.enabled),t=[],l=[];return e.forEach(({urls:s})=>{s==null||s.forEach(a=>{Jl(a)&&t.push(a),zl(a)&&l.push(a)})}),{scripts:t,css:l}}parseApis(){return this.project.apis.value.reduce((t,l)=>(t[l.name]=Hl(l),t),{})}createEnv(){const{contentWindow:e,assets:t,globals:l}=this,s=this.project.dependencies.value,a=t.componentGroups,i={window:e,Vue:null,libs:{},components:{},apis:this.parseApis(),container:e==null?void 0:e.document.body,globals:l};return s.filter(r=>!!r.enabled).forEach(({library:r})=>{const o=e[r];if(o){i.libs[r]=o,r===Ot&&(i[Ot]=o);const v=a.find(d=>d.library===r);((v==null?void 0:v.names)||[]).forEach(d=>{i.components[d]=o[d]})}}),i}ready(){var l,s;this.isReady=!0,(l=this.renderer)==null||l.dispose(),this.renderer=null;const e=this.project.current.value,t=this.createEnv();this.renderer=new bi(t,this.service,this.history),e&&this.renderer.render(e),w.emit(gt,(s=this.contentWindow)==null?void 0:s.document)}dispose(){var e;(e=this.renderer)==null||e.dispose(),this.contentWindow=null,this.iframe=null,this.renderer=null,this.history.value=null,this.unwatches.forEach(t=>t()),w.off(_t),w.off(Ke),w.off($e)}}const It=Symbol("VtjEngine");class ki{constructor(e,t={}){$(this,"config");$(this,"skeleton");$(this,"app");$(this,"service");$(this,"emitter",w);$(this,"project");$(this,"assets");$(this,"simulator");const{config:l={},service:s=new qt,project:a,globals:i={}}=t;this.service=s,this.config=Ms(Bs,l),this.skeleton=new ci(this.config.widgets||[]),this.project=Qt(new pn(a,this.config.dependencies)),this.assets=new gi(this.service,this.project),this.simulator=new yi({project:this.project,assets:this.assets,service:this.service,globals:i}),this.app=Zt(ri,{engine:Ye(this)}),this.bindListeners(),this.loadProject(this.project.toDsl()),et(()=>{var r;this.app.mount((r=n(e))!=null?r:document.body)}),De(()=>{this.dispose()})}loadProject(e){return O(this,null,function*(){const{service:t,project:l}=this,s=yield t.getProject(e||{name:"未命名项目"});l.load(s)})}bindListeners(){const{emitter:e,service:t}=this;e.on(ve,l=>t.updateProject(l)),e.on(Ge,l=>t.createFile(l)),e.on(ft,l=>t.updateFile(l)),e.on(ht,l=>t.removeFile(l)),e.on(U,()=>{const l=this.project.current.value;l&&t.updateFile(l.toDsl())})}dispose(){this.emitter.all.clear(),this.skeleton.dispose(),this.assets.dispose(),this.simulator.dispose(),this.app.unmount()}}class Ei{constructor(e,t,l){$(this,"draggingComponent",null);$(this,"document",null);$(this,"proxied",{});$(this,"hover",at(null));$(this,"dropping",at(null));$(this,"selected",at(null));this.engine=e,this.iframe=t,this.slotPicker=l,e.simulator.init(t),w.on(gt,s=>{this.bindEvents(s)}),w.on(bt,s=>{this.draggingComponent=s}),w.on(yt,()=>{this.draggingComponent=null}),w.on($e,()=>{this.selected.value=null,this.hover.value=null}),te(e.project.current,()=>{this.selected.value=null,this.hover.value=null})}dispose(){this.engine.simulator.dispose(),w.off(gt),w.off(bt),w.off(yt),this.document&&(this.unbindEvents(this.document),this.document=null)}getNodeByElement(e){var l;const t=(l=e.__vtj__)!=null?l:"";return Le.nodes[t]||null}getElementByNode(e){return!this.document||!e?null:ee(e)?this.document.body:Array.from(this.document.querySelectorAll("*")).find(l=>l.__vtj__===e.id)}getDropType(e,t,l){const{left:s,top:a,width:i,height:r}=e;return t>=s&&t<=s+i*.2?"left":t>=s+i*.8&&t<=s+i?"right":l>=a&&l<=a+r*.2?"top":l>=a+r*.8&&l<=a+r?"bottom":"inner"}getElementAndNode(e){const{engine:t,document:l}=this,s=e.composedPath(),a=this.findVtjElement(s)||(l==null?void 0:l.body),i=a?this.getNodeByElement(a)||t.project.current.value:null;return{el:a,node:i,path:s}}onDragOver(e){const{el:t,node:l}=this.getElementAndNode(e);if(l&&t&&this.allowDrop(l)){e.preventDefault();const s=t.getBoundingClientRect();this.dropping.value={el:t,node:l,rect:s,type:this.getDropType(s,e.clientX,e.clientY),path:[]}}else this.dropping.value=null}onMouseOver(e){const{el:t,node:l}=this.getElementAndNode(e);if(t&&l){const s=t.getBoundingClientRect();this.hover.value={el:t,node:l,rect:s,type:"inner",path:[]}}}onLeave(e){this.hover.value=null,this.dropping.value=null}createNodeDsl(e){const{name:t,snippet:l={},from:s}=e;return ae(z({},l),{name:t,from:s||e.package})}getDropSlot(e){return O(this,null,function*(){var o;if(!e)return;const{engine:t,slotPicker:l}=this,s=t.assets.componentMap,a=(yield t.assets.getBlockDescription(e.from))||s[e.name];if(!(a!=null&&a.slots))return;const i=((a==null?void 0:a.slots)||["default"]).map(v=>typeof v=="string"?{name:v,params:[]}:{name:v.name,params:v.params||[]});if(i.length===0)return;if(i.length===1)return i[0];const r=yield l(i).catch(v=>{});if(!(r&&r.name==="default"&&(!r.params||((o=r.params)==null?void 0:o.length)===0)))return r})}onDrop(e){return O(this,null,function*(){e.preventDefault();const{engine:t,draggingComponent:l,dropping:s}=this,a=t.project.current.value;if(!a||!l||!s.value)return;const{el:i,node:r}=this.getElementAndNode(e);if(!i||!r||!this.allowDrop(r))return;const o=this.createNodeDsl(l),v=new Le(o),f=s.value.type;v.slot=yield this.getDropSlot(f==="inner"?r:r.parent),ee(r)?a.appendChild(v):a.appendChild(v,r,f)})}onSelected(e){const{el:t,node:l,path:s}=this.getElementAndNode(e);if(t&&l){const a=t.getBoundingClientRect();this.selected.value={el:t,node:l,rect:a,path:this.getNodePath(s),type:this.getDropType(a,e.clientX,e.clientY)}}}onViewChange(){this.updateRect()}updateRect(){const e=n(this.selected),t=n(this.hover);if(e){const l=e.el.getBoundingClientRect();this.selected.value=ae(z({},e),{rect:l})}if(t){const l=t.el.getBoundingClientRect();this.hover.value=ae(z({},t),{rect:l})}}getNodePath(e){const l=e.filter(a=>this.isVtjElement(a)&&this.isCurrentContext(a)).map(a=>this.getNodeByElement(a)),s=this.engine.project.current.value;return s&&l.push(s),l}isVtjElement(e){return!!e.__vtj__}isCurrentContext(e){var s,a;const t=(s=this.engine.project.current.value)==null?void 0:s.id,l=(a=e.__context__)==null?void 0:a.__id;return t===l}findVtjElement(e){return e.find(t=>this.isVtjElement(t)&&this.isCurrentContext(t))}bind(e,t){let l=this.proxied[t];return l||(l=e.bind(this),this.proxied[t]=l),l}bindEvents(e){this.document&&this.unbindEvents(this.document);const t=this.engine.simulator.contentWindow;e.addEventListener("mouseover",this.bind(this.onMouseOver,"onMouseOver")),e.addEventListener("mouseleave",this.bind(this.onLeave,"onLeave")),e.addEventListener("dragover",this.bind(this.onDragOver,"onDragOver")),e.addEventListener("dragleave",this.bind(this.onLeave,"onLeave")),e.addEventListener("drop",this.bind(this.onDrop,"onDrop")),e.addEventListener("click",this.bind(this.onSelected,"onSelected")),e.addEventListener("scroll",this.bind(this.onViewChange,"onViewChange")),t==null||t.addEventListener("resize",this.bind(this.onViewChange,"onViewChange")),this.document=e}unbindEvents(e){const t=this.engine.simulator.contentWindow;e.removeEventListener("mouseover",this.bind(this.onMouseOver,"onMouseOver")),e.removeEventListener("mouseleave",this.bind(this.onLeave,"onLeave")),e.removeEventListener("dragover",this.bind(this.onDragOver,"onDragOver")),e.removeEventListener("dragleave",this.bind(this.onLeave,"onLeave")),e.removeEventListener("drop",this.bind(this.onDrop,"onDrop")),e.removeEventListener("click",this.bind(this.onSelected,"onSelected")),e.removeEventListener("scroll",this.bind(this.onViewChange,"onViewChange")),t==null||t.removeEventListener("resize",this.bind(this.onViewChange,"onViewChange")),this.document=null}allowDrop(e){const{draggingComponent:t,engine:l}=this;if(!t)return!0;const s=l.project.current.value;return s&&s.allowDrop(t,e,l.assets)}setHover(e){const t=this.getElementByNode(e);if(!t)return;const l=t.getBoundingClientRect();this.hover.value={el:t,node:e,rect:l,type:"inner",path:[]}}setSelected(e){if(!this.document)return;const t=this.getElementByNode(e)||this.document.createElement("span"),l=t.getBoundingClientRect();this.selected.value={el:t,node:e,rect:l,path:this.findPathByNode(e),type:"inner"}}findPathByNode(e){const t=[e];if(ee(e))return t;let l=e;for(;l.parent&&l.parent!==l;)l=l.parent,l!==e&&t.unshift(l);return t.reverse()}}const Vi=u=>(Es("data-v-09e1836c"),u=u(),Vs(),u),Ci={class:"vtj-ide"},Si={class:"file-list"},wi={key:1},xi=Vi(()=>T("div",{class:"error-tip"}," 错误日志已保存. 这可能是系统的bug。您可以把日志提交给作者协助解决。 ",-1)),ji=N({__name:"index",setup(u){const t=E(!1),l=E(!1),s=E([]),a=E(null),i=E(!1),r=E(),o=Gl(),{project:v,raw:f=!1,service:d="storage",debug:_}=(o==null?void 0:o.options)||{},{id:g="ide",name:p="IDE",base:b="/",mode:k="hash",page:S="/page",preview:A="/preview",home:C="/"}=v||{},P=()=>`${b}${k==="hash"?"#":""}${C}`,j=new ki(r,{service:d==="file"?new Rs:new qt,config:{widgets:[{name:"switcher",props:{link:P()}},{name:"actions",props:{coder:!0,copy:!1}}]},project:{id:g,name:p},globals:{$route:Cl(),$router:Sl()}});return j.emitter.on(ml,D=>{const L=k==="hash"?"#":"";let I="";ql(D)?I=f?`${b}${L}${A}/${D.id}`:`${b}${L}${S}/${D.id}`:I=`${b}${L}${A}/${D.id}`,window.open(I)}),j.emitter.on(fl,D=>{const I=`${b}${k==="hash"?"#":""}${C}`;window.open(I)}),j.emitter.on(hl,D=>O(this,null,function*(){if(d==="storage"||!f){D.value=!1,t.value=!0;return}l.value=!0,i.value=!0,s.value=[],a.value=null;const L=j.project.toDsl(),I=j.assets.componentMap,G=j.assets.packages;s.value=yield Lt({type:"projectCoder",data:{debug:_,project:L,assets:{componentMap:I,packages:G}}}).catch(B=>(a.value=B.data,console.log(B),[])),i.value=!1})),j.emitter.on(_l,D=>O(this,null,function*(){D.value=!0,yield Lt({type:"copyProject"}),D.value=!1,yield Wl(g),pe.success({message:"复制项目样例完成, 正在重置设置器"}),yield rt(2e3),location.reload()})),(D,L)=>(c(),V("div",Ci,[T("div",{ref_key:"container",ref:r,class:"container"},null,512),h(n(ne),{modelValue:t.value,"onUpdate:modelValue":L[0]||(L[0]=I=>t.value=I),title:"温馨提示",width:"500px",height:"180px"},{default:m(()=>[h(n(Be),{title:"当前设计器是非源码模式，不支持出码功能",type:"warning",closable:!1,description:"可以使用以下命令下载完整版本体验"}),h(n(Be),{class:"npm-command",closable:!1,type:"info",title:"npm create vtj@latest -- -t web"})]),_:1},8,["modelValue"]),h(n(ne),{modelValue:l.value,"onUpdate:modelValue":L[1]||(L[1]=I=>l.value=I),title:"出码结果",width:"800px",height:"400px"},{default:m(()=>[h(n(fs),{rows:3,animated:"",loading:i.value},{default:m(()=>[a.value?x("",!0):(c(),y(n(Be),{key:0,closable:!1,type:"success",title:`输出文件数: ${s.value.length}`},null,8,["title"])),T("div",Si,[(c(!0),V(M,null,F(s.value,I=>(c(),V("div",null,H(I),1))),256))]),a.value?(c(),V("div",wi,[h(n(Be),{closable:!1,type:"error",title:"出码失败",description:a.value.msg},null,8,["description"]),xi])):x("",!0)]),_:1},8,["loading"])]),_:1},8,["modelValue"])]))}});const zi=Gt(ji,[["__scopeId","data-v-09e1836c"]]);export{zi as default};
