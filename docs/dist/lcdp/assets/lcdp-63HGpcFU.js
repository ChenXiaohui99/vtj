import{c as Ne,d as ue,e as Ze,f as ra,g as ua,h as ca,i as Et,j as et,k as jt,l as ct,m as tt,n as at,b as Z,o as ve,p as da,q as ma,r as We,s as pa,t as va,u as ga,v as ht,w as ha,x as ft,y as fa,A as ba,z as ya,E as wa,B as At,C as ka,a as dt,D as _a,F as Dt,G as Sa,H as me,I as mt,J as xa,K as Va,L as Ca,M as Ea,N as ja}from"./element-plus-FZucZ7st.js";import{l as Aa,v as Da,a as Pa,e as Ra,i as Ba,b as za,M as Fa,$ as Ta,O as ge,W as Pt,r as Wa,F as Ia,g as Oa,N as La,H as Ma,x as Na,t as _e,S as Ja,C as Ua,c as Ha,E as $a,w as lt,d as de,f as D,j as qa,h as Rt,k as Bt,s as zt,I as L,K as H,L as Ft,n as q,P as Ga,y as nt,T as Qa,m as Za,o as Ka,A as Ya,p as Xa,V as st,B as el,q as tl,u as ot,z as De,G as al,R as ll,U as bt,X as nl,Y as sl,_ as Pe,Z as ol,a0 as yt,a1 as il,a2 as Tt,a3 as rl,a4 as He,a5 as Wt,a6 as It,a7 as ul,a8 as pt,a9 as Re,aa as Ot,ab as $e,ac as Lt,ad as Mt,ae as cl,af as Ve,ag as dl,ah as Je,ai as ml,aj as pl,ak as vl,al as wt,am as gl,an as hl,ao as fl,ap as bl,aq as Be,ar as yl,as as wl,at as kl,au as Nt,av as kt,aw as _l,ax as Sl,ay as xl,az as Jt,aA as Vl,aB as Cl,aC as El,aD as jl,aE as Ke,aF as Al,aG as Dl}from"./index-lZ_aECVi.js";import{_ as Pl}from"./monaco-editor-a3IpPo1Q.js";import{d as C,o as c,c as j,Z as O,j as S,_ as p,U as f,u as a,a as I,S as y,X as x,r as _,Y as $,F,a9 as T,m as it,f as ae,O as ee,P as Ie,aa as Oe,a5 as je,i as Ut,I as Ht,au as $t,aw as Rl,n as ke,bD as be,J as Ce,an as _t,V as Ae,$ as Ue,W as qt,Q as ce,a1 as ze,w as Gt,ab as Bl,M as pe,bB as rt,aU as zl,s as Le,G as Fl,ad as Qt,am as Zt,aD as Kt,ae as Tl}from"./@vue-lwVaHA3a.js";import{n as Yt,p as Wl}from"./@vueuse-PhcRqKe4.js";import{n as Il,D as Ol,P as Ll,k as Ml,M as Xt,E as vt}from"./@element-plus-NeE1p5Kv.js";const Wo="/vtj/",Io="LCDP",Oo="低代码开发平台";/**!
 * Copyright (c) 2024, VTJ.PRO All rights reserved.
 * @name @vtj/designer 
 * @author CHC chenhuachun1549@dingtalk.com 
 * @version 0.7.7
 * @license <a href="https://vtj.pro/license.html">MIT License</a>
 */const Nl="0.7.7",St={width:390,height:844},xt={width:1180,height:820},he=/^[A-Za-z_$][\w_-]*$/,Jl=["click","dblclick","mouseenter","mouseleave","mousedown","mouseup","mouseover","contextmenu"],Ul=["keydown","keyup","keypress"],Hl=["GET","POST","PUT","PATCH","DELETE","JSONP"],$l=["stop","prevent","capture","self","once","passive"];var re=(u=>(u.Block="block",u.Node="node",u))(re||{});const ea="data:image/png;base64,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",ql=["title","src"],Gl={key:1},Ql=C({name:"LogoWidget",inheritAttrs:!1,__name:"index",props:{icon:{default:ea},text:{default:"VTJ"},link:{}},setup(u){const e=u,t=()=>{e.link&&(location.href=e.link)};return(l,n)=>(c(),j("div",{class:"v-logo-widget",onClick:t},[e.icon?(c(),j("img",{key:0,title:e.text,class:"v-logo-widget__icon",src:e.icon},null,8,ql)):(c(),j("span",Gl,O(e.text),1))]))}}),Zl={class:"v-empty-widget"},Kl=C({name:"EmptyWidget",__name:"index",setup(u){return(e,t)=>(c(),j("div",Zl,"EmptyWidget"))}});function ta(){const u=le(),e=S(()=>u.project.value?.dependencies??[]);return{engine:u,dependencies:e}}function Se(u,e){const t=S(()=>oa.getWidgets(a(u),a(e)).filter(n=>!n.invisible)),l=_();return{widgets:t,widgetsRef:l}}function aa(){const u=le();return{span:S(()=>{const e=u.skeleton?.skeletonRef.leftWidth||400,t=Math.min(Math.floor((e-50)/120),24);return Math.floor(24/t)}),engine:u}}function Yl(){const u=le(),e=S(()=>u.project.value?.blocks??[]);return{engine:u,blocks:e}}const Xl=(u=[])=>u.map(e=>e.name);function en(){const u=le(),{components:e,groups:t,componentMap:l}=u.assets,n=ze({}),o=S(()=>{const b={};return t.value&&t.value.forEach(v=>{b[v.name]=v}),b}),i=S(()=>t.value?t.value.map(b=>({label:`${b.label} (${b.count})`,name:b.name,disabled:!b.children?.length})):[]),s=_(i.value[0]?.name),r=_(""),m=S(()=>o.value[s.value]);Gt(()=>{const b=i.value.reduce((v,g)=>(v[g.name]=Xl(o.value[g.name].children),v),{});Object.assign(n,b)});const d=S(()=>{const b=r.value.toLowerCase();return!b||!e?[]:e.filter(v=>v.name.toLowerCase().includes(b)||v.label?.toLowerCase().includes(b))});return{components:e,groups:t,componentMap:l,groupMap:o,tabs:i,model:n,currentTab:s,currentGroup:m,searchKey:r,searchResult:d}}function te(){const u=le(),e=S(()=>u.current.value),t=S(()=>u.context.value),l=S(()=>u.isEmptyCurrent.value);return{engine:u,current:e,isEmpty:l,context:t}}function tn(u,e){const t=le();t.simulator.init(u,e);const l=S(()=>t.simulator.designer.value),n=S(()=>Ye("hover",l.value?.hover.value)),o=S(()=>Ye("dropping",l.value?.dropping.value)),i=S(()=>Ye("selected",l.value?.selected.value));return{designer:l,dropping:o,hover:n,selected:i}}function an(u,e=!0){const{top:t,height:l,width:n,left:o}=u||{};if(l>100&&n>200)return"inner";let i,s;return s=t>30?"top":"bottom",i=e||o<300&&n<300?"left":"right",[i,s].join("-")}function ln(u){const{rect:e,type:t}=u,{left:l,width:n,top:o,height:i}=e,s={left:l,width:n,top:o,height:i};switch(t){case"left":s.left=0,s.width=0;break;case"right":s.left=s.left+s.width-4,s.width=0;break;case"bottom":s.top=s.top+s.height-4,s.height=0;break;case"top":s.height=0;break}return s}function Ye(u,e){if(!e)return null;const{left:t,top:l,width:n,height:o}=u==="dropping"?ln(e):e.rect,i={left:`${t}px`,top:`${l}px`,width:`${n}px`,height:`${o}px`,visibility:n||o?"visible":"hidden"};return{...e,style:i,position:an(e.rect,u!=="selected")}}function fe(){const u=le(),e=S(()=>u.simulator.designer.value),t=S(()=>e.value?.selected.value),l=S(()=>H(t.value?.model));return{engine:u,designer:e,selected:t,isSelectBlock:l}}function nn(u,e){const t=_(""),{selected:l,isSelectBlock:n}=fe(),o=S(()=>l.value?.model.id),i=S(()=>{const r=rt(u),m=rt(e),d=[];if(!r)return d;const b=m?.__contextRefs[o.value||""],v=m===b||n.value?[]:Object.keys(b?.context||{}).filter(P=>!["context","ref"].includes(P)).map(P=>`this.context.${P}`);v.length&&d.push({title:"上下文",items:v});const g=r.inject.map(P=>`this.${P.name}`);g.length&&d.push({title:"注入",items:g});const h=r.props.map(P=>typeof P=="string"?`this.$props.${P}`:`this.$props.${P.name}`);h.length&&d.push({title:"属性",items:h});const k=Object.keys(r.state).map(P=>`this.state.${P}`);k.length&&d.push({title:"状态",items:k});const w=Object.keys(r.computed).map(P=>`this.${P}.value`);w.length&&d.push({title:"计算属性",items:w});const E=Object.keys(r.methods).map(P=>`this.${P}`);E.length&&d.push({title:"方法",items:E});const V=Object.keys(r.dataSources).map(P=>`this.${P}`);V.length&&d.push({title:"数据源",items:V});const A=Object.keys(m?.$refs||{}).map(P=>`this.$refs.${P}`);return A.length&&d.push({title:"refs",items:A}),d}),s=S(()=>{if(!t.value)return i.value;const r=t.value.toLowerCase(),m=[];return i.value.forEach(d=>{const b=d.items.filter(v=>v.toLowerCase().includes(r));b.length&&m.push({title:d.title,items:b})}),m});return{keyword:t,options:i,searchResult:s}}const Te=[{name:"StringSetter",label:"文本"},{name:"ExpressionSetter",label:"表达式"}];function sn(u){const e=le(),t=S(()=>{const r=u.value?.model||null;return H(r)?null:r}),l=_();ae(t,async r=>{r?.from?l.value=await e.assets.getBlockMaterial(r.from)||void 0:l.value=void 0},{immediate:!0});const n=S(()=>t.value?[{name:"key",setters:Te,value:t.value.getPropValue("key")},{name:"ref",setters:Te,value:t.value.getPropValue("ref")},{name:"class",label:"class",setters:Te,value:t.value.getPropValue("class")},{name:"children",label:"文本",title:"如设置组件文本，将清空子组件",setters:Te,value:Array.isArray(t.value.children)?"":t.value.children}]:[]),o=S(()=>{if(!t.value)return[];const r=l.value||e.assets.componentMap.get(t.value.name);return r?(r.props||[]).map(m=>({...m,value:t.value?.getPropValue(m.name)??m.defaultValue})):[]}),i=r=>n.value.some(m=>m.name===r)||o.value.some(m=>m.name===r)||r==="style",s=S(()=>t.value?Object.keys(t.value.props).filter(r=>!i(r)).map(r=>({name:r,setters:"InputSetter",value:t.value?.getPropValue(r)})):[]);return{commonProps:n,componentProps:o,customProps:s,node:t,change:(r,m)=>{t.value&&(r==="children"?t.value.setChildren(m):t.value.setProp(r,m))},addCustom:r=>{r&&t.value?.setProp(r,"")},removeCustom:r=>{t.value?.removeProp(r)},isExist:i}}function K(u,e="提示"){return me.warning({title:e,message:u})}async function Ee(u){return await mt.confirm(u,"提示",{type:"warning"}).catch(()=>!1)}function se(u,e="success"){return dt({message:u,type:e})}function X(u,e,t=!1){let l=!0;try{u.type==="JSExpression"?Je(u,e,t,!0):bl(u,e,t,!0)}catch(n){l=!1,me.error({title:"代码错误",message:n.message})}return l}function la(){const u=le(),e=S(()=>u.simulator.designer.value),t=S(()=>u.current.value?u.history.value:null),l=S(()=>t.value?.items.length||0),n=()=>{e.value?.cleanHelper(),t.value?.forward()},o=()=>{t.value?.backward(),e.value?.cleanHelper()},i=m=>{e.value?.cleanHelper(),t.value?.load(m),se("已载入历史记录","success")},s=S(()=>l.value<=1?!0:(t.value?.index||-1)<=0),r=S(()=>l.value<=1?!0:(t.value?.index||-1)>=l.value-1);return{engine:u,history:t,total:l,forward:n,backward:o,load:i,forwardDisabled:s,backwardDisabled:r}}function qe(){const u=le(),e=S(()=>u.project.value);return{engine:u,project:e}}function on(u){const e=le(),t=S(()=>{const s=u.value?.model||null;return H(s)?null:s}),l=_();ae(t,async s=>{s?.from?l.value=await e.assets.getBlockMaterial(s.from)||void 0:l.value=void 0});const n=S(()=>{if(H(t.value))return[];const s=t.value?.events||{};return Jl.map(r=>({name:r,event:s[r]}))}),o=S(()=>{if(H(t.value))return[];const s=t.value?.events||{};return Ul.map(r=>({name:r,event:s[r]}))}),i=S(()=>{if(!t.value||H(t.value))return[];const s=t.value.events||{};return(l.value?.events||e.assets.componentMap.get(t.value.name)?.events||[]).map(r=>{const m=typeof r=="string"?r:r.name;return{name:m,event:s[m]}})});return{mouseEventList:n,keyboardEventList:o,componentEventList:i}}const rn=(u,e)=>new Jt({name:u,value:void 0,iterator:e}),un=(u="modelValue")=>new Jt({name:"vModel",value:void 0,arg:u});function cn(u){if(!u)return[];const{props:e=[],events:t=[]}=u;if(e.length&&t.length){const l=t.filter(n=>(typeof n=="string"?n:n.name).startsWith("update:")).map(n=>n=typeof n=="string"?n:n.name);return l.length?e.filter(n=>l.some(o=>o.includes(n.name))):[]}return[]}function dn(u){const e=le(),t=S(()=>{const b=u.value?.model||null;return H(b)?null:b}),l=b=>S(()=>t.value&&(t.value.directives||[]).find(v=>v.name===b)||rn(b)),n=()=>S(()=>{if(!t.value)return[];const b=e.assets.componentMap.get(t.value.name||"");return(b?cn(b):[]).map(v=>(t.value?.directives||[]).find(g=>g.name==="vModel"&&g.arg==v.name)||un(v.name))}),o=l("vIf"),i=l("vShow"),s=l("vBind"),r=l("vFor"),m=n(),d={vIf:o,vShow:i,vBind:s,vFor:r};return{engine:e,node:t,vIf:o,vShow:i,vBind:s,vFor:r,vModels:m,onValueChange:(b,v)=>{const g=d[b];t.value&&(v?(g.value.value=v,t.value.setDirective(g.value)):(g.value.value=void 0,t.value.removeDirective(g.value)))},onForChange:(b,v)=>{if(t.value){if(b==="value"){v?(r.value.value=v,t.value.setDirective(r.value)):t.value.removeDirective(r.value);return}(b==="item"||b==="index")&&(r.value.iterator={...r.value.iterator,[b]:v||void 0},t.value.setDirective(r.value))}},onModelChange:(b,v)=>{if(!t.value)return;const g=parseInt(b),h=m.value[g];h&&(v?(h.value=v,t.value.setDirective(h)):(h.value=void 0,t.value.removeDirective(h)))}}}function mn(){const{engine:u,project:e}=qe(),t=S(()=>e.value?.apis||[]);return{engine:u,project:e,apis:t}}const pn={class:"v-switcher-widget"},vn={key:1},gn=C({name:"SwitcherWidget",inheritAttrs:!1,__name:"index",emits:["click"],setup(u,{emit:e}){const t=e,{engine:l}=te(),n=S(()=>l.project.value?.name),o=S(()=>l.project.value?.currentFile?.title),i=()=>{t("click",l.project.value)};return(s,r)=>(c(),j("div",pn,[p(a(ue),{size:"small",round:"",onClick:i},{default:f(()=>[p(a(Wa),{class:"v-switcher-widget__back"}),I("span",null,O(n.value),1),o.value?(c(),y(a(Ne),{key:0,direction:"vertical"})):x("",!0),o.value?(c(),j("span",vn,O(o.value),1)):x("",!0)]),_:1})]))}}),hn={class:"v-toolbar-widget"},fn=C({name:"ToolbarWidget",inheritAttrs:!1,__name:"index",props:{preview:{type:Boolean}},setup(u,{expose:e}){const t=u,{forward:l,backward:n,forwardDisabled:o,backwardDisabled:i}=la(),s=_("pc");return e({mode:s}),(r,m)=>(c(),j("div",hn,[p(a(ra),{size:"small",modelValue:s.value,"onUpdate:modelValue":m[0]||(m[0]=d=>s.value=d)},{default:f(()=>[p(a(Ze),{label:"pc"},{default:f(()=>[p(a(Ia))]),_:1}),p(a(Ze),{label:"mobile"},{default:f(()=>[p(a(Oa))]),_:1}),p(a(Ze),{label:"pad"},{default:f(()=>[p(a(La))]),_:1})]),_:1},8,["modelValue"]),x("",!0),p(a(ua),null,{default:f(()=>[p(a(ue),{type:"default",size:"small",onClick:a(n),disabled:a(i)||!!t.preview},{default:f(()=>[p(a(Ma))]),_:1},8,["onClick","disabled"]),p(a(ue),{type:"default",size:"small",onClick:a(l),disabled:a(o)||!!t.preview},{default:f(()=>[p(a(Na))]),_:1},8,["onClick","disabled"])]),_:1})]))}}),bn={class:"v-actions-widget"},yn=I("span",null,"发布",-1),wn=C({name:"ActionsWidget",inheritAttrs:!1,__name:"index",props:{coder:{type:Boolean,default:!0}},setup(u){const{engine:e,designer:t}=fe(),l=_(!1),n=()=>{e.current.value?(l.value?e.skeleton?.getWidget("Previewer")?.widgetRef.refresh():(t.value?.setSelected(null),e.simulator.refresh()),se("刷新完成","success")):se("请先打开文件","warning")},o=async()=>{e.current.value?(l.value&&(e.skeleton?.closePreview(),l.value=!1,await Wt(1e3)),t.value?.setSelected(e.current.value)):se("请先打开文件","warning")},i=()=>{if(e.project.value)if(e.current.value){if(l.value){e.skeleton?.closePreview(),l.value=!1;return}e.skeleton?.openPreview(""),l.value=!0}else se("请先打开文件","warning")},s=()=>{const m=e.project.value;m&&(m.currentFile?m.publish(m.currentFile):se("请先打开文件","warning"))},r=m=>{const d=e.project.value;d&&(m==="current"?s():d.publish())};return(m,d)=>(c(),j("div",bn,[p(a(ca),{value:0,max:99,hidden:!0},{default:f(()=>[p(a(_e),{mode:"icon",icon:a(Ja),background:"hover"},null,8,["icon"])]),_:1}),p(a(Ne),{direction:"vertical"}),p(a(ue),{onClick:i,type:l.value?"warning":"default",size:"small",title:"预览"},{default:f(()=>[p(a(Ua))]),_:1},8,["type"]),p(a(ue),{onClick:n,type:"default",size:"small",title:"刷新"},{default:f(()=>[p(a(Ha))]),_:1}),p(a(ue),{type:"default",size:"small",title:"页面设置",onClick:o},{default:f(()=>[p(a($a))]),_:1}),p(a(Ne),{direction:"vertical"}),p(a(jt),{"split-button":"",type:"primary",size:"small",onClick:s,onCommand:r},{dropdown:f(()=>[p(a(Et),null,{default:f(()=>[p(a(et),{command:"current"},{default:f(()=>[$("发布页面")]),_:1}),p(a(et),{command:"project"},{default:f(()=>[$("整站发布")]),_:1})]),_:1})]),default:f(()=>[yn]),_:1})]))}}),kn={class:"v-icon-setter"},_n={class:"v-icon-setter__content"},Sn={class:"v-icon-setter__list"},na=C({name:"IconSetter",__name:"icon",props:{modelValue:{default:""},size:{default:"small"}},emits:["change","update:modelValue"],setup(u,{emit:e}){const t=u,l=e,n=_(!1),o=_(t.modelValue),i=_(""),s=S(()=>lt[t.modelValue]||t.modelValue),r=S(()=>{const g=Object.entries(lt);return i.value?g.filter(h=>h[0].toLowerCase().includes(i.value)):g}),m=g=>{o.value=g},d=()=>{l("change",o.value),l("update:modelValue",o.value),n.value=!1},b=()=>{o.value="",l("change",""),l("update:modelValue",""),n.value=!1},v=()=>{n.value=!0};return(g,h)=>(c(),j("div",kn,[p(a(ve),{size:t.size,readonly:"",placeholder:"请选择图标","model-value":t.modelValue,"suffix-icon":a(Ml),onFocus:v},{prepend:f(()=>[p(a(Re),{icon:s.value},null,8,["icon"])]),_:1},8,["size","model-value","suffix-icon"]),n.value?(c(),y(a(Be),{key:0,title:"图标选择器",width:"1000px",height:"600px",cancel:"",submit:"",clear:"",modelValue:n.value,"onUpdate:modelValue":h[1]||(h[1]=k=>n.value=k),onSubmit:d},{extra:f(()=>[p(a(ue),{size:"default",type:"warning",onClick:b},{default:f(()=>[$(" 清除绑定 ")]),_:1})]),default:f(()=>[I("div",_n,[p(a(ve),{size:t.size,"prefix-icon":a(Xt),clearable:"",modelValue:i.value,"onUpdate:modelValue":h[0]||(h[0]=k=>i.value=k),placeholder:"请输入查询关键字"},null,8,["size","prefix-icon","modelValue"]),I("div",Sn,[(c(!0),j(F,null,T(r.value,k=>(c(),y(a(Re),{icon:k[1],onClick:w=>m(k[0]),class:ee({"is-active":o.value===k[0]})},null,8,["icon","onClick","class"]))),256)),r.value.length===0?(c(),y(a(Z),{key:0})):x("",!0)])])]),_:1},8,["modelValue"])):x("",!0)]))}}),xn=C({name:"PageForm",__name:"form",props:{item:{},parentId:{}},setup(u){const e=u,{project:t}=qe(),l=S(()=>e.item?"编辑页面":"新增页面"),n=()=>({dir:!1,name:"",title:"",icon:"",mask:!0,hidden:!1,raw:!1}),o=_(e.item||n()),i=[{label:"页面",value:!1},{label:"目录",value:!0}],s=m=>{o.value&&(o.value.name=Lt(m))},r=async m=>t.value?.existPageName(m.name,[m.id])?(K("页面名称已存在，请更换"),!1):(e.item?t.value?.updatePage(m):t.value?.createPage(m,e.parentId),!0);return(m,d)=>(c(),y(a(de),{title:l.value,width:"800px",height:"500px","form-props":{tooltipMessage:!1},model:o.value,"submit-method":r},{default:f(()=>[p(a(D),{name:"dir",label:"类型",editor:"radio",options:i,props:{button:!0,size:"small"},disabled:!!e.item,required:""},null,8,["disabled"]),p(a(D),{name:"name",label:"名称",required:"",onChange:s,rules:{pattern:a(he),message:"名称格式不正确"}},null,8,["rules"]),p(a(D),{name:"title",label:"标题",required:""}),p(a(D),{name:"icon",label:"菜单图标",editor:"none"},{editor:f(()=>[p(na,{modelValue:o.value.icon,"onUpdate:modelValue":d[0]||(d[0]=b=>o.value.icon=b),size:"default"},null,8,["modelValue"])]),_:1}),p(a(D),{visible:{dir:!1},name:"mask",label:"包含母版",editor:"switch"}),p(a(D),{name:"hidden",label:"隐藏菜单",editor:"switch"}),p(a(D),{visible:{dir:!1},disabled:!!e.item,inline:"",name:"raw",label:"源码模式",editor:"switch",tip:"页面是非低代码开发，不能在线编辑"},null,8,["disabled"])]),_:1},8,["title","model"]))}}),Vt=C({name:"VIcon",__name:"Icon",props:{icon:{},label:{},active:{type:Boolean,default:!1},open:{type:Boolean,default:!1}},emits:["click"],setup(u,{emit:e}){const t=u,l=e,n=S(()=>({"is-active":t.active,"is-open":t.open})),o=()=>{l("click")};return(i,s)=>(c(),y(a(At),{effect:"dark",placement:"right",content:i.label,"show-after":600},{default:f(()=>[I("div",{class:ee(["v-apps-region__icon",n.value]),onClick:o},[(c(),y(qt(i.icon)))],2)]),_:1},8,["content"]))}}),M=C({name:"VPanel",__name:"panel",props:{title:{},subtitle:{},plus:{type:Boolean},back:{type:Boolean},remove:{type:Boolean},save:{type:Boolean},header:{type:Boolean,default:!0}},emits:["plus","back","remove","save"],setup(u,{emit:e}){const t=u,l=e,n=()=>{l("plus")},o=()=>{l("back")},i=()=>{l("remove")},s=()=>{l("save")},r=S(()=>t.header?{content:t.title,subtitle:t.subtitle,icon:t.back?Ol:void 0,onClickBack:t.back?o:void 0}:null);return(m,d)=>(c(),y(a(pt),{class:"v-panel",border:!1,header:r.value,fit:""},Bl({actions:f(()=>[t.plus?(c(),y(a(_e),{key:0,size:m.$attrs.size,mode:"icon",icon:a(It),background:"hover",title:"新增",onClick:n},null,8,["size","icon"])):x("",!0),t.remove?(c(),y(a(_e),{key:1,size:m.$attrs.size,mode:"icon",icon:a(Ll),background:"hover",title:"清除",onClick:i},null,8,["size","icon"])):x("",!0),t.save?(c(),y(a(_e),{key:2,size:m.$attrs.size,mode:"icon",icon:a(ul),background:"hover",title:"保存",onClick:s},null,8,["size","icon"])):x("",!0),pe(m.$slots,"actions")]),default:f(()=>[pe(m.$slots,"default")]),_:2},[m.$slots.footer?{name:"footer",fn:f(()=>[pe(m.$slots,"footer")]),key:"0"}:void 0]),1032,["header"]))}}),Vn={class:"v-tabs__header"},Cn={key:0,class:"v-tabs__actions"},Ge=C({__name:"tabs",props:{items:{default:()=>[]},menus:{},modelValue:{},stretch:{type:Boolean},checkable:{type:Boolean}},emits:["update:modelValue","command","remove"],setup(u,{emit:e}){const t=u,l=e,n=_((t.modelValue||t.items[0]?.name)??"");ae(n,()=>{l("update:modelValue",n.value)}),ae(()=>t.modelValue,s=>{n.value=s});const o=s=>{l("command",s)},i=s=>{l("remove",s)};return(s,r)=>(c(),y(a(pt),{class:"v-tabs",border:!1,fit:"",radius:!1},{header:f(()=>[I("div",Vn,[p(a(Rt),{class:"v-tabs__tabs",items:t.items,type:"card",modelValue:n.value,"onUpdate:modelValue":r[0]||(r[0]=m=>n.value=m),onTabRemove:i,stretch:t.stretch},null,8,["items","modelValue","stretch"]),t.menus&&t.menus.length?(c(),j("div",Cn,[t.menus&&t.menus.length?(c(),y(a(_e),{key:0,mode:"icon",size:"small",icon:a(vt),background:"hover",dropdown:{size:"small",placement:"bottom-end"},menus:t.menus,onCommand:o},{item:f(({item:m})=>[I("span",null,[t.checkable?(c(),y(a(Tt),{key:0,class:ee({"v-tabs__checked":!0,"is-checked":m.checked})},null,8,["class"])):x("",!0),$(" "+O(m.label),1)])]),_:1},8,["icon","menus"])):x("",!0)])):x("",!0)])]),default:f(()=>[pe(s.$slots,"default")]),_:3}))}}),En={key:2,class:"v-item__index"},jn={class:"v-item__content"},An={key:3,class:"v-item__subtitle"},Y=C({name:"VItem",__name:"item",props:{icon:{},index:{},tag:{},tagType:{},title:{},subtitle:{},actions:{default:()=>[]},background:{type:Boolean},border:{type:Boolean},switch:{type:Boolean},modelValue:{},active:{type:Boolean},hover:{type:Boolean},small:{type:Boolean}},emits:["click","action","update:modelValue","switch"],setup(u,{emit:e}){const t={add:{label:"创建",icon:It},copy:{label:"复制",icon:Nt},edit:{label:"编辑",icon:Ot},remove:{label:"删除",icon:He},lock:{label:"锁定",icon:Bt},unlock:{label:"解锁",icon:Vl},invisible:{label:"隐藏",icon:zt},visible:{label:"显示",icon:Cl},home:{label:"主页",icon:El}},l=u,n=e,o=_(!!l.modelValue),i=S(()=>l.actions.map(d=>{const b=t[d];return{name:d,...b}})),s=S(()=>({"is-background":l.background,"is-border":l.border,"is-active":l.active,"is-hover":l.hover,"is-small":l.small})),r=()=>{n("click",l.modelValue)},m=async d=>{d==="remove"?await mt.confirm("确定删除吗？","提示",{type:"warning"}).catch(()=>!1)&&n("action",{name:d,modelValue:l.modelValue}):n("action",{name:d,modelValue:l.modelValue})};return ae(o,d=>{n("update:modelValue",d),n("switch",d)}),ae(()=>l.modelValue,d=>{o.value=!!d}),(d,b)=>(c(),y(a(L),{class:ee(["v-item",s.value]),justify:"space-between",align:"center",onClick:r},{default:f(()=>[p(a(L),{class:"v-item__title",align:"center"},{default:f(()=>[pe(d.$slots,"default",{},()=>[d.icon?(c(),y(a(Re),{key:0,icon:d.icon},null,8,["icon"])):x("",!0),l.tag?(c(),y(a(_a),{key:1,class:"v-item__tag",size:"small",type:l.tagType},{default:f(()=>[$(O(l.tag),1)]),_:1},8,["type"])):x("",!0),d.index!==void 0?(c(),j("span",En," # "+O(d.index),1)):x("",!0),I("span",jn,O(d.title),1),d.subtitle?(c(),j("span",An,O(d.subtitle),1)):x("",!0)])]),_:3}),p(a(L),{class:"v-item__actions",onClick:b[1]||(b[1]=je(()=>{},["stop"]))},{default:f(()=>[(c(!0),j(F,null,T(i.value,v=>(c(),y(a(_e),{name:v.name,title:v.label,mode:"icon",size:"small",background:"none",type:"info",icon:v.icon,onClick:g=>m(v.name)},null,8,["name","title","icon","onClick"]))),256)),l.switch?(c(),y(a(Dt),{key:0,modelValue:o.value,"onUpdate:modelValue":b[0]||(b[0]=v=>o.value=v),class:"v-item__switch",size:"small"},null,8,["modelValue"])):x("",!0),pe(d.$slots,"status")]),_:3})]),_:3},8,["class"]))}}),Dn=["draggable"],Pn={class:"v-box__name"},Rn={class:"v-box__label"},ut=C({name:"VBox",__name:"box",props:{name:{},title:{},editable:{type:Boolean},active:{type:Boolean},draggable:{type:Boolean}},emits:["edit","remove","dragstart","dragend"],setup(u,{emit:e}){const t=u,l=e,n=()=>{l("edit")},o=async()=>{await mt.confirm("确认删除？","提示",{type:"warning"}).catch(()=>!1)&&l("remove")},i=S(()=>({"is-active":t.active,"is-draggable":t.draggable})),s=()=>{l("dragstart",t)},r=()=>{l("dragend",t)};return(m,d)=>(c(),j("div",{class:ee(["v-box",i.value]),draggable:m.draggable,onDragstart:s,onDragend:r},[p(a(L),{direction:"column",justify:"center",align:"center"},{default:f(()=>[I("span",Pn,O(t.name),1),I("span",Rn,O(t.title),1)]),_:1}),t.editable?(c(),y(a(L),{key:0,class:"v-box__footer",justify:"flex-end",align:"center"},{default:f(()=>[p(a(Re),{icon:a(Ot),onClick:n},null,8,["icon"]),p(a(Re),{icon:a(He),onClick:o},null,8,["icon"])]),_:1})):x("",!0)],42,Dn))}}),Bn={class:"v-context-viewer"},zn=C({__name:"viewer",props:{context:{}},emits:["pick","copy"],setup(u,{emit:e}){const t=u,l=e,n=["$provider","$apis","$components","context"],o=d=>{const b=d.value,v=Ke(b);return v==="Object"||v==="Module"?Object.keys(b||{}).length===0:v==="Array"?b.length===0:!0},i=(d,b="this")=>typeof d=="object"?Array.isArray(d)?d.map((v,g)=>{const h=`[${g}]`;return{label:h,value:v,type:Ke(v),path:`${b}${h}`}}):Object.entries(d).map(([v,g])=>({label:v,value:g,type:Ke(g),path:`${b}.${v}`})).filter(v=>!v.label.startsWith("__")&&!n.includes(v.label)):[],s=(d,b)=>{if(d.level===0)b(i(t.context));else{const v=Tl(d.data.value);b(i(v,d.data.path))}},r=d=>{l("copy",d.path)},m=d=>{l("pick",d.path)};return(d,b)=>(c(),j("div",Bn,[d.context?(c(),y(a(ct),{key:0,lazy:"",load:s,"expand-on-click-node":!1,props:{isLeaf:o}},{default:f(({data:v})=>[p(Y,{title:v.label,clickable:"",onClick:g=>m(v),background:"",actions:["copy"],onAction:g=>r(v),grow:"",small:""},null,8,["title","onClick","onAction"])]),_:1},8,["props"])):x("",!0)]))}}),gt=C({__name:"binder",props:{title:{},context:{},block:{},model:{},rules:{},modelValue:{type:Boolean},submitMethod:{type:Function},unbindEnabled:{type:Boolean}},emits:["unbind","submit","cancel","pick","update:modelValue","close"],setup(u,{emit:e}){const t=u,l=e,{searchResult:n,keyword:o}=nn(t.block,t.context),{copy:i}=Wl({}),s=[{name:"normal",label:"常用"},{name:"viewer",label:"高级"}],r=_("normal"),m=_(),d=async E=>{l("submit",E),t.submitMethod?await t.submitMethod(E)&&b():b()},b=()=>{l("update:modelValue",!1),l("close")},v=()=>{l("unbind")},g=()=>{b()},h=async()=>{m.value?.submit()},k=E=>{l("pick",E)},w=E=>{i(E),dt.success({message:"已经复制到粘贴板"})};return(E,V)=>(c(),y(a(Be),{"model-value":t.modelValue,class:"v-binder",title:E.title,width:"1000px",height:"600px","body-padding":!1,maximizable:!1,minimizable:!1,onClose:b},{default:f(()=>[p(a(L),{fit:"",direction:"row",overflow:"hidden"},{default:f(()=>[p(a(L),{width:"30%",height:"100%"},{default:f(()=>[p(Ge,{class:"v-binder__tabs",items:s,modelValue:r.value,"onUpdate:modelValue":V[1]||(V[1]=A=>r.value=A)},{default:f(()=>[p(a(L),{class:"v-binder__tab-content",fit:"",padding:"",flex:!1},{default:f(()=>[Ae(I("div",null,[p(a(ve),{modelValue:a(o),"onUpdate:modelValue":V[0]||(V[0]=A=>it(o)?o.value=A:null),size:"small",clearable:"","prefix-icon":a(Xt),placeholder:"筛选可用项"},null,8,["modelValue","prefix-icon"]),(c(!0),j(F,null,T(a(n),A=>(c(),j("div",null,[p(a(Ne),{"border-style":"dotted"},{default:f(()=>[$(O(A.title),1)]),_:2},1024),(c(!0),j(F,null,T(A.items,P=>(c(),y(Y,{title:P,background:"",actions:["copy"],small:"",onClick:R=>k(P),onAction:R=>w(P)},null,8,["title","onClick","onAction"]))),256))]))),256)),a(n).length?x("",!0):(c(),y(a(Z),{key:0}))],512),[[Ue,r.value==="normal"]]),Ae(p(zn,{context:t.context,onCopy:w,onPick:k},null,8,["context"]),[[Ue,r.value==="viewer"]])]),_:1})]),_:1},8,["modelValue"])]),_:1}),p(a(pt),{grow:"",header:null,border:!1},{footer:f(()=>[p(a(L),{justify:"space-between"},{default:f(()=>[p(a(L),null,{default:f(()=>[E.unbindEnabled?(c(),y(a(ue),{key:0,type:"warning",size:"default",onClick:v},{default:f(()=>[$(" 移除绑定 ")]),_:1})):x("",!0)]),_:1}),p(a(L),null,{default:f(()=>[p(a(ue),{type:"default",size:"default",onClick:g},{default:f(()=>[$(" 取消 ")]),_:1}),p(a(ue),{type:"primary",size:"default",onClick:h},{default:f(()=>[$(" 确定 ")]),_:1})]),_:1})]),_:1})]),default:f(()=>[p(a(yl),{ref_key:"formRef",ref:m,class:"v-binder__form",footer:!1,"label-position":"top","tooltip-message":!1,model:t.model,rules:t.rules,"submit-method":d},{default:f(()=>[pe(E.$slots,"default")]),_:3},8,["model","rules"])]),_:3})]),_:3})]),_:3},8,["model-value","title"]))}}),Fn={class:"v-slots-picker__sn"},Tn=C({__name:"slots",props:{slots:{default:()=>[]}},emits:["submit","update:modelValue"],setup(u,{emit:e}){const t=u,l=e,n=_(),o=S(()=>`${50*Math.ceil(t.slots.length/4)+180}px`),i=r=>{n.value=r},s=()=>{n.value?(l("submit",n.value),l("update:modelValue",!1)):K("请选择插槽")};return(r,m)=>(c(),y(a(Be),ce({class:"v-slots-picker",title:"选择插槽",width:"600px",height:o.value,submit:"",cancel:"",onSubmit:s},r.$attrs),{default:f(()=>[p(a(ja),{title:"该组件支持多个插槽，请选择放置到其中一个",type:"warning",closable:!1}),p(a(L),{class:"v-slots-picker__content",justify:"space-around",alignContent:"flex-start",gap:"",wrap:"wrap"},{default:f(()=>[(c(!0),j(F,null,T(t.slots,(d,b)=>(c(),y(a(L),{class:ee(["v-slots-picker__item",{"is-active":d.name===n.value?.name}]),grow:"",flex:!1,onClick:v=>i(d)},{default:f(()=>[I("span",Fn,"#"+O(b+1),1),$(" "+O(d.name),1)]),_:2},1032,["class","onClick"]))),256))]),_:1})]),_:1},16,["height"]))}}),sa=C({name:"Viewport",__name:"viewport",props:{mode:{default:"pc"},width:{},height:{}},setup(u){const e=u,t=S(()=>[`is-${e.mode}`]),l=S(()=>{if(e.mode==="pc")return 1;const o=e.mode==="mobile"?St:xt,{width:i,height:s}=o,r=i>0?(e.width||0)/i:1,m=s>0?(e.height||0)/s:1;return Math.min(r,m)}),n=S(()=>{if(e.mode==="pc")return{};const o=e.mode==="mobile"?St:xt,{width:i,height:s}=o;return{width:`${i}px`,height:`${s}px`,left:"50%",top:"50%",transform:`translate(-50%, -50%) scale(${l.value})`}});return(o,i)=>(c(),j("div",{class:ee(["v-viewport",t.value]),style:Ie(n.value)},[pe(o.$slots,"default")],6))}}),Wn=C({name:"PagesWidget",__name:"index",setup(u){const{project:e,engine:t}=qe(),l=S(()=>e.value?.pages||[]),{current:n}=te(),o=_(!1),i=_(),s=_(),r=()=>{s.value=void 0,i.value=void 0,o.value=!0},m=async g=>{const{name:h,modelValue:k}=g,{data:w,node:E}=k;if(h==="add"&&(i.value=void 0,s.value=w.id,o.value=!0),h==="edit"&&(i.value=$e(w),s.value=void 0,o.value=!0),h==="remove"){if(w.dir){const V=e.value?.getPage(w.id);if(V&&V.children?.length){K("请先删除子页面");return}}e.value?.removePage(w.id)}if(h==="copy"){const V=E.parent?.data.id;e.value?.clonePage(w,V)}h==="home"&&(e.value?.setHomepage(w.id),se("设置主页成功","success"))},d=async g=>{g.raw&&se("这是源码模式页面，不能低代码设计","warning"),g.dir||g.raw?t.project.value?.deactivate():t.project.value?.active(g)},b=(g,h,k)=>k==="inner"?!!h.data.dir:!0,v=()=>{e.value?.update({pages:rt(l)})};return(g,h)=>(c(),y(a(M),{class:"v-pages-widget",title:"页面管理",plus:"",subtitle:"(共 0 条)",onPlus:r},{default:f(()=>[p(a(ct),{data:l.value,"node-key":"id","default-expand-all":"",draggable:"","allow-drop":b,onNodeDrop:v},{default:f(({data:k,node:w})=>[p(a(Y),{class:"v-pages-widget__item",icon:a(lt)[k.icon],title:k.title,subtitle:k.name,"model-value":{data:k,node:w},actions:k.dir?["add","edit","remove"]:k.raw?["home","edit","remove"]:["home","copy","edit","remove"],onAction:m,onClick:E=>d(k),active:a(n)?.id===k.id,tag:a(e)?.homepage===k.id?"主页":void 0,"tag-type":"success",grow:"",small:"",background:"",hover:""},null,8,["icon","title","subtitle","model-value","actions","onClick","active","tag"])]),_:1},8,["data"]),o.value?(c(),y(xn,{key:0,modelValue:o.value,"onUpdate:modelValue":h[0]||(h[0]=k=>o.value=k),item:i.value,"parent-id":s.value},null,8,["modelValue","item","parent-id"])):x("",!0)]),_:1}))}}),In=C({name:"BlocksWidget",__name:"index",setup(u){const{span:e}=aa(),{blocks:t,engine:l}=Yl(),n=_(void 0),{current:o}=te(),i=_(!1),s=S(()=>n.value?.id?"编辑":"新增"),r=S(()=>`(共 ${t.value.length} 个)`),m=()=>({name:"",title:"",type:"block"}),d=async V=>{const A=V,P=l.project.value;if(!P)return!1;if(V.id)if(!P.existBlockName(A.name,[A.id]))P.updateBlock(A);else return K(`名称【${A.name}】已经存在，请更换名称`),!1;else if(!P.existBlockName(A.name))P.createBlock(A);else return K(`名称【${A.name}】已经存在，请更换名称`),!1;return!0},b=()=>{n.value=m(),i.value=!0},v=V=>{n.value=$e(V),i.value=!0},g=V=>{l.project.value?.removeBlock(V.id)},h=V=>{n.value&&(n.value.name=Lt(V))},k=async V=>{l.project.value?.active(V)},w=async V=>{const A={type:"Schema",id:V.id},P=await l.assets.getBlockMaterial(A),R=l.skeleton?.getWidget("Designer")?.widgetRef?.designer;R&&P&&R.setDragging(P)},E=()=>{const V=l.skeleton?.getWidget("Designer")?.widgetRef?.designer;V&&V.setDragging(null)};return(V,A)=>(c(),y(a(M),{class:"v-blocks-widget",title:"区块管理",subtitle:r.value,plus:"",onPlus:b},{default:f(()=>[p(a(tt),{wrap:"wrap",gutter:5},{default:f(()=>[(c(!0),j(F,null,T(a(t),P=>(c(),y(a(at),{key:P.id,span:a(e)},{default:f(()=>[p(a(ut),{name:P.name,title:P.title,active:a(o)?.id===P.id,editable:"",onEdit:R=>v(P),onRemove:R=>g(P),onClick:R=>k(P),draggable:a(o)?.id!==P.id,onDragstart:R=>w(P),onDragend:E},null,8,["name","title","active","onEdit","onRemove","onClick","draggable","onDragstart"])]),_:2},1032,["span"]))),128))]),_:1}),a(t).length?x("",!0):(c(),y(a(Z),{key:0})),p(a(de),{modelValue:i.value,"onUpdate:modelValue":A[0]||(A[0]=P=>i.value=P),title:s.value,model:n.value,width:"600px",height:"250px","form-props":{tooltipMessage:!1},"submit-method":d},{default:f(()=>[p(a(D),{name:"name",label:"名称",required:"",tip:"名称为英文驼峰格式",rules:{message:"名称格式错误",pattern:a(he)},onChange:h},null,8,["rules"]),p(a(D),{name:"title",label:"标题",required:""})]),_:1},8,["modelValue","title","model"])]),_:1},8,["subtitle"]))}}),On={class:"v-components-widget__search"},Ln={key:0,class:"v-components-widget__result"},Mn={class:"v-components-widget__list"},Nn=C({name:"ComponentsWidget",__name:"index",setup(u){const{span:e,engine:t}=aa(),{tabs:l,currentTab:n,currentGroup:o,model:i,searchKey:s,searchResult:r}=en(),m=b=>{const v=t.skeleton?.getWidget("Designer")?.widgetRef?.designer;v&&v.setDragging(b)},d=()=>{const b=t.skeleton?.getWidget("Designer")?.widgetRef?.designer;b&&b.setDragging(null)};return(b,v)=>(c(),y(a(M),{class:"v-components-widget",title:"组件库",body:{flex:!0,direction:"column"}},{default:f(()=>[I("div",On,[p(a(ve),{modelValue:a(s),"onUpdate:modelValue":v[0]||(v[0]=g=>it(s)?s.value=g:null),placeholder:"搜索组件",clearable:"",size:"small"},{prefix:f(()=>[p(a(qa))]),_:1},8,["modelValue"])]),a(s)?(c(),j("div",Ln,[p(a(tt),{wrap:"wrap",gutter:5},{default:f(()=>[(c(!0),j(F,null,T(a(r),g=>(c(),y(a(at),{span:a(e),key:g.name},{default:f(()=>[p(a(ut),{name:g.name,title:g.label||g.name,draggable:"",onDragstart:h=>m(g),onDragend:d},null,8,["name","title","onDragstart"])]),_:2},1032,["span"]))),128))]),_:1}),a(r).length?x("",!0):(c(),y(a(Z),{key:0}))])):(c(),y(a(Rt),{key:1,items:a(l),modelValue:a(n),"onUpdate:modelValue":v[2]||(v[2]=g=>it(n)?n.value=g:null)},{default:f(()=>[I("div",Mn,[a(o)?(c(),y(a(da),{key:0,modelValue:a(i)[a(n)],"onUpdate:modelValue":v[1]||(v[1]=g=>a(i)[a(n)]=g)},{default:f(()=>[(c(!0),j(F,null,T(a(o).children,g=>(c(),y(a(ma),{key:g.name,name:g.name,title:`${g.label} (${g.count})`},{default:f(()=>[g.components?(c(),y(a(tt),{key:0,wrap:"wrap",gutter:5},{default:f(()=>[(c(!0),j(F,null,T(g.components,h=>(c(),y(a(at),{span:a(e),key:h.name},{default:f(()=>[p(a(ut),{name:h.name,title:h.label||h.name,draggable:"",onDragstart:k=>m(h),onDragend:d},null,8,["name","title","onDragstart"])]),_:2},1032,["span"]))),128))]),_:2},1024)):x("",!0)]),_:2},1032,["name","title"]))),128))]),_:1},8,["modelValue"])):x("",!0)])]),_:1},8,["items","modelValue"]))]),_:1}))}}),Jn=C({name:"OutlineWidget",__name:"index",setup(u){const{engine:e,designer:t,selected:l}=fe(),{current:n}=te(),o=_([]),i=R=>{if(H(R))return R.locked?["unlock"]:["lock"];const W=R.parent;return W&&(W.locked||W.invisible)?[]:n.value?.locked?[]:R.locked?["unlock"]:R.invisible?["visible"]:["lock","invisible","copy","remove"]},s=R=>{const W=[];return R.forEach(B=>{const G={id:B.id,label:B.name,type:B.id,model:B};Array.isArray(B.children)&&(G.children=s(B.children)),W.push(G)}),W},r=()=>{if(!n.value)return[];const{id:R,name:W,nodes:B}=n.value;return[{id:R,label:W,type:R,model:n.value,children:s(B)}]},m=async()=>{o.value=r(),l.value?.model&&(await ke(),t.value?.setSelected(l.value.model))},d=S(()=>l.value?.model.id),b=R=>{const W=R.data;if(H(W.model)||W.model.locked||W.model.name==="template")return!1;const B=e.assets.componentMap.get(W.model.name);return B?(t.value?.setDragging(B),!0):!1},v=async(R,W,B)=>{const G=W.data,ie={prev:"top",next:"bottom",inner:"inner"}[B];let oe=!1;if(H(G.model))oe=B==="inner",t.value?.setDropping(oe?G.model:null,"inner");else{const N=G.model;oe=!!await t.value?.allowDrop(N,ie),t.value?.setDropping(oe?N:null,"inner")}return oe},g=R=>{const W=R?.model;!W||W.invisible||(t.value?.setSelected(W),t.value?.setHover(null))},h=async(R,W,B)=>{const G=R.data,ie=W.data;if(H(ie.model)){t.value?.setDropping(null),t.value?.setDragging(null);return}const oe=ie.model,N={before:"left",after:"right"}[B]||"inner";if(!await t.value?.allowDrop(oe,N)){t.value?.setDropping(null),m(),dt.warning({message:`${G.model.name}不能放置到该位置`}),t.value?.setDragging(null);return}const U=await t.value?.getDropSlot(B==="inner"?oe:oe.parent);if(U!==null){const z=G.model;z.slot=U,n.value?.move(z,oe,N)}else m();t.value?.setDropping(null),t.value?.setDragging(null),e.simulator.refresh()},k=R=>{H(R.model)?t.value?.setHover(R.model):(t.value?.setHover(R.model),R.model.invisible&&t.value?.setHover(null),R.model.name==="slot"&&t.value?.setHover(null))},w=()=>{t.value?.setHover(null)},E=R=>{const W=R.data;W.dragging=!0;const B=e.assets.componentMap.get(W.model.name);B&&t.value?.setDragging(B)},V=async R=>{const W=R.data;W.dragging=!1},A=(R,W)=>{R&&((R.id===W.id||!H(R)&&W.isChild(R))&&t.value?.setSelected(null),t.value?.setHover(null))},P=R=>{const{name:W,modelValue:B}=R,G=l.value?.model;switch(W){case"lock":A(G,B),B.lock();break;case"unlock":A(G,B),B.unlock();break;case"invisible":A(G,B),B.setVisible(!1);break;case"visible":B.setVisible(!0);break;case"copy":const ie=n.value?.cloneNode(B);ie&&t.value?.setSelected(ie);break;case"remove":A(G,B),n.value?.removeNode(B);break}};return ae(e.changed,m,{immediate:!0}),(R,W)=>(c(),y(a(M),{class:"v-outline-widget",title:"大纲树"},{default:f(()=>[(c(),y(a(ct),{key:a(e).changed.value,data:o.value,"node-key":"id","default-expand-all":"",draggable:"","empty-text":"请新建或打开文件","current-node-key":d.value,"highlight-current":!0,"expand-on-click-node":!1,"allow-drop":v,"allow-drag":b,onCurrentChange:g,onNodeDrop:h,onNodeDragStart:E,onNodeDragEnd:V},{default:f(({data:B,node:G})=>[p(a(Y),{class:ee(["v-outline-widget__item",{"is-locked":B.model.locked,"is-invisible":B.model.invisible,"is-dragging":B.dragging}]),active:!B.model.invisible&&G.isCurrent,grow:"",small:"",background:"",hover:"","model-value":B.model,icon:B.model.locked?a(Bt):B.model.invisible?a(zt):void 0,title:B.label,subtitle:B.type,actions:i(B.model),onAction:P,onMouseenter:ie=>k(B),onMouseleave:w},null,8,["class","active","model-value","icon","title","subtitle","actions","onMouseenter"])]),_:1},8,["data","current-node-key"]))]),_:1}))}}),Un=C({name:"HistoryWidget",__name:"index",setup(u){const{history:e,load:t,total:l}=la(),n=S(()=>`(共 ${l.value} 条)`),o=s=>{s.name==="remove"&&e.value?.remove(s.modelValue.id)},i=async()=>{await Ee("确定要清空历史记录吗？")&&e.value?.clear()};return(s,r)=>(c(),y(a(M),{class:"v-history-widget",title:"历史记录",subtitle:n.value,remove:!!a(l),onRemove:i},{default:f(()=>[a(l)===0?(c(),y(a(Z),{key:0,"image-size":50})):x("",!0),a(e)?(c(!0),j(F,{key:1},T(a(e).items,(m,d)=>(c(),y(a(Y),{index:d+1,title:m.label,"model-value":m,active:d==a(e).index,small:"",background:"",actions:["remove"],onAction:o,onClick:b=>a(t)(m.id)},null,8,["index","title","model-value","active","onClick"]))),256)):x("",!0)]),_:1},8,["subtitle","remove"]))}}),Q=zl({loader:()=>Pl(()=>import("./Editor-ctkAn2cu-j1FUryYs.js"),__vite__mapDeps([0,1,2,3]),import.meta.url),loadingComponent:C({render(){return Ce("div","正在拼命加载...")}}),errorComponent:C({render(){return Ce("div","组件加载失败！")}})}),Hn=C({name:"ApisWidget",__name:"index",setup(u){const e=_(!1),t=_(null),l=_(!1),n=S(()=>l.value?"编辑API":"新增API"),o=S(()=>i.value?.apis||[]),{project:i}=qe(),s=()=>({method:"get",name:"",label:"",url:"",settings:{loading:!0,failMessage:!0,validSuccess:!0,originResponse:!1,injectHeaders:!1,type:"form",headers:{type:"JSExpression",value:"({})"}}}),r=()=>{e.value=!0,l.value=!1,t.value=s()},m=Hl.map(w=>({label:w,value:w.toLowerCase()})),d={get:"success",post:"primary",put:"warning",delete:"danger",patch:"warning",jsonp:"info"},b=[{label:"表单",value:"form"},{label:"JSON",value:"json"},{label:"文件",value:"data"}],v=(w,E,V)=>{X({type:"JSExpression",value:E},window)?V():V(new Error("代码错误"))},g=w=>{w.name==="edit"&&h(w.modelValue),w.name==="remove"&&i.value?.removeApi(w.modelValue.name)},h=w=>{l.value=!0,t.value=$e(w),e.value=!0},k=async w=>i.value?.existApiName(w.name,l.value?[w.id]:[])?(K(`API名称 [ ${w.name} ] 已存在`),!1):(i.value?.setApi(w),!0);return(w,E)=>(c(),y(a(M),{class:"v-apis-widget",title:"API管理",plus:"",onPlus:r},{default:f(()=>[(c(!0),j(F,null,T(o.value,V=>(c(),y(a(Y),{key:V.id,small:"",title:V.name,subtitle:V.label,"model-value":V,tag:V.method?.toUpperCase(),"tag-type":d[V.method||"get"],background:"",actions:["edit","remove"],onClick:A=>h(V),onAction:g},null,8,["title","subtitle","model-value","tag","tag-type","onClick"]))),128)),o.value.length===0?(c(),y(a(Z),{key:0,"image-size":50})):x("",!0),p(a(de),{modelValue:e.value,"onUpdate:modelValue":E[1]||(E[1]=V=>e.value=V),model:t.value,title:n.value,width:"1000px",height:"600px","form-props":{labelPosition:"top",tooltipMessage:!1,size:"default"},"submit-method":k},{default:f(()=>[p(a(L),{gap:"",fit:""},{default:f(()=>[p(a(L),{direction:"column",grow:"",width:"50%",shrink:""},{default:f(()=>[p(a(D),{name:"method",label:"请求类型",required:"",editor:"radio",options:a(m),props:{button:!0}},null,8,["options"]),p(a(D),{name:"name",label:"接口名称",required:"",rules:{pattern:a(he),message:"名称格式不正确"}},null,8,["rules"]),p(a(D),{name:"label",label:"备注说明",required:""}),p(a(D),{name:"url",label:"接口URL",required:""})]),_:1}),p(a(L),{direction:"column",grow:"",width:"50%",shrink:""},{default:f(()=>[t.value.method!=="jsonp"?(c(),y(a(M),{key:0,title:"请求配置",subtitle:t.value.method,border:""},{default:f(()=>[p(a(L),{justify:"space-around"},{default:f(()=>[p(a(D),{name:"settings.loading",size:"small",label:"加载提示",editor:"switch"}),p(a(D),{size:"small",name:"settings.failMessage",label:"失败提示",editor:"switch"}),p(a(D),{size:"small",name:"settings.validSuccess",label:"校验成功",editor:"switch"}),p(a(D),{size:"small",name:"settings.originResponse",label:"原始响应",editor:"switch"}),p(a(D),{size:"small",name:"settings.injectHeaders",label:"注入请求头",editor:"switch"})]),_:1}),p(a(D),{size:"small",name:"settings.type",label:"发送数据类型",editor:"radio",options:b,props:{button:!0}}),p(a(D),{size:"small",name:"settings.headers.value",label:"请求头配置",tip:"支持 JSExpression 或 JSFunction",rules:{validator:v}},{editor:f(()=>[p(a(Q),{modelValue:t.value.settings.headers.value,"onUpdate:modelValue":E[0]||(E[0]=V=>t.value.settings.headers.value=V),dark:"",height:"200px"},null,8,["modelValue"])]),_:1},8,["rules"])]),_:1},8,["subtitle"])):x("",!0),t.value.method==="jsonp"?(c(),y(a(M),{key:1,title:"请求配置",subtitle:t.value.method,border:""},{default:f(()=>[p(a(D),{name:"jsonpOptions.jsonpCallback",size:"small",label:"jsonpCallback"}),p(a(D),{name:"jsonpOptions.jsonpCallbackFunction",size:"small",label:"jsonpCallbackFunction"}),p(a(D),{name:"jsonpOptions.timeout",size:"small",label:"timeout",editor:"number"}),p(a(D),{name:"jsonpOptions.crossorigin",size:"small",label:"crossorigin",editor:"switch"})]),_:1},8,["subtitle"])):x("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue","model","title"])]),_:1}))}}),$n=C({name:"DepsWidget",__name:"index",setup(u){const{dependencies:e,engine:t}=ta(),l=_(!1),n=_(!1),o=_({}),i=S(()=>n.value?"查看依赖":o.value?"编辑依赖":"新增依赖"),s=h=>h.required||h.official?[]:["edit","remove"],r=h=>h.official&&!h.required,m=async h=>(h.urls=h.urls.split(`
`),t.project.value?.setDeps(h),!0),d=h=>{t.project.value?.setDeps(h)},b=()=>{n.value=!1,l.value=!0,o.value=null},v=h=>{n.value=!0,o.value={...h,urls:h.urls.join(`
`)},l.value=!0},g=(h,k)=>{k.name==="edit"&&(o.value={...h,urls:h.urls.join(`
`)},n.value=!1,l.value=!0),k.name==="remove"&&t.project.value?.removeDeps(h)};return(h,k)=>(c(),y(a(M),{class:"v-deps-widget",title:"依赖管理",plus:"",onPlus:b},{default:f(()=>[(c(!0),j(F,null,T(a(e),w=>(c(),y(a(Y),{key:w.package,title:w.package,subtitle:w.version,actions:s(w),background:"",switch:r(w),modelValue:w.enabled,"onUpdate:modelValue":E=>w.enabled=E,onSwitch:E=>d(w),onClick:E=>v(w),onAction:E=>g(w,E)},null,8,["title","subtitle","actions","switch","modelValue","onUpdate:modelValue","onSwitch","onClick","onAction"]))),128)),p(a(de),{modelValue:l.value,"onUpdate:modelValue":k[0]||(k[0]=w=>l.value=w),width:"600px",height:"500px",title:i.value,model:o.value,submitMethod:m,formProps:{disabled:n.value,tooltipMessage:!1}},{default:f(()=>[p(a(D),{name:"package",label:"包名",required:"",disabled:!!o.value},null,8,["disabled"]),p(a(D),{name:"version",label:"版本",required:""}),p(a(D),{name:"library",label:"导出名称",required:""}),p(a(D),{name:"urls",label:"资源文件",editor:"textarea",props:{rows:3},tip:"多个资源可以换行输入",required:""}),p(a(D),{name:"assetsUrl",label:"物料URL"}),p(a(D),{name:"assetsLibrary",label:"物料名称"})]),_:1},8,["modelValue","title","model","formProps"])]),_:1}))}}),qn=C({__name:"actions",props:{position:{},model:{},path:{default:()=>[]}},emits:["action"],setup(u,{emit:e}){const t=u,l=e,n=S(()=>t.model.name),o=S(()=>!H(t.model)&&!t.model.locked),i=S(()=>t.path.map(d=>({command:d,label:d.name,onMouseenter:()=>{l("action",{type:"hover",model:d})}}))),s=[{name:"prev",icon:wl,title:"向前移动"},{name:"next",icon:kl,title:"向后移动"},{name:"copy",icon:Nt,title:"复制"},{name:"remove",icon:He,title:"删除"}],r=d=>{l("action",{type:"selected",model:d.command})},m=async d=>{d.name==="remove"?await Ee("确定删除?")&&l("action",{type:d.name,model:t.model}):l("action",{type:d.name,model:t.model})};return(d,b)=>(c(),j("div",{class:ee(["v-actions",[`is-${t.position}`]])},[p(a(_e),{mode:"icon",size:"small",icon:a(Mt),label:n.value,menus:i.value,background:"none",onCommand:r},null,8,["icon","label","menus"]),p(a(cl),{disabled:!o.value,mode:"icon",size:"small",items:s,background:"none",onClick:m},null,8,["disabled"])],2))}}),Gn={key:1,class:"v-designer__placeholder"},Qn=C({name:"VDesigner",inheritAttrs:!1,__name:"index",setup(u,{expose:e}){const t=_(),l=_(),{width:n,height:o}=Yt(t),{dependencies:i,engine:s}=ta(),{current:r,isEmpty:m}=te(),d=S(()=>s.skeleton?.getWidget("Toolbar")?.widgetRef.mode??"pc"),{designer:b,hover:v,dropping:g,selected:h}=tn(l,i),k=w=>{const E=w.type,V=w.model;if(r.value)switch(E){case"remove":r.value.removeNode(V),b.value?.setSelected(null);break;case"copy":const A=r.value.cloneNode(V);b.value?.setSelected(A);break;case"prev":r.value.movePrev(V),b.value?.setSelected(V);break;case"next":r.value.moveNext(V),b.value?.setSelected(V);break;case"hover":b.value?.setHover(V);break;case"selected":b.value?.setSelected(V);break}};return e({designer:b,mode:d}),(w,E)=>(c(),j("div",{ref_key:"container",ref:t,class:"v-designer"},[p(a(sa),{mode:d.value,width:a(n),height:a(o)},{default:f(()=>[I("iframe",{ref_key:"iframe",ref:l,frameborder:"0"},null,512),a(g)?(c(),j("div",{key:0,class:ee(["v-designer__dropping","is-inner"]),style:Ie(a(g).style)},null,4)):x("",!0),a(v)?(c(),j("div",{key:1,class:"v-designer__hover",style:Ie(a(v).style)},[I("span",{class:ee(`is-${a(v).position}`)},[$(O(a(v).model.name)+": ",1),I("i",null,O(a(v).model.id),1)],2)],4)):x("",!0),a(h)?(c(),j("div",{key:2,class:"v-designer__selected",style:Ie(a(h).style)},[p(qn,{position:a(h).position,model:a(h).model,path:a(h).path,onAction:k},null,8,["position","model","path"])],4)):x("",!0)]),_:1},8,["mode","width","height"]),a(r)?x("",!0):(c(),y(a(Z),{key:0,description:"请新建或打开文件"})),a(r)&&a(m)?(c(),j("div",Gn," 您可以拖拽组件放置到这里 ")):x("",!0)],512))}}),Fe=C({__name:"group",props:{context:{},current:{},title:{},nameLabel:{},valueLabel:{},createEmpty:{},list:{},remove:{},submit:{},itemTitle:{type:Function,default:u=>u.name}},setup(u){const e=u,t=_(),l=_(),n=_(!1),o=_(e.createEmpty()),i=_(!1),s=S(()=>i.value?`编辑${e.title}`:`新增${e.title}`),r=()=>{i.value=!1,o.value=e.createEmpty(),n.value=!0},m=(h,k)=>{switch(k.name){case"edit":b(h);break;case"remove":e.remove(h);break}},d=h=>{o.value.value=h},b=h=>{i.value=!0,o.value={...h},n.value=!0},v=async h=>e.submit(h,i.value),g=()=>{l.value?.itemRef.validate()};return(h,k)=>(c(),y(a(M),{title:e.title,class:"v-sub-panel",size:"small",fit:!1,plus:"",onPlus:r},{default:f(()=>[(c(!0),j(F,null,T(h.list,w=>(c(),y(a(Y),{title:e.itemTitle(w),border:"",actions:["edit","remove"],onAction:E=>m(w,E),onClick:E=>b(w)},null,8,["title","onAction","onClick"]))),256)),h.list.length?x("",!0):(c(),y(a(Z),{key:0,"image-size":40})),p(a(gt),{modelValue:n.value,"onUpdate:modelValue":k[1]||(k[1]=w=>n.value=w),title:s.value,"submit-method":v,model:o.value,block:h.current,context:h.context,onPick:d},{default:f(()=>[pe(h.$slots,"fields",Qt(Zt({model:o.value,isEdit:i.value,nameLabel:h.nameLabel,valueLabel:h.valueLabel})),()=>[p(a(D),{name:"name",label:h.nameLabel,required:"",disabled:i.value},null,8,["label","disabled"]),p(a(D),{ref_key:"codeFieldRef",ref:l,name:"value",label:h.valueLabel,required:""},{editor:f(()=>[p(a(Q),{ref_key:"editorRef",ref:t,dark:"",height:"350px",modelValue:o.value.value,"onUpdate:modelValue":k[0]||(k[0]=w=>o.value.value=w),onBlur:g},null,8,["modelValue"])]),_:1},8,["label"])])]),_:3},8,["modelValue","title","model","block","context"])]),_:3},8,["title"]))}}),Zn=C({__name:"state",props:{context:{},current:{}},setup(u){const e=u,t=S(()=>Object.entries(e.current?.state||{}).map(([i,s])=>({name:i,value:Ve(s)}))),l=()=>({name:"",value:""}),n=i=>e.current?.removeState(i.name),o=async(i,s)=>{const{name:r,value:m}=i;if(!s&&e.current?.state[r])return K(`名称 ${r} 已存在，请更换！`),!1;const d={type:"JSExpression",value:m};return X(d,e.context,!0)?(e.current?.setState(r,d),!0):!1};return(i,s)=>(c(),y(Fe,{title:"状态数据",current:e.current,context:e.context,list:t.value,nameLabel:"状态数据名称",valueLabel:"状态初始值 [ JSExpression ]",createEmpty:l,remove:n,submit:o},null,8,["current","context","list"]))}}),Kn=C({__name:"computed",props:{context:{},current:{}},setup(u){const e=u,t=S(()=>Object.entries(e.current?.computed||{}).map(([i,s])=>({name:i,value:Ve(s)}))),l=()=>({name:"",value:"() => { }"}),n=i=>e.current?.removeFunction("computed",i.name),o=async(i,s)=>{const{name:r,value:m}=i;if(!s&&e.current?.computed[r])return K(`名称 ${r} 已存在，请更换！`),!1;const d={type:"JSFunction",value:m};return X(d,e.context,!0)?(e.current?.setFunction("computed",r,d),!0):!1};return(i,s)=>(c(),y(Fe,{title:"计算属性",current:e.current,context:e.context,list:t.value,nameLabel:"计算属性名称",valueLabel:"计算函数 [ JSFunction ]",createEmpty:l,remove:n,submit:o},null,8,["current","context","list"]))}}),Yn=C({__name:"methods",props:{context:{},current:{}},setup(u){const e=u,t=S(()=>Object.entries(e.current?.methods||{}).map(([i,s])=>({name:i,value:Ve(s)}))),l=()=>({name:"",value:"() => { }"}),n=i=>e.current?.removeFunction("methods",i.name),o=async(i,s)=>{const{name:r,value:m}=i;if(!s&&e.current?.methods[r])return K(`名称 ${r} 已存在，请更换！`),!1;const d={type:"JSFunction",value:m};return X(d,e.context,!0)?(e.current?.setFunction("methods",r,d),!0):!1};return(i,s)=>(c(),y(Fe,{title:"组件方法",current:e.current,context:e.context,list:t.value,nameLabel:"方法名称",valueLabel:"方法函数 [ JSFunction ]",createEmpty:l,remove:n,submit:o},null,8,["current","context","list"]))}}),Xn=C({__name:"lifeCycles",props:{context:{},current:{}},setup(u){const e=u,t=S(()=>dl.map(s=>({label:s,value:s}))),l=S(()=>Object.entries(e.current?.lifeCycles||{}).map(([s,r])=>({name:s,value:Ve(r)}))),n=()=>({name:"",value:"() => { }"}),o=s=>e.current?.removeFunction("lifeCycles",s.name),i=async(s,r)=>{const{name:m,value:d}=s;if(!r&&e.current?.lifeCycles[m])return K(`名称 ${m} 已存在，请更换！`),!1;const b={type:"JSFunction",value:d};return X(b,e.context,!0)?(e.current?.setFunction("lifeCycles",m,b),!0):!1};return(s,r)=>(c(),y(Fe,{title:"生命周期",current:e.current,context:e.context,list:l.value,nameLabel:"名称",valueLabel:"函数 [ JSFunction ]",createEmpty:n,remove:o,submit:i},{fields:f(({model:m,nameLabel:d,isEdit:b,valueLabel:v})=>[p(a(D),{name:"name",label:d,editor:"select",options:t.value,required:"",disabled:b},null,8,["label","options","disabled"]),p(a(D),{name:"value",label:v,required:""},{editor:f(()=>[p(a(Q),{ref:"editorRef",dark:"",height:"350px",modelValue:m.value,"onUpdate:modelValue":g=>m.value=g},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])]),_:1},8,["current","context","list"]))}}),es=C({__name:"watch",props:{context:{},current:{}},setup(u){const e=u,t=S(()=>(e.current?.watch||[]).map(s=>({...s,source:Ve(s.source),handler:Ve(s.handler)}))),l=()=>({source:"() => { }",deep:!1,immediate:!1,handler:"() => { }"}),n=s=>s.source,o=s=>e.current?.removeWatch(s),i=async(s,r)=>{const m={type:"JSFunction",value:s.source},d={type:"JSFunction",value:s.handler};if(!X(m,e.context,!0)||!X(d,e.context,!0))return!1;const b={...s,source:m,handler:d};return e.current?.setWatch(b),!0};return(s,r)=>(c(),y(Fe,{title:"侦听器",current:e.current,context:e.context,list:t.value,nameLabel:"侦听源 [ JSFunction ]",valueLabel:"处理函数 [ JSFunction ]",createEmpty:l,remove:o,submit:i,itemTitle:n,grow:""},{fields:f(({model:m,nameLabel:d,valueLabel:b})=>[p(a(D),{name:"source",label:d,required:""},{editor:f(()=>[p(a(Q),{dark:"",height:"100px",modelValue:m.source,"onUpdate:modelValue":v=>m.source=v},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]),p(a(D),{name:"deep",modelValue:m.deep,"onUpdate:modelValue":v=>m.deep=v,label:"深度监听",editor:"switch"},null,8,["modelValue","onUpdate:modelValue"]),p(a(D),{name:"immediate",modelValue:m.immediate,"onUpdate:modelValue":v=>m.immediate=v,label:"立即执行",editor:"switch"},null,8,["modelValue","onUpdate:modelValue"]),p(a(D),{name:"handler",label:b,required:""},{editor:f(()=>[p(a(Q),{dark:"",height:"130px",modelValue:m.handler,"onUpdate:modelValue":v=>m.handler=v},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])]),_:1},8,["current","context","list"]))}}),ts=C({__name:"index",setup(u){const{current:e,context:t}=te();return(l,n)=>(c(),y(a(L),{class:"v-scripts-widget",direction:"column",fit:""},{default:f(()=>[p(Zn,{current:a(e),context:a(t)},null,8,["current","context"]),p(Kn,{current:a(e),context:a(t)},null,8,["current","context"]),p(Yn,{current:a(e),context:a(t)},null,8,["current","context"]),p(Xn,{current:a(e),context:a(t)},null,8,["current","context"]),p(es,{current:a(e),context:a(t)},null,8,["current","context"])]),_:1}))}}),Xe=C({__name:"setters",props:{context:{},current:{},title:{},items:{},node:{},removable:{type:Boolean}},emits:["change","remove"],setup(u,{emit:e}){const t=u,l=e,n=(i,s)=>{l("change",i,s)},o=i=>{l("remove",i)};return(i,s)=>(c(),y(a(M),{title:t.title,class:"v-sub-panel",size:"small",fit:!1},{default:f(()=>[p(a(We),{class:"v-properties-widget__form",size:"small","label-width":"90px",onKeydown:s[0]||(s[0]=Oe(je(()=>{},["prevent","stop"]),["enter"]))},{default:f(()=>[(c(!0),j(F,null,T(t.items,r=>(c(),y(a(we),ce(r,{key:`${r.name}_${t.node.id}`,current:t.current,context:t.context,removable:t.removable,onChange:n,onRemove:o}),null,16,["current","context","removable"]))),128))]),_:1})]),_:1},8,["title"]))}}),as=C({name:"PropertiesWidget",__name:"index",setup(u){const{current:e,context:t}=te(),{selected:l}=fe(),{node:n,commonProps:o,change:i,componentProps:s,customProps:r,addCustom:m,removeCustom:d,isExist:b}=sn(l),v=_(!1),g=_(),h=()=>{v.value=!0,g.value={name:""}},k=async E=>{const V=Object.keys(n.value?.props||{});return!b(E.name)&&!V.includes(E.name)?(m(E.name),!0):(K("已存在该属性名称"),!1)},w=async E=>{await Ee("确定删除？")&&d(E)};return(E,V)=>a(e)?(c(),y(a(L),{key:0,class:"v-properties-widget",direction:"column",fit:""},{default:f(()=>[a(n)?(c(),y(Xe,{key:0,title:"通用属性",current:a(e),context:a(t),node:a(n),items:a(o),onChange:a(i)},null,8,["current","context","node","items","onChange"])):x("",!0),a(n)?(c(),y(Xe,{key:1,title:"组件属性",current:a(e),context:a(t),node:a(n),items:a(s),onChange:a(i)},null,8,["current","context","node","items","onChange"])):x("",!0),a(n)?(c(),y(Xe,{key:2,title:"自定义属性",current:a(e),context:a(t),node:a(n),items:a(r),onChange:a(i),removable:"",plus:"",grow:"",onPlus:h,onRemove:w},null,8,["current","context","node","items","onChange"])):x("",!0),p(a(de),{modelValue:v.value,"onUpdate:modelValue":V[0]||(V[0]=A=>v.value=A),title:"新增自定义属性",width:"400px",height:"150px","submit-method":k,formProps:{tooltipMessage:!1},model:g.value},{default:f(()=>[p(a(D),{name:"name",label:"属性名称",required:"",rules:{message:"名称格式错误",pattern:a(he)}},null,8,["rules"])]),_:1},8,["modelValue","model"])]),_:1})):x("",!0)}}),ls=C({name:"VariableBinder",__name:"variable",props:{context:{},current:{},value:{}},setup(u){const e=u,t=_(),l=ze({type:"JSExpression",value:e.value}),n=o=>{t.value.getEditor().setValue(o),l.value=o};return(o,i)=>(c(),y(a(gt),{title:"绑定变量","unbind-enabled":"",block:e.current,context:e.context,model:l,onPick:n},{default:f(()=>[p(a(D),{name:"value",label:"绑定内容 [ JSExpression ]",required:""},{editor:f(()=>[p(a(Q),{ref_key:"editorRef",ref:t,modelValue:l.value,"onUpdate:modelValue":i[0]||(i[0]=s=>l.value=s),dark:"",height:"450px"},null,8,["modelValue"])]),_:1})]),_:1},8,["block","context","model"]))}}),ns=C({name:"EventBinder",__name:"event",props:{context:{},current:{},name:{},event:{}},setup(u){const e=u,t=_(),l=ze({name:e.name,...e.event,modifiers:Object.keys(e.event?.modifiers||{}),handler:{type:"JSFunction",value:e.event?.handler?.value||"() => {}"}}),n=$l.map(i=>({label:i,value:i})),o=i=>{t.value.getEditor().setValue(i),l.handler.value=i};return(i,s)=>(c(),y(a(gt),{title:"绑定事件","unbind-enabled":"",block:e.current,context:e.context,model:l,onPick:o},{default:f(()=>[p(a(D),{name:"modifiers",label:"事件修饰符",editor:"checkbox",options:a(n)},null,8,["options"]),p(a(D),{name:"handler.value",label:"事件处理函数 [ JSFunction ]",required:""},{editor:f(()=>[p(a(Q),{ref_key:"editorRef",ref:t,modelValue:l.handler.value,"onUpdate:modelValue":s[0]||(s[0]=r=>l.handler.value=r),dark:"",height:"350px"},null,8,["modelValue"])]),_:1})]),_:1},8,["block","context","model"]))}}),ss=C({name:"EventsWidget",__name:"index",setup(u){const{current:e,context:t}=te(),{selected:l}=fe(),{mouseEventList:n,keyboardEventList:o,componentEventList:i}=on(l),s=_({name:"",event:void 0}),r=_(!1),m=h=>{s.value=$e(h),r.value=!0},d=async h=>{const k={...h,modifiers:h.modifiers.reduce((w,E)=>(w[E]=!0,w),{})};return X(k.handler,t.value,!0)?((l.value?.model).setEvent(k),!0):!1},b=async h=>{const k=l.value?.model;h.name&&(k.removeEvent(h.name),r.value=!1)},v=async()=>{s.value.name&&await Ee("确定要删除该事件吗？")&&b(s.value)},g=h=>{const{name:k,modelValue:w}=h;k==="edit"&&m(w),k==="remove"&&b(w)};return(h,k)=>(c(),y(a(L),{class:"v-events-widget",direction:"column",fit:""},{default:f(()=>[p(a(M),{title:"组件事件",class:"v-sub-panel",size:"small",fit:!1},{default:f(()=>[a(i).length?x("",!0):(c(),y(a(Z),{key:0,"image-size":50,description:"该组件无自带事件"})),(c(!0),j(F,null,T(a(i),w=>(c(),y(a(Y),{title:w.name,"model-value":w,border:"",small:"",actions:w.event?["edit","remove"]:["edit"],active:!!w.event,onClick:E=>m(w),onAction:g},null,8,["title","model-value","actions","active","onClick"]))),256))]),_:1}),p(a(M),{title:"鼠标事件",class:"v-sub-panel",size:"small",fit:!1},{default:f(()=>[(c(!0),j(F,null,T(a(n),w=>(c(),y(a(Y),{title:w.name,"model-value":w,border:"",small:"",actions:w.event?["edit","remove"]:["edit"],active:!!w.event,onClick:E=>m(w),onAction:g},null,8,["title","model-value","actions","active","onClick"]))),256))]),_:1}),p(a(M),{title:"键盘事件",class:"v-sub-panel",size:"small",grow:"",fit:!1},{default:f(()=>[(c(!0),j(F,null,T(a(o),w=>(c(),y(a(Y),{title:w.name,"model-value":w,border:"",small:"",actions:w.event?["edit","remove"]:["edit"],active:!!w.event,onClick:E=>m(w),onAction:g},null,8,["title","model-value","actions","active","onClick"]))),256))]),_:1}),r.value?(c(),y(a(ns),{key:0,modelValue:r.value,"onUpdate:modelValue":k[0]||(k[0]=w=>r.value=w),context:a(t),current:a(e),name:s.value.name,event:s.value.event,submitMethod:d,onUnbind:v},null,8,["modelValue","context","current","name","event"])):x("",!0)]),_:1}))}}),os=C({name:"CssWidget",__name:"index",setup(u){const{current:e}=te(),t=_(),l=S(()=>e.value?.css||""),n=i=>{e.value?.setCss(i)},o=()=>{const i=(t.value?.getEditor()).getValue();n(i),se("保存成功")};return(i,s)=>(c(),y(a(M),{class:"v-css-widget v-sub-panel",title:"lang:css scoped",size:"small",fit:"",save:"",onSave:o},{default:f(()=>[p(a(Q),{ref_key:"editorRef",ref:t,"model-value":l.value,height:"100%",lang:"css",dark:"",onBlur:n},null,8,["model-value"])]),_:1}))}}),is=C({name:"DirectivesWidget",__name:"index",setup(u){const{current:e,context:t}=te(),{selected:l}=fe(),{vIf:n,vShow:o,vBind:i,vFor:s,vModels:r,onValueChange:m,onForChange:d,onModelChange:b}=dn(l),v=g=>g.arg?typeof g.arg=="string"?g.arg:Je(g.arg,{}):"modelValue";return(g,h)=>(c(),y(a(L),{class:"v-directives-widget",direction:"column",fit:""},{default:f(()=>[p(a(M),{class:"v-sub-panel",title:"内置指令",size:"small",fit:!1},{default:f(()=>[p(a(We),{size:"small","label-width":"80px",onKeydown:h[0]||(h[0]=Oe(je(()=>{},["prevent","stop"]),["enter"]))},{default:f(()=>[p(a(we),{name:"vIf",label:"v-if",setters:"ExpressionSetter",current:a(e),context:a(t),value:a(n).value,onChange:a(m)},null,8,["current","context","value","onChange"]),p(a(we),{name:"vShow",label:"v-show",setters:"ExpressionSetter",current:a(e),context:a(t),value:a(o).value,onChange:a(m)},null,8,["current","context","value","onChange"]),p(a(we),{name:"vBind",label:"v-bind",setters:"ExpressionSetter",current:a(e),context:a(t),value:a(i).value,onChange:a(m)},null,8,["current","context","value","onChange"])]),_:1})]),_:1}),p(a(M),{class:"v-sub-panel",title:"循环",size:"small",fit:!1},{default:f(()=>[p(a(We),{size:"small","label-width":"80px",onKeydown:h[1]||(h[1]=Oe(je(()=>{},["prevent","stop"]),["enter"]))},{default:f(()=>[p(a(we),{name:"value",label:"循环数据",setters:"ExpressionSetter",current:a(e),context:a(t),value:a(s).value,onChange:a(d)},null,8,["current","context","value","onChange"]),p(a(we),{name:"item",label:"迭代变量名",setters:{name:"StringSetter",props:{placeholder:"item"}},current:a(e),context:a(t),value:a(s).iterator?.item,onChange:a(d)},null,8,["current","context","value","onChange"]),p(a(we),{name:"index",label:"索引变量名",setters:{name:"StringSetter",props:{placeholder:"index"}},current:a(e),context:a(t),value:a(s).iterator?.index,onChange:a(d)},null,8,["current","context","value","onChange"])]),_:1})]),_:1}),p(a(M),{class:"v-sub-panel",title:"双向绑定",size:"small",fit:!1,grow:""},{default:f(()=>[(c(!0),j(F,null,T(a(r),(k,w)=>(c(),y(a(M),{card:"",border:"",class:"v-sub-panel",size:"small",title:`v-model: ${v(k)}`,body:{grow:!1},fit:!1},{default:f(()=>[p(a(We),{size:"small","label-width":"60px",onKeydown:h[2]||(h[2]=Oe(je(()=>{},["prevent","stop"]),["enter"]))},{default:f(()=>[p(a(we),{name:w.toString(),label:"绑定变量",setters:"ExpressionSetter",current:a(e),context:a(t),value:k.value,onChange:a(b)},null,8,["name","current","context","value","onChange"])]),_:2},1024)]),_:2},1032,["title"]))),256)),a(r).length?x("",!0):(c(),y(a(Z),{key:0,description:"当前组件没有双向绑定属性","image-size":50}))]),_:1})]),_:1}))}}),rs=C({name:"DefinedPropsDialog",__name:"props",props:{item:{},current:{},context:{}},setup(u){const e=u,t=S(()=>e.item?"编辑定义属性":"新增定义属性"),l=_(Object.assign({default:{type:"JSExpression",value:""}},e.item)),n=Object.keys(ml).map(i=>({label:i,value:i})),o=async i=>{const s=i.default;return s&&!X(s,e.context,!0)?!1:(e.current.setProp(i),!0)};return(i,s)=>(c(),y(a(de),{title:t.value,width:"800px",height:"500px",model:l.value,"form-props":{tooltipMessage:!1},"submit-method":o},{default:f(()=>[p(a(D),{name:"name",label:"属性名称",required:"",tip:"名称为英文驼峰格式",disabled:!!e.item,rules:{message:"名称格式错误",pattern:a(he)}},null,8,["disabled","rules"]),p(a(D),{name:"type",label:"数据类型",editor:"checkbox",props:{button:!0,size:"small"},options:a(n),required:""},null,8,["options"]),p(a(D),{name:"required",label:"必须",editor:"switch"}),p(a(D),{name:"default.value",label:"默认值",editor:"none"},{default:f(()=>[p(a(Q),{modelValue:l.value.default.value,"onUpdate:modelValue":s[0]||(s[0]=r=>l.value.default.value=r),height:"200px",dark:""},null,8,["modelValue"])]),_:1})]),_:1},8,["title","model"]))}}),us=C({name:"DefinedEventsDialog",__name:"events",props:{item:{},current:{},context:{}},setup(u){const e=u,t=S(()=>e.item?"编辑定义事件":"新增定义事件"),l=_({name:e.item}),n=async o=>(e.item&&e.current.removeEmit(e.item,!0),e.current.setEmit(o.name),!0);return(o,i)=>(c(),y(a(de),{title:t.value,width:"600px",height:"200px",model:l.value,"form-props":{tooltipMessage:!1},"submit-method":n},{default:f(()=>[p(a(D),{name:"name",label:"事件名称",required:"",disabled:!!e.item,rules:{message:"名称格式错误",pattern:a(he)}},null,8,["disabled","rules"])]),_:1},8,["title","model"]))}}),cs=C({name:"DefinedSlotsDialog",__name:"slots",props:{item:{},current:{},context:{}},setup(u){const e=u,t=S(()=>e.item?"编辑定义插槽":"新增定义插槽"),l=_({name:e.item}),n=async o=>(e.item&&e.current.removeSlot(e.item,!0),e.current.setSlot(o.name),!0);return(o,i)=>(c(),y(a(de),{title:t.value,width:"600px",height:"200px",model:l.value,"form-props":{tooltipMessage:!1},"submit-method":n},{default:f(()=>[p(a(D),{name:"name",label:"插槽名称",disabled:!!e.item,required:"",rules:{message:"名称格式错误",pattern:a(he)}},null,8,["disabled","rules"])]),_:1},8,["title","model"]))}}),ds=C({name:"DefinedInjectsDialog",__name:"injects",props:{item:{},current:{},context:{}},setup(u){const e=u,t=S(()=>e.item?"编辑注入":"新增注入"),l=_(Object.assign({default:{type:"JSExpression",value:""}},e.item)),n=async o=>{const i=o.default;return i&&!X(i,e.context,!0)?!1:(e.current.setInject(o),!0)};return(o,i)=>(c(),y(a(de),{title:t.value,width:"800px",height:"500px",model:l.value,"form-props":{tooltipMessage:!1},"submit-method":n},{default:f(()=>[p(a(D),{name:"name",label:"注入名称",required:"",tip:"名称为英文驼峰格式",disabled:!!e.item,rules:{message:"名称格式错误",pattern:a(he)}},null,8,["disabled","rules"]),p(a(D),{name:"from",label:"来源名称",tip:"默认和注入名称一致"}),p(a(D),{name:"default.value",label:"默认值",editor:"none"},{default:f(()=>[p(a(Q),{modelValue:l.value.default.value,"onUpdate:modelValue":i[0]||(i[0]=s=>l.value.default.value=s),height:"200px",dark:""},null,8,["modelValue"])]),_:1})]),_:1},8,["title","model"]))}}),ms=C({name:"DefinedWidget",__name:"index",setup(u){const{current:e,context:t}=te(),l=S(()=>(e.value?.props||[]).map(N=>typeof N=="string"?{name:N}:N)),n=S(()=>e.value?.emits||[]),o=S(()=>e.value?.slots||[]),i=S(()=>e.value?.inject||[]),s=_(!1),r=_(),m=_(!1),d=_(),b=_(!1),v=_(),g=_(!1),h=_(),k=()=>{r.value=void 0,s.value=!0},w=N=>{const{name:U,modelValue:z}=N;U==="edit"&&E(z),U==="remove"&&e.value?.removeProp(z)},E=N=>{r.value=N,s.value=!0},V=()=>{d.value=void 0,m.value=!0},A=N=>{d.value=N,m.value=!0},P=N=>{const{name:U,modelValue:z}=N;U==="edit"&&A(z),U==="remove"&&e.value?.removeEmit(z)},R=()=>{v.value=void 0,b.value=!0},W=N=>{v.value=N,b.value=!0},B=N=>{const{name:U,modelValue:z}=N;U==="edit"&&W(z),U==="remove"&&e.value?.removeSlot(z)},G=()=>{h.value=void 0,g.value=!0},ie=N=>{h.value=N,g.value=!0},oe=N=>{const{name:U,modelValue:z}=N;U==="edit"&&ie(z),U==="remove"&&e.value?.removeInject(z)};return(N,U)=>a(e)&&a(t)?(c(),y(a(L),{key:0,class:"v-defined-widget",direction:"column",fit:""},{default:f(()=>[p(a(M),{class:"v-sub-panel",title:"定义属性",size:"small",plus:"",fit:!1,onPlus:k},{default:f(()=>[(c(!0),j(F,null,T(l.value,z=>(c(),y(a(Y),{"model-value":z,title:z.name,border:"",actions:["edit","remove"],onClick:Qe=>E(z),onAction:w},null,8,["model-value","title","onClick"]))),256)),l.value.length?x("",!0):(c(),y(a(Z),{key:0,"image-size":50})),s.value?(c(),y(rs,{key:1,current:a(e),context:a(t),modelValue:s.value,"onUpdate:modelValue":U[0]||(U[0]=z=>s.value=z),item:r.value},null,8,["current","context","modelValue","item"])):x("",!0)]),_:1}),p(a(M),{class:"v-sub-panel",title:"定义事件",size:"small",plus:"",fit:!1,onPlus:V},{default:f(()=>[(c(!0),j(F,null,T(n.value,z=>(c(),y(a(Y),{"model-value":z,title:z,border:"",actions:["remove"],onClick:Qe=>A(z),onAction:P},null,8,["model-value","title","onClick"]))),256)),n.value.length?x("",!0):(c(),y(a(Z),{key:0,"image-size":50})),m.value?(c(),y(us,{key:1,modelValue:m.value,"onUpdate:modelValue":U[1]||(U[1]=z=>m.value=z),current:a(e),context:a(t),item:d.value},null,8,["modelValue","current","context","item"])):x("",!0)]),_:1}),p(a(M),{class:"v-sub-panel",title:"定义插槽",size:"small",plus:"",fit:!1,onPlus:R},{default:f(()=>[(c(!0),j(F,null,T(o.value,z=>(c(),y(a(Y),{"model-value":z,title:z,border:"",actions:["remove"],onClick:Qe=>W(z),onAction:B},null,8,["model-value","title","onClick"]))),256)),o.value.length?x("",!0):(c(),y(a(Z),{key:0,"image-size":50})),b.value?(c(),y(cs,{key:1,modelValue:b.value,"onUpdate:modelValue":U[2]||(U[2]=z=>b.value=z),current:a(e),context:a(t),item:v.value},null,8,["modelValue","current","context","item"])):x("",!0)]),_:1}),p(a(M),{class:"v-sub-panel",title:"注入",size:"small",plus:"",fit:!1,grow:"",onPlus:G},{default:f(()=>[(c(!0),j(F,null,T(i.value,z=>(c(),y(a(Y),{"model-value":z,title:z.name,border:"",actions:["remove"],onClick:Qe=>ie(z),onAction:oe},null,8,["model-value","title","onClick"]))),256)),i.value.length?x("",!0):(c(),y(a(Z),{key:0,"image-size":50})),g.value?(c(),y(ds,{key:1,modelValue:g.value,"onUpdate:modelValue":U[3]||(U[3]=z=>g.value=z),current:a(e),context:a(t),item:h.value},null,8,["modelValue","current","context","item"])):x("",!0)]),_:1})]),_:1})):x("",!0)}}),ps=C({name:"DataSourceDialogForm",__name:"form",props:{context:{},current:{},item:{}},setup(u){const e=u,{apis:t}=mn(),l=_(Object.assign({type:"api",ref:"",name:"",label:"",transform:{type:"JSFunction",value:`(res) => {
    /* 在这里可对接口返回数据进行转换  */
    return res;
}`},test:{type:"JSFunction",value:`() => this.runApi({
    /* 在这里可输入接口参数  */
})`}},e.item)),n=_(!1),o=_(""),i=_(!1),s=S(()=>t.value.map(v=>({label:v.label||"",value:v.id,data:v}))),r=S(()=>e.item?"编辑数据源":"新增数据源"),m=v=>{const g=t.value.find(h=>h.id===v);g&&(l.value.name=g.name,l.value.label=g.label||"")},d=async v=>{const{transform:g,test:h,name:k}=v;if(!e.current)return!1;if(!e.item&&e.current.dataSources[k])return K(`名称【${k}】已经存在，请更换名称`),!1;if(g?.value){if(!X(g,e.context,!0))return!1}else v.transform=void 0;if(h?.value){if(!X(h,e.context,!0))return!1}else v.test=void 0;return e.current?.setDataSource(v),!0},b=async()=>{if(!e.context)return;if(!l.value.ref){K("请先选择API");return}if(!l.value.test?.value){K("请先填写测试用例");return}if(!X(l.value.test,e.context,!0))return;const v=async(...k)=>{const w=e.context?.$apis[l.value.ref];if(w)return await w.apply(w,k);ge.warn(`API【${l.value.ref}】不存在`)},g=Je(l.value.test,{runApi:v}),h=l.value.transform?.value?Je(l.value.transform,{},!0):k=>k;n.value=!0;try{const k=await g();o.value=JSON.stringify(await h(k),null,2)}catch(k){ge.error(k)}n.value=!1,i.value=!0};return(v,g)=>(c(),y(a(de),{width:"1000px",height:"600px",title:r.value,model:l.value,"form-props":{tooltipMessage:!1},"submit-method":d},{extra:f(()=>[p(a(ue),{loading:n.value,type:"warning",onClick:b},{default:f(()=>[$(" 运行测试用例 ")]),_:1},8,["loading"])]),default:f(()=>[p(a(D),{name:"ref",label:"引用API",editor:"select",required:"",disabled:!!e.item,options:s.value,props:{filterable:!0},onChange:m},{option:f(({option:h})=>[$(O(h.data.label)+" ",1),I("i",null,"[ "+O(h.data.name)+" ]",1)]),_:1},8,["disabled","options"]),p(a(D),{name:"name",label:"调用名称",required:"",tip:"名称为英文驼峰格式",disabled:!!e.item,rules:{message:"名称格式错误",pattern:a(he)}},null,8,["disabled","rules"]),p(a(D),{name:"label",label:"备注说明",required:""}),p(a(D),{name:"transform.value",label:"转换函数",editor:"none"},{default:f(()=>[p(a(Q),{modelValue:l.value.transform.value,"onUpdate:modelValue":g[0]||(g[0]=h=>l.value.transform.value=h),height:"200px",dark:""},null,8,["modelValue"])]),_:1}),p(a(D),{name:"test.value",label:"测试用例",editor:"none"},{default:f(()=>[p(a(Q),{modelValue:l.value.test.value,"onUpdate:modelValue":g[1]||(g[1]=h=>l.value.test.value=h),height:"100px",dark:""},null,8,["modelValue"])]),_:1}),i.value?(c(),y(a(Sa),{key:0,class:"v-drawer",modelValue:i.value,"onUpdate:modelValue":g[2]||(g[2]=h=>i.value=h),title:"测试用例运行结果",direction:"btt","append-to-body":"",size:"80%"},{default:f(()=>[p(a(Q),{"model-value":o.value,border:"",dark:"",height:"100%",lang:"json"},null,8,["model-value"])]),_:1},8,["modelValue"])):x("",!0)]),_:1},8,["title","model"]))}}),vs=C({name:"DataSourcesWidget",__name:"index",setup(u){const{current:e,context:t}=te(),l=_(!1),n=_(),o=S(()=>Object.values(e.value?.dataSources||{}).filter(m=>m.type==="api")),i=()=>{n.value=void 0,l.value=!0},s=m=>{n.value=m,l.value=!0},r=m=>{const{name:d,modelValue:b}=m;d==="edit"&&s(b),d==="remove"&&e.value?.removeDataSource(b.name)};return(m,d)=>(c(),y(a(L),{class:"v-data-sources-widget",direction:"column",fit:""},{default:f(()=>[p(a(M),{title:"API",class:"v-sub-panel",size:"small",plus:"",onPlus:i},{default:f(()=>[(c(!0),j(F,null,T(o.value,b=>(c(),y(a(Y),{border:"",title:b.name,subtitle:b.label,"model-value":b,actions:["edit","remove"],onAction:r,onClick:v=>s(b)},null,8,["title","subtitle","model-value","onClick"]))),256)),o.value.length?x("",!0):(c(),y(a(Z),{key:0,"image-size":50}))]),_:1}),l.value?(c(),y(ps,{key:0,modelValue:l.value,"onUpdate:modelValue":d[0]||(d[0]=b=>l.value=b),current:a(e),context:a(t),item:n.value},null,8,["modelValue","current","context","item"])):x("",!0)]),_:1}))}}),gs=C({name:"StyleWidget",__name:"index",setup(u){const{selected:e}=fe(),t=_(),l=S(()=>{const s=e.value?.model||null;return H(s)?null:s}),n=S(()=>JSON.stringify(l.value?.getPropValue("style")||{},null,2)),o=s=>{try{const r=JSON.parse(s);l.value?.setProp("style",r)}catch{K("JSON格式错误")}},i=()=>{const s=(t.value?.getEditor()).getValue();o(s),se("保存成功")};return(s,r)=>(c(),y(a(M),{class:"v-css-widget v-sub-panel",title:"style",size:"small",fit:"",save:"",onSave:i},{default:f(()=>[p(a(Q),{ref_key:"editorRef",ref:t,"model-value":n.value,height:"100%",lang:"json",dark:"",onBlur:o},null,8,["model-value"])]),_:1}))}}),hs=["src"],fs=C({name:"PreviewerWidget",__name:"index",props:{path:{type:Function}},setup(u,{expose:e}){const t=u,l=_(),n=_(Symbol()),{current:o,engine:i}=te(),{width:s,height:r}=Yt(l),m=S(()=>o.value&&t.path?t.path(o.value):null),d=S(()=>i.skeleton?.getWidget("Toolbar")?.widgetRef.mode??"pc");return e({refresh:()=>{n.value=Symbol()}}),(b,v)=>(c(),j("div",{ref_key:"container",ref:l,class:"v-previewer",key:n.value},[p(a(sa),{mode:d.value,width:a(s),height:a(r)},{default:f(()=>[m.value?(c(),j("iframe",{key:0,ref:"iframe",frameborder:"0",src:m.value},null,8,hs)):x("",!0)]),_:1},8,["mode","width","height"])]))}}),bs=C({name:"NodePathWidget",inheritAttrs:!1,__name:"index",setup(u){const{selected:e,designer:t}=fe(),l=S(()=>(e.value?.path||[]).slice(0).reverse()),n=i=>{t.value?.setSelected(i)},o=i=>{t.value?.setHover(i)};return(i,s)=>a(e)?(c(),y(a(va),{key:0,class:"v-nodepath-widget","separator-icon":a(Il)},{default:f(()=>[(c(!0),j(F,null,T(l.value,r=>(c(),y(a(pa),{onClick:m=>n(r),onMouseover:m=>o(r)},{default:f(()=>[$(O(r.name),1)]),_:2},1032,["onClick","onMouseover"]))),256))]),_:1},8,["separator-icon"])):x("",!0)}}),ys=C({name:"SchemaWidget",__name:"index",setup(u){const{current:e}=te(),t=_(),l=S(()=>JSON.stringify(e.value?.toDsl()||{},null,2)),n=S(()=>e.value?e.value.name:""),o=async()=>{const i=(t.value?.getEditor()).getValue();if(i&&await Ee("手动修改DSL有风险，可能导致页面无法加载，请确认您的操作无误。"))try{const s=JSON.parse(i);e.value?.update(s),se("保存成功")}catch(s){K(s?.message)}};return(i,s)=>(c(),y(a(M),{class:"v-schema-widget",title:n.value,subtitle:"手动修改DSL有风险，可能导致页面无法加载，请确认您的操作无误。",size:"small",fit:"",save:"",onSave:o},{default:f(()=>[p(a(Q),{ref_key:"editorRef",ref:t,"model-value":l.value,height:"100%",lang:"json",dark:""},null,8,["model-value"])]),_:1},8,["title"]))}}),ws=C({name:"SchemaWidget",__name:"index",setup(u){const{current:e,engine:t}=te(),l=_(),n=_(""),o=S(()=>e.value?`$vtj/raw/${e.value.id}.vue`:""),i=S(()=>e.value?e.value.name:"");return ae(e,async s=>{const r=t.project.value;r&&s?n.value=await t.service.genVueContent(r.toDsl(),s.toDsl()):n.value=""},{immediate:!0,deep:!0}),(s,r)=>(c(),y(a(M),{class:"v-raw-widget",title:i.value,subtitle:o.value,size:"small",fit:""},{default:f(()=>[p(a(Q),{ref_key:"editorRef",ref:l,"model-value":n.value,height:"100%",lang:"html",dark:"",readonly:""},null,8,["model-value"])]),_:1},8,["title","subtitle"]))}}),ks=["src"],_s=C({name:"DocsWidget",__name:"index",props:{url:{default:"https://newgateway.gitee.io/vtj/help/index.html"}},setup(u){const e=u,t=_();let l=null;Ut(()=>{l||(l=ga.service({target:t.value?.$el}))}),Ht(()=>{n(),l=null});const n=()=>{l?.close()};return(o,i)=>(c(),y(a(M),{class:"v-docs-widget",size:"small",fit:"",body:{padding:!1},header:!1,ref_key:"panel",ref:t},{default:f(()=>[I("iframe",{ref:"frame",src:e.url,onLoad:n},null,40,ks)]),_:1},512))}}),Ss={class:"v-about-widget"},xs={class:"v-about-widget__logo"},Vs=["src"],Cs=I("div",{class:"v-about-widget__name"},"VTJ.PRO",-1),Es={class:"v-about-widget__version"},js=C({name:"AboutWidget",__name:"index",setup(u){return(e,t)=>(c(),j("div",Ss,[I("div",xs,[I("img",{src:a(ea)},null,8,Vs)]),Cs,I("div",Es,"版本："+O(a(Nl)),1)]))}}),J={Logo:Ql,EmptyWidget:Kl,Switcher:gn,Toolbar:fn,Actions:wn,Pages:Wn,Blocks:In,Components:Nn,Outline:Jn,History:Un,Apis:Hn,Deps:$n,Designer:Qn,Scripts:ts,Properties:as,Events:ss,Css:os,Directives:is,Defined:ms,DataSources:vs,Style:gs,Previewer:fs,NodePath:bs,Schema:ys,Raw:ws,Docs:_s,About:js},As=[{name:"Logo",region:"Brand",component:J.Logo},{name:"Switcher",region:"Brand",component:J.Switcher},{name:"Toolbar",region:"Toolbar",component:J.Toolbar},{name:"Actions",region:"Actions",component:J.Actions},{name:"Pages",region:"Apps",component:J.Pages,type:"app",openType:"panel",icon:Aa,label:"页面管理"},{name:"Blocks",region:"Apps",component:J.Blocks,type:"app",openType:"panel",icon:Da,label:"区块管理"},{name:"Components",region:"Apps",component:J.Components,type:"app",openType:"panel",icon:Pa,label:"组件库"},{name:"Outline",region:"Apps",component:J.Outline,type:"app",openType:"panel",icon:Ra,label:"大纲树"},{name:"History",region:"Apps",component:J.History,type:"app",openType:"panel",icon:Ba,label:"历史记录"},{name:"Apis",region:"Apps",component:J.Apis,type:"app",openType:"panel",icon:za,label:"API管理"},{name:"Deps",region:"Apps",component:J.Deps,type:"app",openType:"panel",icon:Fa,label:"依赖管理"},{name:"About",region:"Apps",component:J.About,type:"app",openType:"dialog",icon:Ta,label:"关于",props:{width:500,height:300}},{name:"Designer",region:"Workspace",component:J.Designer,type:"tab",closable:!1,label:"设计视图"},{name:"Previewer",region:"Preview",component:J.Previewer,type:"tab",closable:!1,label:"预览视图"},{name:"Schema",region:"Workspace",component:J.Schema,type:"tab",closable:!0,label:"DSL视图"},{name:"Raw",region:"Workspace",component:J.Raw,type:"tab",closable:!0,label:"源码视图"},{name:"Docs",region:"Workspace",component:J.Docs,type:"tab",closable:!0,label:"帮助中心"},{name:"Scripts",region:"Settings",component:J.Scripts,type:"tab",group:re.Block,label:"设置"},{name:"Css",region:"Settings",component:J.Css,type:"tab",group:re.Block,label:"CSS"},{name:"DataSources",region:"Settings",component:J.DataSources,type:"tab",group:re.Block,label:"数据源"},{name:"Defined",region:"Settings",component:J.Defined,type:"tab",group:re.Block,label:"定义"},{name:"Properties",region:"Settings",component:J.Properties,type:"tab",group:re.Node,label:"属性"},{name:"Style",region:"Settings",component:J.Style,type:"tab",group:re.Node,label:"样式"},{name:"Events",region:"Settings",component:J.Events,type:"tab",group:re.Node,label:"事件"},{name:"Directives",region:"Settings",component:J.Directives,type:"tab",group:re.Node,label:"指令"},{name:"NodePath",region:"Status",component:J.NodePath}],Ds=[{package:"vue",version:"latest",library:"Vue",urls:["@vtj/materials/deps/vue/vue.global.prod.js"],required:!0,official:!0,enabled:!0},{package:"vue-router",version:"latest",library:"VueRouter",urls:["@vtj/materials/deps/vue-router/vue-router.global.prod.js"],required:!0,official:!0,enabled:!0},{package:"@vtj/utils",version:"latest",library:"VtjUtils",urls:["@vtj/materials/deps/@vtj/utils/index.umd.js"],required:!0,official:!0,enabled:!0},{package:"@vtj/icons",version:"latest",library:"VtjIcons",urls:["@vtj/materials/deps/@vtj/icons/style.css","@vtj/materials/deps/@vtj/icons/index.umd.js"],required:!0,official:!0,enabled:!0},{package:"element-plus",version:"latest",library:"ElementPlus",urls:["@vtj/materials/deps/element-plus/index.css","@vtj/materials/deps/element-plus/index.full.min.js"],assetsUrl:"@vtj/materials/assets/element/index.umd.js",assetsLibrary:"ElementPlusMaterial",required:!1,official:!0,enabled:!0},{package:"echarts",version:"latest",library:"echarts",urls:["@vtj/materials/deps/echarts/echarts.min.js"],required:!1,official:!0,enabled:!0},{package:"@vtj/ui",version:"latest",library:"VtjUI",urls:["@vtj/materials/deps/@vtj/ui/style.css","@vtj/materials/deps/@vtj/ui/index.umd.js"],assetsUrl:"@vtj/materials/assets/ui/index.umd.js",assetsLibrary:"VtjUIMaterial",required:!1,official:!0,enabled:!0},{package:"ant-design-vue",version:"latest",library:"antd",urls:["@vtj/materials/deps/ant-design-vue/rest.css","@vtj/materials/deps/ant-design-vue/dayjs/dayjs.min.js","@vtj/materials/deps/ant-design-vue/dayjs/plugin/customParseFormat.js","@vtj/materials/deps/ant-design-vue/dayjs/plugin/weekday.js","@vtj/materials/deps/ant-design-vue/dayjs/plugin/localeData.js","@vtj/materials/deps/ant-design-vue/dayjs/plugin/weekOfYear.js","@vtj/materials/deps/ant-design-vue/dayjs/plugin/weekYear.js","@vtj/materials/deps/ant-design-vue/dayjs/plugin/advancedFormat.js","@vtj/materials/deps/ant-design-vue/dayjs/plugin/quarterOfYear.js","@vtj/materials/deps/ant-design-vue/antd.min.js"],assetsUrl:"@vtj/materials/assets/antdv/index.umd.js",assetsLibrary:"AntdvMaterial",required:!1,official:!0,enabled:!1}],Ps=[{id:"elements",category:"特殊元素"},{id:"components",category:"内置组件"}],Rs=[{name:"component",label:"动态组件",categoryId:"elements",doc:"https://cn.vuejs.org/api/built-in-special-elements.html#component",props:[{name:"is",label:"组件名",setters:"InputSetter"}],snippet:{children:"组件文本内容示例",props:{is:"div"}}},{name:"slot",label:"插槽",categoryId:"elements",doc:"https://cn.vuejs.org/api/built-in-special-elements.html#slot",props:[{name:"name",label:"名称",defaultValue:"default",setters:"InputSetter"}],snippet:{children:"默认插槽内容"}}],Bs=[...Rs,{name:"Transition",label:"过渡效果",categoryId:"components",doc:"https://cn.vuejs.org/api/built-in-components.html#transition",package:"vue",props:[{name:"name",label:"名称",defaultValue:"",title:"用于自动生成过渡 CSS class 名",setters:"InputSetter"},{name:"css",label:"应用CSS",defaultValue:!0,title:"是否应用 CSS 过渡 class",setters:"BooleanSetter"},{name:"type",label:"事件类型",defaultValue:void 0,title:"指定要等待的过渡事件类型来确定过渡结束的时间，默认情况下会自动检测持续时间较长的类型",setters:"SelectSetter",options:["transition","animation"]},{name:"duration",label:"持续时间",defaultValue:void 0,title:"显式指定过渡的持续时间",setters:["NumberSetter","JSONSetter"]},{name:"mode",label:"时序",defaultValue:"default",title:"控制离开/进入过渡的时序。",setters:"SelectSetter",options:["in-out","out-in","default"]},{name:"appear",label:"使用过渡",defaultValue:!1,title:"是否对初始渲染使用过渡",setters:"BooleanSetter"},{name:"enterFromClass",label:"enterFromClass",defaultValue:void 0,setters:"InputSetter"},{name:"enterActiveClass",label:"enterActiveClass",defaultValue:void 0,setters:"InputSetter"},{name:"enterToClass",label:"enterToClass",defaultValue:void 0,setters:"InputSetter"},{name:"appearFromClass",label:"appearFromClass",defaultValue:void 0,setters:"InputSetter"},{name:"appearActiveClass",label:"appearActiveClass",defaultValue:void 0,setters:"InputSetter"},{name:"appearToClass",label:"appearToClass",defaultValue:void 0,setters:"InputSetter"},{name:"leaveFromClass",label:"leaveFromClass",defaultValue:void 0,setters:"InputSetter"},{name:"leaveActiveClass",label:"leaveActiveClass",defaultValue:void 0,setters:"InputSetter"},{name:"leaveToClass",label:"leaveToClass",defaultValue:void 0,setters:"InputSetter"}],events:["before-enter","before-leave","enter","leave","appear","after-enter","after-leave","after-appear","enter-cancelled","leave-cancelled","ppear-cancelled"],snippet:{children:"Transition"}},{name:"TransitionGroup",label:"过渡效果组",categoryId:"components",doc:"https://cn.vuejs.org/api/built-in-components.html#transitiongroup",package:"vue",props:[{name:"name",label:"名称",defaultValue:"",title:"用于自动生成过渡 CSS class 名",setters:"InputSetter"},{name:"tag",label:"标签名",defaultValue:void 0,title:"如果未定义，则渲染为片段 (fragment)",setters:"InputSetter"},{name:"moveClass",label:"moveClass",defaultValue:void 0,title:"用于自定义过渡期间被应用的 CSS class。",setters:"InputSetter"},{name:"css",label:"应用CSS",defaultValue:!0,title:"是否应用 CSS 过渡 class",setters:"BooleanSetter"},{name:"type",label:"事件类型",defaultValue:void 0,title:"指定要等待的过渡事件类型来确定过渡结束的时间，默认情况下会自动检测持续时间较长的类型",setters:"SelectSetter",options:["transition","animation"]},{name:"duration",label:"持续时间",defaultValue:void 0,title:"显式指定过渡的持续时间",setters:["NumberSetter","JSONSetter"]},{name:"appear",label:"使用过渡",defaultValue:!1,title:"是否对初始渲染使用过渡",setters:"BooleanSetter"},{name:"enterFromClass",label:"enterFromClass",defaultValue:void 0,setters:"InputSetter"},{name:"enterActiveClass",label:"enterActiveClass",defaultValue:void 0,setters:"InputSetter"},{name:"enterToClass",label:"enterToClass",defaultValue:void 0,setters:"InputSetter"},{name:"appearFromClass",label:"appearFromClass",defaultValue:void 0,setters:"InputSetter"},{name:"appearActiveClass",label:"appearActiveClass",defaultValue:void 0,setters:"InputSetter"},{name:"appearToClass",label:"appearToClass",defaultValue:void 0,setters:"InputSetter"},{name:"leaveFromClass",label:"leaveFromClass",defaultValue:void 0,setters:"InputSetter"},{name:"leaveActiveClass",label:"leaveActiveClass",defaultValue:void 0,setters:"InputSetter"},{name:"leaveToClass",label:"leaveToClass",defaultValue:void 0,setters:"InputSetter"}],events:["before-enter","before-leave","enter","leave","appear","after-enter","after-leave","after-appear","enter-cancelled","leave-cancelled","ppear-cancelled"],snippet:{children:"TransitionGroup"}},{name:"KeepAlive",label:"缓存切换组件",categoryId:"components",doc:"https://cn.vuejs.org/api/built-in-components.html#keepalive",package:"vue",props:[{name:"include",label:"匹配包含",title:"如果指定，则只有与 `include` 名称, 匹配的组件才会被缓存。",setters:["InputSetter","JSONSetter"]},{name:"exclude",label:"匹配排除",title:"任何名称与 `exclude` 匹配的组件都不会被缓存。",setters:["InputSetter","JSONSetter"]},{name:"max",label:"最大缓存数",title:"最多可以缓存多少组件实例。",setters:["InputSetter"]}]},{name:"Teleport",label:"传送组件",categoryId:"components",doc:"https://cn.vuejs.org/api/built-in-components.html#teleport",package:"vue",props:[{name:"to",label:"目标容器",title:"指定目标容器,可以是选择器或实际元素",setters:["InputSetter"]},{name:"disabled",label:"目标容器",title:"当值为 `true` 时，内容将保留在其原始位置, 而不是移动到目标容器中, 可以动态更改",setters:["BooleanSetter"]}]},{name:"Suspense",label:"异步依赖",categoryId:"components",doc:"https://cn.vuejs.org/api/built-in-components.html#suspense",package:"vue",props:[{name:"timeout",label:"timeout",setters:["InputSetter"]}]}],zs=[{name:"vue",version:"latest",label:"内置",library:"Vue",order:0,categories:Ps,components:Bs}],Fs=C({name:"StringSetter",__name:"string",setup(u){return(e,t)=>(c(),y(a(ve),ce({clearable:""},e.$attrs),null,16))}}),Ts=C({name:"BooleanSetter",__name:"boolean",setup(u){return(e,t)=>(c(),y(a(Dt),ce(e.$attrs,{"model-value":!!e.$attrs.modelValue}),null,16,["model-value"]))}}),Ws="{{",Is="}}",Os=C({name:"ExpressionSetter",__name:"expression",props:{modelValue:{},context:{}},emits:["change"],setup(u,{emit:e}){const t=(r="")=>({type:"JSExpression",value:Pe(r)?r.value:r}),l=u,n=e,o=r=>X(r,l.context,!0),i=_(t(l.modelValue).value);ae(()=>l.modelValue,r=>{i.value=t(r).value},{immediate:!0});const s=r=>{const m={type:"JSExpression",value:r};o(m)&&n("change",m)};return(r,m)=>(c(),y(a(ve),{class:"v-expression-setter",modelValue:i.value,"onUpdate:modelValue":m[0]||(m[0]=d=>i.value=d),onChange:s},{prefix:f(()=>[$(O(Ws))]),suffix:f(()=>[$(O(Is))]),_:1},8,["modelValue"]))}}),Ls=C({name:"SelectSetter",__name:"select",props:{options:{default:()=>[]}},setup(u){const e=u;return(t,l)=>(c(),y(a(Va),ce({clearable:""},t.$attrs),{default:f(()=>[(c(!0),j(F,null,T(e.options,n=>(c(),y(a(xa),ce({key:n.label},n),null,16))),128))]),_:1},16))}}),Ms=C({name:"NumberSetter",__name:"number",props:{modelValue:{}},emits:["change"],setup(u,{emit:e}){const t=u,l=e,n=S(()=>Pe(t.modelValue)?void 0:Number(t.modelValue||0)),o=i=>{l("change",i)};return(i,s)=>(c(),y(a(Ca),ce({class:"v-number-setter","controls-position":"right","model-value":n.value},i.$attrs,{onChange:o}),null,16,["model-value"]))}}),Ns=C({name:"ColorSetter",__name:"color",setup(u){return(e,t)=>(c(),y(a(Ea),Qt(Zt(e.$attrs)),null,16))}}),Js=C({name:"JsonSetter",__name:"json",props:{modelValue:{default:void 0},type:{default:"JSON"}},emits:["change"],setup(u,{emit:e}){const t=u,l=_(),n=_(typeof t.modelValue=="object"?JSON.stringify(t.modelValue,null,2):void 0),o=S(()=>!!n.value),i=_(!1),s=e,r=v=>{let g=!0;try{const h=JSON.parse(v);if(t.type==="Array"&&!Array.isArray(h))throw new Error(`"${v}" is not a Array`);if(t.type==="Object"&&!Al(h))throw new Error(`"${v}" is not a PlainObject`);if(typeof h!="object")throw new Error(`"${v}" is not a ${t.type}`)}catch(h){g=!1,me.error({title:"代码错误",message:h?.message||h})}return g},m=()=>{const v=l.value?.getEditor();if(v){const g=v.getValue();r(g)&&(n.value=g,s("change",JSON.parse(g)),i.value=!1)}},d=()=>{n.value="",s("change",void 0),i.value=!1},b=()=>{i.value=!0};return(v,g)=>(c(),j("div",{class:ee(["v-json-setter",{"is-active":o.value}])},[p(a(ve),ce({readonly:"",onFocus:b,"model-value":t.type,"suffix-icon":a(vt)},v.$attrs),null,16,["model-value","suffix-icon"]),i.value?(c(),y(a(Be),{key:0,modelValue:i.value,"onUpdate:modelValue":g[0]||(g[0]=h=>i.value=h),title:t.type,width:"1000px",height:"600px",cancel:"",submit:"",clear:"",onSubmit:m,onClear:d},{default:f(()=>[p(a(Q),{ref_key:"codeEditor",ref:l,height:"100%",lang:"json",dark:"","model-value":n.value},null,8,["model-value"])]),_:1},8,["modelValue","title"])):x("",!0)],2))}}),Us=C({name:"FunctionSetter",__name:"function",props:{modelValue:{default:()=>({type:"JSFunction",value:""})}},emits:["change"],setup(u,{emit:e}){const t=u,l=_(),n=_(t.modelValue.value),o=_(!1),i=S(()=>!!n.value),s=e,r=()=>{const b=l.value?.getEditor();if(b){const v=b.getValue(),g={type:"JSFunction",value:v};X(g,{})&&(n.value=v,s("change",g),o.value=!1)}},m=()=>{n.value="",s("change",void 0),o.value=!1},d=()=>{o.value=!0};return(b,v)=>(c(),j("div",{class:ee(["v-function-setter",{"is-active":i.value}])},[p(a(ve),ce({readonly:"",onFocus:d,"model-value":"JSFunction","suffix-icon":a(vt)},b.$attrs),null,16,["suffix-icon"]),o.value?(c(),y(a(Be),{key:0,modelValue:o.value,"onUpdate:modelValue":v[0]||(v[0]=g=>o.value=g),title:"JSFunction",width:"1000px",height:"600px",cancel:"",submit:"",clear:"",onSubmit:r,onClear:m},{default:f(()=>[p(a(Q),{ref_key:"codeEditor",ref:l,height:"100%","model-value":n.value,dark:""},null,8,["model-value"])]),_:1},8,["modelValue"])):x("",!0)],2))}}),ne={StringSetter:Fs,BooleanSetter:Ts,ExpressionSetter:Os,SelectSetter:Ls,NumberSetter:Ms,ColorSetter:Ns,IconSetter:na,JsonSetter:Js,FunctionSetter:Us},Hs={name:"StringSetter",component:ne.StringSetter,type:"String"},$s=[{name:"InputSetter",component:ne.StringSetter,type:"String"},{name:"StringSetter",component:ne.StringSetter,type:"String"},{name:"BooleanSetter",component:ne.BooleanSetter,type:"Boolean"},{name:"ExpressionSetter",component:ne.ExpressionSetter,type:"Object"},{name:"SelectSetter",component:ne.SelectSetter,type:"String"},{name:"NumberSetter",component:ne.NumberSetter,type:"Number"},{name:"ColorSetter",component:ne.ColorSetter,type:"String"},{name:"IconSetter",component:ne.IconSetter,type:"String"},{name:"ObjectSetter",component:ne.JsonSetter,type:"Object",props:{type:"Object"}},{name:"ArraySetter",component:ne.JsonSetter,type:"Array",props:{type:"Array"}},{name:"JsonSetter",component:ne.JsonSetter,type:"Object",props:{type:"JSON"}},{name:"JSONSetter",component:ne.JsonSetter,type:"Object",props:{type:"JSON"}},{name:"FunctionSetter",component:ne.FunctionSetter,type:"Function"}];class qs{widgets={};constructor(){this.widgets=this.createWidgets()}createWidgets(){const e={};for(const t of As)e[t.name]=t;return e}register(e){this.widgets[e.name]=e}get(e){return this.widgets[e]}set(e,t){const l=this.widgets[e];if(!l){ge.warn(`widget '${e}' is not found`);return}Pt(l,t),t.component&&(l.component=t.component)}getWidgets(e,t){const l=Object.values(this.widgets);return e?l.filter(n=>n.region===e&&(!t||t&&t===n.group)):l}}const oa=new qs;class Gs{constructor(e=Ds){this.deps=e}get(){return this.deps}set(e){this.deps=e}add(e){const t=this.deps.find(l=>l.package===e.package);t?Object.assign(t,e):this.deps.push(e)}merge(e){const t=[];for(const l of this.deps){const n=e.find(o=>o.package===l.package);t.push({...l,...n})}for(const l of e)this.deps.find(n=>n.package===l.package)||t.push(l);return t}remove(e){const t=this.deps.findIndex(l=>l.package===e);t>-1&&this.deps.splice(t,1)}}const Qs=new Gs;class Zs{setters={};defaultSetter=Hs;constructor(){this.setters=this.createSetters()}createSetters(){const e={};for(const t of $s)e[t.name]=t;return e}register(e){this.setters[e.name]=e}get(e){return this.setters[e]}set(e,t){const l=this.setters[e];if(!l){ge.warn(`setter '${e}' is not found`);return}Pt(l,t),t.component&&(l.component=t.component)}getByType(e){return Object.values(this.setters).filter(t=>t.type===e).map(t=>t.name)}}const Me=new Zs;function Ks(u){return new Promise((e,t)=>{const l=$t(Tn,{slots:u,onClose:()=>{l.unmount(),t(null)},onSubmit:n=>{l.unmount(),e(n)}});l.mount(document.createElement("div"))})}class Ys{constructor(e,t,l){this.engine=e,this.contentWindow=t,this.dependencies=l,this.document=this.contentWindow.document,this.bindEvents(t,this.document)}proxied={};document=null;hover=Le(null);dropping=Le(null);selected=Le(null);dragging=null;bind(e,t){let l=this.proxied[t];return l||(l=e.bind(this),this.proxied[t]=l),l}bindEvents(e,t){t.addEventListener("mouseover",this.bind(this.onMouseOver,"onMouseOver")),t.addEventListener("scroll",this.bind(this.onViewChange,"onViewChange")),e.addEventListener("resize",this.bind(this.onViewChange,"onViewChange")),t.addEventListener("mouseleave",this.bind(this.onLeave,"onLeave")),t.addEventListener("dragleave",this.bind(this.onLeave,"onLeave")),t.addEventListener("dragover",this.bind(this.onDragOver,"onDragOver")),t.addEventListener("drop",this.bind(this.onDrop,"onDrop")),t.addEventListener("click",this.bind(this.onSelected,"onSelected")),q.on(st,this.bind(this.onActiveChange,"onActiveChange")),q.on(De,this.bind(this.onViewChange,"onViewChange"))}unbindEvents(e,t){t.removeEventListener("mouseover",this.bind(this.onMouseOver,"onMouseOver")),t.removeEventListener("scroll",this.bind(this.onViewChange,"onViewChange")),e.removeEventListener("resize",this.bind(this.onViewChange,"onViewChange")),t.removeEventListener("mouseleave",this.bind(this.onLeave,"onLeave")),t.removeEventListener("dragleave",this.bind(this.onLeave,"onLeave")),t.removeEventListener("dragover",this.bind(this.onDragOver,"onDragOver")),t.removeEventListener("drop",this.bind(this.onDrop,"onDrop")),t.removeEventListener("click",this.bind(this.onSelected,"onSelected")),q.off(st,this.bind(this.onActiveChange,"onActiveChange")),q.off(De,this.bind(this.onViewChange,"onViewChange"))}onMouseOver(e){const t=this.getHelper(e);t?.model.id!==this.selected.value?.model.id&&(this.hover.value=t)}onViewChange(){this.updateRect()}onLeave(e){this.hover.value=null,this.dropping.value=null}onActiveChange(){this.hover.value=null,this.dropping.value=null,this.selected.value=null}async getDropSlot(e){if(!e)return;const{engine:t}=this,l=t.assets,n=l.componentMap,o=await l.getBlockMaterial(e.from)||n.get(e.name);if(!o?.slots)return;const i=(o?.slots||["default"]).map(r=>typeof r=="string"?{name:r,params:[]}:{name:r.name,params:r.params||[]});if(i.length===0)return;if(i.length===1)return i[0];const s=await Ks(i).catch(()=>null);if(!(s&&s.name==="default"&&(!s.params||s.params?.length===0)))return s}async onDrop(e){e.preventDefault();const{engine:t,dragging:l,dropping:n}=this,o=t.current.value,i=this.getHelper(e);if(!o||!l||!n.value||!i)return;const s=i.model,r=n.value.type;if(!await this.allowDrop(s,r))return;const m=this.createNodeDsl(l),d=new kt(m);if(H(s))o.addNode(d,void 0,r);else{const b=await this.getDropSlot(r==="inner"?s:s.parent);if(b===null){this.dropping.value=null;return}d.slot=b,o.addNode(d,s,r)}this.dropping.value=null}onSelected(e){this.setHover(null),this.selected.value=this.getHelper(e)}async onDragOver(e){const t=this.getHelper(e);if(!t)return;const{model:l,type:n}=t;l&&await this.allowDrop(l,n)?(e.preventDefault(),this.dropping.value=t):this.dropping.value=null}isVtjElement(e){return!!e.__vtj__&&!!e.__context__}findVtjElement(e){return e.find(t=>this.isVtjElement(t))}getNodeByElement(e){const t=e.__vtj__??"";return kt.nodes[t]||null}getDropType(e,t,l){const{left:n,top:o,width:i,height:s}=e;return t>=n&&t<=n+i*.2?"left":t>=n+i*.8&&t<=n+i?"right":l>=o&&l<=o+s*.2?"top":l>=o+s*.8&&l<=o+s?"bottom":"inner"}getNodePath(e=[]){const t=e.filter(n=>this.isVtjElement(n)),l=this.engine.current.value;return[...t.map(n=>this.getNodeByElement(n)).filter(n=>!!n),l]}setDslFrom(e){const t=this.engine.assets.componentMap.get(e.name);if(e.from=e.from||t?.package,Array.isArray(e.children))for(const l of e.children)this.setDslFrom(l)}createNodeDsl(e){const{name:t,snippet:l={},from:n}=e,o={...l,name:t,from:n||e.package};return this.setDslFrom(o),o}getElmenetByModel(e){return!this.document||!e?null:H(e)?this.document.body:Array.from(this.document.querySelectorAll("*")).find(t=>t.__vtj__===e.id)}findPathByNode(e){const t=[e];let l=e;for(;l.parent&&l.parent!==l;)l=l.parent,l!==e&&t.unshift(l);const n=this.engine.current.value;return t.unshift(n),t.reverse()}getHelper(e){const t=e.composedPath()||[],l=this.findVtjElement(t)||this.document?.body;if(!l)return null;const n=this.getNodeByElement(l)||this.engine.current.value;if(!n)return null;const o=l.getBoundingClientRect(),i=this.getDropType(o,e.clientX,e.clientY),s=this.getNodePath(t);return{el:l,model:n,rect:o,type:i,path:s}}cleanHelper(){this.setSelected(null),this.setHover(null),this.setDragging(null),this.setDropping(null)}async updateRect(){await Wt(0);const e=a(this.selected),t=a(this.hover);if(e){const l=e.el.getBoundingClientRect();this.selected.value={...e,rect:l}}if(t){const l=t.el.getBoundingClientRect();this.hover.value={...t,rect:l}}}setDragging(e){this.dragging=e}async setHover(e){if(await ke(),e){const t=this.getElmenetByModel(e);if(!t)return;const l=t.getBoundingClientRect(),n=H(e)?[]:this.findPathByNode(e);this.hover.value={el:t,model:e,rect:l,type:"inner",path:n}}else this.hover.value=null}async setSelected(e){if(await ke(),e){const t=this.getElmenetByModel(e)||this.document?.createElement("span");if(!t)return;const l=t.getBoundingClientRect(),n=H(e)?[]:this.findPathByNode(e);this.selected.value={el:t,model:e,rect:l,type:"inner",path:n}}else this.selected.value=null}async setDropping(e,t="inner"){if(await ke(),e){const l=this.getElmenetByModel(e);if(!l)return;const n=l.getBoundingClientRect(),o=H(e)?[]:this.findPathByNode(e);this.dropping.value={el:l,model:e,rect:n,type:t,path:o}}else this.dropping.value=null}async allowDrop(e,t="inner"){const{dragging:l,engine:n}=this,o=n.current.value;if(!l||!o)return!1;if(H(e))return!0;const i=n.assets.componentMap,s=t!=="inner"&&e.parent||e,r=await n.assets.getBlockMaterial(s.from)||i.get(s.name);if(!r)return!1;const{parentIncludes:m=!0,name:d}=l,{childIncludes:b=!0}=r,v=m===!0||Array.isArray(m)&&m.includes(s.name),g=b===!0||Array.isArray(b)&&b.includes(d);return v&&g}dispose(){const{contentWindow:e,document:t}=this;this.setSelected(null),this.setHover(null),this.setDragging(null),e&&t&&this.unbindEvents(e,t),this.document=null}}class Xs{constructor(e,t,l=null){this.env=e,this.service=t,this.designer=l,this.nodeChange=this.__onNodeChange.bind(this),this.blockChange=this.__onBlockChange.bind(this)}app=null;dsl=null;nodeChange;blockChange;context=null;install(e){const{library:t,globals:l}=this.env,n=Object.values(t);Object.assign(e.config.globalProperties,l),e.config.errorHandler=(o,i,s)=>{const r=i?.$options.name,m=o?.message||o?.msg||"未知错误",d=`[ ${r} ] ${m}`;console.error({err:o,instance:i,info:s}),me.error({title:"运行错误",message:d})},n.forEach(o=>{(typeof o=="function"||typeof o.install=="function")&&e?.use(o)})}render(e){const{window:t,container:l,Vue:n,components:o,library:i,apis:s}=this.env,r=t.document.createElement("div");r.id="app",l.appendChild(r),this.dsl=n.reactive(e.toDsl());const m=_l({getDsl:async v=>await this.service.getFile(v)||null,options:{mode:nt.Design,Vue:n,components:o,libs:i,apis:s,window:t}}),{renderer:d,context:b}=Sl({Vue:n,mode:nt.Design,dsl:this.dsl,components:o,libs:i,apis:s,loader:m,window:t});this.app=n.createApp(d),this.install(this.app);try{this.app.mount(r)}catch(v){K(v.message||"未知错误","运行时错误"),console.error(v)}this.context=b,q.on(De,this.nodeChange),q.on(ot,this.blockChange)}dispose(){if(this.app){this.app.unmount();const e=this.app._container;e&&e.parentNode&&(e.parentNode.removeChild(e),this.app._container=null),this.app=null}this.dsl=null,this.context=null,q.off(De,this.nodeChange),q.off(ot,this.blockChange)}updateChild(e,t){const l=t.children||t.nodes||[];if(Array.isArray(l))for(let n=0;n<l.length;n++){const o=l[n];if(o.id===e.id){l.splice(n,1,e);return}else this.updateChild(e,o)}}__onNodeChange(e){this.dsl&&this.updateChild(e.toDsl(),this.dsl)}__onBlockChange(e){this.dispose(),this.render(e),this.designer?.selected.value&&this.designer.setSelected(e)}}class eo extends Ft{contentWindow=null;renderer=null;designer=Le(null);engine;materialPath;constructor(e){super();const{engine:t,materialPath:l}=e;this.engine=t,this.materialPath=l,ae(this.engine.current,()=>{this.refresh()})}init(e,t){Gt(()=>{e.value&&t.value.length&&(this.resetReady(),this.setup(e.value,t.value),this.contentWindow&&(this.designer.value?.dispose(),this.designer.value=new Ys(this.engine,this.contentWindow,t)))})}setup(e,t){const l=e.contentWindow;if(!l){ge.warn("Simulator contentWindow is null");return}l.__simulator__=this;const n=l.document;this.contentWindow=l;const{scripts:o,css:i,materials:s,libraryExports:r,materialExports:m,materialMapLibrary:d}=pl(t,this.materialPath);n.open(),n.write(`
     <!DOCTYPE html>
     <html lang="zh-CN">
       <head>
       <meta charset="utf-8">
       <meta name="viewport"
             content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0,viewport-fit=cover"/>
         <style>
            html, body, #app {
              padding: 0;
              margin: 0;
              min-height: 100vh;
              width: 100%;
              height: 100%;
              background: #fff;
            }
         </style>
         ${vl(i)}
         ${wt(o)}
         ${wt(s)}
       </head>
       <body> 
       </body>
       <script>
       __simulator__.emitReady(${JSON.stringify(r)},
        ${JSON.stringify(m)}, 
    ${JSON.stringify(d)});
     <\/script> 
     </html>
    `),n.close()}async emitReady(e=[],t=[],l={}){this.renderer?.dispose(),this.renderer=null;const n=this.contentWindow,{assets:o,service:i,current:s,provider:r}=this.engine,m=r.materials||{},d=[];for(const v of t){const g=m[v]?(await m[v]()).default:n[v];d.push(g)}o.load(d);const b=this.createEnv(e,l,d);this.renderer=new Xs(b,i,this.designer.value),s.value&&this.renderer.render(s.value),this.triggerReady()}createEnv(e=[],t={},l=[]){const n=this.contentWindow,{engine:o}=this,{project:i,assets:s,provider:r}=o,m=e.reduce((w,E)=>(w[E]=n[E],w),{}),d={},{groups:b,componentMap:v}=s;for(const w of b.value){const E=w.names||[],V=m[t[w.library||""]];V&&E.forEach(A=>{const P=v.get(A);P?d[A]=gl(P,V):d[A]=V[A]})}const{adapter:g,globals:h}=r,k=hl(i.value?.apis,g);return{window:n,Vue:n.Vue,library:m,materials:l,components:d,container:n.document.body,apis:k,globals:h}}refresh(){this.renderer?.dispose();const e=this.engine.current.value;e&&this.renderer?.render(e)}dispose(){this.renderer?.dispose(),this.designer.value?.dispose(),this.contentWindow=null,this.renderer=null,this.designer.value=null}}class to{constructor(e){this.service=e}components=[];componentMap=new Map;groups=_([]);getCateoryComponents(e,t){const l=t.filter(n=>n.categoryId===e.id&&n.hidden!==!0);return{name:e.id,label:e.category,count:l.length,components:l}}parseGroups(e){const t=[];for(let l of e){const{categories:n,components:o,label:i,name:s,library:r}=l;if(!n||!o)continue;const m=o.map(g=>g.name),d=n.map(g=>this.getCateoryComponents(g,o)),b=d.reduce((g,h)=>h.count+g,0),v={name:l.name,label:i||s,count:b,names:m,library:r,children:d};t.push(v)}return t}load(e){const t=[...zs,...e].filter(l=>!!l);t.sort((l,n)=>l.order-n.order);for(let l of t)l.components&&(this.components=this.components.concat(l.components));this.groups.value=this.parseGroups(t),this.componentMap=fl(this.components,"name")}async getBlockMaterial(e){if(!e||typeof e=="string")return null;const t=e.type==="Schema"?e.id:null;if(!t)return null;const l=await this.service.getFile(t);if(!l)return null;const{id:n,name:o,slots:i,props:s,emits:r}=l,m=d=>{const b=Array.isArray(d)?d:[d];let v=[];for(const g of b)v=v.concat(Me.getByType(g));return v};return{id:n,name:o,childIncludes:i?.length?void 0:!1,props:(s||[]).map(d=>typeof d=="string"?{name:d}:{name:d.name,type:d.type,setters:m(d.type)}),events:r,slots:i,from:e}}}const ia=Symbol("VtjEngine");class Lo extends Ft{app;skeleton;container;service;assets;simulator;emitter=q;project=_(null);current=_(null);context=_(null);isEmptyCurrent=_(!1);history=_(null);provider;changed=_(Symbol());constructor(e){super();const{container:t,service:l,project:n={},globals:o={},dependencies:i,materials:s,materialPath:r="./"}=e;this.container=t,this.service=l,this.provider=new Ga({mode:nt.Design,globals:o,project:n,service:l,dependencies:i,materials:s,materialPath:r}),this.assets=new to(this.service),this.simulator=new eo({engine:this,materialPath:r}),this.bindEvents(),this.init(n),Ut(this.render.bind(this)),Ht(this.dispose.bind(this))}async init(e){const t=await this.service.init(e).catch(l=>(ge.warn("VTJEngine service init fail.",l),null));t&&(t.dependencies=Qs.merge(t.dependencies||[]),this.project.value=new Qa(t),this.saveMaterials(),this.triggerReady())}render(){const e=a(this.container);if(e){const t=$t(ao);t.provide(ia,Rl(this)),t.mount(e),this.app=t}else ge.warn("VTJEngine constructor param [ container ] is undefined")}bindEvents(){q.on(Za,e=>this.saveProject(e)),q.on(Ka,e=>this.saveBlockFile(e)),q.on(Ya,e=>this.saveBlockFile(e)),q.on(Xa,()=>this.saveMaterials()),q.on(st,e=>this.activeFile(e)),q.on(el,()=>this.publish()),q.on(tl,()=>this.publishCurrent()),q.on(ot,e=>this.changeFile(e)),q.on(De,()=>this.changeCurrentFile()),q.on(al,e=>this.saveHistory(e)),q.on(ll,e=>this.loadHistory(e))}async activeFile(e){await ke();const t=e.model,l=e.model.currentFile;if(l){if(t.isPageFile(l)&&l.raw)return;const n=await this.service.getFile(l.id);n&&(l.dsl=n)}if(l?.dsl){const n=new bt(l.dsl);this.updateCurrent(n),this.initHistory(n)}else this.updateCurrent(null);be(this.project)}async changeFile(e){await ke();const t=e.toDsl();this.service.saveFile(t),this.updateCurrent(e),this.history.value?.add(t),be(this.history)}changeCurrentFile(){this.saveCurrentFile(),this.current.value&&(this.history.value?.add(this.current.value.toDsl()),be(this.history))}async updateCurrent(e,t=!0){this.current.value=e,await ke(),this.context.value=this.simulator.renderer?.context||null,this.isEmptyCurrent.value=this.current.value?.nodes.length===0,this.changed.value=Symbol(),t&&be(this.context)}async saveProject(e){const t=e.model.toDsl();await this.service.saveProject(t),be(this.project)}async saveBlockFile(e){const t=e.type,l=e.model;if(t==="create"){const n=e.data;l.isPageFile(n)&&n.raw?(await this.service.createRawPage(n),se(`源码文件已经生成：/.vtj/vue/${n.id}.vue`,"success")):n.dsl&&await this.service.saveFile(n.dsl)}if(t==="update"){const n=e.data;if(l.isPageFile(n)&&(n.dir||n.raw))return;const o=await this.service.getFile(n.id);o&&(o.name=n.name,await this.service.saveFile(o))}if(t==="delete"){const n=e.data;n&&l.isPageFile(n)&&n.raw?await this.service.removeRawPage(n.id):n.dir||(await this.service.removeFile(n.id),await this.service.removeHistory(n.id))}if(t==="clone"){const{page:n,newPage:o}=e.data,i=await this.service.getFile(n.id);i&&(i.id=o.id,i.name=o.name,await this.service.saveFile(i))}be(this.project)}async saveMaterials(){await ke(),this.simulator.ready(()=>{const e=this.project.value;if(e){const t=this.assets.componentMap;this.service.saveMaterials(e.toDsl(),t)}})}saveCurrentFile(){const e=this.current.value;e&&(this.updateCurrent(e),this.service.saveFile(e.toDsl()))}async initHistory(e){if(e){const t=await this.service.getHistory(e.id).catch(()=>null);this.history.value=new nl(Object.assign(t||{},{id:e.id}))}else this.history.value=null}async saveHistory(e){const t=e.type,l=e.model;t==="create"&&await this.service.saveHistoryItem(l.id,e.data),t==="delete"&&await this.service.removeHistoryItem(l.id,e.data),t==="clear"&&await this.service.removeHistoryItem(l.id,e.data);const n=l.toDsl();await this.service.saveHistory(n),be(this.history)}async loadHistory(e){const t=e.model,l=e.data,n=await this.service.getHistoryItem(t.id,l.id);if(n&&n.dsl){const o=new bt(n.dsl);await this.updateCurrent(o),be(this.history)}}async publish(){const e=this.project.value;if(e){const t={...e.toDsl(),pages:e.getPages()};await this.service.publish(t)&&se("整站发布成功","success")}}async publishCurrent(){const e=this.project.value,t=e?.currentFile;if(e&&t){const l={...e.toDsl(),pages:e.getPages()};await this.service.publishFile(l,t)&&se("发布成功","success")}}dispose(){this.emitter.all.clear(),this.simulator.dispose(),this.app&&(this.app.unmount(),this.container=void 0)}async openFile(e){const t=this.project.value,l=this.skeleton?.getRegion("Apps"),n=e||t?.homepage;if(!t||!l||!n)return;const o=t.getPage(n);o&&!o.raw&&(l.regionRef?.setActive("Pages"),this.simulator.ready(()=>{t.active(o)}));const i=t.getBlock(n);i&&(l.regionRef?.setActive("Blocks"),this.simulator?.ready(()=>{t.active(i)}))}}function le(){const u=Fl(ia,null);return u||ge.error("VTJEngine is not exist"),u}const ye=C({name:"RegionWrapper",props:{region:{type:String,required:!0}},setup(){return{regionRef:_()}},render(){const u=Ct[this.region]||Ct.EmptyRegion;return Ce(u,{...this.$props,...this.$attrs,ref:"regionRef"})}}),xe=C({name:"WidgetWrapper",props:{region:{type:String,required:!0},widget:{type:Object,required:!0}},setup(){return{widgetRef:_()}},render(){return Ce(this.widget.component,{...this.widget.props,...this.$props,...this.$attrs,ref:"widgetRef"})}}),ao=C({name:"SkeletonWrapper",setup(){const u=_(),e=le(),t=_({});return{skeletonRef:u,engine:e,widgets:t}},mounted(){this.engine.skeleton=this},render(){return Ce(lo,{...this.$props,...this.$attrs,ref:"skeletonRef"})},methods:{getRegion(u){return this.skeletonRef[u.toLowerCase()]},toggleCollapse(u){if(this.skeletonRef){const e=this.skeletonRef.collapsed;this.skeletonRef.collapsed=u??!e}},settable(u){this.skeletonRef&&(this.skeletonRef.settable=u)},getWidgets(u){const e=this.getRegion(u);return e?sl(e.regionRef?.widgetsRef||[]):[]},getWidget(u){const e=oa.get(u);if(!e){ge.warn(`widget [ ${u} ] is not exsit`);return}return this.getWidgets(e.region).find(t=>t.widget.name===u)},openPreview(u){this.skeletonRef&&(this.skeletonRef.isPreview=!0)},closePreview(){this.skeletonRef&&(this.skeletonRef.isPreview=!1)}}}),we=C({name:"SetterWrapper",props:{context:{type:Object},current:{type:Object},name:String,label:String,title:String,value:{type:[String,Object,Array,Number,Boolean],default:void 0},setters:{type:[String,Object,Array],required:!0,default(){return[]}},options:{type:Array,default(){return[]}},variable:{type:Boolean,default:!0},removable:{type:Boolean,default:!1}},computed:{computedSetters(){return(Array.isArray(this.setters)?this.setters:[this.setters]).map(u=>{let e;if(typeof u=="string")return e=this.getSetter(u),{component:_t(e.component),name:e.name,label:u,props:e.props||{}};{const t=u;return e=this.getSetter(t.name),{component:_t(t.component||e.component),name:t.name,label:t.label||t.name,props:Object.assign(e.props||{},t.props)}}})},computedOptions(){return(this.options||[]).map(u=>typeof u=="string"?{label:u,value:u}:u)},defaultSetter(){const{value:u,computedSetters:e}=this;let t=typeof u;t==="Object"&&(Array.isArray(u)?t="Array":Pe(u)?t="Object":ol(u)&&(t="Function"));const l=Me.getByType(t)||[];return l.length?(e.find(n=>l.includes(n.name))||e[0])?.name:e[0]?.name}},render(){const{context:u,current:e,name:t,label:l,title:n,value:o,computedSetters:i,computedOptions:s,variable:r,changeValue:m,defaultSetter:d,removable:b,onRemove:v}=this;return Ce(co,{context:u,current:e,name:t,label:l,title:n,setters:i,defaultSetter:d,variable:r,value:o,removable:b,options:s,onChange:m,onRemove:v})},emits:["change","remove"],methods:{getSetter(u){return typeof u=="string"?Me.get(u)||Me.defaultSetter:u},changeValue(u){this.$emit("change",this.name,u)},onRemove(u){this.$emit("remove",u)}}}),lo=C({name:"Skeletion",__name:"skeleton",props:{headerHeight:{default:"36px"},leftWidth:{default:"400px"},rightWidth:{default:"350px"},footerHeight:{default:"20px"}},setup(u,{expose:e}){const t=u,l=_(!1),n=_(parseInt(t.leftWidth)),o=_(parseInt(t.rightWidth)),i={dirs:["e"],maxWidth:600,minWidth:49,onResizing(V,A){n.value=A.elementWidth.value},onEnd(V,A){n.value=A.elementWidth.value}},s={dirs:["w"],maxWidth:600,minWidth:2,onResizing(V,A){o.value=A.elementWidth.value},onEnd(V,A){o.value=A.elementWidth.value}},r=_(),m=_(),d=_(),b=_(),v=_(),g=_(),h=_(),k=_(),w=_(!1),E=_(!1);return e({brand:r,toolbar:m,actions:d,apps:b,workspace:v,settings:g,status:h,collapsed:w,settable:E,leftWidth:n,rightWidth:o,preview:k,isPreview:l}),(V,A)=>(c(),y(a(wa),{locale:a(ya)},{default:f(()=>[p(a(ht),{class:"v-skeleton"},{default:f(()=>[p(a(ha),{class:"v-skeleton__header",height:V.headerHeight},{default:f(()=>[p(a(ye),{ref_key:"brand",ref:r,region:"Brand"},null,512),p(a(ye),{ref_key:"toolbar",ref:m,region:"Toolbar",preview:l.value},null,8,["preview"]),p(a(ye),{ref_key:"actions",ref:d,region:"Actions"},null,512)]),_:1},8,["height"]),p(a(ht),{class:"v-skeleton__wrapper"},{default:f(()=>[l.value?x("",!0):Ae((c(),y(a(ft),{key:0,width:t.leftWidth,class:ee(["v-skeleton__left",{"is-collapsed":w.value}])},{default:f(()=>[p(a(ye),{ref_key:"apps",ref:b,region:"Apps"},null,512)]),_:1},8,["width","class"])),[[a(yt),i]]),p(a(fa),{class:"v-skeleton__main"},{default:f(()=>[l.value?(c(),y(a(ye),{key:0,ref_key:"preview",ref:k,region:"Preview",preview:l.value},null,8,["preview"])):x("",!0),Ae(p(a(ye),{ref_key:"workspace",ref:v,region:"Workspace"},null,512),[[Ue,!l.value]])]),_:1}),l.value?x("",!0):Ae((c(),y(a(ft),{key:1,width:t.rightWidth,class:"v-skeleton__right"},{default:f(()=>[p(a(ye),{ref_key:"settings",ref:g,region:"Settings"},null,512)]),_:1},8,["width"])),[[Ue,E.value],[a(yt),s]])]),_:1}),l.value?x("",!0):(c(),y(a(ba),{key:0,class:"v-skeleton__footer",height:V.footerHeight},{default:f(()=>[p(a(ye),{ref_key:"status",ref:h,region:"Status"},null,512)]),_:1},8,["height"]))]),_:1})]),_:1},8,["locale"]))}}),no={key:1},so={class:"v-setter__content"},oo={key:0,class:"v-setter__input"},io={class:"v-setter__action"},ro="{{",uo="}}",co=C({__name:"setter",props:{context:{},current:{},name:{},label:{default:""},title:{},setters:{},variable:{type:Boolean,default:!0},value:{},options:{default:()=>[]},defaultSetter:{},removable:{type:Boolean}},emits:["change","remove"],setup(u,{emit:e}){const t=u,l=e,n=_(!1),o=_(""),i=_(t.setters.find(E=>E.name===t.defaultSetter)||t.setters[0]),s=_(t.value),r=S(()=>!!Pe(s.value)),m={[i.value.name]:s.value},d=E=>{m[i.value.name]=s.value,i.value=E,s.value=m[E.name]??void 0,b(s.value)};ae(()=>t.value,()=>{s.value=t.value}),ae(()=>t.defaultSetter,()=>{i.value=t.setters.find(E=>E.name===t.defaultSetter)||t.setters[0]});const b=E=>{l("change",E)},v=()=>{l("remove",t.name)},g=()=>{n.value=!0,o.value=Pe(s.value)?s.value.value:""},h=()=>{n.value=!1,o.value=""},k=async E=>X(E,t.context,!0)?(m[i.value.name]=s.value,s.value=E,l("change",E),!0):!1,w=async()=>{await Ee("确定要解除绑定吗？")&&(h(),s.value=void 0,l("change",""))};return(E,V)=>(c(),y(a(ka),{class:"v-setter",size:"small","label-positon":"left"},{label:f(()=>[t.title?(c(),y(a(At),{key:0,placement:"top-start",content:t.title},{default:f(()=>[$(O(t.label||t.name),1)]),_:1},8,["content"])):(c(),j("span",no,O(t.label||t.name),1))]),default:f(()=>[I("div",so,[i.value?(c(),j("div",oo,[r.value?x("",!0):(c(),y(qt(i.value.component),ce({key:0,current:t.current,context:t.context},i.value.props,{options:t.options,modelValue:s.value,"onUpdate:modelValue":V[0]||(V[0]=A=>s.value=A),onChange:b,disabled:r.value}),null,16,["current","context","options","modelValue","disabled"])),r.value?(c(),y(a(ve),{key:1,class:"v-expression-setter",disabled:"","model-value":"JSExpression"},{prefix:f(()=>[$(O(ro))]),suffix:f(()=>[$(O(uo))]),_:1})):x("",!0)])):x("",!0),I("div",io,[t.variable?(c(),y(a(il),{key:0,onClick:g,class:ee(["v-icon-vars",{"is-active":r.value}]),title:"绑定变量"},null,8,["class"])):x("",!0),t.setters.length>1?(c(),y(a(jt),{key:1,disabled:r.value,size:"small","popper-class":"v-setter-switch",onCommand:d},{dropdown:f(()=>[p(a(Et),null,{default:f(()=>[(c(!0),j(F,null,T(t.setters,A=>(c(),y(a(et),{command:A,key:A.name},{default:f(()=>[p(a(Tt),{class:ee({"is-placeholder":A.name!==i.value.name})},null,8,["class"]),$(" "+O(A.label),1)]),_:2},1032,["command"]))),128))]),_:1})]),default:f(()=>[p(a(rl),{title:"切换设置器"})]),_:1},8,["disabled"])):x("",!0),t.removable?(c(),y(a(He),{key:2,onClick:v,title:"删除"})):x("",!0)])]),n.value?(c(),y(a(ls),{key:0,current:t.current,context:t.context,value:o.value,modelValue:n.value,"onUpdate:modelValue":V[1]||(V[1]=A=>n.value=A),submitMethod:k,onUnbind:w},null,8,["current","context","value","modelValue"])):x("",!0)]),_:1}))}}),mo={class:"v-empty-region"},po=C({name:"EmptyRegion",__name:"empty",props:{region:{}},setup(u){return(e,t)=>(c(),j("div",mo,"找不到符合【"+O(e.region)+"】名称的区域组件",1))}}),vo={class:"v-brand-region"},go=C({name:"BrandRegion",inheritAttrs:!1,__name:"brand",props:{region:{}},setup(u,{expose:e}){const t=u,{widgets:l,widgetsRef:n}=Se(t.region);return e({widgets:l,widgetsRef:n}),(o,i)=>(c(),j("div",vo,[(c(!0),j(F,null,T(a(l),s=>(c(),y(a(xe),{ref_for:!0,ref_key:"widgetsRef",ref:n,region:o.region,widget:s},null,8,["region","widget"]))),256))]))}}),ho={class:"v-toolbar-region"},fo=C({name:"ToolbarRegion",__name:"toolbar",props:{region:{},preview:{type:Boolean}},setup(u,{expose:e}){const t=u,{widgets:l,widgetsRef:n}=Se(t.region);return e({widgets:l,widgetsRef:n}),(o,i)=>(c(),j("div",ho,[(c(!0),j(F,null,T(a(l),s=>(c(),y(a(xe),{ref_for:!0,ref_key:"widgetsRef",ref:n,region:o.region,widget:s,preview:o.preview},null,8,["region","widget","preview"]))),256))]))}}),bo={class:"v-actions-region"},yo=C({name:"ActionsRegion",inheritAttrs:!1,__name:"actions",props:{region:{}},setup(u,{expose:e}){const t=u,{widgets:l,widgetsRef:n}=Se(t.region);return e({widgets:l,widgetsRef:n}),(o,i)=>(c(),j("div",bo,[(c(!0),j(F,null,T(a(l),s=>(c(),y(a(xe),{ref_for:!0,ref_key:"widgetsRef",ref:n,region:o.region,widget:s},null,8,["region","widget"]))),256))]))}}),wo={class:"v-apps-region"},ko={class:"v-apps-region__header"},_o={class:"v-apps-region__top"},So={class:"v-apps-region__bottom"},xo={class:"v-apps-region__panels"},Vo=C({name:"AppsRegion",inheritAttrs:!1,__name:"apps",props:{region:{},index:{default:0}},setup(u,{expose:e}){const t=u,l=le(),{widgets:n,widgetsRef:o}=Se(t.region),i=S(()=>n.value.filter(g=>g.openType==="panel")),s=S(()=>n.value.filter(g=>g.openType!=="panel")),r=i.value[t.index],m=_(r),d=_(r),b=g=>{m.value=g,d.value=d.value?.name===g.name?null:g},v=g=>{g.openType==="link"&&g.url&&window.open(g.url),g.openType==="dialog"&&jl({title:g.label,icon:g.icon,...g.props,content:g.component})};return ae(d,g=>{l.skeleton?.toggleCollapse(!g)}),e({widgets:n,widgetsRef:o,setActive:g=>{const h=i.value.find(k=>k.name===g);m.value=h,d.value=h}}),(g,h)=>(c(),j("div",wo,[I("div",ko,[I("div",_o,[(c(!0),j(F,null,T(i.value,k=>(c(),y(a(Vt),{key:`icon-${k.name}`,icon:k.icon,label:k.label,active:m.value?.name===k.name,open:d.value?.name===k.name,onClick:w=>b(k)},null,8,["icon","label","active","open","onClick"]))),128))]),I("div",So,[(c(!0),j(F,null,T(s.value,k=>(c(),y(a(Vt),{key:`icon-${k.name}`,icon:k.icon,label:k.label,onClick:w=>v(k)},null,8,["icon","label","onClick"]))),128))])]),I("div",xo,[(c(!0),j(F,null,T(i.value,k=>(c(),y(Kt,{key:k.name},[m.value?.name===k.name?(c(),y(a(xe),{key:0,ref_for:!0,ref_key:"widgetsRef",ref:o,region:g.region,widget:k},null,8,["region","widget"])):x("",!0)],1024))),128))])]))}}),Co=C({name:"WorkspaceRegion",__name:"workspace",props:{region:{}},setup(u,{expose:e}){const t=u,{widgets:l,widgetsRef:n}=Se(t.region),o=ze(l.value.map(v=>({name:v.name,command:v.name,label:v.label,closable:!!v.closable,props:v.props||{},checked:!v.closable}))),i=S(()=>o.filter(v=>!v.closable||v.checked)),s=S(()=>o.map(v=>({...v,disabled:!v.closable}))),r=_(i.value[0]?.name),m=S(()=>o.find(v=>v.name===r.value)?.props||{}),d=v=>{const g=o.find(h=>h.name===v);g&&(g.checked=!1),r.value===v&&(r.value=i.value[0]?.name)},b=v=>{const g=o.find(h=>h.name===v.name);g&&g.closable&&(g.checked=!g.checked,g.checked&&(r.value=g.name),!g.checked&&r.value===g.name&&(r.value=i.value[0]?.name))};return e({currentTab:r,widgets:l,widgetsRef:n,openTab:(v,g={})=>{const h=o.find(k=>k.name===v);h&&(h.props=Object.assign({},h.props,g),h.checked=!0,r.value=h.name)}}),(v,g)=>(c(),y(a(Ge),{class:"v-workspace-region",items:i.value,menus:s.value,modelValue:r.value,"onUpdate:modelValue":g[0]||(g[0]=h=>r.value=h),checkable:"",onRemove:d,onCommand:b},{default:f(()=>[(c(!0),j(F,null,T(a(l),h=>(c(),j(F,{key:h.name},[r.value===h.name?(c(),y(a(xe),{key:0,ref_for:!0,ref_key:"widgetsRef",ref:n,region:v.region,widget:{...h,props:m.value}},null,8,["region","widget"])):x("",!0)],64))),128))]),_:1},8,["items","menus","modelValue"]))}}),Eo=C({name:"SettingsRegion",__name:"settings",props:{region:{}},setup(u,{expose:e}){const t=u,l=le(),{current:n}=te(),{selected:o,isSelectBlock:i}=fe(),s=S(()=>i.value?re.Block:re.Node),{widgets:r,widgetsRef:m}=Se(t.region,s),d=S(()=>r.value.map(h=>({name:h.name,label:h.label}))),b=_(""),v=S(()=>{const h=o.value?.model;return h?l.assets.componentMap.get(h.name)?.doc:null});ae(n,h=>{l.skeleton?.settable(!!h)}),ae(s,()=>{b.value=d.value[0]?.name},{immediate:!0});const g=()=>{if(v.value){const h=l.skeleton?.getRegion("Workspace");h&&h.regionRef.openTab("Docs",{url:v.value})}};return e({widgets:r,widgetsRef:m}),(h,k)=>a(n)?(c(),y(a(L),{key:0,class:"v-settings-region",fit:"",direction:"column"},{default:f(()=>[a(o)?(c(),y(a(L),{key:0,flex:"",justify:"space-between",align:"center",class:"v-settings-region__header"},{default:f(()=>[p(a(L),{class:"v-settings-region__title"},{default:f(()=>[p(a(Mt)),I("span",null,[$(O(a(o)?.model.name)+": ",1),I("i",null,O(a(o)?.model.id),1)])]),_:1}),v.value?(c(),y(a(L),{key:0},{default:f(()=>[p(a(_e),{onClick:g,icon:a(xl),mode:"text",label:"帮助"},null,8,["icon"])]),_:1})):x("",!0)]),_:1})):x("",!0),a(o)&&!a(o).model.locked?(c(),y(a(L),{key:1,grow:"",padding:!1},{default:f(()=>[p(a(Ge),{items:d.value,modelValue:b.value,"onUpdate:modelValue":k[0]||(k[0]=w=>b.value=w),stretch:"",body:{padding:!1}},{default:f(()=>[(c(!0),j(F,null,T(a(r),w=>(c(),j(F,{key:w.name},[b.value===w.name?(c(),y(a(xe),{key:0,ref_for:!0,ref_key:"widgetsRef",ref:m,region:h.region,widget:w},null,8,["region","widget"])):x("",!0)],64))),128))]),_:1},8,["items","modelValue"])]),_:1})):x("",!0),a(o)?x("",!0):(c(),y(a(Z),{key:2,description:"请在左侧画布选中节点"})),a(o)&&a(o).model.locked?(c(),y(a(Z),{key:3,"image-size":1,description:"节点已被锁定, 禁止编辑"})):x("",!0)]),_:1})):x("",!0)}}),jo={class:"v-status-region"},Ao=C({name:"StatusRegion",inheritAttrs:!1,__name:"status",props:{region:{}},setup(u,{expose:e}){const t=u,{widgets:l,widgetsRef:n}=Se(t.region);return e({widgets:l,widgetsRef:n}),(o,i)=>(c(),j("div",jo,[(c(!0),j(F,null,T(a(l),s=>(c(),y(a(xe),{ref_for:!0,ref_key:"widgetsRef",ref:n,region:o.region,widget:s},null,8,["region","widget"]))),256))]))}}),Do=C({name:"PreviewRegion",__name:"preview",props:{region:{}},setup(u,{expose:e}){const t=u,{widgets:l,widgetsRef:n}=Se(t.region),o=ze(l.value.map(r=>({name:r.name,command:r.name,label:r.label,closable:!!r.closable,checked:!1}))),i=S(()=>o.filter(r=>!r.closable||r.checked)),s=_(i.value[0]?.name);return e({currentTab:s,widgets:l,widgetsRef:n}),(r,m)=>(c(),y(a(Ge),{class:"v-workspace-region",items:i.value,modelValue:s.value,"onUpdate:modelValue":m[0]||(m[0]=d=>s.value=d)},{default:f(()=>[(c(!0),j(F,null,T(a(l),d=>(c(),y(Kt,{key:d.name},[s.value===d.name?(c(),y(a(xe),{key:0,ref_for:!0,ref_key:"widgetsRef",ref:n,region:r.region,widget:d},null,8,["region","widget"])):x("",!0)],1024))),128))]),_:1},8,["items","modelValue"]))}}),Ct={EmptyRegion:po,Brand:go,Toolbar:fo,Actions:yo,Apps:Vo,Workspace:Co,Settings:Eo,Status:Ao,Preview:Do};class Mo extends Dl{publish(e){return me.warning({title:"提示",message:"在线演示版本不支持发布功能，如需体验请下载本地版本。"}),Promise.resolve(!1)}publishFile(e,t){return me.warning({title:"提示",message:"在线演示版本不支持发布功能，如需体验请下载本地版本。"}),Promise.resolve(!1)}genVueContent(e,t){return me.warning({title:"提示",message:"在线演示版本不支持源码生成功能，如需体验请下载本地版本。"}),Promise.resolve("")}async createRawPage(e){return me.warning({title:"提示",message:"在线演示版本不支持源码模式页面，如需体验请下载本地版本。"}),Promise.resolve(!1)}async removeRawPage(e){return me.warning({title:"提示",message:"在线演示版本不支持源码模式页面，如需体验请下载本地版本。"}),Promise.resolve(!1)}}export{Mo as L,Wo as M,Io as P,Oo as a,Lo as b,oa as r};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./Editor-ctkAn2cu-j1FUryYs.js","./monaco-editor-a3IpPo1Q.js","./monaco-editor-cf__QvdG.css","./@vue-lwVaHA3a.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
