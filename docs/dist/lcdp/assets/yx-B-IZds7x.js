import"./index-DOjeZZeJ.js";import{d as q,r as x,a1 as T,j as G,o as v,c as N,a as f,_ as o,U as r,u as n,Y as h,Z as S,X as $,S as U,F as P,a9 as Q,af as y,bD as W,n as ee,bo as te,bm as ae,at as ne}from"./@vue-DbHY7CtS.js";import{b as J,c as le,d as R,e as j,f as I,g as oe,h as g,i as se,j as re,k as ie,a as C}from"./element-plus-CHrdaKtk.js";import{_ as ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./lodash-es-DKmLY3Gz.js";import"./@vueuse-DrUKsxYo.js";import"./@element-plus-mH6lrfSY.js";import"./@popperjs-CsO2-mKt.js";import"./@ctrl-r5W6hzzQ.js";import"./dayjs-Bz4m6kJv.js";import"./@ckeditor-Cpj98o6Y.js";import"./async-validator-BKXt4Vjq.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./@floating-ui-o_LpjUj1.js";const de=k=>(te("data-v-81315034"),k=k(),ae(),k),ce={class:"volunteer"},me={class:"content"},pe=de(()=>f("h3",null,"广州越秀区小升初志愿录取测算",-1)),he={class:"base"},ge={key:0,class:"result"},fe={style:{padding:"10px 0"}},ve={key:1,class:"logs"},be=["innerHTML"],_e={class:"op"},xe=q({__name:"Volunteer",setup(k){const E=()=>Math.ceil(Math.random()*899999999+1e8),A=JSON.parse(localStorage.getItem("schools")||"null"),B=JSON.parse(localStorage.getItem("myVolunteer")||"{}"),b=x(Number.parseInt(localStorage.getItem("studentTotal")??"2000")),_=E(),c=x([]),m=x(),O=x(!1),d=T(A||[{index:0,name:"第七中学",hot:1,percentage:4.27},{index:1,name:"第十中学",hot:1,percentage:29.3},{index:2,name:"十三中学",hot:1,percentage:8.37},{index:3,name:"十六中学",hot:1,percentage:12.09},{index:4,name:"十六中东华",hot:1,percentage:20.9},{index:5,name:"培正中学",hot:1,percentage:8.83},{index:6,name:"七中东山",hot:1,percentage:2.32},{index:7,name:"省实中学",hot:1,percentage:7.44},{index:8,name:"执信本部",hot:1,percentage:2.32},{index:9,name:"铁一中学",hot:1,percentage:4.09}]);let p={};const u=T(B||{}),w=G(()=>Object.values(u).sort().map(t=>{const a=Object.entries(u).find(l=>l[1]===t);return Number.parseInt(a?.[0])})),M=x(Symbol()),L=(s,t)=>{Object.values(u).map(l=>Number.parseInt(l)).filter(l=>l===Number.parseInt(t)).length>1?(C.warning({message:"该志愿次序已填报，请更换"}),u[s]=void 0):u[s]=t},z=()=>{const s=y(d).slice(0);return s.sort((t,e)=>e.hot*Math.random()-t.hot*Math.random()),s.map(t=>t.index)},F=async()=>{if(localStorage.setItem("studentTotal",b.value.toString()),localStorage.setItem("schools",JSON.stringify(y(d))),localStorage.setItem("myVolunteer",JSON.stringify(y(u))),!(Object.keys(u).length===d.length)){C.warning({message:"请先填报志愿"});return}p={},W(w),await ee(),p[_]=y(w.value);for(let t=0;t<b.value-1;t++)p[E()]=z();m.value=null,M.value=Symbol()},D=s=>{const t=w.value.every(l=>l>=0),e=u[s];return!t||e===void 0?null:Object.values(p).filter(l=>l[e]===s).length},H=s=>{const t=Number.parseInt(u[s]);return Object.entries(p).filter(([l,i])=>Number.parseInt(i[t])===Number.parseInt(s)).map(l=>l[0]).sort((l,i)=>Number.parseInt(i)-Number.parseInt(l)).findIndex(l=>l.toString()==_.toString())+1},K=(s,t)=>Object.entries(p).filter(([e,a])=>a[t]===s).map(e=>e[0]).sort((e,a)=>Number.parseInt(a)-Number.parseInt(e)),X=()=>{if(Object.keys(p).length===0){C.warning({message:"请先提交志愿"});return}const s=[],t={};for(const e of d)t[e.index]={school:y(e),picked:0,total:Math.ceil(e.percentage*b.value/100),students:[]};c.value=[];for(let e=0;e<d.length;e++){c.value.push(`<dt>第${e+1}志愿开始招生</dt>`);for(const a of d){const l=K(a.index,e),i=t[a.index];if(i.picked>=i.total){c.value.push(`<dd>${a.name} 已招生满员</dd>`);continue}for(let V of l)if(!s.includes(V)){if(i.picked>=i.total)break;s.push(V),i.students.push(V),V===_.toString()&&c.value.push(`<dd class="current">您被${a.name}录取</dd>`),++i.picked}i.picked<i.total?c.value.push(`<dd>${a.name} 选生源${i.picked}人, 剩余名额${i.total-i.picked}人</dd>`):c.value.push(`<dd>${a.name} 满员生源${i.picked}人</dd>`)}}for(const e of Object.values(t))if(e.students.includes(_.toString())){console.log(e),m.value=e;break}},Y=()=>{m.value=null,localStorage.removeItem("myVolunteer"),location.reload()},Z=()=>{O.value=!O.value};return(s,t)=>(v(),N("div",ce,[f("div",me,[pe,f("div",he,[o(n(R),{"label-position":"right",inline:"","label-width":"80px"},{default:r(()=>[o(n(J),{label:"随机号"},{default:r(()=>[o(n(le),{class:"randomNo",type:"success",size:"large"},{default:r(()=>[h(S(n(_)),1)]),_:1})]),_:1})]),_:1}),o(n(R),{"label-position":"right",inline:"","label-width":"80px"},{default:r(()=>[o(n(J),{label:"学生人数"},{default:r(()=>[o(n(j),{precision:0,controls:!1,min:1,max:99999,modelValue:b.value,"onUpdate:modelValue":t[0]||(t[0]=e=>b.value=e)},null,8,["modelValue"])]),_:1})]),_:1})]),m.value?(v(),N("div",ge,[o(n(oe),{type:"success",title:"录取结果",closable:!1},{default:r(()=>[f("div",null," 您已被【 "+S(m.value.school.name)+" 】录取, 计划招生 "+S(m.value.total)+" 人。 ",1),f("div",fe,[o(n(I),{size:"small",onClick:Z},{default:r(()=>[h("派位过程")]),_:1})])]),_:1})])):$("",!0),m.value&&O.value?(v(),N("div",ve,[f("dl",{innerHTML:c.value.join("")},null,8,be)])):$("",!0),(v(),U(n(ie),{border:"",stripe:"",data:d,key:M.value},{default:r(()=>[o(n(g),{type:"index",label:"#",fixed:"",width:"50px"}),o(n(g),{label:"学校",prop:"name",fixed:"","min-width":"100px"}),o(n(g),{label:"热度权重",prop:"hot","min-width":"150px"},{default:r(({row:e})=>[o(n(j),{precision:0,step:1,"step-strictly":"",size:"small",min:1,max:100,modelValue:e.hot,"onUpdate:modelValue":a=>e.hot=a},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),o(n(g),{label:"录取比例(%)","min-width":"150px"},{default:r(({row:e})=>[o(n(j),{precision:2,step:.01,"step-strictly":"",size:"small",min:0,max:100,modelValue:e.percentage,"onUpdate:modelValue":a=>e.percentage=a},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),o(n(g),{label:"填报志愿","min-width":"150px"},{default:r(({row:e})=>[o(n(se),{placeholder:"选择志愿次序",modelValue:u[e.index],"onUpdate:modelValue":a=>u[e.index]=a,onChange:a=>L(e.index,a)},{default:r(()=>[(v(!0),N(P,null,Q(d,(a,l)=>(v(),U(n(re),{key:l,value:l,label:`第${l+1}志愿`},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),o(n(g),{label:"志愿人数","min-width":"100px"},{default:r(({row:e})=>[h(S(D(e.index)||"待提交志愿"),1)]),_:1}),o(n(g),{label:"你的排位","min-width":"100px"},{default:r(({row:e})=>[h(S(H(e.index)||"待提交志愿"),1)]),_:1})]),_:1},8,["data"]))]),f("div",_e,[o(n(I),{type:"primary",onClick:F},{default:r(()=>[h("提交志愿")]),_:1}),o(n(I),{type:"warning",onClick:X},{default:r(()=>[h("派位录取")]),_:1}),o(n(I),{onClick:Y},{default:r(()=>[h("重置")]),_:1})])]))}}),Se=ue(xe,[["__scopeId","data-v-81315034"]]),ye=ne(Se);ye.mount("#app");
