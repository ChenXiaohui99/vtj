import{c as ct,d as ue,e as Ge,f as ua,g as ca,h as At,i as Ye,j as Rt,k as dt,l as Xe,m as et,b as Z,n as ve,o as da,p as ma,q as We,r as pa,s as va,t as ga,u as bt,v as ha,w as yt,x as fa,y as ba,z as ya,E as wa,A as Pt,B as ka,a as mt,C as _a,D as Bt,F as Sa,G as me,H as pt,I as xa,J as Va,K as Ca,L as Ea,M as ja}from"./element-plus-TlEIvSR5.js";import{l as Da,v as Aa,b as Ra,e as Pa,i as Ba,c as Ia,M as za,$ as Fa,r as ge,W as It,d as Wa,F as La,g as Oa,N as Ta,H as Ja,x as Na,C as Ma,y as Ua,E as Ha,f as tt,j as de,t as A,h as qa,m as zt,n as Ft,s as Wt,I as T,Q as H,q as Lt,o as $,p as $a,w as at,u as Ga,z as Qa,A as Za,B as Ka,V as Ya,P as lt,J as Xa,G as el,D as nt,K as Ae,L as tl,R as al,S as wt,T as ll,U as nl,X as Re,Y as sl,Z as kt,_ as ol,a0 as Ot,a1 as il,a2 as Me,a3 as Tt,a4 as xe,a5 as Jt,a6 as rl,a7 as vt,a8 as Pe,a9 as Nt,aa as Ue,ab as Mt,ac as Ut,ad as ul,ae as Ve,af as cl,ag as Je,ah as dl,ai as ml,aj as pl,ak as _t,al as st,am as St,an as vl,ao as gl,ap as hl,aq as Be,ar as fl,as as bl,at as yl,au as Ht,av as xt,aw as wl,ax as kl,ay as _l,az as Sl,aA as qt,aB as xl,aC as Vl,aD as Cl,aE as El,aF as jl,aG as Dl,aH as Qe,aI as Al,aJ as Rl}from"./index-udDtu1QU.js";import{_ as Pl}from"./monaco-editor-a3IpPo1Q.js";import{d as C,o as c,c as j,Z as O,j as S,_ as p,U as b,u as a,a as L,S as y,X as x,r as _,Y as q,F,a9 as W,m as ot,f as Y,O as te,P as Le,aa as Oe,a5 as je,i as $t,I as Gt,au as Qt,aw as Bl,n as ke,bD as be,J as Ce,an as Vt,V as De,$ as Ne,W as Zt,Q as ce,a1 as Ie,w as Il,ab as zl,M as pe,bB as it,aU as Fl,s as rt,G as Wl,ad as Kt,am as Yt,aD as Xt,ae as Ll}from"./@vue-lwVaHA3a.js";import{n as ea,p as Ol}from"./@vueuse-PhcRqKe4.js";import{n as Tl,D as Jl,P as Nl,k as Ml,M as ta,E as gt}from"./@element-plus-NeE1p5Kv.js";const Oo="/vtj/",To="LCDP",Jo="低代码开发平台";/**!
 * Copyright (c) 2024, VTJ.PRO All rights reserved.
 * @name @vtj/designer 
 * @author CHC chenhuachun1549@dingtalk.com 
 * @version 0.7.14
 * @license <a href="https://vtj.pro/license.html">MIT License</a>
 */const Ul="0.7.14",Ct={width:390,height:844},Et={width:1180,height:820},he=/^[A-Za-z_$][\w_-]*$/,Hl=["click","dblclick","mouseenter","mouseleave","mousedown","mouseup","mouseover","contextmenu"],ql=["keydown","keyup","keypress"],$l=["GET","POST","PUT","PATCH","DELETE","JSONP"],Gl=["stop","prevent","capture","self","once","passive"];var re=(u=>(u.Block="block",u.Node="node",u))(re||{});const ht="data:image/png;base64,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",Ql=["title","src"],Zl={key:1},Kl=C({name:"LogoWidget",inheritAttrs:!1,__name:"index",props:{icon:{default:ht},text:{default:"VTJ"},link:{}},setup(u){const e=u,t=()=>{e.link&&(location.href=e.link)};return(l,n)=>(c(),j("div",{class:"v-logo-widget",onClick:t},[e.icon?(c(),j("img",{key:0,title:e.text,class:"v-logo-widget__icon",src:e.icon},null,8,Ql)):(c(),j("span",Zl,O(e.text),1))]))}}),Yl={class:"v-empty-widget"},Xl=C({name:"EmptyWidget",__name:"index",setup(u){return(e,t)=>(c(),j("div",Yl,"EmptyWidget"))}});function aa(){const u=le(),e=S(()=>u.project.value?.dependencies??[]);return{engine:u,dependencies:e}}function _e(u,e){const t=S(()=>ia.getWidgets(a(u),a(e)).filter(n=>!n.invisible)),l=_();return{widgets:t,widgetsRef:l}}function la(){const u=le();return{span:S(()=>{const e=u.skeleton?.skeletonRef.leftWidth||400,t=Math.min(Math.floor((e-50)/120),24);return Math.floor(24/t)}),engine:u}}function en(){const u=le(),e=S(()=>u.project.value?.blocks??[]);return{engine:u,blocks:e}}const tn=(u=[])=>u.map(e=>e.name);function an(){const u=le(),{components:e,groups:t,componentMap:l}=u.assets,n=Ie({}),i=S(()=>{const f={};return t.value&&t.value.forEach(v=>{f[v.name]=v}),f}),o=S(()=>t.value?t.value.map(f=>({label:`${f.label} (${f.count})`,name:f.name,disabled:!f.children?.length})):[]),s=_(o.value[0]?.name),r=_(""),m=S(()=>i.value[s.value]);Il(()=>{const f=o.value.reduce((v,g)=>(v[g.name]=tn(i.value[g.name].children),v),{});Object.assign(n,f)});const d=S(()=>{const f=r.value.toLowerCase();return!f||!e?[]:e.filter(v=>v.name.toLowerCase().includes(f)||v.label?.toLowerCase().includes(f))});return{components:e,groups:t,componentMap:l,groupMap:i,tabs:o,model:n,currentTab:s,currentGroup:m,searchKey:r,searchResult:d}}function ae(){const u=le(),e=S(()=>u.current.value),t=S(()=>u.context.value),l=S(()=>u.isEmptyCurrent.value);return{engine:u,current:e,isEmpty:l,context:t}}function ln(u,e){const t=le();t.simulator.init(u,e);const l=S(()=>t.simulator.designer.value),n=S(()=>Ze("hover",l.value?.hover.value)),i=S(()=>Ze("dropping",l.value?.dropping.value)),o=S(()=>Ze("selected",l.value?.selected.value));return Y(t.changed,()=>{l.value?.updateRect()}),{designer:l,dropping:i,hover:n,selected:o}}function nn(u,e=!0){const{top:t,height:l,width:n,left:i}=u||{};if(l>100&&n>200)return"inner";let o,s;return s=t>30?"top":"bottom",o=e||i<300&&n<300?"left":"right",[o,s].join("-")}function sn(u){const{rect:e,type:t}=u,{left:l,width:n,top:i,height:o}=e,s={left:l,width:n,top:i,height:o};switch(t){case"left":s.left=0,s.width=0;break;case"right":s.left=s.left+s.width-4,s.width=0;break;case"bottom":s.top=s.top+s.height-4,s.height=0;break;case"top":s.height=0;break}return s}function Ze(u,e){if(!e)return null;const{left:t,top:l,width:n,height:i}=u==="dropping"?sn(e):e.rect,o={left:`${t}px`,top:`${l}px`,width:`${n}px`,height:`${i}px`,visibility:n||i?"visible":"hidden"};return{...e,style:o,position:nn(e.rect,u!=="selected")}}function fe(){const u=le(),e=S(()=>u.simulator.designer.value),t=S(()=>e.value?.selected.value),l=S(()=>H(t.value?.model));return{engine:u,designer:e,selected:t,isSelectBlock:l}}function on(u,e){const t=_(""),{selected:l,isSelectBlock:n}=fe(),i=S(()=>l.value?.model.id),o=S(()=>{const r=it(u),m=it(e),d=[];if(!r)return d;const f=m?.__contextRefs[i.value||""],v=m===f||n.value?[]:Object.keys(f?.context||{}).filter(R=>!["context","ref"].includes(R)).map(R=>`this.context.${R}`);v.length&&d.push({title:"上下文",items:v});const g=r.inject.map(R=>`this.${R.name}`);g.length&&d.push({title:"注入",items:g});const h=r.props.map(R=>typeof R=="string"?`this.$props.${R}`:`this.$props.${R.name}`);h.length&&d.push({title:"属性",items:h});const k=Object.keys(r.state).map(R=>`this.state.${R}`);k.length&&d.push({title:"状态",items:k});const w=Object.keys(r.computed).map(R=>`this.${R}.value`);w.length&&d.push({title:"计算属性",items:w});const E=Object.keys(r.methods).map(R=>`this.${R}`);E.length&&d.push({title:"方法",items:E});const V=Object.keys(r.dataSources).map(R=>`this.${R}`);V.length&&d.push({title:"数据源",items:V});const D=Object.keys(m?.$refs||{}).map(R=>`this.$refs.${R}`);return D.length&&d.push({title:"refs",items:D}),d}),s=S(()=>{if(!t.value)return o.value;const r=t.value.toLowerCase(),m=[];return o.value.forEach(d=>{const f=d.items.filter(v=>v.toLowerCase().includes(r));f.length&&m.push({title:d.title,items:f})}),m});return{keyword:t,options:o,searchResult:s}}const Fe=[{name:"StringSetter",label:"文本"},{name:"ExpressionSetter",label:"表达式"}];function rn(u){const e=le(),t=S(()=>{const r=u.value?.model||null;return H(r)?null:r}),l=_();Y(t,async r=>{r?.from?l.value=await e.assets.getBlockMaterial(r.from)||void 0:l.value=void 0},{immediate:!0});const n=S(()=>t.value?[{name:"key",setters:Fe,value:t.value.getPropValue("key")},{name:"ref",setters:Fe,value:t.value.getPropValue("ref")},{name:"class",label:"class",setters:Fe,value:t.value.getPropValue("class")},{name:"children",label:"文本",title:"如设置组件文本，将清空子组件",setters:Fe,value:Array.isArray(t.value.children)?"":t.value.children}]:[]),i=S(()=>{if(!t.value)return[];const r=l.value||e.assets.componentMap.get(t.value.name);return r?(r.props||[]).map(m=>({...m,value:t.value?.getPropValue(m.name)??m.defaultValue})):[]}),o=r=>n.value.some(m=>m.name===r)||i.value.some(m=>m.name===r)||r==="style",s=S(()=>t.value?Object.keys(t.value.props).filter(r=>!o(r)).map(r=>({name:r,setters:"InputSetter",value:t.value?.getPropValue(r)})):[]);return{commonProps:n,componentProps:i,customProps:s,node:t,change:(r,m)=>{t.value&&(r==="children"?t.value.setChildren(m):t.value.setProp(r,m))},addCustom:r=>{r&&t.value?.setProp(r,"")},removeCustom:r=>{t.value?.removeProp(r)},isExist:o}}function K(u,e="提示"){return me.warning({title:e,message:u})}async function Ee(u){return await pt.confirm(u,"提示",{type:"warning"}).catch(()=>!1)}function se(u,e="success"){return mt({message:u,type:e})}function ee(u,e,t=!1){let l=!0;try{u.type==="JSExpression"?Je(u,e,t,!0):hl(u,e,t,!0)}catch(n){l=!1,me.error({title:"代码错误",message:n.message})}return l}function na(){const u=le(),e=S(()=>u.simulator.designer.value),t=S(()=>u.current.value?u.history.value:null),l=S(()=>t.value?.items.length||0),n=()=>{e.value?.cleanHelper(),t.value?.forward()},i=()=>{t.value?.backward(),e.value?.cleanHelper()},o=m=>{e.value?.cleanHelper(),t.value?.load(m),se("已载入历史记录","success")},s=S(()=>l.value<=1?!0:(t.value?.index||-1)<=0),r=S(()=>l.value<=1?!0:(t.value?.index||-1)>=l.value-1);return{engine:u,history:t,total:l,forward:n,backward:i,load:o,forwardDisabled:s,backwardDisabled:r}}function He(){const u=le(),e=S(()=>u.project.value);return{engine:u,project:e}}function un(u){const e=le(),t=S(()=>{const s=u.value?.model||null;return!s||H(s)?null:s}),l=_();Y(t,async s=>{s?.from?l.value=await e.assets.getBlockMaterial(s.from)||void 0:l.value=void 0});const n=S(()=>{if(H(t.value))return[];const s=t.value?.events||{};return Hl.map(r=>({name:r,event:s[r]}))}),i=S(()=>{if(H(t.value))return[];const s=t.value?.events||{};return ql.map(r=>({name:r,event:s[r]}))}),o=S(()=>{if(!t.value||H(t.value))return[];const s=t.value.events||{};return(l.value?.events||e.assets.componentMap.get(t.value.name)?.events||[]).map(r=>{const m=typeof r=="string"?r:r.name;return{name:m,event:s[m]}})});return{mouseEventList:n,keyboardEventList:i,componentEventList:o}}const cn=(u,e)=>new qt({name:u,value:void 0,iterator:e}),dn=(u="modelValue")=>new qt({name:"vModel",value:void 0,arg:u});function mn(u){if(!u)return[];const{props:e=[],events:t=[]}=u;if(e.length&&t.length){const l=t.filter(n=>(typeof n=="string"?n:n.name).startsWith("update:")).map(n=>n=typeof n=="string"?n:n.name);return l.length?e.filter(n=>l.some(i=>i.includes(n.name))):[]}return[]}function pn(u){const e=le(),t=S(()=>{const f=u.value?.model||null;return H(f)?null:f}),l=f=>S(()=>t.value&&(t.value.directives||[]).find(v=>v.name===f)||cn(f)),n=()=>S(()=>{if(!t.value)return[];const f=e.assets.componentMap.get(t.value.name||"");return(f?mn(f):[]).map(v=>(t.value?.directives||[]).find(g=>g.name==="vModel"&&g.arg==v.name)||dn(v.name))}),i=l("vIf"),o=l("vShow"),s=l("vBind"),r=l("vFor"),m=n(),d={vIf:i,vShow:o,vBind:s,vFor:r};return{engine:e,node:t,vIf:i,vShow:o,vBind:s,vFor:r,vModels:m,onValueChange:(f,v)=>{const g=d[f];t.value&&(v?(g.value.value=v,t.value.setDirective(g.value)):(g.value.value=void 0,t.value.removeDirective(g.value)))},onForChange:(f,v)=>{if(t.value){if(f==="value"){v?(r.value.value=v,t.value.setDirective(r.value)):t.value.removeDirective(r.value);return}(f==="item"||f==="index")&&(r.value.iterator={...r.value.iterator,[f]:v||void 0},t.value.setDirective(r.value))}},onModelChange:(f,v)=>{if(!t.value)return;const g=parseInt(f),h=m.value[g];h&&(v?(h.value=v,t.value.setDirective(h)):(h.value=void 0,t.value.removeDirective(h)))}}}function vn(){const{engine:u,project:e}=He(),t=S(()=>e.value?.apis||[]);return{engine:u,project:e,apis:t}}const gn={class:"v-switcher-widget"},hn={key:1},fn=C({name:"SwitcherWidget",inheritAttrs:!1,__name:"index",emits:["click"],setup(u,{emit:e}){const t=e,{engine:l}=ae(),n=S(()=>l.project.value?.name),i=S(()=>l.project.value?.currentFile?.title),o=()=>{t("click",l.project.value)};return(s,r)=>(c(),j("div",gn,[p(a(ue),{size:"small",round:"",onClick:o},{default:b(()=>[p(a(Wa),{class:"v-switcher-widget__back"}),L("span",null,O(n.value),1),i.value?(c(),y(a(ct),{key:0,direction:"vertical"})):x("",!0),i.value?(c(),j("span",hn,O(i.value),1)):x("",!0)]),_:1})]))}}),bn={class:"v-toolbar-widget"},yn=C({name:"ToolbarWidget",inheritAttrs:!1,__name:"index",props:{preview:{type:Boolean}},setup(u,{expose:e}){const t=u,{forward:l,backward:n,forwardDisabled:i,backwardDisabled:o}=na(),s=_("pc");return e({mode:s}),(r,m)=>(c(),j("div",bn,[p(a(ua),{size:"small",modelValue:s.value,"onUpdate:modelValue":m[0]||(m[0]=d=>s.value=d)},{default:b(()=>[p(a(Ge),{label:"pc"},{default:b(()=>[p(a(La))]),_:1}),p(a(Ge),{label:"mobile"},{default:b(()=>[p(a(Oa))]),_:1}),p(a(Ge),{label:"pad"},{default:b(()=>[p(a(Ta))]),_:1})]),_:1},8,["modelValue"]),x("",!0),p(a(ca),null,{default:b(()=>[p(a(ue),{type:"default",size:"small",onClick:a(n),disabled:a(o)||!!t.preview},{default:b(()=>[p(a(Ja))]),_:1},8,["onClick","disabled"]),p(a(ue),{type:"default",size:"small",onClick:a(l),disabled:a(i)||!!t.preview},{default:b(()=>[p(a(Na))]),_:1},8,["onClick","disabled"])]),_:1})]))}}),wn={class:"v-actions-widget"},kn=L("span",null,"发布",-1),_n=C({name:"ActionsWidget",inheritAttrs:!1,__name:"index",props:{coder:{type:Boolean,default:!0}},setup(u){const{engine:e,designer:t}=fe(),l=_(!1),n=()=>{e.current.value?(l.value?e.skeleton?.getWidget("Previewer")?.widgetRef.refresh():(t.value?.setSelected(null),e.simulator.refresh()),se("刷新完成","success")):se("请先打开文件","warning")},i=async()=>{e.current.value?(l.value&&(e.skeleton?.closePreview(),l.value=!1,await Tt(1e3)),t.value?.setSelected(e.current.value)):se("请先打开文件","warning")},o=()=>{if(e.project.value)if(e.current.value){if(l.value){e.skeleton?.closePreview(),l.value=!1;return}e.skeleton?.openPreview(""),l.value=!0}else se("请先打开文件","warning")},s=()=>{const m=e.project.value;m&&(m.currentFile?m.publish(m.currentFile):se("请先打开文件","warning"))},r=m=>{const d=e.project.value;d&&(m==="current"?s():d.publish())};return(m,d)=>(c(),j("div",wn,[x("",!0),x("",!0),p(a(ue),{onClick:o,type:l.value?"warning":"default",size:"small",title:"预览"},{default:b(()=>[p(a(Ma))]),_:1},8,["type"]),p(a(ue),{onClick:n,type:"default",size:"small",title:"刷新"},{default:b(()=>[p(a(Ua))]),_:1}),p(a(ue),{type:"default",size:"small",title:"页面设置",onClick:i},{default:b(()=>[p(a(Ha))]),_:1}),p(a(ct),{direction:"vertical"}),p(a(Rt),{"split-button":"",type:"primary",size:"small",onClick:s,onCommand:r},{dropdown:b(()=>[p(a(At),null,{default:b(()=>[p(a(Ye),{command:"current"},{default:b(()=>[q("发布页面")]),_:1}),p(a(Ye),{command:"project"},{default:b(()=>[q("整站发布")]),_:1})]),_:1})]),default:b(()=>[kn]),_:1})]))}}),Sn={class:"v-icon-setter"},xn={class:"v-icon-setter__content"},Vn={class:"v-icon-setter__list"},sa=C({name:"IconSetter",__name:"icon",props:{modelValue:{default:""},size:{default:"small"}},emits:["change","update:modelValue"],setup(u,{emit:e}){const t=u,l=e,n=_(!1),i=_(t.modelValue),o=_(""),s=S(()=>tt[t.modelValue]||t.modelValue),r=S(()=>{const g=Object.entries(tt);return o.value?g.filter(h=>h[0].toLowerCase().includes(o.value)):g}),m=g=>{i.value=g},d=()=>{l("change",i.value),l("update:modelValue",i.value),n.value=!1},f=()=>{i.value="",l("change",""),l("update:modelValue",""),n.value=!1},v=()=>{n.value=!0};return(g,h)=>(c(),j("div",Sn,[p(a(ve),{size:t.size,readonly:"",placeholder:"请选择图标","model-value":t.modelValue,"suffix-icon":a(Ml),onFocus:v},{prepend:b(()=>[p(a(Pe),{icon:s.value},null,8,["icon"])]),_:1},8,["size","model-value","suffix-icon"]),n.value?(c(),y(a(Be),{key:0,title:"图标选择器",width:"1000px",height:"600px",cancel:"",submit:"",clear:"",modelValue:n.value,"onUpdate:modelValue":h[1]||(h[1]=k=>n.value=k),onSubmit:d},{extra:b(()=>[p(a(ue),{size:"default",type:"warning",onClick:f},{default:b(()=>[q(" 清除绑定 ")]),_:1})]),default:b(()=>[L("div",xn,[p(a(ve),{size:t.size,"prefix-icon":a(ta),clearable:"",modelValue:o.value,"onUpdate:modelValue":h[0]||(h[0]=k=>o.value=k),placeholder:"请输入查询关键字"},null,8,["size","prefix-icon","modelValue"]),L("div",Vn,[(c(!0),j(F,null,W(r.value,k=>(c(),y(a(Pe),{icon:k[1],onClick:w=>m(k[0]),class:te({"is-active":i.value===k[0]})},null,8,["icon","onClick","class"]))),256)),r.value.length===0?(c(),y(a(Z),{key:0})):x("",!0)])])]),_:1},8,["modelValue"])):x("",!0)]))}}),Cn=C({name:"PageForm",__name:"form",props:{item:{},parentId:{}},setup(u){const e=u,{project:t}=He(),l=S(()=>e.item?"编辑页面":"新增页面"),n=()=>({dir:!1,name:"",title:"",icon:"",mask:!0,hidden:!1,raw:!1}),i=_(e.item||n()),o=[{label:"页面",value:!1},{label:"目录",value:!0}],s=m=>{i.value&&(i.value.name=Mt(m))},r=async m=>t.value?.existPageName(m.name,[m.id])?(K("页面名称已存在，请更换"),!1):(e.item?t.value?.updatePage(m):t.value?.createPage(m,e.parentId),!0);return(m,d)=>(c(),y(a(de),{title:l.value,width:"800px",height:"500px","form-props":{tooltipMessage:!1},model:i.value,"submit-method":r},{default:b(()=>[p(a(A),{name:"dir",label:"类型",editor:"radio",options:o,props:{button:!0,size:"small"},disabled:!!e.item,required:""},null,8,["disabled"]),p(a(A),{name:"name",label:"名称",required:"",onChange:s,rules:{pattern:a(he),message:"名称格式不正确"}},null,8,["rules"]),p(a(A),{name:"title",label:"标题",required:""}),p(a(A),{name:"icon",label:"菜单图标",editor:"none"},{editor:b(()=>[p(sa,{modelValue:i.value.icon,"onUpdate:modelValue":d[0]||(d[0]=f=>i.value.icon=f),size:"default"},null,8,["modelValue"])]),_:1}),p(a(A),{visible:{dir:!1},name:"mask",label:"包含母版",editor:"switch"}),p(a(A),{name:"hidden",label:"隐藏菜单",editor:"switch"}),p(a(A),{visible:{dir:!1},disabled:!!e.item,inline:"",name:"raw",label:"源码模式",editor:"switch",tip:"页面是非低代码开发，不能在线编辑"},null,8,["disabled"])]),_:1},8,["title","model"]))}}),jt=C({name:"VIcon",__name:"Icon",props:{icon:{},label:{},active:{type:Boolean,default:!1},open:{type:Boolean,default:!1}},emits:["click"],setup(u,{emit:e}){const t=u,l=e,n=S(()=>({"is-active":t.active,"is-open":t.open})),i=()=>{l("click")};return(o,s)=>(c(),y(a(Pt),{effect:"dark",placement:"right",content:o.label,"show-after":600},{default:b(()=>[L("div",{class:te(["v-apps-region__icon",n.value]),onClick:i},[(c(),y(Zt(o.icon)))],2)]),_:1},8,["content"]))}}),J=C({name:"VPanel",__name:"panel",props:{title:{},subtitle:{},plus:{type:Boolean},back:{type:Boolean},remove:{type:Boolean},save:{type:Boolean},header:{type:Boolean,default:!0}},emits:["plus","back","remove","save"],setup(u,{emit:e}){const t=u,l=e,n=()=>{l("plus")},i=()=>{l("back")},o=()=>{l("remove")},s=()=>{l("save")},r=S(()=>t.header?{content:t.title,subtitle:t.subtitle,icon:t.back?Jl:void 0,onClickBack:t.back?i:void 0}:null);return(m,d)=>(c(),y(a(vt),{class:"v-panel",border:!1,header:r.value,fit:""},zl({actions:b(()=>[t.plus?(c(),y(a(xe),{key:0,size:m.$attrs.size,mode:"icon",icon:a(Jt),background:"hover",title:"新增",onClick:n},null,8,["size","icon"])):x("",!0),t.remove?(c(),y(a(xe),{key:1,size:m.$attrs.size,mode:"icon",icon:a(Nl),background:"hover",title:"清除",onClick:o},null,8,["size","icon"])):x("",!0),t.save?(c(),y(a(xe),{key:2,size:m.$attrs.size,mode:"icon",icon:a(rl),background:"hover",title:"保存",onClick:s},null,8,["size","icon"])):x("",!0),pe(m.$slots,"actions")]),default:b(()=>[pe(m.$slots,"default")]),_:2},[m.$slots.footer?{name:"footer",fn:b(()=>[pe(m.$slots,"footer")]),key:"0"}:void 0]),1032,["header"]))}}),En={class:"v-tabs__header"},jn={key:0,class:"v-tabs__actions"},qe=C({__name:"tabs",props:{items:{default:()=>[]},menus:{},modelValue:{},stretch:{type:Boolean},checkable:{type:Boolean}},emits:["update:modelValue","command","remove"],setup(u,{emit:e}){const t=u,l=e,n=_((t.modelValue||t.items[0]?.name)??"");Y(n,()=>{l("update:modelValue",n.value)}),Y(()=>t.modelValue,s=>{n.value=s});const i=s=>{l("command",s)},o=s=>{l("remove",s)};return(s,r)=>(c(),y(a(vt),{class:"v-tabs",border:!1,fit:"",radius:!1},{header:b(()=>[L("div",En,[p(a(zt),{class:"v-tabs__tabs",items:t.items,type:"card",modelValue:n.value,"onUpdate:modelValue":r[0]||(r[0]=m=>n.value=m),onTabRemove:o,stretch:t.stretch},null,8,["items","modelValue","stretch"]),t.menus&&t.menus.length?(c(),j("div",jn,[t.menus&&t.menus.length?(c(),y(a(xe),{key:0,mode:"icon",size:"small",icon:a(gt),background:"hover",dropdown:{size:"small",placement:"bottom-end"},menus:t.menus,onCommand:i},{item:b(({item:m})=>[L("span",null,[t.checkable?(c(),y(a(Ot),{key:0,class:te({"v-tabs__checked":!0,"is-checked":m.checked})},null,8,["class"])):x("",!0),q(" "+O(m.label),1)])]),_:1},8,["icon","menus"])):x("",!0)])):x("",!0)])]),default:b(()=>[pe(s.$slots,"default")]),_:3}))}}),Dn={key:2,class:"v-item__index"},An={class:"v-item__content"},Rn={key:3,class:"v-item__subtitle"},X=C({name:"VItem",__name:"item",props:{icon:{},index:{},tag:{},tagType:{},title:{},subtitle:{},actions:{default:()=>[]},background:{type:Boolean},border:{type:Boolean},switch:{type:Boolean},modelValue:{},active:{type:Boolean},hover:{type:Boolean},small:{type:Boolean}},emits:["click","action","update:modelValue","switch"],setup(u,{emit:e}){const t={add:{label:"创建",icon:Jt},copy:{label:"复制",icon:Ht},edit:{label:"编辑",icon:Nt},remove:{label:"删除",icon:Me},lock:{label:"锁定",icon:Ft},unlock:{label:"解锁",icon:xl},invisible:{label:"隐藏",icon:Wt},visible:{label:"显示",icon:Vl},home:{label:"主页",icon:Cl}},l=u,n=e,i=_(!!l.modelValue),o=S(()=>l.actions.map(d=>{const f=t[d];return{name:d,...f}})),s=S(()=>({"is-background":l.background,"is-border":l.border,"is-active":l.active,"is-hover":l.hover,"is-small":l.small})),r=()=>{n("click",l.modelValue)},m=async d=>{d==="remove"?await pt.confirm("确定删除吗？","提示",{type:"warning"}).catch(()=>!1)&&n("action",{name:d,modelValue:l.modelValue}):n("action",{name:d,modelValue:l.modelValue})};return Y(i,d=>{n("update:modelValue",d),n("switch",d)}),Y(()=>l.modelValue,d=>{i.value=!!d}),(d,f)=>(c(),y(a(T),{class:te(["v-item",s.value]),justify:"space-between",align:"center",onClick:r},{default:b(()=>[p(a(T),{class:"v-item__title",align:"center"},{default:b(()=>[pe(d.$slots,"default",{},()=>[d.icon?(c(),y(a(Pe),{key:0,icon:d.icon},null,8,["icon"])):x("",!0),l.tag?(c(),y(a(_a),{key:1,class:"v-item__tag",size:"small",type:l.tagType},{default:b(()=>[q(O(l.tag),1)]),_:1},8,["type"])):x("",!0),d.index!==void 0?(c(),j("span",Dn," # "+O(d.index),1)):x("",!0),L("span",An,O(d.title),1),d.subtitle?(c(),j("span",Rn,O(d.subtitle),1)):x("",!0)])]),_:3}),p(a(T),{class:"v-item__actions",onClick:f[1]||(f[1]=je(()=>{},["stop"]))},{default:b(()=>[(c(!0),j(F,null,W(o.value,v=>(c(),y(a(xe),{name:v.name,title:v.label,mode:"icon",size:"small",background:"none",type:"info",icon:v.icon,onClick:g=>m(v.name)},null,8,["name","title","icon","onClick"]))),256)),l.switch?(c(),y(a(Bt),{key:0,modelValue:i.value,"onUpdate:modelValue":f[0]||(f[0]=v=>i.value=v),class:"v-item__switch",size:"small"},null,8,["modelValue"])):x("",!0),pe(d.$slots,"status")]),_:3})]),_:3},8,["class"]))}}),Pn=["draggable"],Bn={class:"v-box__name"},In={class:"v-box__label"},ut=C({name:"VBox",__name:"box",props:{name:{},title:{},editable:{type:Boolean},active:{type:Boolean},draggable:{type:Boolean}},emits:["edit","remove","dragstart","dragend"],setup(u,{emit:e}){const t=u,l=e,n=()=>{l("edit")},i=async()=>{await pt.confirm("确认删除？","提示",{type:"warning"}).catch(()=>!1)&&l("remove")},o=S(()=>({"is-active":t.active,"is-draggable":t.draggable})),s=()=>{l("dragstart",t)},r=()=>{l("dragend",t)};return(m,d)=>(c(),j("div",{class:te(["v-box",o.value]),draggable:m.draggable,onDragstart:s,onDragend:r},[p(a(T),{direction:"column",justify:"center",align:"center"},{default:b(()=>[L("span",Bn,O(t.name),1),L("span",In,O(t.title),1)]),_:1}),t.editable?(c(),y(a(T),{key:0,class:"v-box__footer",justify:"flex-end",align:"center"},{default:b(()=>[p(a(Pe),{icon:a(Nt),onClick:n},null,8,["icon"]),p(a(Pe),{icon:a(Me),onClick:i},null,8,["icon"])]),_:1})):x("",!0)],42,Pn))}}),zn={class:"v-context-viewer"},Fn=C({__name:"viewer",props:{context:{}},emits:["pick","copy"],setup(u,{emit:e}){const t=u,l=e,n=["$provider","$apis","$components","context"],i=d=>{const f=d.value,v=Qe(f);return v==="Object"||v==="Module"?Object.keys(f||{}).length===0:v==="Array"?f.length===0:!0},o=(d,f="this")=>typeof d=="object"?Array.isArray(d)?d.map((v,g)=>{const h=`[${g}]`;return{label:h,value:v,type:Qe(v),path:`${f}${h}`}}):Object.entries(d).map(([v,g])=>({label:v,value:g,type:Qe(g),path:`${f}.${v}`})).filter(v=>!v.label.startsWith("__")&&!n.includes(v.label)):[],s=(d,f)=>{if(d.level===0)f(o(t.context));else{const v=Ll(d.data.value);f(o(v,d.data.path))}},r=d=>{l("copy",d.path)},m=d=>{l("pick",d.path)};return(d,f)=>(c(),j("div",zn,[d.context?(c(),y(a(dt),{key:0,lazy:"",load:s,"expand-on-click-node":!1,props:{isLeaf:i}},{default:b(({data:v})=>[p(X,{title:v.label,clickable:"",onClick:g=>m(v),background:"",actions:["copy"],onAction:g=>r(v),grow:"",small:""},null,8,["title","onClick","onAction"])]),_:1},8,["props"])):x("",!0)]))}}),ft=C({__name:"binder",props:{title:{},context:{},block:{},model:{},rules:{},modelValue:{type:Boolean},submitMethod:{type:Function},unbindEnabled:{type:Boolean}},emits:["unbind","submit","cancel","pick","update:modelValue","close"],setup(u,{emit:e}){const t=u,l=e,{searchResult:n,keyword:i}=on(t.block,t.context),{copy:o}=Ol({}),s=[{name:"normal",label:"常用"},{name:"viewer",label:"高级"}],r=_("normal"),m=_(),d=async E=>{l("submit",E),t.submitMethod?await t.submitMethod(E)&&f():f()},f=()=>{l("update:modelValue",!1),l("close")},v=()=>{l("unbind")},g=()=>{f()},h=async()=>{m.value?.submit()},k=E=>{l("pick",E)},w=E=>{o(E),mt.success({message:"已经复制到粘贴板"})};return(E,V)=>(c(),y(a(Be),{"model-value":t.modelValue,class:"v-binder",title:E.title,width:"1000px",height:"600px","body-padding":!1,maximizable:!1,minimizable:!1,onClose:f},{default:b(()=>[p(a(T),{fit:"",direction:"row",overflow:"hidden"},{default:b(()=>[p(a(T),{width:"30%",height:"100%"},{default:b(()=>[p(qe,{class:"v-binder__tabs",items:s,modelValue:r.value,"onUpdate:modelValue":V[1]||(V[1]=D=>r.value=D)},{default:b(()=>[p(a(T),{class:"v-binder__tab-content",fit:"",padding:"",flex:!1},{default:b(()=>[De(L("div",null,[p(a(ve),{modelValue:a(i),"onUpdate:modelValue":V[0]||(V[0]=D=>ot(i)?i.value=D:null),size:"small",clearable:"","prefix-icon":a(ta),placeholder:"筛选可用项"},null,8,["modelValue","prefix-icon"]),(c(!0),j(F,null,W(a(n),D=>(c(),j("div",null,[p(a(ct),{"border-style":"dotted"},{default:b(()=>[q(O(D.title),1)]),_:2},1024),(c(!0),j(F,null,W(D.items,R=>(c(),y(X,{title:R,background:"",actions:["copy"],small:"",onClick:P=>k(R),onAction:P=>w(R)},null,8,["title","onClick","onAction"]))),256))]))),256)),a(n).length?x("",!0):(c(),y(a(Z),{key:0}))],512),[[Ne,r.value==="normal"]]),De(p(Fn,{context:t.context,onCopy:w,onPick:k},null,8,["context"]),[[Ne,r.value==="viewer"]])]),_:1})]),_:1},8,["modelValue"])]),_:1}),p(a(vt),{grow:"",header:null,border:!1},{footer:b(()=>[p(a(T),{justify:"space-between"},{default:b(()=>[p(a(T),null,{default:b(()=>[E.unbindEnabled?(c(),y(a(ue),{key:0,type:"warning",size:"default",onClick:v},{default:b(()=>[q(" 移除绑定 ")]),_:1})):x("",!0)]),_:1}),p(a(T),null,{default:b(()=>[p(a(ue),{type:"default",size:"default",onClick:g},{default:b(()=>[q(" 取消 ")]),_:1}),p(a(ue),{type:"primary",size:"default",onClick:h},{default:b(()=>[q(" 确定 ")]),_:1})]),_:1})]),_:1})]),default:b(()=>[p(a(fl),{ref_key:"formRef",ref:m,class:"v-binder__form",footer:!1,"label-position":"top","tooltip-message":!1,model:t.model,rules:t.rules,"submit-method":d},{default:b(()=>[pe(E.$slots,"default")]),_:3},8,["model","rules"])]),_:3})]),_:3})]),_:3},8,["model-value","title"]))}}),Wn={class:"v-slots-picker__sn"},Ln=C({__name:"slots",props:{slots:{default:()=>[]}},emits:["submit","update:modelValue"],setup(u,{emit:e}){const t=u,l=e,n=_(),i=S(()=>`${50*Math.ceil(t.slots.length/4)+180}px`),o=r=>{n.value=r},s=()=>{n.value?(l("submit",n.value),l("update:modelValue",!1)):K("请选择插槽")};return(r,m)=>(c(),y(a(Be),ce({class:"v-slots-picker",title:"选择插槽",width:"600px",height:i.value,submit:"",cancel:"",onSubmit:s},r.$attrs),{default:b(()=>[p(a(ja),{title:"该组件支持多个插槽，请选择放置到其中一个",type:"warning",closable:!1}),p(a(T),{class:"v-slots-picker__content",justify:"space-around",alignContent:"flex-start",gap:"",wrap:"wrap"},{default:b(()=>[(c(!0),j(F,null,W(t.slots,(d,f)=>(c(),y(a(T),{class:te(["v-slots-picker__item",{"is-active":d.name===n.value?.name}]),grow:"",flex:!1,onClick:v=>o(d)},{default:b(()=>[L("span",Wn,"#"+O(f+1),1),q(" "+O(d.name),1)]),_:2},1032,["class","onClick"]))),256))]),_:1})]),_:1},16,["height"]))}}),oa=C({name:"Viewport",__name:"viewport",props:{mode:{default:"pc"},width:{},height:{}},setup(u){const e=u,t=S(()=>[`is-${e.mode}`]),l=S(()=>{if(e.mode==="pc")return 1;const i=e.mode==="mobile"?Ct:Et,{width:o,height:s}=i,r=o>0?(e.width||0)/o:1,m=s>0?(e.height||0)/s:1;return Math.min(r,m)}),n=S(()=>{if(e.mode==="pc")return{};const i=e.mode==="mobile"?Ct:Et,{width:o,height:s}=i;return{width:`${o}px`,height:`${s}px`,left:"50%",top:"50%",transform:`translate(-50%, -50%) scale(${l.value})`}});return(i,o)=>(c(),j("div",{class:te(["v-viewport",t.value]),style:Le(n.value)},[pe(i.$slots,"default")],6))}}),On=C({name:"PagesWidget",__name:"index",setup(u){const{project:e,engine:t}=He(),l=S(()=>e.value?.pages||[]),{current:n}=ae(),i=_(!1),o=_(),s=_(),r=()=>{s.value=void 0,o.value=void 0,i.value=!0},m=async g=>{const{name:h,modelValue:k}=g,{data:w,node:E}=k;if(h==="add"&&(o.value=void 0,s.value=w.id,i.value=!0),h==="edit"&&(o.value=Ue(w),s.value=void 0,i.value=!0),h==="remove"){if(w.dir){const V=e.value?.getPage(w.id);if(V&&V.children?.length){K("请先删除子页面");return}}e.value?.removePage(w.id)}if(h==="copy"){const V=E.parent?.data.id;e.value?.clonePage(w,V)}h==="home"&&(e.value?.setHomepage(w.id),se("设置主页成功","success"))},d=async g=>{g.raw&&se("这是源码模式页面，不能低代码设计","warning"),g.dir||g.raw?t.project.value?.deactivate():t.project.value?.active(g)},f=(g,h,k)=>k==="inner"?!!h.data.dir:!0,v=()=>{e.value?.update({pages:it(l)})};return(g,h)=>(c(),y(a(J),{class:"v-pages-widget",title:"页面管理",plus:"",subtitle:"(共 0 条)",onPlus:r},{default:b(()=>[p(a(dt),{data:l.value,"node-key":"id","default-expand-all":"",draggable:"","allow-drop":f,onNodeDrop:v},{default:b(({data:k,node:w})=>[p(a(X),{class:"v-pages-widget__item",icon:a(tt)[k.icon],title:k.title,subtitle:k.name,"model-value":{data:k,node:w},actions:k.dir?["add","edit","remove"]:k.raw?["home","edit","remove"]:["home","copy","edit","remove"],onAction:m,onClick:E=>d(k),active:a(n)?.id===k.id,tag:a(e)?.homepage===k.id?"主页":void 0,"tag-type":"success",grow:"",small:"",background:"",hover:""},null,8,["icon","title","subtitle","model-value","actions","onClick","active","tag"])]),_:1},8,["data"]),i.value?(c(),y(Cn,{key:0,modelValue:i.value,"onUpdate:modelValue":h[0]||(h[0]=k=>i.value=k),item:o.value,"parent-id":s.value},null,8,["modelValue","item","parent-id"])):x("",!0)]),_:1}))}}),Tn=C({name:"BlocksWidget",__name:"index",setup(u){const{span:e}=la(),{blocks:t,engine:l}=en(),n=_(void 0),{current:i}=ae(),o=_(!1),s=S(()=>n.value?.id?"编辑":"新增"),r=S(()=>`(共 ${t.value.length} 个)`),m=()=>({name:"",title:"",type:"block"}),d=async V=>{const D=V,R=l.project.value;if(!R)return!1;if(V.id)if(!R.existBlockName(D.name,[D.id]))R.updateBlock(D);else return K(`名称【${D.name}】已经存在，请更换名称`),!1;else if(!R.existBlockName(D.name))R.createBlock(D);else return K(`名称【${D.name}】已经存在，请更换名称`),!1;return!0},f=()=>{n.value=m(),o.value=!0},v=V=>{n.value=Ue(V),o.value=!0},g=V=>{l.project.value?.removeBlock(V.id)},h=V=>{n.value&&(n.value.name=Mt(V))},k=async V=>{l.project.value?.active(V)},w=async V=>{const D={type:"Schema",id:V.id},R=await l.assets.getBlockMaterial(D),P=l.skeleton?.getWidget("Designer")?.widgetRef?.designer;P&&R&&P.setDragging(R)},E=()=>{const V=l.skeleton?.getWidget("Designer")?.widgetRef?.designer;V&&V.setDragging(null)};return(V,D)=>(c(),y(a(J),{class:"v-blocks-widget",title:"区块管理",subtitle:r.value,plus:"",onPlus:f},{default:b(()=>[p(a(Xe),{wrap:"wrap",gutter:5},{default:b(()=>[(c(!0),j(F,null,W(a(t),R=>(c(),y(a(et),{key:R.id,span:a(e)},{default:b(()=>[p(a(ut),{name:R.name,title:R.title,active:a(i)?.id===R.id,editable:"",onEdit:P=>v(R),onRemove:P=>g(R),onClick:P=>k(R),draggable:a(i)?.id!==R.id,onDragstart:P=>w(R),onDragend:E},null,8,["name","title","active","onEdit","onRemove","onClick","draggable","onDragstart"])]),_:2},1032,["span"]))),128))]),_:1}),a(t).length?x("",!0):(c(),y(a(Z),{key:0})),p(a(de),{modelValue:o.value,"onUpdate:modelValue":D[0]||(D[0]=R=>o.value=R),title:s.value,model:n.value,width:"600px",height:"250px","form-props":{tooltipMessage:!1},"submit-method":d},{default:b(()=>[p(a(A),{name:"name",label:"名称",required:"",tip:"名称为英文驼峰格式",rules:{message:"名称格式错误",pattern:a(he)},onChange:h},null,8,["rules"]),p(a(A),{name:"title",label:"标题",required:""})]),_:1},8,["modelValue","title","model"])]),_:1},8,["subtitle"]))}}),Jn={class:"v-components-widget__search"},Nn={key:0,class:"v-components-widget__result"},Mn={class:"v-components-widget__list"},Un=C({name:"ComponentsWidget",__name:"index",setup(u){const{span:e,engine:t}=la(),{tabs:l,currentTab:n,currentGroup:i,model:o,searchKey:s,searchResult:r}=an(),m=f=>{const v=t.skeleton?.getWidget("Designer")?.widgetRef?.designer;v&&v.setDragging(f)},d=()=>{const f=t.skeleton?.getWidget("Designer")?.widgetRef?.designer;f&&f.setDragging(null)};return(f,v)=>(c(),y(a(J),{class:"v-components-widget",title:"组件库",body:{flex:!0,direction:"column"}},{default:b(()=>[L("div",Jn,[p(a(ve),{modelValue:a(s),"onUpdate:modelValue":v[0]||(v[0]=g=>ot(s)?s.value=g:null),placeholder:"搜索组件",clearable:"",size:"small"},{prefix:b(()=>[p(a(qa))]),_:1},8,["modelValue"])]),a(s)?(c(),j("div",Nn,[p(a(Xe),{wrap:"wrap",gutter:5},{default:b(()=>[(c(!0),j(F,null,W(a(r),g=>(c(),y(a(et),{span:a(e),key:g.name},{default:b(()=>[p(a(ut),{name:g.name,title:g.label||g.name,draggable:"",onDragstart:h=>m(g),onDragend:d},null,8,["name","title","onDragstart"])]),_:2},1032,["span"]))),128))]),_:1}),a(r).length?x("",!0):(c(),y(a(Z),{key:0}))])):(c(),y(a(zt),{key:1,items:a(l),modelValue:a(n),"onUpdate:modelValue":v[2]||(v[2]=g=>ot(n)?n.value=g:null)},{default:b(()=>[L("div",Mn,[a(i)?(c(),y(a(da),{key:0,modelValue:a(o)[a(n)],"onUpdate:modelValue":v[1]||(v[1]=g=>a(o)[a(n)]=g)},{default:b(()=>[(c(!0),j(F,null,W(a(i).children,g=>(c(),y(a(ma),{key:g.name,name:g.name,title:`${g.label} (${g.count})`},{default:b(()=>[g.components?(c(),y(a(Xe),{key:0,wrap:"wrap",gutter:5},{default:b(()=>[(c(!0),j(F,null,W(g.components,h=>(c(),y(a(et),{span:a(e),key:h.name},{default:b(()=>[p(a(ut),{name:h.name,title:h.label||h.name,draggable:"",onDragstart:k=>m(h),onDragend:d},null,8,["name","title","onDragstart"])]),_:2},1032,["span"]))),128))]),_:2},1024)):x("",!0)]),_:2},1032,["name","title"]))),128))]),_:1},8,["modelValue"])):x("",!0)])]),_:1},8,["items","modelValue"]))]),_:1}))}}),Hn=C({name:"OutlineWidget",__name:"index",setup(u){const{engine:e,designer:t,selected:l}=fe(),{current:n}=ae(),i=_([]),o=P=>{if(H(P))return P.locked?["unlock"]:["lock"];const I=P.parent;return I&&(I.locked||I.invisible)?[]:n.value?.locked?[]:P.locked?["unlock"]:P.invisible?["visible"]:["lock","invisible","copy","remove"]},s=P=>{const I=[];return P.forEach(B=>{const G={id:B.id,label:B.name,type:B.id,model:B};Array.isArray(B.children)&&(G.children=s(B.children)),I.push(G)}),I},r=()=>{if(!n.value)return[];const{id:P,name:I,nodes:B}=n.value;return[{id:P,label:I,type:P,model:n.value,children:s(B)}]},m=async()=>{i.value=r(),l.value?.model&&(await ke(),t.value?.setSelected(l.value.model))},d=S(()=>l.value?.model.id),f=P=>{const I=P.data;if(H(I.model)||I.model.locked||I.model.name==="template")return!1;const B=e.assets.componentMap.get(I.model.name);return B?(t.value?.setDragging(B),!0):!1},v=async(P,I,B)=>{const G=I.data,ie={prev:"top",next:"bottom",inner:"inner"}[B];let oe=!1;if(H(G.model))oe=B==="inner",t.value?.setDropping(oe?G.model:null,"inner");else{const N=G.model;oe=!!await t.value?.allowDrop(N,ie),t.value?.setDropping(oe?N:null,"inner")}return oe},g=P=>{const I=P?.model;!I||I.invisible||(t.value?.setSelected(I),t.value?.setHover(null))},h=async(P,I,B)=>{const G=P.data,ie=I.data;if(H(ie.model)){t.value?.setDropping(null),t.value?.setDragging(null);return}const oe=ie.model,N={before:"left",after:"right"}[B]||"inner";if(!await t.value?.allowDrop(oe,N)){t.value?.setDropping(null),m(),mt.warning({message:`${G.model.name}不能放置到该位置`}),t.value?.setDragging(null);return}const U=await t.value?.getDropSlot(B==="inner"?oe:oe.parent);if(U!==null){const z=G.model;z.slot=U,n.value?.move(z,oe,N)}else m();t.value?.setDropping(null),t.value?.setDragging(null),e.simulator.refresh()},k=P=>{H(P.model)?t.value?.setHover(P.model):(t.value?.setHover(P.model),P.model.invisible&&t.value?.setHover(null),P.model.name==="slot"&&t.value?.setHover(null))},w=()=>{t.value?.setHover(null)},E=P=>{const I=P.data;I.dragging=!0;const B=e.assets.componentMap.get(I.model.name);B&&t.value?.setDragging(B)},V=async P=>{const I=P.data;I.dragging=!1},D=(P,I)=>{P&&((P.id===I.id||!H(P)&&I.isChild(P))&&t.value?.setSelected(null),t.value?.setHover(null))},R=P=>{const{name:I,modelValue:B}=P,G=l.value?.model;switch(I){case"lock":D(G,B),B.lock();break;case"unlock":D(G,B),B.unlock();break;case"invisible":D(G,B),B.setVisible(!1);break;case"visible":B.setVisible(!0);break;case"copy":const ie=n.value?.cloneNode(B);ie&&t.value?.setSelected(ie);break;case"remove":D(G,B),n.value?.removeNode(B);break}};return Y(e.changed,m,{immediate:!0}),(P,I)=>(c(),y(a(J),{class:"v-outline-widget",title:"大纲树"},{default:b(()=>[(c(),y(a(dt),{key:a(e).changed.value,data:i.value,"node-key":"id","default-expand-all":"",draggable:"","empty-text":"请新建或打开文件","current-node-key":d.value,"highlight-current":!0,"expand-on-click-node":!1,"allow-drop":v,"allow-drag":f,onCurrentChange:g,onNodeDrop:h,onNodeDragStart:E,onNodeDragEnd:V},{default:b(({data:B,node:G})=>[p(a(X),{class:te(["v-outline-widget__item",{"is-locked":B.model.locked,"is-invisible":B.model.invisible,"is-dragging":B.dragging}]),active:!B.model.invisible&&G.isCurrent,grow:"",small:"",background:"",hover:"","model-value":B.model,icon:B.model.locked?a(Ft):B.model.invisible?a(Wt):void 0,title:B.label,subtitle:B.type,actions:o(B.model),onAction:R,onMouseenter:ie=>k(B),onMouseleave:w},null,8,["class","active","model-value","icon","title","subtitle","actions","onMouseenter"])]),_:1},8,["data","current-node-key"]))]),_:1}))}}),qn=C({name:"HistoryWidget",__name:"index",setup(u){const{history:e,load:t,total:l}=na(),n=S(()=>`(共 ${l.value} 条)`),i=s=>{s.name==="remove"&&e.value?.remove(s.modelValue.id)},o=async()=>{await Ee("确定要清空历史记录吗？")&&e.value?.clear()};return(s,r)=>(c(),y(a(J),{class:"v-history-widget",title:"历史记录",subtitle:n.value,remove:!!a(l),onRemove:o},{default:b(()=>[a(l)===0?(c(),y(a(Z),{key:0,"image-size":50})):x("",!0),a(e)?(c(!0),j(F,{key:1},W(a(e).items,(m,d)=>(c(),y(a(X),{index:d+1,title:m.label,"model-value":m,active:d==a(e).index,small:"",background:"",actions:["remove"],onAction:i,onClick:f=>a(t)(m.id)},null,8,["index","title","model-value","active","onClick"]))),256)):x("",!0)]),_:1},8,["subtitle","remove"]))}}),Q=Fl({loader:()=>Pl(()=>import("./Editor-ctkAn2cu-j1FUryYs.js"),__vite__mapDeps([0,1,2,3]),import.meta.url),loadingComponent:C({render(){return Ce("div","正在拼命加载...")}}),errorComponent:C({render(){return Ce("div","组件加载失败！")}})}),$n=C({name:"ApisWidget",__name:"index",setup(u){const e=_(!1),t=_(null),l=_(!1),n=S(()=>l.value?"编辑API":"新增API"),i=S(()=>o.value?.apis||[]),{project:o}=He(),s=()=>({method:"get",name:"",label:"",url:"",settings:{loading:!0,failMessage:!0,validSuccess:!0,originResponse:!1,injectHeaders:!1,type:"form",headers:{type:"JSExpression",value:"({})"}}}),r=()=>{e.value=!0,l.value=!1,t.value=s()},m=$l.map(w=>({label:w,value:w.toLowerCase()})),d={get:"success",post:"primary",put:"warning",delete:"danger",patch:"warning",jsonp:"info"},f=[{label:"表单",value:"form"},{label:"JSON",value:"json"},{label:"文件",value:"data"}],v=(w,E,V)=>{ee({type:"JSExpression",value:E},window)?V():V(new Error("代码错误"))},g=w=>{w.name==="edit"&&h(w.modelValue),w.name==="remove"&&o.value?.removeApi(w.modelValue.name)},h=w=>{l.value=!0,t.value=Ue(w),e.value=!0},k=async w=>o.value?.existApiName(w.name,l.value?[w.id]:[])?(K(`API名称 [ ${w.name} ] 已存在`),!1):(o.value?.setApi(w),!0);return(w,E)=>(c(),y(a(J),{class:"v-apis-widget",title:"API管理",plus:"",onPlus:r},{default:b(()=>[(c(!0),j(F,null,W(i.value,V=>(c(),y(a(X),{key:V.id,small:"",title:V.name,subtitle:V.label,"model-value":V,tag:V.method?.toUpperCase(),"tag-type":d[V.method||"get"],background:"",actions:["edit","remove"],onClick:D=>h(V),onAction:g},null,8,["title","subtitle","model-value","tag","tag-type","onClick"]))),128)),i.value.length===0?(c(),y(a(Z),{key:0,"image-size":50})):x("",!0),p(a(de),{modelValue:e.value,"onUpdate:modelValue":E[1]||(E[1]=V=>e.value=V),model:t.value,title:n.value,width:"1000px",height:"600px","form-props":{labelPosition:"top",tooltipMessage:!1,size:"default"},"submit-method":k},{default:b(()=>[p(a(T),{gap:"",fit:""},{default:b(()=>[p(a(T),{direction:"column",grow:"",width:"50%",shrink:""},{default:b(()=>[p(a(A),{name:"method",label:"请求类型",required:"",editor:"radio",options:a(m),props:{button:!0}},null,8,["options"]),p(a(A),{name:"name",label:"接口名称",required:"",rules:{pattern:a(he),message:"名称格式不正确"}},null,8,["rules"]),p(a(A),{name:"label",label:"备注说明",required:""}),p(a(A),{name:"url",label:"接口URL",required:""})]),_:1}),p(a(T),{direction:"column",grow:"",width:"50%",shrink:""},{default:b(()=>[t.value.method!=="jsonp"?(c(),y(a(J),{key:0,title:"请求配置",subtitle:t.value.method,border:""},{default:b(()=>[p(a(T),{justify:"space-around"},{default:b(()=>[p(a(A),{name:"settings.loading",size:"small",label:"加载提示",editor:"switch"}),p(a(A),{size:"small",name:"settings.failMessage",label:"失败提示",editor:"switch"}),p(a(A),{size:"small",name:"settings.validSuccess",label:"校验成功",editor:"switch"}),p(a(A),{size:"small",name:"settings.originResponse",label:"原始响应",editor:"switch"}),p(a(A),{size:"small",name:"settings.injectHeaders",label:"注入请求头",editor:"switch"})]),_:1}),p(a(A),{size:"small",name:"settings.type",label:"发送数据类型",editor:"radio",options:f,props:{button:!0}}),p(a(A),{size:"small",name:"settings.headers.value",label:"请求头配置",tip:"支持 JSExpression 或 JSFunction",rules:{validator:v}},{editor:b(()=>[p(a(Q),{modelValue:t.value.settings.headers.value,"onUpdate:modelValue":E[0]||(E[0]=V=>t.value.settings.headers.value=V),dark:"",height:"200px"},null,8,["modelValue"])]),_:1},8,["rules"])]),_:1},8,["subtitle"])):x("",!0),t.value.method==="jsonp"?(c(),y(a(J),{key:1,title:"请求配置",subtitle:t.value.method,border:""},{default:b(()=>[p(a(A),{name:"jsonpOptions.jsonpCallback",size:"small",label:"jsonpCallback"}),p(a(A),{name:"jsonpOptions.jsonpCallbackFunction",size:"small",label:"jsonpCallbackFunction"}),p(a(A),{name:"jsonpOptions.timeout",size:"small",label:"timeout",editor:"number"}),p(a(A),{name:"jsonpOptions.crossorigin",size:"small",label:"crossorigin",editor:"switch"})]),_:1},8,["subtitle"])):x("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue","model","title"])]),_:1}))}}),Gn=C({name:"DepsWidget",__name:"index",setup(u){const{dependencies:e,engine:t}=aa(),l=_(!1),n=_(!1),i=_({}),o=S(()=>n.value?"查看依赖":i.value?"编辑依赖":"新增依赖"),s=h=>h.required||h.official?[]:["edit","remove"],r=h=>h.official&&!h.required,m=async h=>(h.urls=h.urls.split(`
`),t.project.value?.setDeps(h),!0),d=h=>{t.project.value?.setDeps(h)},f=()=>{n.value=!1,l.value=!0,i.value=null},v=h=>{n.value=!0,i.value={...h,urls:h.urls.join(`
`)},l.value=!0},g=(h,k)=>{k.name==="edit"&&(i.value={...h,urls:h.urls.join(`
`)},n.value=!1,l.value=!0),k.name==="remove"&&t.project.value?.removeDeps(h)};return(h,k)=>(c(),y(a(J),{class:"v-deps-widget",title:"依赖管理",plus:"",onPlus:f},{default:b(()=>[(c(!0),j(F,null,W(a(e),w=>(c(),y(a(X),{key:w.package,title:w.package,subtitle:w.version,actions:s(w),background:"",switch:r(w),modelValue:w.enabled,"onUpdate:modelValue":E=>w.enabled=E,onSwitch:E=>d(w),onClick:E=>v(w),onAction:E=>g(w,E)},null,8,["title","subtitle","actions","switch","modelValue","onUpdate:modelValue","onSwitch","onClick","onAction"]))),128)),p(a(de),{modelValue:l.value,"onUpdate:modelValue":k[0]||(k[0]=w=>l.value=w),width:"600px",height:"500px",title:o.value,model:i.value,submitMethod:m,formProps:{disabled:n.value,tooltipMessage:!1}},{default:b(()=>[p(a(A),{name:"package",label:"包名",required:"",disabled:!!i.value},null,8,["disabled"]),p(a(A),{name:"version",label:"版本",required:""}),p(a(A),{name:"library",label:"导出名称",required:""}),p(a(A),{name:"urls",label:"资源文件",editor:"textarea",props:{rows:3},tip:"多个资源可以换行输入",required:""}),p(a(A),{name:"assetsUrl",label:"物料URL"}),p(a(A),{name:"assetsLibrary",label:"物料名称"})]),_:1},8,["modelValue","title","model","formProps"])]),_:1}))}}),Qn=C({__name:"actions",props:{position:{},model:{},path:{default:()=>[]}},emits:["action"],setup(u,{emit:e}){const t=u,l=e,n=S(()=>t.model.name),i=S(()=>!H(t.model)&&!t.model.locked),o=S(()=>t.path.map(d=>({command:d,label:d.name,onMouseenter:()=>{l("action",{type:"hover",model:d})}}))),s=[{name:"prev",icon:bl,title:"向前移动"},{name:"next",icon:yl,title:"向后移动"},{name:"copy",icon:Ht,title:"复制"},{name:"remove",icon:Me,title:"删除"}],r=d=>{l("action",{type:"selected",model:d.command})},m=async d=>{d.name==="remove"?await Ee("确定删除?")&&l("action",{type:d.name,model:t.model}):l("action",{type:d.name,model:t.model})};return(d,f)=>(c(),j("div",{class:te(["v-actions",[`is-${t.position}`]])},[p(a(xe),{mode:"icon",size:"small",icon:a(Ut),label:n.value,menus:o.value,background:"none",onCommand:r},null,8,["icon","label","menus"]),p(a(ul),{disabled:!i.value,mode:"icon",size:"small",items:s,background:"none",onClick:m},null,8,["disabled"])],2))}}),Zn={key:1,class:"v-designer__placeholder"},Kn=C({name:"VDesigner",inheritAttrs:!1,__name:"index",setup(u,{expose:e}){const t=_(),l=_(),{width:n,height:i}=ea(t),{dependencies:o,engine:s}=aa(),{current:r,isEmpty:m}=ae(),d=S(()=>s.skeleton?.getWidget("Toolbar")?.widgetRef.mode??"pc"),{designer:f,hover:v,dropping:g,selected:h}=ln(l,o),k=w=>{const E=w.type,V=w.model;if(r.value)switch(E){case"remove":r.value.removeNode(V),f.value?.setSelected(null);break;case"copy":const D=r.value.cloneNode(V);f.value?.setSelected(D);break;case"prev":r.value.movePrev(V),f.value?.setSelected(V);break;case"next":r.value.moveNext(V),f.value?.setSelected(V);break;case"hover":f.value?.setHover(V);break;case"selected":f.value?.setSelected(V);break}};return e({designer:f,mode:d}),(w,E)=>(c(),j("div",{ref_key:"container",ref:t,class:"v-designer"},[p(a(oa),{mode:d.value,width:a(n),height:a(i)},{default:b(()=>[L("iframe",{ref_key:"iframe",ref:l,frameborder:"0"},null,512),a(g)?(c(),j("div",{key:0,class:te(["v-designer__dropping","is-inner"]),style:Le(a(g).style)},null,4)):x("",!0),a(v)?(c(),j("div",{key:1,class:"v-designer__hover",style:Le(a(v).style)},[L("span",{class:te(`is-${a(v).position}`)},[q(O(a(v).model.name)+": ",1),L("i",null,O(a(v).model.id),1)],2)],4)):x("",!0),a(h)?(c(),j("div",{key:2,class:"v-designer__selected",style:Le(a(h).style)},[p(Qn,{position:a(h).position,model:a(h).model,path:a(h).path,onAction:k},null,8,["position","model","path"])],4)):x("",!0)]),_:1},8,["mode","width","height"]),a(r)?x("",!0):(c(),y(a(Z),{key:0,description:"请新建或打开文件"})),a(r)&&a(m)?(c(),j("div",Zn," 您可以拖拽组件放置到这里 ")):x("",!0)],512))}}),ze=C({__name:"group",props:{context:{},current:{},title:{},nameLabel:{},valueLabel:{},createEmpty:{},list:{},remove:{},submit:{},itemTitle:{type:Function,default:u=>u.name}},setup(u){const e=u,t=_(),l=_(),n=_(!1),i=_(e.createEmpty()),o=_(!1),s=S(()=>o.value?`编辑${e.title}`:`新增${e.title}`),r=()=>{o.value=!1,i.value=e.createEmpty(),n.value=!0},m=(h,k)=>{switch(k.name){case"edit":f(h);break;case"remove":e.remove(h);break}},d=h=>{i.value.value=h},f=h=>{o.value=!0,i.value={...h},n.value=!0},v=async h=>e.submit(h,o.value),g=()=>{l.value?.itemRef.validate()};return(h,k)=>(c(),y(a(J),{title:e.title,class:"v-sub-panel",size:"small",fit:!1,plus:"",onPlus:r},{default:b(()=>[(c(!0),j(F,null,W(h.list,w=>(c(),y(a(X),{title:e.itemTitle(w),border:"",actions:["edit","remove"],onAction:E=>m(w,E),onClick:E=>f(w)},null,8,["title","onAction","onClick"]))),256)),h.list.length?x("",!0):(c(),y(a(Z),{key:0,"image-size":40})),p(a(ft),{modelValue:n.value,"onUpdate:modelValue":k[1]||(k[1]=w=>n.value=w),title:s.value,"submit-method":v,model:i.value,block:h.current,context:h.context,onPick:d},{default:b(()=>[pe(h.$slots,"fields",Kt(Yt({model:i.value,isEdit:o.value,nameLabel:h.nameLabel,valueLabel:h.valueLabel})),()=>[p(a(A),{name:"name",label:h.nameLabel,required:"",disabled:o.value},null,8,["label","disabled"]),p(a(A),{ref_key:"codeFieldRef",ref:l,name:"value",label:h.valueLabel,required:""},{editor:b(()=>[p(a(Q),{ref_key:"editorRef",ref:t,dark:"",height:"350px",modelValue:i.value.value,"onUpdate:modelValue":k[0]||(k[0]=w=>i.value.value=w),onBlur:g},null,8,["modelValue"])]),_:1},8,["label"])])]),_:3},8,["modelValue","title","model","block","context"])]),_:3},8,["title"]))}}),Yn=C({__name:"state",props:{context:{},current:{}},setup(u){const e=u,t=S(()=>Object.entries(e.current?.state||{}).map(([o,s])=>({name:o,value:Ve(s)}))),l=()=>({name:"",value:""}),n=o=>e.current?.removeState(o.name),i=async(o,s)=>{const{name:r,value:m}=o;if(!s&&e.current?.state[r])return K(`名称 ${r} 已存在，请更换！`),!1;const d={type:"JSExpression",value:m};return ee(d,e.context,!0)?(e.current?.setState(r,d),!0):!1};return(o,s)=>(c(),y(ze,{title:"状态数据",current:e.current,context:e.context,list:t.value,nameLabel:"状态数据名称",valueLabel:"状态初始值 [ JSExpression ]",createEmpty:l,remove:n,submit:i},null,8,["current","context","list"]))}}),Xn=C({__name:"computed",props:{context:{},current:{}},setup(u){const e=u,t=S(()=>Object.entries(e.current?.computed||{}).map(([o,s])=>({name:o,value:Ve(s)}))),l=()=>({name:"",value:"() => { }"}),n=o=>e.current?.removeFunction("computed",o.name),i=async(o,s)=>{const{name:r,value:m}=o;if(!s&&e.current?.computed[r])return K(`名称 ${r} 已存在，请更换！`),!1;const d={type:"JSFunction",value:m};return ee(d,e.context,!0)?(e.current?.setFunction("computed",r,d),!0):!1};return(o,s)=>(c(),y(ze,{title:"计算属性",current:e.current,context:e.context,list:t.value,nameLabel:"计算属性名称",valueLabel:"计算函数 [ JSFunction ]",createEmpty:l,remove:n,submit:i},null,8,["current","context","list"]))}}),es=C({__name:"methods",props:{context:{},current:{}},setup(u){const e=u,t=S(()=>Object.entries(e.current?.methods||{}).map(([o,s])=>({name:o,value:Ve(s)}))),l=()=>({name:"",value:"() => { }"}),n=o=>e.current?.removeFunction("methods",o.name),i=async(o,s)=>{const{name:r,value:m}=o;if(!s&&e.current?.methods[r])return K(`名称 ${r} 已存在，请更换！`),!1;const d={type:"JSFunction",value:m};return ee(d,e.context,!0)?(e.current?.setFunction("methods",r,d),!0):!1};return(o,s)=>(c(),y(ze,{title:"组件方法",current:e.current,context:e.context,list:t.value,nameLabel:"方法名称",valueLabel:"方法函数 [ JSFunction ]",createEmpty:l,remove:n,submit:i},null,8,["current","context","list"]))}}),ts=C({__name:"lifeCycles",props:{context:{},current:{}},setup(u){const e=u,t=S(()=>cl.map(s=>({label:s,value:s}))),l=S(()=>Object.entries(e.current?.lifeCycles||{}).map(([s,r])=>({name:s,value:Ve(r)}))),n=()=>({name:"",value:"() => { }"}),i=s=>e.current?.removeFunction("lifeCycles",s.name),o=async(s,r)=>{const{name:m,value:d}=s;if(!r&&e.current?.lifeCycles[m])return K(`名称 ${m} 已存在，请更换！`),!1;const f={type:"JSFunction",value:d};return ee(f,e.context,!0)?(e.current?.setFunction("lifeCycles",m,f),!0):!1};return(s,r)=>(c(),y(ze,{title:"生命周期",current:e.current,context:e.context,list:l.value,nameLabel:"名称",valueLabel:"函数 [ JSFunction ]",createEmpty:n,remove:i,submit:o},{fields:b(({model:m,nameLabel:d,isEdit:f,valueLabel:v})=>[p(a(A),{name:"name",label:d,editor:"select",options:t.value,required:"",disabled:f},null,8,["label","options","disabled"]),p(a(A),{name:"value",label:v,required:""},{editor:b(()=>[p(a(Q),{ref:"editorRef",dark:"",height:"350px",modelValue:m.value,"onUpdate:modelValue":g=>m.value=g},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])]),_:1},8,["current","context","list"]))}}),as=C({__name:"watch",props:{context:{},current:{}},setup(u){const e=u,t=S(()=>(e.current?.watch||[]).map(s=>({...s,source:Ve(s.source),handler:Ve(s.handler)}))),l=()=>({source:"() => { }",deep:!1,immediate:!1,handler:"() => { }"}),n=s=>s.source,i=s=>e.current?.removeWatch(s),o=async(s,r)=>{const m={type:"JSFunction",value:s.source},d={type:"JSFunction",value:s.handler};if(!ee(m,e.context,!0)||!ee(d,e.context,!0))return!1;const f={...s,source:m,handler:d};return e.current?.setWatch(f),!0};return(s,r)=>(c(),y(ze,{title:"侦听器",current:e.current,context:e.context,list:t.value,nameLabel:"侦听源 [ JSFunction ]",valueLabel:"处理函数 [ JSFunction ]",createEmpty:l,remove:i,submit:o,itemTitle:n,grow:""},{fields:b(({model:m,nameLabel:d,valueLabel:f})=>[p(a(A),{name:"source",label:d,required:""},{editor:b(()=>[p(a(Q),{dark:"",height:"100px",modelValue:m.source,"onUpdate:modelValue":v=>m.source=v},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]),p(a(A),{name:"deep",modelValue:m.deep,"onUpdate:modelValue":v=>m.deep=v,label:"深度监听",editor:"switch"},null,8,["modelValue","onUpdate:modelValue"]),p(a(A),{name:"immediate",modelValue:m.immediate,"onUpdate:modelValue":v=>m.immediate=v,label:"立即执行",editor:"switch"},null,8,["modelValue","onUpdate:modelValue"]),p(a(A),{name:"handler",label:f,required:""},{editor:b(()=>[p(a(Q),{dark:"",height:"130px",modelValue:m.handler,"onUpdate:modelValue":v=>m.handler=v},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])]),_:1},8,["current","context","list"]))}}),ls=C({__name:"index",setup(u){const{current:e,context:t}=ae();return(l,n)=>(c(),y(a(T),{class:"v-scripts-widget",direction:"column",fit:""},{default:b(()=>[p(Yn,{current:a(e),context:a(t)},null,8,["current","context"]),p(Xn,{current:a(e),context:a(t)},null,8,["current","context"]),p(es,{current:a(e),context:a(t)},null,8,["current","context"]),p(ts,{current:a(e),context:a(t)},null,8,["current","context"]),p(as,{current:a(e),context:a(t)},null,8,["current","context"])]),_:1}))}}),Ke=C({__name:"setters",props:{context:{},current:{},title:{},items:{},node:{},removable:{type:Boolean}},emits:["change","remove"],setup(u,{emit:e}){const t=u,l=e,n=(o,s)=>{l("change",o,s)},i=o=>{l("remove",o)};return(o,s)=>(c(),y(a(J),{title:t.title,class:"v-sub-panel",size:"small",fit:!1},{default:b(()=>[p(a(We),{class:"v-properties-widget__form",size:"small","label-width":"90px",onKeydown:s[0]||(s[0]=Oe(je(()=>{},["prevent","stop"]),["enter"]))},{default:b(()=>[(c(!0),j(F,null,W(t.items,r=>(c(),y(a(we),ce(r,{key:`${r.name}_${t.node.id}`,current:t.current,context:t.context,removable:t.removable,onChange:n,onRemove:i}),null,16,["current","context","removable"]))),128))]),_:1})]),_:1},8,["title"]))}}),ns=C({name:"PropertiesWidget",__name:"index",setup(u){const{current:e,context:t}=ae(),{selected:l}=fe(),{node:n,commonProps:i,change:o,componentProps:s,customProps:r,addCustom:m,removeCustom:d,isExist:f}=rn(l),v=_(!1),g=_(),h=()=>{v.value=!0,g.value={name:""}},k=async E=>{const V=Object.keys(n.value?.props||{});return!f(E.name)&&!V.includes(E.name)?(m(E.name),!0):(K("已存在该属性名称"),!1)},w=async E=>{await Ee("确定删除？")&&d(E)};return(E,V)=>a(e)?(c(),y(a(T),{key:0,class:"v-properties-widget",direction:"column",fit:""},{default:b(()=>[a(n)?(c(),y(Ke,{key:0,title:"通用属性",current:a(e),context:a(t),node:a(n),items:a(i),onChange:a(o)},null,8,["current","context","node","items","onChange"])):x("",!0),a(n)&&a(s).length?(c(),y(Ke,{key:1,title:"组件属性",current:a(e),context:a(t),node:a(n),items:a(s),onChange:a(o)},null,8,["current","context","node","items","onChange"])):x("",!0),a(n)?(c(),y(Ke,{key:2,title:"自定义属性",current:a(e),context:a(t),node:a(n),items:a(r),onChange:a(o),removable:"",plus:"",grow:"",onPlus:h,onRemove:w},null,8,["current","context","node","items","onChange"])):x("",!0),p(a(de),{modelValue:v.value,"onUpdate:modelValue":V[0]||(V[0]=D=>v.value=D),title:"新增自定义属性",width:"400px",height:"150px","submit-method":k,formProps:{tooltipMessage:!1},model:g.value},{default:b(()=>[p(a(A),{name:"name",label:"属性名称",required:"",rules:{message:"名称格式错误",pattern:a(he)}},null,8,["rules"])]),_:1},8,["modelValue","model"])]),_:1})):x("",!0)}}),ss=C({name:"VariableBinder",__name:"variable",props:{context:{},current:{},value:{}},setup(u){const e=u,t=_(),l=Ie({type:"JSExpression",value:e.value}),n=i=>{t.value.getEditor().setValue(i),l.value=i};return(i,o)=>(c(),y(a(ft),{title:"绑定变量","unbind-enabled":"",block:e.current,context:e.context,model:l,onPick:n},{default:b(()=>[p(a(A),{name:"value",label:"绑定内容 [ JSExpression ]",required:""},{editor:b(()=>[p(a(Q),{ref_key:"editorRef",ref:t,modelValue:l.value,"onUpdate:modelValue":o[0]||(o[0]=s=>l.value=s),dark:"",height:"450px"},null,8,["modelValue"])]),_:1})]),_:1},8,["block","context","model"]))}}),os=C({name:"EventBinder",__name:"event",props:{context:{},current:{},name:{},event:{}},setup(u){const e=u,t=_(),l=Ie({name:e.name,...e.event,modifiers:Object.keys(e.event?.modifiers||{}),handler:{type:"JSFunction",value:e.event?.handler?.value||"() => {}"}}),n=Gl.map(o=>({label:o,value:o})),i=o=>{t.value.getEditor().setValue(o),l.handler.value=o};return(o,s)=>(c(),y(a(ft),{title:"绑定事件","unbind-enabled":"",block:e.current,context:e.context,model:l,onPick:i},{default:b(()=>[p(a(A),{name:"modifiers",label:"事件修饰符",editor:"checkbox",options:a(n)},null,8,["options"]),p(a(A),{name:"handler.value",label:"事件处理函数 [ JSFunction ]",required:""},{editor:b(()=>[p(a(Q),{ref_key:"editorRef",ref:t,modelValue:l.handler.value,"onUpdate:modelValue":s[0]||(s[0]=r=>l.handler.value=r),dark:"",height:"350px"},null,8,["modelValue"])]),_:1})]),_:1},8,["block","context","model"]))}}),is=C({name:"EventsWidget",__name:"index",setup(u){const{current:e,context:t}=ae(),{selected:l}=fe(),{mouseEventList:n,keyboardEventList:i,componentEventList:o}=un(l),s=_({name:"",event:void 0}),r=_(!1),m=h=>{s.value=Ue(h),r.value=!0},d=async h=>{const k={...h,modifiers:h.modifiers.reduce((w,E)=>(w[E]=!0,w),{})};return ee(k.handler,t.value,!0)?((l.value?.model).setEvent(k),!0):!1},f=async h=>{const k=l.value?.model;h.name&&(k.removeEvent(h.name),r.value=!1)},v=async()=>{s.value.name&&await Ee("确定要删除该事件吗？")&&f(s.value)},g=h=>{const{name:k,modelValue:w}=h;k==="edit"&&m(w),k==="remove"&&f(w)};return(h,k)=>(c(),y(a(T),{class:"v-events-widget",direction:"column",fit:""},{default:b(()=>[p(a(J),{title:"组件事件",class:"v-sub-panel",size:"small",fit:!1},{default:b(()=>[a(o).length?x("",!0):(c(),y(a(Z),{key:0,"image-size":50,description:"该组件无自带事件"})),(c(!0),j(F,null,W(a(o),w=>(c(),y(a(X),{key:`component_${w.name}`,title:w.name,"model-value":w,border:"",small:"",actions:w.event?["edit","remove"]:["edit"],active:!!w.event,onClick:E=>m(w),onAction:g},null,8,["title","model-value","actions","active","onClick"]))),128))]),_:1}),p(a(J),{title:"鼠标事件",class:"v-sub-panel",size:"small",fit:!1},{default:b(()=>[(c(!0),j(F,null,W(a(n),w=>(c(),y(a(X),{key:`mouse_${w.name}`,title:w.name,"model-value":w,border:"",small:"",actions:w.event?["edit","remove"]:["edit"],active:!!w.event,onClick:E=>m(w),onAction:g},null,8,["title","model-value","actions","active","onClick"]))),128))]),_:1}),p(a(J),{title:"键盘事件",class:"v-sub-panel",size:"small",grow:"",fit:!1},{default:b(()=>[(c(!0),j(F,null,W(a(i),w=>(c(),y(a(X),{key:`keyboard_${w.name}`,title:w.name,"model-value":w,border:"",small:"",actions:w.event?["edit","remove"]:["edit"],active:!!w.event,onClick:E=>m(w),onAction:g},null,8,["title","model-value","actions","active","onClick"]))),128))]),_:1}),r.value?(c(),y(a(os),{key:0,modelValue:r.value,"onUpdate:modelValue":k[0]||(k[0]=w=>r.value=w),context:a(t),current:a(e),name:s.value.name,event:s.value.event,submitMethod:d,onUnbind:v},null,8,["modelValue","context","current","name","event"])):x("",!0)]),_:1}))}}),rs=C({name:"CssWidget",__name:"index",setup(u){const{current:e}=ae(),t=_(),l=S(()=>e.value?.css||""),n=o=>{e.value?.setCss(o)},i=()=>{const o=(t.value?.getEditor()).getValue();n(o),se("保存成功")};return(o,s)=>(c(),y(a(J),{class:"v-css-widget v-sub-panel",title:"lang:css scoped",size:"small",fit:"",save:"",onSave:i},{default:b(()=>[p(a(Q),{ref_key:"editorRef",ref:t,"model-value":l.value,height:"100%",lang:"css",dark:"",onBlur:n},null,8,["model-value"])]),_:1}))}}),us=C({name:"DirectivesWidget",__name:"index",setup(u){const{current:e,context:t}=ae(),{selected:l}=fe(),{vIf:n,vShow:i,vBind:o,vFor:s,vModels:r,onValueChange:m,onForChange:d,onModelChange:f}=pn(l),v=g=>g.arg?typeof g.arg=="string"?g.arg:Je(g.arg,{}):"modelValue";return(g,h)=>(c(),y(a(T),{class:"v-directives-widget",direction:"column",fit:""},{default:b(()=>[p(a(J),{class:"v-sub-panel",title:"内置指令",size:"small",fit:!1},{default:b(()=>[p(a(We),{size:"small","label-width":"80px",onKeydown:h[0]||(h[0]=Oe(je(()=>{},["prevent","stop"]),["enter"]))},{default:b(()=>[p(a(we),{name:"vIf",label:"v-if",setters:"ExpressionSetter",current:a(e),context:a(t),value:a(n).value,onChange:a(m)},null,8,["current","context","value","onChange"]),p(a(we),{name:"vShow",label:"v-show",setters:"ExpressionSetter",current:a(e),context:a(t),value:a(i).value,onChange:a(m)},null,8,["current","context","value","onChange"]),p(a(we),{name:"vBind",label:"v-bind",setters:"ExpressionSetter",current:a(e),context:a(t),value:a(o).value,onChange:a(m)},null,8,["current","context","value","onChange"])]),_:1})]),_:1}),p(a(J),{class:"v-sub-panel",title:"循环",size:"small",fit:!1},{default:b(()=>[p(a(We),{size:"small","label-width":"80px",onKeydown:h[1]||(h[1]=Oe(je(()=>{},["prevent","stop"]),["enter"]))},{default:b(()=>[p(a(we),{name:"value",label:"循环数据",setters:"ExpressionSetter",current:a(e),context:a(t),value:a(s).value,onChange:a(d)},null,8,["current","context","value","onChange"]),p(a(we),{name:"item",label:"迭代变量名",setters:{name:"StringSetter",props:{placeholder:"item"}},current:a(e),context:a(t),value:a(s).iterator?.item,onChange:a(d)},null,8,["current","context","value","onChange"]),p(a(we),{name:"index",label:"索引变量名",setters:{name:"StringSetter",props:{placeholder:"index"}},current:a(e),context:a(t),value:a(s).iterator?.index,onChange:a(d)},null,8,["current","context","value","onChange"])]),_:1})]),_:1}),p(a(J),{class:"v-sub-panel",title:"双向绑定",size:"small",fit:!1,grow:""},{default:b(()=>[(c(!0),j(F,null,W(a(r),(k,w)=>(c(),y(a(J),{card:"",border:"",class:"v-sub-panel",size:"small",title:`v-model: ${v(k)}`,body:{grow:!1},fit:!1},{default:b(()=>[p(a(We),{size:"small","label-width":"60px",onKeydown:h[2]||(h[2]=Oe(je(()=>{},["prevent","stop"]),["enter"]))},{default:b(()=>[p(a(we),{name:w.toString(),label:"绑定变量",setters:"ExpressionSetter",current:a(e),context:a(t),value:k.value,onChange:a(f)},null,8,["name","current","context","value","onChange"])]),_:2},1024)]),_:2},1032,["title"]))),256)),a(r).length?x("",!0):(c(),y(a(Z),{key:0,description:"当前组件没有双向绑定属性","image-size":50}))]),_:1})]),_:1}))}}),cs=C({name:"DefinedPropsDialog",__name:"props",props:{item:{},current:{},context:{}},setup(u){const e=u,t=S(()=>e.item?"编辑定义属性":"新增定义属性"),l=_(Object.assign({default:{type:"JSExpression",value:""}},e.item)),n=Object.keys(dl).map(o=>({label:o,value:o})),i=async o=>{const s=o.default;return s&&!ee(s,e.context,!0)?!1:(e.current.setProp(o),!0)};return(o,s)=>(c(),y(a(de),{title:t.value,width:"800px",height:"500px",model:l.value,"form-props":{tooltipMessage:!1},"submit-method":i},{default:b(()=>[p(a(A),{name:"name",label:"属性名称",required:"",tip:"名称为英文驼峰格式",disabled:!!e.item,rules:{message:"名称格式错误",pattern:a(he)}},null,8,["disabled","rules"]),p(a(A),{name:"type",label:"数据类型",editor:"checkbox",props:{button:!0,size:"small"},options:a(n),required:""},null,8,["options"]),p(a(A),{name:"required",label:"必须",editor:"switch"}),p(a(A),{name:"default.value",label:"默认值",editor:"none"},{default:b(()=>[p(a(Q),{modelValue:l.value.default.value,"onUpdate:modelValue":s[0]||(s[0]=r=>l.value.default.value=r),height:"200px",dark:""},null,8,["modelValue"])]),_:1})]),_:1},8,["title","model"]))}}),ds=C({name:"DefinedEventsDialog",__name:"events",props:{item:{},current:{},context:{}},setup(u){const e=u,t=S(()=>e.item?"编辑定义事件":"新增定义事件"),l=_({name:e.item}),n=async i=>(e.item&&e.current.removeEmit(e.item,!0),e.current.setEmit(i.name),!0);return(i,o)=>(c(),y(a(de),{title:t.value,width:"600px",height:"200px",model:l.value,"form-props":{tooltipMessage:!1},"submit-method":n},{default:b(()=>[p(a(A),{name:"name",label:"事件名称",required:"",disabled:!!e.item,rules:{message:"名称格式错误",pattern:a(he)}},null,8,["disabled","rules"])]),_:1},8,["title","model"]))}}),ms=C({name:"DefinedSlotsDialog",__name:"slots",props:{item:{},current:{},context:{}},setup(u){const e=u,t=S(()=>e.item?"编辑定义插槽":"新增定义插槽"),l=_({name:e.item}),n=async i=>(e.item&&e.current.removeSlot(e.item,!0),e.current.setSlot(i.name),!0);return(i,o)=>(c(),y(a(de),{title:t.value,width:"600px",height:"200px",model:l.value,"form-props":{tooltipMessage:!1},"submit-method":n},{default:b(()=>[p(a(A),{name:"name",label:"插槽名称",disabled:!!e.item,required:"",rules:{message:"名称格式错误",pattern:a(he)}},null,8,["disabled","rules"])]),_:1},8,["title","model"]))}}),ps=C({name:"DefinedInjectsDialog",__name:"injects",props:{item:{},current:{},context:{}},setup(u){const e=u,t=S(()=>e.item?"编辑注入":"新增注入"),l=_(Object.assign({default:{type:"JSExpression",value:""}},e.item)),n=async i=>{const o=i.default;return o&&!ee(o,e.context,!0)?!1:(e.current.setInject(i),!0)};return(i,o)=>(c(),y(a(de),{title:t.value,width:"800px",height:"500px",model:l.value,"form-props":{tooltipMessage:!1},"submit-method":n},{default:b(()=>[p(a(A),{name:"name",label:"注入名称",required:"",tip:"名称为英文驼峰格式",disabled:!!e.item,rules:{message:"名称格式错误",pattern:a(he)}},null,8,["disabled","rules"]),p(a(A),{name:"from",label:"来源名称",tip:"默认和注入名称一致"}),p(a(A),{name:"default.value",label:"默认值",editor:"none"},{default:b(()=>[p(a(Q),{modelValue:l.value.default.value,"onUpdate:modelValue":o[0]||(o[0]=s=>l.value.default.value=s),height:"200px",dark:""},null,8,["modelValue"])]),_:1})]),_:1},8,["title","model"]))}}),vs=C({name:"DefinedWidget",__name:"index",setup(u){const{current:e,context:t}=ae(),l=S(()=>(e.value?.props||[]).map(N=>typeof N=="string"?{name:N}:N)),n=S(()=>e.value?.emits||[]),i=S(()=>e.value?.slots||[]),o=S(()=>e.value?.inject||[]),s=_(!1),r=_(),m=_(!1),d=_(),f=_(!1),v=_(),g=_(!1),h=_(),k=()=>{r.value=void 0,s.value=!0},w=N=>{const{name:U,modelValue:z}=N;U==="edit"&&E(z),U==="remove"&&e.value?.removeProp(z)},E=N=>{r.value=N,s.value=!0},V=()=>{d.value=void 0,m.value=!0},D=N=>{d.value=N,m.value=!0},R=N=>{const{name:U,modelValue:z}=N;U==="edit"&&D(z),U==="remove"&&e.value?.removeEmit(z)},P=()=>{v.value=void 0,f.value=!0},I=N=>{v.value=N,f.value=!0},B=N=>{const{name:U,modelValue:z}=N;U==="edit"&&I(z),U==="remove"&&e.value?.removeSlot(z)},G=()=>{h.value=void 0,g.value=!0},ie=N=>{h.value=N,g.value=!0},oe=N=>{const{name:U,modelValue:z}=N;U==="edit"&&ie(z),U==="remove"&&e.value?.removeInject(z)};return(N,U)=>a(e)&&a(t)?(c(),y(a(T),{key:0,class:"v-defined-widget",direction:"column",fit:""},{default:b(()=>[p(a(J),{class:"v-sub-panel",title:"定义属性",size:"small",plus:"",fit:!1,onPlus:k},{default:b(()=>[(c(!0),j(F,null,W(l.value,z=>(c(),y(a(X),{"model-value":z,title:z.name,border:"",actions:["edit","remove"],onClick:$e=>E(z),onAction:w},null,8,["model-value","title","onClick"]))),256)),l.value.length?x("",!0):(c(),y(a(Z),{key:0,"image-size":50})),s.value?(c(),y(cs,{key:1,current:a(e),context:a(t),modelValue:s.value,"onUpdate:modelValue":U[0]||(U[0]=z=>s.value=z),item:r.value},null,8,["current","context","modelValue","item"])):x("",!0)]),_:1}),p(a(J),{class:"v-sub-panel",title:"定义事件",size:"small",plus:"",fit:!1,onPlus:V},{default:b(()=>[(c(!0),j(F,null,W(n.value,z=>(c(),y(a(X),{"model-value":z,title:z,border:"",actions:["remove"],onClick:$e=>D(z),onAction:R},null,8,["model-value","title","onClick"]))),256)),n.value.length?x("",!0):(c(),y(a(Z),{key:0,"image-size":50})),m.value?(c(),y(ds,{key:1,modelValue:m.value,"onUpdate:modelValue":U[1]||(U[1]=z=>m.value=z),current:a(e),context:a(t),item:d.value},null,8,["modelValue","current","context","item"])):x("",!0)]),_:1}),p(a(J),{class:"v-sub-panel",title:"定义插槽",size:"small",plus:"",fit:!1,onPlus:P},{default:b(()=>[(c(!0),j(F,null,W(i.value,z=>(c(),y(a(X),{"model-value":z,title:z,border:"",actions:["remove"],onClick:$e=>I(z),onAction:B},null,8,["model-value","title","onClick"]))),256)),i.value.length?x("",!0):(c(),y(a(Z),{key:0,"image-size":50})),f.value?(c(),y(ms,{key:1,modelValue:f.value,"onUpdate:modelValue":U[2]||(U[2]=z=>f.value=z),current:a(e),context:a(t),item:v.value},null,8,["modelValue","current","context","item"])):x("",!0)]),_:1}),p(a(J),{class:"v-sub-panel",title:"注入",size:"small",plus:"",fit:!1,grow:"",onPlus:G},{default:b(()=>[(c(!0),j(F,null,W(o.value,z=>(c(),y(a(X),{"model-value":z,title:z.name,border:"",actions:["remove"],onClick:$e=>ie(z),onAction:oe},null,8,["model-value","title","onClick"]))),256)),o.value.length?x("",!0):(c(),y(a(Z),{key:0,"image-size":50})),g.value?(c(),y(ps,{key:1,modelValue:g.value,"onUpdate:modelValue":U[3]||(U[3]=z=>g.value=z),current:a(e),context:a(t),item:h.value},null,8,["modelValue","current","context","item"])):x("",!0)]),_:1})]),_:1})):x("",!0)}}),gs=C({name:"DataSourceDialogForm",__name:"form",props:{context:{},current:{},item:{}},setup(u){const e=u,{apis:t}=vn(),l=_(Object.assign({type:"api",ref:"",name:"",label:"",transform:{type:"JSFunction",value:`(res) => {
    /* 在这里可对接口返回数据进行转换  */
    return res;
}`},test:{type:"JSFunction",value:`() => this.runApi({
    /* 在这里可输入接口参数  */
})`}},e.item)),n=_(!1),i=_(""),o=_(!1),s=S(()=>t.value.map(v=>({label:v.label||"",value:v.id,data:v}))),r=S(()=>e.item?"编辑数据源":"新增数据源"),m=v=>{const g=t.value.find(h=>h.id===v);g&&(l.value.name=g.name,l.value.label=g.label||"")},d=async v=>{const{transform:g,test:h,name:k}=v;if(!e.current)return!1;if(!e.item&&e.current.dataSources[k])return K(`名称【${k}】已经存在，请更换名称`),!1;if(g?.value){if(!ee(g,e.context,!0))return!1}else v.transform=void 0;if(h?.value){if(!ee(h,e.context,!0))return!1}else v.test=void 0;return e.current?.setDataSource(v),!0},f=async()=>{if(!e.context)return;if(!l.value.ref){K("请先选择API");return}if(!l.value.test?.value){K("请先填写测试用例");return}if(!ee(l.value.test,e.context,!0))return;const v=async(...k)=>{const w=e.context?.$apis[l.value.ref];if(w)return await w.apply(w,k);ge.warn(`API【${l.value.ref}】不存在`)},g=Je(l.value.test,{runApi:v}),h=l.value.transform?.value?Je(l.value.transform,{},!0):k=>k;n.value=!0;try{const k=await g();i.value=JSON.stringify(await h(k),null,2)}catch(k){ge.error(k)}n.value=!1,o.value=!0};return(v,g)=>(c(),y(a(de),{width:"1000px",height:"600px",title:r.value,model:l.value,"form-props":{tooltipMessage:!1},"submit-method":d},{extra:b(()=>[p(a(ue),{loading:n.value,type:"warning",onClick:f},{default:b(()=>[q(" 运行测试用例 ")]),_:1},8,["loading"])]),default:b(()=>[p(a(A),{name:"ref",label:"引用API",editor:"select",required:"",disabled:!!e.item,options:s.value,props:{filterable:!0},onChange:m},{option:b(({option:h})=>[q(O(h.data.label)+" ",1),L("i",null,"[ "+O(h.data.name)+" ]",1)]),_:1},8,["disabled","options"]),p(a(A),{name:"name",label:"调用名称",required:"",tip:"名称为英文驼峰格式",disabled:!!e.item,rules:{message:"名称格式错误",pattern:a(he)}},null,8,["disabled","rules"]),p(a(A),{name:"label",label:"备注说明",required:""}),p(a(A),{name:"transform.value",label:"转换函数",editor:"none"},{default:b(()=>[p(a(Q),{modelValue:l.value.transform.value,"onUpdate:modelValue":g[0]||(g[0]=h=>l.value.transform.value=h),height:"200px",dark:""},null,8,["modelValue"])]),_:1}),p(a(A),{name:"test.value",label:"测试用例",editor:"none"},{default:b(()=>[p(a(Q),{modelValue:l.value.test.value,"onUpdate:modelValue":g[1]||(g[1]=h=>l.value.test.value=h),height:"100px",dark:""},null,8,["modelValue"])]),_:1}),o.value?(c(),y(a(Sa),{key:0,class:"v-drawer",modelValue:o.value,"onUpdate:modelValue":g[2]||(g[2]=h=>o.value=h),title:"测试用例运行结果",direction:"btt","append-to-body":"",size:"80%"},{default:b(()=>[p(a(Q),{"model-value":i.value,border:"",dark:"",height:"100%",lang:"json"},null,8,["model-value"])]),_:1},8,["modelValue"])):x("",!0)]),_:1},8,["title","model"]))}}),hs=C({name:"DataSourcesWidget",__name:"index",setup(u){const{current:e,context:t}=ae(),l=_(!1),n=_(),i=S(()=>Object.values(e.value?.dataSources||{}).filter(m=>m.type==="api")),o=()=>{n.value=void 0,l.value=!0},s=m=>{n.value=m,l.value=!0},r=m=>{const{name:d,modelValue:f}=m;d==="edit"&&s(f),d==="remove"&&e.value?.removeDataSource(f.name)};return(m,d)=>(c(),y(a(T),{class:"v-data-sources-widget",direction:"column",fit:""},{default:b(()=>[p(a(J),{title:"API",class:"v-sub-panel",size:"small",plus:"",onPlus:o},{default:b(()=>[(c(!0),j(F,null,W(i.value,f=>(c(),y(a(X),{border:"",title:f.name,subtitle:f.label,"model-value":f,actions:["edit","remove"],onAction:r,onClick:v=>s(f)},null,8,["title","subtitle","model-value","onClick"]))),256)),i.value.length?x("",!0):(c(),y(a(Z),{key:0,"image-size":50}))]),_:1}),l.value?(c(),y(gs,{key:0,modelValue:l.value,"onUpdate:modelValue":d[0]||(d[0]=f=>l.value=f),current:a(e),context:a(t),item:n.value},null,8,["modelValue","current","context","item"])):x("",!0)]),_:1}))}}),fs=C({name:"StyleWidget",__name:"index",setup(u){const{selected:e}=fe(),t=_(),l=S(()=>{const s=e.value?.model||null;return H(s)?null:s}),n=S(()=>JSON.stringify(l.value?.getPropValue("style")||{},null,2)),i=s=>{try{const r=JSON.parse(s);l.value?.setProp("style",r)}catch{K("JSON格式错误")}},o=()=>{const s=(t.value?.getEditor()).getValue();i(s),se("保存成功")};return(s,r)=>(c(),y(a(J),{class:"v-css-widget v-sub-panel",title:"style",size:"small",fit:"",save:"",onSave:o},{default:b(()=>[p(a(Q),{ref_key:"editorRef",ref:t,"model-value":n.value,height:"100%",lang:"json",dark:"",onBlur:i},null,8,["model-value"])]),_:1}))}}),bs=["src"],ys=C({name:"PreviewerWidget",__name:"index",props:{path:{type:Function}},setup(u,{expose:e}){const t=u,l=_(),n=_(Symbol()),{current:i,engine:o}=ae(),{width:s,height:r}=ea(l),m=S(()=>i.value&&t.path?t.path(i.value):null),d=S(()=>o.skeleton?.getWidget("Toolbar")?.widgetRef.mode??"pc");return e({refresh:()=>{n.value=Symbol()}}),(f,v)=>(c(),j("div",{ref_key:"container",ref:l,class:"v-previewer",key:n.value},[p(a(oa),{mode:d.value,width:a(s),height:a(r)},{default:b(()=>[m.value?(c(),j("iframe",{key:0,ref:"iframe",frameborder:"0",src:m.value},null,8,bs)):x("",!0)]),_:1},8,["mode","width","height"])]))}}),ws=C({name:"NodePathWidget",inheritAttrs:!1,__name:"index",setup(u){const{selected:e,designer:t}=fe(),l=S(()=>(e.value?.path||[]).slice(0).reverse()),n=o=>{t.value?.setSelected(o)},i=o=>{t.value?.setHover(o)};return(o,s)=>a(e)?(c(),y(a(va),{key:0,class:"v-nodepath-widget","separator-icon":a(Tl)},{default:b(()=>[(c(!0),j(F,null,W(l.value,r=>(c(),y(a(pa),{onClick:m=>n(r),onMouseover:m=>i(r)},{default:b(()=>[q(O(r.name),1)]),_:2},1032,["onClick","onMouseover"]))),256))]),_:1},8,["separator-icon"])):x("",!0)}}),ks=C({name:"SchemaWidget",__name:"index",setup(u){const{current:e}=ae(),t=_(),l=S(()=>JSON.stringify(e.value?.toDsl()||{},null,2)),n=S(()=>e.value?e.value.name:""),i=async()=>{const o=(t.value?.getEditor()).getValue();if(o&&await Ee("手动修改DSL有风险，可能导致页面无法加载，请确认您的操作无误。"))try{const s=JSON.parse(o);e.value?.update(s),se("保存成功")}catch(s){K(s?.message)}};return(o,s)=>(c(),y(a(J),{class:"v-schema-widget",title:n.value,subtitle:"手动修改DSL有风险，可能导致页面无法加载，请确认您的操作无误。",size:"small",fit:"",save:"",onSave:i},{default:b(()=>[p(a(Q),{ref_key:"editorRef",ref:t,"model-value":l.value,height:"100%",lang:"json",dark:""},null,8,["model-value"])]),_:1},8,["title"]))}}),_s=C({name:"SchemaWidget",__name:"index",setup(u){const{current:e,engine:t}=ae(),l=_(),n=_(""),i=S(()=>e.value?`$vtj/vue/${e.value.id}.vue`:""),o=S(()=>e.value?e.value.name:"");return Y(e,async s=>{const r=t.project.value;r&&s?n.value=await t.service.genVueContent(r.toDsl(),s.toDsl()):n.value=""},{immediate:!0,deep:!0}),(s,r)=>(c(),y(a(J),{class:"v-raw-widget",title:o.value,subtitle:i.value,size:"small",fit:""},{default:b(()=>[p(a(Q),{ref_key:"editorRef",ref:l,"model-value":n.value,height:"100%",lang:"html",dark:"",readonly:""},null,8,["model-value"])]),_:1},8,["title","subtitle"]))}}),Ss=["src"],xs=C({name:"DocsWidget",__name:"index",props:{url:{default:"https://newgateway.gitee.io/vtj/help/index.html"}},setup(u){const e=u,t=_();let l=null;$t(()=>{l||(l=ga.service({target:t.value?.$el}))}),Gt(()=>{n(),l=null});const n=()=>{l?.close()};return(i,o)=>(c(),y(a(J),{class:"v-docs-widget",size:"small",fit:"",body:{padding:!1},header:!1,ref_key:"panel",ref:t},{default:b(()=>[L("iframe",{ref:"frame",src:e.url,onLoad:n},null,40,Ss)]),_:1},512))}}),Vs={class:"v-about-widget"},Cs={class:"v-about-widget__logo"},Es=["src"],js=L("div",{class:"v-about-widget__name"},"VTJ.PRO",-1),Ds={class:"v-about-widget__version"},As=C({name:"AboutWidget",__name:"index",setup(u){return(e,t)=>(c(),j("div",Vs,[L("div",Cs,[L("img",{src:a(ht)},null,8,Es)]),js,L("div",Ds,"版本："+O(a(Ul)),1)]))}}),M={Logo:Kl,EmptyWidget:Xl,Switcher:fn,Toolbar:yn,Actions:_n,Pages:On,Blocks:Tn,Components:Un,Outline:Hn,History:qn,Apis:$n,Deps:Gn,Designer:Kn,Scripts:ls,Properties:ns,Events:is,Css:rs,Directives:us,Defined:vs,DataSources:hs,Style:fs,Previewer:ys,NodePath:ws,Schema:ks,Raw:_s,Docs:xs,About:As},Rs=[{name:"Logo",region:"Brand",component:M.Logo},{name:"Switcher",region:"Brand",component:M.Switcher},{name:"Toolbar",region:"Toolbar",component:M.Toolbar},{name:"Actions",region:"Actions",component:M.Actions},{name:"Pages",region:"Apps",component:M.Pages,type:"app",openType:"panel",icon:Da,label:"页面管理"},{name:"Blocks",region:"Apps",component:M.Blocks,type:"app",openType:"panel",icon:Aa,label:"区块管理"},{name:"Components",region:"Apps",component:M.Components,type:"app",openType:"panel",icon:Ra,label:"组件库"},{name:"Outline",region:"Apps",component:M.Outline,type:"app",openType:"panel",icon:Pa,label:"大纲树"},{name:"History",region:"Apps",component:M.History,type:"app",openType:"panel",icon:Ba,label:"历史记录"},{name:"Apis",region:"Apps",component:M.Apis,type:"app",openType:"panel",icon:Ia,label:"API管理"},{name:"Deps",region:"Apps",component:M.Deps,type:"app",openType:"panel",icon:za,label:"依赖管理"},{name:"About",region:"Apps",component:M.About,type:"app",openType:"dialog",icon:Fa,label:"关于",props:{width:500,height:300}},{name:"Designer",region:"Workspace",component:M.Designer,type:"tab",closable:!1,label:"设计视图"},{name:"Previewer",region:"Preview",component:M.Previewer,type:"tab",closable:!1,label:"预览视图"},{name:"Schema",region:"Workspace",component:M.Schema,type:"tab",closable:!0,label:"DSL视图"},{name:"Raw",region:"Workspace",component:M.Raw,type:"tab",closable:!0,label:"源码视图"},{name:"Docs",region:"Workspace",component:M.Docs,type:"tab",closable:!0,label:"帮助中心"},{name:"Scripts",region:"Settings",component:M.Scripts,type:"tab",group:re.Block,label:"设置"},{name:"Css",region:"Settings",component:M.Css,type:"tab",group:re.Block,label:"CSS"},{name:"DataSources",region:"Settings",component:M.DataSources,type:"tab",group:re.Block,label:"数据源"},{name:"Defined",region:"Settings",component:M.Defined,type:"tab",group:re.Block,label:"定义"},{name:"Properties",region:"Settings",component:M.Properties,type:"tab",group:re.Node,label:"属性"},{name:"Style",region:"Settings",component:M.Style,type:"tab",group:re.Node,label:"样式"},{name:"Events",region:"Settings",component:M.Events,type:"tab",group:re.Node,label:"事件"},{name:"Directives",region:"Settings",component:M.Directives,type:"tab",group:re.Node,label:"指令"},{name:"NodePath",region:"Status",component:M.NodePath}],Ps=[{package:"vue",version:"latest",library:"Vue",urls:["@vtj/materials/deps/vue/vue.global.prod.js"],assetsLibrary:El,required:!0,official:!0,enabled:!0},{package:"vue-router",version:"latest",library:"VueRouter",urls:["@vtj/materials/deps/vue-router/vue-router.global.prod.js"],assetsLibrary:jl,required:!0,official:!0,enabled:!0},{package:"@vtj/utils",version:"latest",library:"VtjUtils",urls:["@vtj/materials/deps/@vtj/utils/index.umd.js"],required:!0,official:!0,enabled:!0},{package:"@vtj/icons",version:"latest",library:"VtjIcons",urls:["@vtj/materials/deps/@vtj/icons/style.css","@vtj/materials/deps/@vtj/icons/index.umd.js"],required:!0,official:!0,enabled:!0},{package:"element-plus",version:"latest",library:"ElementPlus",urls:["@vtj/materials/deps/element-plus/index.css","@vtj/materials/deps/element-plus/index.full.min.js"],assetsUrl:"@vtj/materials/assets/element/index.umd.js",assetsLibrary:"ElementPlusMaterial",required:!1,official:!0,enabled:!0},{package:"echarts",version:"latest",library:"echarts",urls:["@vtj/materials/deps/echarts/echarts.min.js"],required:!1,official:!0,enabled:!0},{package:"@vtj/ui",version:"latest",library:"VtjUI",urls:["@vtj/materials/deps/@vtj/ui/style.css","@vtj/materials/deps/@vtj/ui/index.umd.js"],assetsUrl:"@vtj/materials/assets/ui/index.umd.js",assetsLibrary:"VtjUIMaterial",required:!1,official:!0,enabled:!0},{package:"ant-design-vue",version:"latest",library:"antd",urls:["@vtj/materials/deps/ant-design-vue/rest.css","@vtj/materials/deps/ant-design-vue/dayjs/dayjs.min.js","@vtj/materials/deps/ant-design-vue/dayjs/plugin/customParseFormat.js","@vtj/materials/deps/ant-design-vue/dayjs/plugin/weekday.js","@vtj/materials/deps/ant-design-vue/dayjs/plugin/localeData.js","@vtj/materials/deps/ant-design-vue/dayjs/plugin/weekOfYear.js","@vtj/materials/deps/ant-design-vue/dayjs/plugin/weekYear.js","@vtj/materials/deps/ant-design-vue/dayjs/plugin/advancedFormat.js","@vtj/materials/deps/ant-design-vue/dayjs/plugin/quarterOfYear.js","@vtj/materials/deps/ant-design-vue/antd.min.js"],assetsUrl:"@vtj/materials/assets/antdv/index.umd.js",assetsLibrary:"AntdvMaterial",required:!1,official:!0,enabled:!1}],Bs=[{id:"html",category:"HTML"},{id:"elements",category:"特殊元素"},{id:"components",category:"内置组件"}],Is=[{name:"div",label:"容器",categoryId:"html",snippet:{children:"容器文本内容示例"}},{name:"span",label:"内联",categoryId:"html",snippet:{children:"内联容器文本内容示例"}},{name:"a",label:"链接",categoryId:"html",props:[{name:"href",label:"href",setters:"InputSetter"}],snippet:{children:"链接文本内容示例",props:{href:"#"}}},{name:"img",label:"图片",categoryId:"html",childIncludes:!1,props:[{name:"src",label:"src",setters:"InputSetter"},{name:"width",label:"width",setters:"InputSetter"},{name:"height",label:"height",setters:"InputSetter"}],snippet:{props:{src:ht,width:"200",height:"200"}}},{name:"h1",label:"大标题",categoryId:"html",snippet:{children:"标题"}},{name:"h2",label:"中标题",categoryId:"html",snippet:{children:"标题"}},{name:"h3",label:"小标题",categoryId:"html",snippet:{children:"标题"}},{name:"p",label:"段落",categoryId:"html",snippet:{children:"段落文本"}},{name:"component",label:"动态组件",categoryId:"elements",doc:"https://cn.vuejs.org/api/built-in-special-elements.html#component",props:[{name:"is",label:"组件名",setters:"InputSetter"}],snippet:{children:"组件文本内容示例",props:{is:"div"}}},{name:"slot",label:"插槽",categoryId:"elements",doc:"https://cn.vuejs.org/api/built-in-special-elements.html#slot",props:[{name:"name",label:"名称",defaultValue:"default",setters:"InputSetter"}],snippet:{children:"默认插槽内容"}}],zs=[...Is,{name:"Transition",label:"过渡效果",categoryId:"components",doc:"https://cn.vuejs.org/api/built-in-components.html#transition",package:"vue",props:[{name:"name",label:"名称",defaultValue:"",title:"用于自动生成过渡 CSS class 名",setters:"InputSetter"},{name:"css",label:"应用CSS",defaultValue:!0,title:"是否应用 CSS 过渡 class",setters:"BooleanSetter"},{name:"type",label:"事件类型",defaultValue:void 0,title:"指定要等待的过渡事件类型来确定过渡结束的时间，默认情况下会自动检测持续时间较长的类型",setters:"SelectSetter",options:["transition","animation"]},{name:"duration",label:"持续时间",defaultValue:void 0,title:"显式指定过渡的持续时间",setters:["NumberSetter","JSONSetter"]},{name:"mode",label:"时序",defaultValue:"default",title:"控制离开/进入过渡的时序。",setters:"SelectSetter",options:["in-out","out-in","default"]},{name:"appear",label:"使用过渡",defaultValue:!1,title:"是否对初始渲染使用过渡",setters:"BooleanSetter"},{name:"enterFromClass",label:"enterFromClass",defaultValue:void 0,setters:"InputSetter"},{name:"enterActiveClass",label:"enterActiveClass",defaultValue:void 0,setters:"InputSetter"},{name:"enterToClass",label:"enterToClass",defaultValue:void 0,setters:"InputSetter"},{name:"appearFromClass",label:"appearFromClass",defaultValue:void 0,setters:"InputSetter"},{name:"appearActiveClass",label:"appearActiveClass",defaultValue:void 0,setters:"InputSetter"},{name:"appearToClass",label:"appearToClass",defaultValue:void 0,setters:"InputSetter"},{name:"leaveFromClass",label:"leaveFromClass",defaultValue:void 0,setters:"InputSetter"},{name:"leaveActiveClass",label:"leaveActiveClass",defaultValue:void 0,setters:"InputSetter"},{name:"leaveToClass",label:"leaveToClass",defaultValue:void 0,setters:"InputSetter"}],events:["before-enter","before-leave","enter","leave","appear","after-enter","after-leave","after-appear","enter-cancelled","leave-cancelled","ppear-cancelled"],snippet:{children:"Transition"}},{name:"TransitionGroup",label:"过渡效果组",categoryId:"components",doc:"https://cn.vuejs.org/api/built-in-components.html#transitiongroup",package:"vue",props:[{name:"name",label:"名称",defaultValue:"",title:"用于自动生成过渡 CSS class 名",setters:"InputSetter"},{name:"tag",label:"标签名",defaultValue:void 0,title:"如果未定义，则渲染为片段 (fragment)",setters:"InputSetter"},{name:"moveClass",label:"moveClass",defaultValue:void 0,title:"用于自定义过渡期间被应用的 CSS class。",setters:"InputSetter"},{name:"css",label:"应用CSS",defaultValue:!0,title:"是否应用 CSS 过渡 class",setters:"BooleanSetter"},{name:"type",label:"事件类型",defaultValue:void 0,title:"指定要等待的过渡事件类型来确定过渡结束的时间，默认情况下会自动检测持续时间较长的类型",setters:"SelectSetter",options:["transition","animation"]},{name:"duration",label:"持续时间",defaultValue:void 0,title:"显式指定过渡的持续时间",setters:["NumberSetter","JSONSetter"]},{name:"appear",label:"使用过渡",defaultValue:!1,title:"是否对初始渲染使用过渡",setters:"BooleanSetter"},{name:"enterFromClass",label:"enterFromClass",defaultValue:void 0,setters:"InputSetter"},{name:"enterActiveClass",label:"enterActiveClass",defaultValue:void 0,setters:"InputSetter"},{name:"enterToClass",label:"enterToClass",defaultValue:void 0,setters:"InputSetter"},{name:"appearFromClass",label:"appearFromClass",defaultValue:void 0,setters:"InputSetter"},{name:"appearActiveClass",label:"appearActiveClass",defaultValue:void 0,setters:"InputSetter"},{name:"appearToClass",label:"appearToClass",defaultValue:void 0,setters:"InputSetter"},{name:"leaveFromClass",label:"leaveFromClass",defaultValue:void 0,setters:"InputSetter"},{name:"leaveActiveClass",label:"leaveActiveClass",defaultValue:void 0,setters:"InputSetter"},{name:"leaveToClass",label:"leaveToClass",defaultValue:void 0,setters:"InputSetter"}],events:["before-enter","before-leave","enter","leave","appear","after-enter","after-leave","after-appear","enter-cancelled","leave-cancelled","ppear-cancelled"],snippet:{children:"TransitionGroup"}},{name:"KeepAlive",label:"缓存切换组件",categoryId:"components",doc:"https://cn.vuejs.org/api/built-in-components.html#keepalive",package:"vue",props:[{name:"include",label:"匹配包含",title:"如果指定，则只有与 `include` 名称, 匹配的组件才会被缓存。",setters:["InputSetter","JSONSetter"]},{name:"exclude",label:"匹配排除",title:"任何名称与 `exclude` 匹配的组件都不会被缓存。",setters:["InputSetter","JSONSetter"]},{name:"max",label:"最大缓存数",title:"最多可以缓存多少组件实例。",setters:["InputSetter"]}]},{name:"Teleport",label:"传送组件",categoryId:"components",doc:"https://cn.vuejs.org/api/built-in-components.html#teleport",package:"vue",props:[{name:"to",label:"目标容器",title:"指定目标容器,可以是选择器或实际元素",setters:["InputSetter"]},{name:"disabled",label:"禁用",title:"当值为 `true` 时，内容将保留在其原始位置, 而不是移动到目标容器中, 可以动态更改",setters:["BooleanSetter"]}]},{name:"Suspense",label:"异步依赖",categoryId:"components",doc:"https://cn.vuejs.org/api/built-in-components.html#suspense",package:"vue",props:[{name:"timeout",label:"timeout",setters:["InputSetter"]}]},{name:"RouterLink",label:"路由链接",categoryId:"components",doc:"https://router.vuejs.org/zh/api/interfaces/RouterLinkProps.html",package:"vue-router",props:[{name:"to",label:"to",setters:["InputSetter"]},{name:"replace",label:"replace",setters:["BooleanSetter"]}],snippet:{children:"RouterLink",props:{to:"/"}}}],Fs=[{name:st,version:"latest",label:"内置",library:st,order:0,categories:Bs,components:zs}],Ws=C({name:"StringSetter",__name:"string",setup(u){return(e,t)=>(c(),y(a(ve),ce({clearable:""},e.$attrs),null,16))}}),Ls=C({name:"BooleanSetter",__name:"boolean",setup(u){return(e,t)=>(c(),y(a(Bt),ce(e.$attrs,{"model-value":!!e.$attrs.modelValue}),null,16,["model-value"]))}}),Os="{{",Ts="}}",Js=C({name:"ExpressionSetter",__name:"expression",props:{modelValue:{},context:{}},emits:["change"],setup(u,{emit:e}){const t=(r="")=>({type:"JSExpression",value:Re(r)?r.value:r}),l=u,n=e,i=r=>ee(r,l.context,!0),o=_(t(l.modelValue).value);Y(()=>l.modelValue,r=>{o.value=t(r).value},{immediate:!0});const s=r=>{const m={type:"JSExpression",value:r};i(m)&&n("change",m)};return(r,m)=>(c(),y(a(ve),{class:"v-expression-setter",modelValue:o.value,"onUpdate:modelValue":m[0]||(m[0]=d=>o.value=d),onChange:s},{prefix:b(()=>[q(O(Os))]),suffix:b(()=>[q(O(Ts))]),_:1},8,["modelValue"]))}}),Ns=C({name:"SelectSetter",__name:"select",props:{options:{default:()=>[]}},setup(u){const e=u;return(t,l)=>(c(),y(a(Va),ce({clearable:""},t.$attrs),{default:b(()=>[(c(!0),j(F,null,W(e.options,n=>(c(),y(a(xa),ce({key:n.label},n),null,16))),128))]),_:1},16))}}),Ms=C({name:"NumberSetter",__name:"number",props:{modelValue:{}},emits:["change"],setup(u,{emit:e}){const t=u,l=e,n=S(()=>Re(t.modelValue)?void 0:Number(t.modelValue||0)),i=o=>{l("change",o)};return(o,s)=>(c(),y(a(Ca),ce({class:"v-number-setter","controls-position":"right","model-value":n.value},o.$attrs,{onChange:i}),null,16,["model-value"]))}}),Us=C({name:"ColorSetter",__name:"color",setup(u){return(e,t)=>(c(),y(a(Ea),Kt(Yt(e.$attrs)),null,16))}}),Hs=C({name:"JsonSetter",__name:"json",props:{modelValue:{default:void 0},type:{default:"JSON"}},emits:["change"],setup(u,{emit:e}){const t=u,l=_(),n=_(typeof t.modelValue=="object"?JSON.stringify(t.modelValue,null,2):void 0),i=S(()=>!!n.value),o=_(!1),s=e,r=v=>{let g=!0;try{const h=JSON.parse(v);if(t.type==="Array"&&!Array.isArray(h))throw new Error(`"${v}" is not a Array`);if(t.type==="Object"&&!Al(h))throw new Error(`"${v}" is not a PlainObject`);if(typeof h!="object")throw new Error(`"${v}" is not a ${t.type}`)}catch(h){g=!1,me.error({title:"代码错误",message:h?.message||h})}return g},m=()=>{const v=l.value?.getEditor();if(v){const g=v.getValue();r(g)&&(n.value=g,s("change",JSON.parse(g)),o.value=!1)}},d=()=>{n.value="",s("change",void 0),o.value=!1},f=()=>{o.value=!0};return(v,g)=>(c(),j("div",{class:te(["v-json-setter",{"is-active":i.value}])},[p(a(ve),ce({readonly:"",onFocus:f,"model-value":t.type,"suffix-icon":a(gt)},v.$attrs),null,16,["model-value","suffix-icon"]),o.value?(c(),y(a(Be),{key:0,modelValue:o.value,"onUpdate:modelValue":g[0]||(g[0]=h=>o.value=h),title:t.type,width:"1000px",height:"600px",cancel:"",submit:"",clear:"",onSubmit:m,onClear:d},{default:b(()=>[p(a(Q),{ref_key:"codeEditor",ref:l,height:"100%",lang:"json",dark:"","model-value":n.value},null,8,["model-value"])]),_:1},8,["modelValue","title"])):x("",!0)],2))}}),qs=C({name:"FunctionSetter",__name:"function",props:{modelValue:{default:()=>({type:"JSFunction",value:""})}},emits:["change"],setup(u,{emit:e}){const t=u,l=_(),n=_(t.modelValue.value),i=_(!1),o=S(()=>!!n.value),s=e,r=()=>{const f=l.value?.getEditor();if(f){const v=f.getValue(),g={type:"JSFunction",value:v};ee(g,{})&&(n.value=v,s("change",g),i.value=!1)}},m=()=>{n.value="",s("change",void 0),i.value=!1},d=()=>{i.value=!0};return(f,v)=>(c(),j("div",{class:te(["v-function-setter",{"is-active":o.value}])},[p(a(ve),ce({readonly:"",onFocus:d,"model-value":"JSFunction","suffix-icon":a(gt)},f.$attrs),null,16,["suffix-icon"]),i.value?(c(),y(a(Be),{key:0,modelValue:i.value,"onUpdate:modelValue":v[0]||(v[0]=g=>i.value=g),title:"JSFunction",width:"1000px",height:"600px",cancel:"",submit:"",clear:"",onSubmit:r,onClear:m},{default:b(()=>[p(a(Q),{ref_key:"codeEditor",ref:l,height:"100%","model-value":n.value,dark:""},null,8,["model-value"])]),_:1},8,["modelValue"])):x("",!0)],2))}}),ne={StringSetter:Ws,BooleanSetter:Ls,ExpressionSetter:Js,SelectSetter:Ns,NumberSetter:Ms,ColorSetter:Us,IconSetter:sa,JsonSetter:Hs,FunctionSetter:qs},$s={name:"StringSetter",component:ne.StringSetter,type:"String"},Gs=[{name:"InputSetter",component:ne.StringSetter,type:"String"},{name:"StringSetter",component:ne.StringSetter,type:"String"},{name:"BooleanSetter",component:ne.BooleanSetter,type:"Boolean"},{name:"ExpressionSetter",component:ne.ExpressionSetter,type:"Object"},{name:"SelectSetter",component:ne.SelectSetter,type:"String"},{name:"NumberSetter",component:ne.NumberSetter,type:"Number"},{name:"ColorSetter",component:ne.ColorSetter,type:"String"},{name:"IconSetter",component:ne.IconSetter,type:"String"},{name:"ObjectSetter",component:ne.JsonSetter,type:"Object",props:{type:"Object"}},{name:"ArraySetter",component:ne.JsonSetter,type:"Array",props:{type:"Array"}},{name:"JsonSetter",component:ne.JsonSetter,type:"Object",props:{type:"JSON"}},{name:"JSONSetter",component:ne.JsonSetter,type:"Object",props:{type:"JSON"}},{name:"FunctionSetter",component:ne.FunctionSetter,type:"Function"}];class Qs{widgets={};constructor(){this.widgets=this.createWidgets()}createWidgets(){const e={};for(const t of Rs)e[t.name]=t;return e}register(e){this.widgets[e.name]=e}get(e){return this.widgets[e]}set(e,t){const l=this.widgets[e];if(!l){ge.warn(`widget '${e}' is not found`);return}It(l,t),t.component&&(l.component=t.component)}getWidgets(e,t){const l=Object.values(this.widgets);return e?l.filter(n=>n.region===e&&(!t||t&&t===n.group)):l}}const ia=new Qs;class Zs{constructor(e=Ps){this.deps=e}get(){return this.deps}set(e){this.deps=e}add(e){const t=this.deps.find(l=>l.package===e.package);t?Object.assign(t,e):this.deps.push(e)}merge(e){const t=[];for(const l of this.deps){const n=e.find(i=>i.package===l.package);t.push({...l,...n})}for(const l of e)this.deps.find(n=>n.package===l.package)||t.push(l);return t}remove(e){const t=this.deps.findIndex(l=>l.package===e);t>-1&&this.deps.splice(t,1)}}const Ks=new Zs;class Ys{setters={};defaultSetter=$s;constructor(){this.setters=this.createSetters()}createSetters(){const e={};for(const t of Gs)e[t.name]=t;return e}register(e){this.setters[e.name]=e}get(e){return this.setters[e]}set(e,t){const l=this.setters[e];if(!l){ge.warn(`setter '${e}' is not found`);return}It(l,t),t.component&&(l.component=t.component)}getByType(e){return Object.values(this.setters).filter(t=>t.type===e).map(t=>t.name)}}const Te=new Ys;function Xs(u){return new Promise((e,t)=>{const l=Qt(Ln,{slots:u,onClose:()=>{l.unmount(),t(null)},onSubmit:n=>{l.unmount(),e(n)}});l.mount(document.createElement("div"))})}class eo{constructor(e,t,l){this.engine=e,this.contentWindow=t,this.dependencies=l,this.document=this.contentWindow.document,this.bindEvents(t,this.document)}proxied={};document=null;hover=rt(null);dropping=rt(null);selected=_(null);dragging=null;bind(e,t){let l=this.proxied[t];return l||(l=e.bind(this),this.proxied[t]=l),l}bindEvents(e,t){t.addEventListener("mouseover",this.bind(this.onMouseOver,"onMouseOver")),t.addEventListener("scroll",this.bind(this.onViewChange,"onViewChange")),e.addEventListener("resize",this.bind(this.onViewChange,"onViewChange")),t.addEventListener("mouseleave",this.bind(this.onLeave,"onLeave")),t.addEventListener("dragleave",this.bind(this.onLeave,"onLeave")),t.addEventListener("dragover",this.bind(this.onDragOver,"onDragOver")),t.addEventListener("drop",this.bind(this.onDrop,"onDrop")),t.addEventListener("click",this.bind(this.onSelected,"onSelected")),$.on(lt,this.bind(this.onActiveChange,"onActiveChange")),$.on(Ae,this.bind(this.onViewChange,"onViewChange"))}unbindEvents(e,t){t.removeEventListener("mouseover",this.bind(this.onMouseOver,"onMouseOver")),t.removeEventListener("scroll",this.bind(this.onViewChange,"onViewChange")),e.removeEventListener("resize",this.bind(this.onViewChange,"onViewChange")),t.removeEventListener("mouseleave",this.bind(this.onLeave,"onLeave")),t.removeEventListener("dragleave",this.bind(this.onLeave,"onLeave")),t.removeEventListener("dragover",this.bind(this.onDragOver,"onDragOver")),t.removeEventListener("drop",this.bind(this.onDrop,"onDrop")),t.removeEventListener("click",this.bind(this.onSelected,"onSelected")),$.off(lt,this.bind(this.onActiveChange,"onActiveChange")),$.off(Ae,this.bind(this.onViewChange,"onViewChange"))}onMouseOver(e){const t=this.getHelper(e);t?.model.id!==this.selected.value?.model.id&&(this.hover.value=t)}onViewChange(){this.updateRect()}onLeave(e){this.hover.value=null,this.dropping.value=null}onActiveChange(){this.hover.value=null,this.dropping.value=null,this.selected.value=null}async getDropSlot(e){if(!e)return;const{engine:t}=this,l=t.assets,n=l.componentMap,i=await l.getBlockMaterial(e.from)||n.get(e.name);if(!i?.slots)return;const o=(i?.slots||["default"]).map(r=>typeof r=="string"?{name:r,params:[]}:{name:r.name,params:r.params||[]});if(o.length===0)return;if(o.length===1)return o[0];const s=await Xs(o).catch(()=>null);if(!(s&&s.name==="default"&&(!s.params||s.params?.length===0)))return s}async onDrop(e){e.preventDefault();const{engine:t,dragging:l,dropping:n}=this,i=t.current.value,o=this.getHelper(e);if(!i||!l||!n.value||!o)return;const s=o.model,r=n.value.type;if(!await this.allowDrop(s,r))return;const m=this.createNodeDsl(l),d=new xt(m);if(H(s))i.addNode(d,void 0,r);else{const f=await this.getDropSlot(r==="inner"?s:s.parent);if(f===null){this.dropping.value=null;return}d.slot=f,i.addNode(d,s,r)}this.dropping.value=null}onSelected(e){this.setHover(null),this.selected.value=this.getHelper(e)}async onDragOver(e){const t=this.getHelper(e);if(!t)return;const{model:l,type:n}=t;l&&await this.allowDrop(l,n)?(e.preventDefault(),this.dropping.value=t):this.dropping.value=null}isVtjElement(e){return!!e.__vtj__&&!!e.__context__}findVtjElement(e){return e.find(t=>this.isVtjElement(t))}getNodeByElement(e){const t=e.__vtj__??"";return xt.nodes[t]||null}getDropType(e,t,l){const{left:n,top:i,width:o,height:s}=e;return t>=n&&t<=n+o*.2?"left":t>=n+o*.8&&t<=n+o?"right":l>=i&&l<=i+s*.2?"top":l>=i+s*.8&&l<=i+s?"bottom":"inner"}getNodePath(e=[]){const t=e.filter(n=>this.isVtjElement(n)),l=this.engine.current.value;return[...t.map(n=>this.getNodeByElement(n)).filter(n=>!!n),l]}setDslFrom(e){const t=this.engine.assets.componentMap.get(e.name);if(e.from=e.from||t?.package,Array.isArray(e.children))for(const l of e.children)this.setDslFrom(l)}createNodeDsl(e){const{name:t,snippet:l={},from:n}=e,i={...l,name:t,from:n||e.package};return this.setDslFrom(i),i}getElmenetByModel(e){return!this.document||!e?null:H(e)?this.document.body:Array.from(this.document.querySelectorAll("*")).find(t=>t.__vtj__===e.id)}findPathByNode(e){const t=[e];let l=e;for(;l.parent&&l.parent!==l;)l=l.parent,l!==e&&t.unshift(l);const n=this.engine.current.value;return t.unshift(n),t.reverse()}getHelper(e){const t=e.composedPath()||[],l=this.findVtjElement(t)||this.document?.body;if(!l)return null;const n=this.getNodeByElement(l)||this.engine.current.value;if(!n)return null;const i=l.getBoundingClientRect(),o=this.getDropType(i,e.clientX,e.clientY),s=this.getNodePath(t);return{el:l,model:n,rect:i,type:o,path:s}}cleanHelper(){this.setSelected(null),this.setHover(null),this.setDragging(null),this.setDropping(null)}async updateRect(){await Tt(100);const e=a(this.selected),t=a(this.hover);if(e){const l=e.el.getBoundingClientRect();this.selected.value={...e,rect:l}}if(t){const l=t.el.getBoundingClientRect();this.hover.value={...t,rect:l}}}setDragging(e){this.dragging=e}async setHover(e){if(await ke(),e){const t=this.getElmenetByModel(e);if(!t)return;const l=t.getBoundingClientRect(),n=H(e)?[]:this.findPathByNode(e);this.hover.value={el:t,model:e,rect:l,type:"inner",path:n}}else this.hover.value=null}async setSelected(e){if(await ke(),e){const t=this.getElmenetByModel(e)||this.document?.createElement("span");if(!t)return;const l=t.getBoundingClientRect(),n=H(e)?[]:this.findPathByNode(e);this.selected.value={el:t,model:e,rect:l,type:"inner",path:n}}else this.selected.value=null}async setDropping(e,t="inner"){if(await ke(),e){const l=this.getElmenetByModel(e);if(!l)return;const n=l.getBoundingClientRect(),i=H(e)?[]:this.findPathByNode(e);this.dropping.value={el:l,model:e,rect:n,type:t,path:i}}else this.dropping.value=null}async allowDrop(e,t="inner"){const{dragging:l,engine:n}=this,i=n.current.value;if(!l||!i)return!1;if(H(e))return!0;const o=n.assets.componentMap,s=t!=="inner"&&e.parent||e,r=await n.assets.getBlockMaterial(s.from)||o.get(s.name);if(!r)return!1;const{parentIncludes:m=!0,name:d}=l,{childIncludes:f=!0}=r,v=m===!0||Array.isArray(m)&&m.includes(s.name),g=f===!0||Array.isArray(f)&&f.includes(d);return v&&g}dispose(){const{contentWindow:e,document:t}=this;this.setSelected(null),this.setHover(null),this.setDragging(null),e&&t&&this.unbindEvents(e,t),this.document=null}}class to{constructor(e,t,l=null){this.env=e,this.service=t,this.designer=l,this.nodeChange=this.__onNodeChange.bind(this),this.blockChange=this.__onBlockChange.bind(this)}app=null;dsl=null;nodeChange;blockChange;context=null;install(e){const{library:t,globals:l,VueRouter:n}=this.env;if(n){const o=n.createRouter({history:n.createWebHashHistory(),routes:[]});e.use(o)}const i=Object.values(t);Object.assign(e.config.globalProperties,l),e.config.errorHandler=(o,s,r)=>{const m=s?.$options.name,d=o?.message||o?.msg||"未知错误",f=`[ ${m} ] ${d}`;console.error({err:o,instance:s,info:r}),me.error({title:"运行错误",message:f})},i.forEach(o=>{(typeof o=="function"||typeof o.install=="function")&&e?.use(o)})}render(e){const{window:t,container:l,Vue:n,components:i,library:o,apis:s}=this.env,r=t.document.createElement("div");r.id="app",l.appendChild(r),this.dsl=n.reactive(e.toDsl());const m=wl({getDsl:async v=>await this.service.getFile(v)||null,options:{mode:at.Design,Vue:n,components:i,libs:o,apis:s,window:t}}),{renderer:d,context:f}=kl({Vue:n,mode:at.Design,dsl:this.dsl,components:i,libs:o,apis:s,loader:m,window:t});this.app=n.createApp(d),this.install(this.app);try{this.app.mount(r)}catch(v){K(v.message||"未知错误","运行时错误"),console.error(v)}this.context=f,$.on(Ae,this.nodeChange),$.on(nt,this.blockChange)}dispose(){if(this.app){this.app.unmount();const e=this.app._container;e&&e.parentNode&&(e.parentNode.removeChild(e),this.app._container=null),this.app=null}this.dsl=null,this.context=null,$.off(Ae,this.nodeChange),$.off(nt,this.blockChange)}updateChild(e,t){const l=t.children||t.nodes||[];if(Array.isArray(l))for(let n=0;n<l.length;n++){const i=l[n];if(i.id===e.id){l.splice(n,1,e);return}else this.updateChild(e,i)}}__onNodeChange(e){this.dsl&&this.updateChild(e.toDsl(),this.dsl)}__onBlockChange(e){this.dispose(),this.render(e),this.designer?.selected.value&&this.designer.setSelected(e)}}class ao extends Lt{contentWindow=null;renderer=null;designer=rt(null);engine;materialPath;constructor(e){super();const{engine:t,materialPath:l}=e;this.engine=t,this.materialPath=l,Y(this.engine.current,()=>{this.refresh()})}init(e,t){Y([e,t],()=>{e.value&&t.value.length&&(this.resetReady(),this.setup(e.value,t.value),this.contentWindow&&(this.designer.value?.dispose(),this.designer.value=new eo(this.engine,this.contentWindow,t)))},{immediate:!0,deep:!0})}setup(e,t){const l=e.contentWindow;if(!l){ge.warn("Simulator contentWindow is null");return}l.__simulator__=this;const n=l.document;this.contentWindow=l;const{scripts:i,css:o,materials:s,libraryExports:r,materialExports:m,materialMapLibrary:d}=ml(t,this.materialPath);n.open(),n.write(`
     <!DOCTYPE html>
     <html lang="zh-CN">
       <head>
       <meta charset="utf-8">
       <meta name="viewport"
             content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0,viewport-fit=cover"/>
         <style>
            html, body, #app {
              padding: 0;
              margin: 0;
              min-height: 100vh;
              width: 100%;
              height: 100%;
              background: #fff;
            }
         </style>
         ${pl(o)}
         ${_t(i)}
         ${_t(s)}
       </head>
       <body> 
       </body>
       <script>
       __simulator__.emitReady(${JSON.stringify(r)},
        ${JSON.stringify(m)}, 
    ${JSON.stringify(d)});
     <\/script> 
     </html>
    `),n.close()}async emitReady(e=[],t=[],l={}){this.renderer?.dispose(),this.renderer=null;const n=this.contentWindow,{assets:i,service:o,current:s,provider:r}=this.engine,m=r.materials||{},d=[];for(const v of t){const g=m[v]?(await m[v]()).default:n[v];d.push(g)}i.load(d);const f=this.createEnv(e,l,d);this.renderer=new to(f,o,this.designer.value),s.value&&this.renderer.render(s.value),this.triggerReady()}createEnv(e=[],t={},l=[]){const n=this.contentWindow,{engine:i}=this,{project:o,assets:s,provider:r}=i,m=e.reduce((w,E)=>(w[E]=n[E],w),{}),d={},{groups:f,componentMap:v}=s;for(const w of f.value){const E=w.names||[];if(w.name===st)E.forEach(V=>{const D=v.get(V),R=D?.package||"",P=_l[R],I=m[P];I&&D&&(d[V]=St(D,I))});else{const V=m[t[w.library||""]];V&&E.forEach(D=>{const R=v.get(D);R?d[D]=St(R,V):d[D]=V[D]})}}const{adapter:g,globals:h}=r,k=vl(o.value?.apis,g);return{window:n,Vue:n.Vue,VueRouter:n.VueRouter,library:m,materials:l,components:d,container:n.document.body,apis:k,globals:h}}refresh(){this.renderer?.dispose();const e=this.engine.current.value;e&&this.renderer?.render(e)}dispose(){this.renderer?.dispose(),this.designer.value?.dispose(),this.contentWindow=null,this.renderer=null,this.designer.value=null}}class lo{constructor(e){this.service=e}components=[];componentMap=new Map;groups=_([]);getCateoryComponents(e,t){const l=t.filter(n=>n.categoryId===e.id&&n.hidden!==!0);return{name:e.id,label:e.category,count:l.length,components:l}}parseGroups(e){const t=[];for(let l of e){const{categories:n,components:i,label:o,name:s,library:r}=l;if(!n||!i)continue;const m=i.filter(g=>!!g.package).map(g=>g.name),d=n.map(g=>this.getCateoryComponents(g,i)),f=d.reduce((g,h)=>h.count+g,0),v={name:l.name,label:o||s,count:f,names:m,library:r,children:d};t.push(v)}return t}load(e){const t=[...Fs,...e].filter(l=>!!l);t.sort((l,n)=>l.order-n.order);for(let l of t)l.components&&(this.components=this.components.concat(l.components));this.groups.value=this.parseGroups(t),this.componentMap=gl(this.components,"name")}async getBlockMaterial(e){if(!e||typeof e=="string")return null;const t=e.type==="Schema"?e.id:null;if(!t)return null;const l=await this.service.getFile(t);if(!l)return null;const{id:n,name:i,slots:o,props:s,emits:r}=l,m=d=>{const f=Array.isArray(d)?d:[d];let v=[];for(const g of f)v=v.concat(Te.getByType(g));return v};return{id:n,name:i,childIncludes:o?.length?void 0:!1,props:(s||[]).map(d=>typeof d=="string"?{name:d}:{name:d.name,type:d.type,setters:m(d.type)}),events:r,slots:o,from:e}}}const ra=Symbol("VtjEngine");class No extends Lt{app;skeleton;container;service;assets;simulator;emitter=$;project=_(null);current=_(null);context=_(null);isEmptyCurrent=_(!1);history=_(null);provider;changed=_(Symbol());constructor(e){super();const{container:t,service:l,project:n={},globals:i={},dependencies:o,materials:s,materialPath:r="./"}=e;this.container=t,this.service=l,this.provider=new $a({mode:at.Design,globals:i,project:n,service:l,dependencies:o,materials:s,materialPath:r}),this.assets=new lo(this.service),this.simulator=new ao({engine:this,materialPath:r}),this.bindEvents(),this.init(n),$t(this.render.bind(this)),Gt(this.dispose.bind(this))}async init(e){const t=await this.service.init(e).catch(l=>(ge.warn("VTJEngine service init fail.",l),null));t&&(t.dependencies=Ks.merge(t.dependencies||[]),this.project.value=new Ga(t),this.saveMaterials(),this.triggerReady())}render(){const e=a(this.container);if(e){const t=Qt(no);t.provide(ra,Bl(this)),t.mount(e),this.app=t}else ge.warn("VTJEngine constructor param [ container ] is undefined")}bindEvents(){$.on(Qa,e=>this.saveProject(e)),$.on(Za,e=>this.saveBlockFile(e)),$.on(Ka,e=>this.saveBlockFile(e)),$.on(Ya,()=>this.saveMaterials()),$.on(lt,e=>this.activeFile(e)),$.on(Xa,()=>this.publish()),$.on(el,()=>this.publishCurrent()),$.on(nt,e=>this.changeFile(e)),$.on(Ae,()=>this.changeCurrentFile()),$.on(tl,e=>this.saveHistory(e)),$.on(al,e=>this.loadHistory(e))}async activeFile(e){await ke();const t=e.model,l=e.model.currentFile;if(l){if(t.isPageFile(l)&&l.raw)return;const n=await this.service.getFile(l.id);n&&(l.dsl=n)}if(l?.dsl){const n=new wt(l.dsl);this.updateCurrent(n),this.initHistory(n)}else this.updateCurrent(null);be(this.project)}async changeFile(e){await ke();const t=e.toDsl();this.service.saveFile(t),this.updateCurrent(e),this.history.value?.add(t),be(this.history)}changeCurrentFile(){this.saveCurrentFile(),this.current.value&&(this.history.value?.add(this.current.value.toDsl()),be(this.history))}async updateCurrent(e,t=!0){this.current.value=e,await ke(),this.context.value=this.simulator.renderer?.context||null,this.isEmptyCurrent.value=this.current.value?.nodes.length===0,this.changed.value=Symbol(),t&&be(this.context)}async saveProject(e){const t=e.model.toDsl();await this.service.saveProject(t),be(this.project)}async saveBlockFile(e){const t=e.type,l=e.model;if(t==="create"){const n=e.data;l.isPageFile(n)&&n.raw?(await this.service.createRawPage(n),se(`源码文件已经生成：/.vtj/vue/${n.id}.vue`,"success")):n.dsl&&await this.service.saveFile(n.dsl)}if(t==="update"){const n=e.data;if(l.isPageFile(n)&&(n.dir||n.raw))return;const i=await this.service.getFile(n.id);i&&(i.name=n.name,await this.service.saveFile(i))}if(t==="delete"){const n=e.data;n&&l.isPageFile(n)&&n.raw?await this.service.removeRawPage(n.id):n.dir||(await this.service.removeFile(n.id),await this.service.removeHistory(n.id))}if(t==="clone"){const{page:n,newPage:i}=e.data,o=await this.service.getFile(n.id);o&&(o.id=i.id,o.name=i.name,await this.service.saveFile(o))}be(this.project)}async saveMaterials(){await ke(),this.simulator.ready(()=>{const e=this.project.value;if(e){const t=this.assets.componentMap;this.service.saveMaterials(e.toDsl(),t)}})}saveCurrentFile(){const e=this.current.value;e&&(this.updateCurrent(e),this.service.saveFile(e.toDsl()))}async initHistory(e){if(e){const t=await this.service.getHistory(e.id).catch(()=>null);this.history.value=new ll(Object.assign(t||{},{id:e.id}))}else this.history.value=null}async saveHistory(e){const t=e.type,l=e.model;t==="create"&&await this.service.saveHistoryItem(l.id,e.data),t==="delete"&&await this.service.removeHistoryItem(l.id,e.data),t==="clear"&&await this.service.removeHistoryItem(l.id,e.data);const n=l.toDsl();await this.service.saveHistory(n),be(this.history)}async loadHistory(e){const t=e.model,l=e.data,n=await this.service.getHistoryItem(t.id,l.id);if(n&&n.dsl){const i=new wt(n.dsl);await this.updateCurrent(i),be(this.history)}}async publish(){const e=this.project.value;if(e){const t={...e.toDsl(),pages:e.getPages()};await this.service.publish(t)&&se("整站发布成功","success")}}async publishCurrent(){const e=this.project.value,t=e?.currentFile;if(e&&t){const l={...e.toDsl(),pages:e.getPages()};await this.service.publishFile(l,t)&&se("发布成功","success")}}dispose(){this.emitter.all.clear(),this.simulator.dispose(),this.app&&(this.app.unmount(),this.container=void 0)}async openFile(e){const t=this.project.value,l=this.skeleton?.getRegion("Apps"),n=e||t?.homepage;if(!t||!l||!n)return;const i=t.getPage(n);i&&!i.raw&&(l.regionRef?.setActive("Pages"),this.simulator.ready(()=>{t.active(i)}));const o=t.getBlock(n);o&&(l.regionRef?.setActive("Blocks"),this.simulator?.ready(()=>{t.active(o)}))}}function le(){const u=Wl(ra,null);return u||ge.error("VTJEngine is not exist"),u}const ye=C({name:"RegionWrapper",props:{region:{type:String,required:!0}},setup(){return{regionRef:_()}},render(){const u=Dt[this.region]||Dt.EmptyRegion;return Ce(u,{...this.$props,...this.$attrs,ref:"regionRef"})}}),Se=C({name:"WidgetWrapper",props:{region:{type:String,required:!0},widget:{type:Object,required:!0}},setup(){return{widgetRef:_()}},render(){return Ce(this.widget.component,{...this.widget.props,...this.$props,...this.$attrs,ref:"widgetRef"})}}),no=C({name:"SkeletonWrapper",setup(){const u=_(),e=le(),t=_({});return{skeletonRef:u,engine:e,widgets:t}},mounted(){this.engine.skeleton=this},render(){return Ce(so,{...this.$props,...this.$attrs,ref:"skeletonRef"})},methods:{getRegion(u){return this.skeletonRef[u.toLowerCase()]},toggleCollapse(u){if(this.skeletonRef){const e=this.skeletonRef.collapsed;this.skeletonRef.collapsed=u??!e}},settable(u){this.skeletonRef&&(this.skeletonRef.settable=u)},getWidgets(u){const e=this.getRegion(u);return e?nl(e.regionRef?.widgetsRef||[]):[]},getWidget(u){const e=ia.get(u);if(!e){ge.warn(`widget [ ${u} ] is not exsit`);return}return this.getWidgets(e.region).find(t=>t.widget.name===u)},openPreview(u){this.skeletonRef&&(this.skeletonRef.isPreview=!0)},closePreview(){this.skeletonRef&&(this.skeletonRef.isPreview=!1)}}}),we=C({name:"SetterWrapper",props:{context:{type:Object},current:{type:Object},name:String,label:String,title:String,value:{type:[String,Object,Array,Number,Boolean],default:void 0},setters:{type:[String,Object,Array],required:!0,default(){return[]}},options:{type:Array,default(){return[]}},variable:{type:Boolean,default:!0},removable:{type:Boolean,default:!1}},computed:{computedSetters(){return(Array.isArray(this.setters)?this.setters:[this.setters]).map(u=>{let e;if(typeof u=="string")return e=this.getSetter(u),{component:Vt(e.component),name:e.name,label:u,props:e.props||{}};{const t=u;return e=this.getSetter(t.name),{component:Vt(t.component||e.component),name:t.name,label:t.label||t.name,props:Object.assign(e.props||{},t.props)}}})},computedOptions(){return(this.options||[]).map(u=>typeof u=="string"?{label:u,value:u}:u)},defaultSetter(){const{value:u,computedSetters:e}=this;let t=typeof u;t==="Object"&&(Array.isArray(u)?t="Array":Re(u)?t="Object":sl(u)&&(t="Function"));const l=Te.getByType(t)||[];return l.length?(e.find(n=>l.includes(n.name))||e[0])?.name:e[0]?.name}},render(){const{context:u,current:e,name:t,label:l,title:n,value:i,computedSetters:o,computedOptions:s,variable:r,changeValue:m,defaultSetter:d,removable:f,onRemove:v}=this;return Ce(po,{context:u,current:e,name:t,label:l,title:n,setters:o,defaultSetter:d,variable:r,value:i,removable:f,options:s,onChange:m,onRemove:v})},emits:["change","remove"],methods:{getSetter(u){return typeof u=="string"?Te.get(u)||Te.defaultSetter:u},changeValue(u){this.$emit("change",this.name,u)},onRemove(u){this.$emit("remove",u)}}}),so=C({name:"Skeletion",__name:"skeleton",props:{headerHeight:{default:"36px"},leftWidth:{default:"400px"},rightWidth:{default:"350px"},footerHeight:{default:"20px"}},setup(u,{expose:e}){const t=u,l=_(!1),n=_(parseInt(t.leftWidth)),i=_(parseInt(t.rightWidth)),o={dirs:["e"],maxWidth:600,minWidth:49,onResizing(V,D){n.value=D.elementWidth.value},onEnd(V,D){n.value=D.elementWidth.value}},s={dirs:["w"],maxWidth:600,minWidth:2,onResizing(V,D){i.value=D.elementWidth.value},onEnd(V,D){i.value=D.elementWidth.value}},r=_(),m=_(),d=_(),f=_(),v=_(),g=_(),h=_(),k=_(),w=_(!1),E=_(!1);return e({brand:r,toolbar:m,actions:d,apps:f,workspace:v,settings:g,status:h,collapsed:w,settable:E,leftWidth:n,rightWidth:i,preview:k,isPreview:l}),(V,D)=>(c(),y(a(wa),{locale:a(ya)},{default:b(()=>[p(a(bt),{class:"v-skeleton"},{default:b(()=>[p(a(ha),{class:"v-skeleton__header",height:V.headerHeight},{default:b(()=>[p(a(ye),{ref_key:"brand",ref:r,region:"Brand"},null,512),p(a(ye),{ref_key:"toolbar",ref:m,region:"Toolbar",preview:l.value},null,8,["preview"]),p(a(ye),{ref_key:"actions",ref:d,region:"Actions"},null,512)]),_:1},8,["height"]),p(a(bt),{class:"v-skeleton__wrapper"},{default:b(()=>[l.value?x("",!0):De((c(),y(a(yt),{key:0,width:t.leftWidth,class:te(["v-skeleton__left",{"is-collapsed":w.value}])},{default:b(()=>[p(a(ye),{ref_key:"apps",ref:f,region:"Apps"},null,512)]),_:1},8,["width","class"])),[[a(kt),o]]),p(a(fa),{class:"v-skeleton__main"},{default:b(()=>[l.value?(c(),y(a(ye),{key:0,ref_key:"preview",ref:k,region:"Preview",preview:l.value},null,8,["preview"])):x("",!0),De(p(a(ye),{ref_key:"workspace",ref:v,region:"Workspace"},null,512),[[Ne,!l.value]])]),_:1}),l.value?x("",!0):De((c(),y(a(yt),{key:1,width:t.rightWidth,class:"v-skeleton__right"},{default:b(()=>[p(a(ye),{ref_key:"settings",ref:g,region:"Settings"},null,512)]),_:1},8,["width"])),[[Ne,E.value],[a(kt),s]])]),_:1}),l.value?x("",!0):(c(),y(a(ba),{key:0,class:"v-skeleton__footer",height:V.footerHeight},{default:b(()=>[p(a(ye),{ref_key:"status",ref:h,region:"Status"},null,512)]),_:1},8,["height"]))]),_:1})]),_:1},8,["locale"]))}}),oo={key:1},io={class:"v-setter__content"},ro={key:0,class:"v-setter__input"},uo={class:"v-setter__action"},co="{{",mo="}}",po=C({__name:"setter",props:{context:{},current:{},name:{},label:{default:""},title:{},setters:{},variable:{type:Boolean,default:!0},value:{},options:{default:()=>[]},defaultSetter:{},removable:{type:Boolean}},emits:["change","remove"],setup(u,{emit:e}){const t=u,l=e,n=_(!1),i=_(""),o=_(t.setters.find(E=>E.name===t.defaultSetter)||t.setters[0]),s=_(t.value),r=S(()=>!!Re(s.value)),m={[o.value.name]:s.value},d=E=>{m[o.value.name]=s.value,o.value=E,s.value=m[E.name]??void 0,f(s.value)};Y(()=>t.value,()=>{s.value=t.value}),Y(()=>t.defaultSetter,()=>{o.value=t.setters.find(E=>E.name===t.defaultSetter)||t.setters[0]});const f=E=>{l("change",E)},v=()=>{l("remove",t.name)},g=()=>{n.value=!0,i.value=Re(s.value)?s.value.value:""},h=()=>{n.value=!1,i.value=""},k=async E=>ee(E,t.context,!0)?(m[o.value.name]=s.value,s.value=E,l("change",E),!0):!1,w=async()=>{await Ee("确定要解除绑定吗？")&&(h(),s.value=void 0,l("change",""))};return(E,V)=>(c(),y(a(ka),{class:"v-setter",size:"small","label-positon":"left"},{label:b(()=>[t.title?(c(),y(a(Pt),{key:0,placement:"top-start",content:t.title},{default:b(()=>[q(O(t.label||t.name),1)]),_:1},8,["content"])):(c(),j("span",oo,O(t.label||t.name),1))]),default:b(()=>[L("div",io,[o.value?(c(),j("div",ro,[r.value?x("",!0):(c(),y(Zt(o.value.component),ce({key:0,current:t.current,context:t.context},o.value.props,{options:t.options,modelValue:s.value,"onUpdate:modelValue":V[0]||(V[0]=D=>s.value=D),onChange:f,disabled:r.value}),null,16,["current","context","options","modelValue","disabled"])),r.value?(c(),y(a(ve),{key:1,class:"v-expression-setter",disabled:"","model-value":"JSExpression"},{prefix:b(()=>[q(O(co))]),suffix:b(()=>[q(O(mo))]),_:1})):x("",!0)])):x("",!0),L("div",uo,[t.variable?(c(),y(a(ol),{key:0,onClick:g,class:te(["v-icon-vars",{"is-active":r.value}]),title:"绑定变量"},null,8,["class"])):x("",!0),t.setters.length>1?(c(),y(a(Rt),{key:1,disabled:r.value,size:"small","popper-class":"v-setter-switch",onCommand:d},{dropdown:b(()=>[p(a(At),null,{default:b(()=>[(c(!0),j(F,null,W(t.setters,D=>(c(),y(a(Ye),{command:D,key:D.name},{default:b(()=>[p(a(Ot),{class:te({"is-placeholder":D.name!==o.value.name})},null,8,["class"]),q(" "+O(D.label),1)]),_:2},1032,["command"]))),128))]),_:1})]),default:b(()=>[p(a(il),{title:"切换设置器"})]),_:1},8,["disabled"])):x("",!0),t.removable?(c(),y(a(Me),{key:2,onClick:v,title:"删除"})):x("",!0)])]),n.value?(c(),y(a(ss),{key:0,current:t.current,context:t.context,value:i.value,modelValue:n.value,"onUpdate:modelValue":V[1]||(V[1]=D=>n.value=D),submitMethod:k,onUnbind:w},null,8,["current","context","value","modelValue"])):x("",!0)]),_:1}))}}),vo={class:"v-empty-region"},go=C({name:"EmptyRegion",__name:"empty",props:{region:{}},setup(u){return(e,t)=>(c(),j("div",vo,"找不到符合【"+O(e.region)+"】名称的区域组件",1))}}),ho={class:"v-brand-region"},fo=C({name:"BrandRegion",inheritAttrs:!1,__name:"brand",props:{region:{}},setup(u,{expose:e}){const t=u,{widgets:l,widgetsRef:n}=_e(t.region);return e({widgets:l,widgetsRef:n}),(i,o)=>(c(),j("div",ho,[(c(!0),j(F,null,W(a(l),s=>(c(),y(a(Se),{ref_for:!0,ref_key:"widgetsRef",ref:n,region:i.region,widget:s},null,8,["region","widget"]))),256))]))}}),bo={class:"v-toolbar-region"},yo=C({name:"ToolbarRegion",__name:"toolbar",props:{region:{},preview:{type:Boolean}},setup(u,{expose:e}){const t=u,{widgets:l,widgetsRef:n}=_e(t.region);return e({widgets:l,widgetsRef:n}),(i,o)=>(c(),j("div",bo,[(c(!0),j(F,null,W(a(l),s=>(c(),y(a(Se),{ref_for:!0,ref_key:"widgetsRef",ref:n,region:i.region,widget:s,preview:i.preview},null,8,["region","widget","preview"]))),256))]))}}),wo={class:"v-actions-region"},ko=C({name:"ActionsRegion",inheritAttrs:!1,__name:"actions",props:{region:{}},setup(u,{expose:e}){const t=u,{widgets:l,widgetsRef:n}=_e(t.region);return e({widgets:l,widgetsRef:n}),(i,o)=>(c(),j("div",wo,[(c(!0),j(F,null,W(a(l),s=>(c(),y(a(Se),{ref_for:!0,ref_key:"widgetsRef",ref:n,region:i.region,widget:s},null,8,["region","widget"]))),256))]))}}),_o={class:"v-apps-region"},So={class:"v-apps-region__header"},xo={class:"v-apps-region__top"},Vo={class:"v-apps-region__bottom"},Co={class:"v-apps-region__panels"},Eo=C({name:"AppsRegion",inheritAttrs:!1,__name:"apps",props:{region:{},index:{default:0}},setup(u,{expose:e}){const t=u,l=le(),{widgets:n,widgetsRef:i}=_e(t.region),o=S(()=>n.value.filter(g=>g.openType==="panel")),s=S(()=>n.value.filter(g=>g.openType!=="panel")),r=o.value[t.index],m=_(r),d=_(r),f=g=>{m.value=g,d.value=d.value?.name===g.name?null:g},v=g=>{g.openType==="link"&&g.url&&window.open(g.url),g.openType==="dialog"&&Dl({title:g.label,icon:g.icon,...g.props,content:g.component})};return Y(d,g=>{l.skeleton?.toggleCollapse(!g)}),e({widgets:n,widgetsRef:i,setActive:g=>{const h=o.value.find(k=>k.name===g);m.value=h,d.value=h}}),(g,h)=>(c(),j("div",_o,[L("div",So,[L("div",xo,[(c(!0),j(F,null,W(o.value,k=>(c(),y(a(jt),{key:`icon-${k.name}`,icon:k.icon,label:k.label,active:m.value?.name===k.name,open:d.value?.name===k.name,onClick:w=>f(k)},null,8,["icon","label","active","open","onClick"]))),128))]),L("div",Vo,[(c(!0),j(F,null,W(s.value,k=>(c(),y(a(jt),{key:`icon-${k.name}`,icon:k.icon,label:k.label,onClick:w=>v(k)},null,8,["icon","label","onClick"]))),128))])]),L("div",Co,[(c(!0),j(F,null,W(o.value,k=>(c(),y(Xt,{key:k.name},[m.value?.name===k.name?(c(),y(a(Se),{key:0,ref_for:!0,ref_key:"widgetsRef",ref:i,region:g.region,widget:k},null,8,["region","widget"])):x("",!0)],1024))),128))])]))}}),jo=C({name:"WorkspaceRegion",__name:"workspace",props:{region:{}},setup(u,{expose:e}){const t=u,{widgets:l,widgetsRef:n}=_e(t.region),i=Ie(l.value.map(v=>({name:v.name,command:v.name,label:v.label,closable:!!v.closable,props:v.props||{},checked:!v.closable}))),o=S(()=>i.filter(v=>!v.closable||v.checked)),s=S(()=>i.map(v=>({...v,disabled:!v.closable}))),r=_(o.value[0]?.name),m=S(()=>i.find(v=>v.name===r.value)?.props||{}),d=v=>{const g=i.find(h=>h.name===v);g&&(g.checked=!1),r.value===v&&(r.value=o.value[0]?.name)},f=v=>{const g=i.find(h=>h.name===v.name);g&&g.closable&&(g.checked=!g.checked,g.checked&&(r.value=g.name),!g.checked&&r.value===g.name&&(r.value=o.value[0]?.name))};return e({currentTab:r,widgets:l,widgetsRef:n,openTab:(v,g={})=>{const h=i.find(k=>k.name===v);h&&(h.props=Object.assign({},h.props,g),h.checked=!0,r.value=h.name)}}),(v,g)=>(c(),y(a(qe),{class:"v-workspace-region",items:o.value,menus:s.value,modelValue:r.value,"onUpdate:modelValue":g[0]||(g[0]=h=>r.value=h),checkable:"",onRemove:d,onCommand:f},{default:b(()=>[(c(!0),j(F,null,W(a(l),h=>(c(),j(F,{key:h.name},[r.value===h.name?(c(),y(a(Se),{key:0,ref_for:!0,ref_key:"widgetsRef",ref:n,region:v.region,widget:{...h,props:m.value}},null,8,["region","widget"])):x("",!0)],64))),128))]),_:1},8,["items","menus","modelValue"]))}}),Do=C({name:"SettingsRegion",__name:"settings",props:{region:{}},setup(u,{expose:e}){const t=u,l=le(),{current:n}=ae(),{selected:i,isSelectBlock:o}=fe(),s=S(()=>o.value?re.Block:re.Node),{widgets:r,widgetsRef:m}=_e(t.region,s),d=S(()=>r.value.map(h=>({name:h.name,label:h.label}))),f=_(""),v=S(()=>{const h=i.value?.model;return h?l.assets.componentMap.get(h.name)?.doc:null});Y(n,h=>{l.skeleton?.settable(!!h)}),Y(s,()=>{f.value=d.value[0]?.name},{immediate:!0});const g=()=>{if(v.value){const h=l.skeleton?.getRegion("Workspace");h&&h.regionRef.openTab("Docs",{url:v.value})}};return e({widgets:r,widgetsRef:m}),(h,k)=>a(n)?(c(),y(a(T),{key:0,class:"v-settings-region",fit:"",direction:"column"},{default:b(()=>[a(i)?(c(),y(a(T),{key:0,flex:"",justify:"space-between",align:"center",class:"v-settings-region__header"},{default:b(()=>[p(a(T),{class:"v-settings-region__title"},{default:b(()=>[p(a(Ut)),L("span",null,[q(O(a(i)?.model.name)+": ",1),L("i",null,O(a(i)?.model.id),1)])]),_:1}),v.value?(c(),y(a(T),{key:0},{default:b(()=>[p(a(xe),{onClick:g,icon:a(Sl),mode:"text",label:"帮助"},null,8,["icon"])]),_:1})):x("",!0)]),_:1})):x("",!0),a(i)&&!a(i).model.locked?(c(),y(a(T),{key:1,grow:"",padding:!1},{default:b(()=>[p(a(qe),{items:d.value,modelValue:f.value,"onUpdate:modelValue":k[0]||(k[0]=w=>f.value=w),stretch:"",body:{padding:!1}},{default:b(()=>[(c(!0),j(F,null,W(a(r),w=>(c(),j(F,{key:w.name},[f.value===w.name?(c(),y(a(Se),{key:0,ref_for:!0,ref_key:"widgetsRef",ref:m,region:h.region,widget:w},null,8,["region","widget"])):x("",!0)],64))),128))]),_:1},8,["items","modelValue"])]),_:1})):x("",!0),a(i)?x("",!0):(c(),y(a(Z),{key:2,description:"请在左侧画布选中节点"})),a(i)&&a(i).model.locked?(c(),y(a(Z),{key:3,"image-size":1,description:"节点已被锁定, 禁止编辑"})):x("",!0)]),_:1})):x("",!0)}}),Ao={class:"v-status-region"},Ro=C({name:"StatusRegion",inheritAttrs:!1,__name:"status",props:{region:{}},setup(u,{expose:e}){const t=u,{widgets:l,widgetsRef:n}=_e(t.region);return e({widgets:l,widgetsRef:n}),(i,o)=>(c(),j("div",Ao,[(c(!0),j(F,null,W(a(l),s=>(c(),y(a(Se),{ref_for:!0,ref_key:"widgetsRef",ref:n,region:i.region,widget:s},null,8,["region","widget"]))),256))]))}}),Po=C({name:"PreviewRegion",__name:"preview",props:{region:{}},setup(u,{expose:e}){const t=u,{widgets:l,widgetsRef:n}=_e(t.region),i=Ie(l.value.map(r=>({name:r.name,command:r.name,label:r.label,closable:!!r.closable,checked:!1}))),o=S(()=>i.filter(r=>!r.closable||r.checked)),s=_(o.value[0]?.name);return e({currentTab:s,widgets:l,widgetsRef:n}),(r,m)=>(c(),y(a(qe),{class:"v-workspace-region",items:o.value,modelValue:s.value,"onUpdate:modelValue":m[0]||(m[0]=d=>s.value=d)},{default:b(()=>[(c(!0),j(F,null,W(a(l),d=>(c(),y(Xt,{key:d.name},[s.value===d.name?(c(),y(a(Se),{key:0,ref_for:!0,ref_key:"widgetsRef",ref:n,region:r.region,widget:d},null,8,["region","widget"])):x("",!0)],1024))),128))]),_:1},8,["items","modelValue"]))}}),Dt={EmptyRegion:go,Brand:fo,Toolbar:yo,Actions:ko,Apps:Eo,Workspace:jo,Settings:Do,Status:Ro,Preview:Po};class Mo extends Rl{publish(e){return me.warning({title:"提示",message:"在线演示版本不支持发布功能，如需体验请下载本地版本。"}),Promise.resolve(!1)}publishFile(e,t){return me.warning({title:"提示",message:"在线演示版本不支持发布功能，如需体验请下载本地版本。"}),Promise.resolve(!1)}genVueContent(e,t){return me.warning({title:"提示",message:"在线演示版本不支持源码生成功能，如需体验请下载本地版本。"}),Promise.resolve("")}async createRawPage(e){return me.warning({title:"提示",message:"在线演示版本不支持源码模式页面，如需体验请下载本地版本。"}),Promise.resolve(!1)}async removeRawPage(e){return me.warning({title:"提示",message:"在线演示版本不支持源码模式页面，如需体验请下载本地版本。"}),Promise.resolve(!1)}}export{Mo as L,Oo as M,No as O,To as P,Jo as a,ia as u};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./Editor-ctkAn2cu-j1FUryYs.js","./monaco-editor-a3IpPo1Q.js","./monaco-editor-cf__QvdG.css","./@vue-lwVaHA3a.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
