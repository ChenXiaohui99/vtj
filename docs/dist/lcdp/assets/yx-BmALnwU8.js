import"./index-DOjeZZeJ.js";import{d as Z,r as k,a1 as M,j as q,o as b,c as N,a as v,_ as s,U as i,u as a,Y as h,Z as S,S as T,F as G,a9 as P,X as $,af as f,bo as Q,bm as W,at as ee}from"./@vue-DbHY7CtS.js";import{b as U,c as te,d as J,e as I,f as g,g as ne,h as ae,i as le,j as oe,k as O,a as w}from"./element-plus-BsffbOUp.js";import{_ as se}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./lodash-es-DKmLY3Gz.js";import"./@vueuse-DrUKsxYo.js";import"./@element-plus-mH6lrfSY.js";import"./@popperjs-CsO2-mKt.js";import"./@ctrl-r5W6hzzQ.js";import"./dayjs-Bz4m6kJv.js";import"./@ckeditor-Cpj98o6Y.js";import"./async-validator-BKXt4Vjq.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./@floating-ui-o_LpjUj1.js";const A=y=>(Q("data-v-0e24bbbd"),y=y(),W(),y),re={class:"volunteer"},ie={class:"content"},ue=A(()=>v("h3",null,"广州越秀区小升初志愿录取测算",-1)),de={class:"base"},ce={key:0,class:"result"},me={key:1,class:"logs"},pe=A(()=>v("h4",null,"派位过程：",-1)),he=["innerHTML"],fe={class:"op"},ge=Z({__name:"Volunteer",setup(y){const j=()=>Math.ceil(Math.random()*899999999+1e8),B=JSON.parse(localStorage.getItem("schools")||"null"),R=JSON.parse(localStorage.getItem("myVolunteer")||"{}"),_=k(Number.parseInt(localStorage.getItem("studentTotal")??"2000")),x=j(),c=k([]),m=k(),d=M(B||[{index:0,name:"第七中学",hot:1,percentage:4.27},{index:1,name:"第十中学",hot:1,percentage:29.3},{index:2,name:"十三中学",hot:1,percentage:8.37},{index:3,name:"十六中学",hot:1,percentage:12.09},{index:4,name:"十六中东华",hot:1,percentage:20.9},{index:5,name:"培正中学",hot:1,percentage:8.83},{index:6,name:"七中东山",hot:1,percentage:2.32},{index:7,name:"省实中学",hot:1,percentage:7.44},{index:8,name:"执信本部",hot:1,percentage:2.32},{index:9,name:"铁一中学",hot:1,percentage:4.09}]);let p={};const u=M(R||{}),E=q(()=>Object.values(f(u)).sort().map(t=>{const n=Object.entries(f(u)).find(l=>l[1]===t);return Number.parseInt(n?.[0])})),C=k(Symbol()),F=(o,t)=>{Object.values(u).map(l=>Number.parseInt(l)).filter(l=>l===Number.parseInt(t)).length>1?(w.warning({message:"该志愿次序已填报，请更换"}),u[o]=void 0):u[o]=t},z=()=>{const o=f(d).slice(0);return o.sort((t,e)=>e.hot*Math.random()-t.hot*Math.random()),o.map(t=>t.index)},L=()=>{if(localStorage.setItem("studentTotal",_.value.toString()),localStorage.setItem("schools",JSON.stringify(f(d))),localStorage.setItem("myVolunteer",JSON.stringify(f(u))),!(Object.keys(u).length===d.length)){w.warning({message:"请先填报志愿"});return}p={},p[x]=f(E.value);for(let t=0;t<_.value-1;t++)p[j()]=z();m.value=null,C.value=Symbol()},H=o=>{const t=E.value.every(l=>l>=0),e=u[o];return!t||e===void 0?null:Object.values(p).filter(l=>l[e]===o).length},D=o=>{const t=u[o];return t===void 0?null:Object.entries(p).filter(([l,r])=>r[t]===o).map(l=>l[0]).sort((l,r)=>Number.parseInt(r)-Number.parseInt(l)).findIndex(l=>l.toString()==x.toString())+1},K=(o,t)=>Object.entries(p).filter(([e,n])=>n[t]===o).map(e=>e[0]).sort((e,n)=>Number.parseInt(n)-Number.parseInt(e)),X=()=>{if(Object.keys(p).length===0){w.warning({message:"请先提交志愿"});return}const o=[],t={};for(const e of d)t[e.index]={school:f(e),picked:0,total:Math.ceil(e.percentage*_.value/100),students:[]};c.value=[];for(let e=0;e<d.length;e++){c.value.push(`<dt>第${e+1}志愿开始招生</dt>`);for(const n of d){const l=K(n.index,e),r=t[n.index];if(r.picked>=r.total){c.value.push(`<dd>${n.name} 已招生满员</dd>`);continue}for(let V of l)if(!o.includes(V)){if(r.picked>=r.total)break;o.push(V),r.students.push(V),V===x.toString()&&c.value.push(`<dd class="current">您被${n.name}录取</dd>`),++r.picked}r.picked<r.total?c.value.push(`<dd>${n.name} 选生源${r.picked}人, 剩余名额${r.total-r.picked}人</dd>`):c.value.push(`<dd>${n.name} 满员生源${r.picked}人</dd>`)}}for(const e of Object.values(t))if(e.students.includes(x.toString())){console.log(e),m.value=e;break}},Y=()=>{m.value=null,localStorage.removeItem("myVolunteer"),location.reload()};return(o,t)=>(b(),N("div",re,[v("div",ie,[ue,v("div",de,[s(a(J),{"label-position":"right",inline:"","label-width":"80px"},{default:i(()=>[s(a(U),{label:"随机号"},{default:i(()=>[s(a(te),{class:"randomNo",type:"success",size:"large"},{default:i(()=>[h(S(a(x)),1)]),_:1})]),_:1})]),_:1}),s(a(J),{"label-position":"right",inline:"","label-width":"80px"},{default:i(()=>[s(a(U),{label:"学生人数"},{default:i(()=>[s(a(I),{precision:0,controls:!1,min:1,max:99999,modelValue:_.value,"onUpdate:modelValue":t[0]||(t[0]=e=>_.value=e)},null,8,["modelValue"])]),_:1})]),_:1})]),(b(),T(a(le),{border:"",stripe:"",data:d,key:C.value},{default:i(()=>[s(a(g),{type:"index",label:"#",fixed:"",width:"50px"}),s(a(g),{label:"学校",prop:"name",fixed:"","min-width":"100px"}),s(a(g),{label:"热度权重",prop:"hot","min-width":"150px"},{default:i(({row:e})=>[s(a(I),{precision:0,step:1,"step-strictly":"",size:"small",min:1,max:100,modelValue:e.hot,"onUpdate:modelValue":n=>e.hot=n},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),s(a(g),{label:"录取比例(%)","min-width":"150px"},{default:i(({row:e})=>[s(a(I),{precision:2,step:.01,"step-strictly":"",size:"small",min:0,max:100,modelValue:e.percentage,"onUpdate:modelValue":n=>e.percentage=n},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),s(a(g),{label:"填报志愿","min-width":"150px"},{default:i(({row:e})=>[s(a(ne),{placeholder:"选择志愿次序",modelValue:u[e.index],"onUpdate:modelValue":n=>u[e.index]=n,onChange:n=>F(e.index,n)},{default:i(()=>[(b(!0),N(G,null,P(d,(n,l)=>(b(),T(a(ae),{key:l,value:l,label:`第${l+1}志愿`},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),s(a(g),{label:"志愿人数","min-width":"100px"},{default:i(({row:e})=>[h(S(H(e.index)||"待提交志愿"),1)]),_:1}),s(a(g),{label:"你的排位","min-width":"100px"},{default:i(({row:e})=>[h(S(D(e.index)||"待提交志愿"),1)]),_:1})]),_:1},8,["data"])),m.value?(b(),N("div",ce,[s(a(oe),{type:"success",title:"录取结果",closable:!1},{default:i(()=>[h(" 您已被【 "+S(m.value.school.name)+" 】录取, 计划招生 "+S(m.value.total)+" 人。 ",1)]),_:1})])):$("",!0),m.value?(b(),N("div",me,[pe,v("dl",{innerHTML:c.value.join("")},null,8,he)])):$("",!0)]),v("div",fe,[s(a(O),{type:"primary",onClick:L},{default:i(()=>[h("提交志愿")]),_:1}),s(a(O),{type:"warning",onClick:X},{default:i(()=>[h("派位录取")]),_:1}),s(a(O),{onClick:Y},{default:i(()=>[h("重置")]),_:1})])]))}}),be=se(ge,[["__scopeId","data-v-0e24bbbd"]]),ve=ee(be);ve.mount("#app");
